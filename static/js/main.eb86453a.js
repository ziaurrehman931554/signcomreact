/*! For license information please see main.eb86453a.js.LICENSE.txt */
(()=>{var e={111:(e,t,n)=>{"use strict";n.a(e,(async(e,r)=>{try{n.d(t,{A:()=>p});var i=n(216),o=n(475),a=n(172),s=n(564),A=n(158),c=(n(50),n(43)),l=n(579),d=e([s]);function h(){const e=(0,i.Zp)(),t=(0,A.iw)(A.Ay.createClient({codec:"vp8",mode:"rtc"})),[n,r]=(0,c.useState)("");return(0,l.jsx)(o.Kd,{basename:"/signcomreact",children:(0,l.jsx)("div",{className:"main-container",style:{height:window.innerHeight},children:(0,l.jsx)("div",{className:"app-container",children:(0,l.jsxs)(i.BV,{children:[(0,l.jsx)(i.qh,{path:"/",element:(0,l.jsx)(a.$,{connectToVideo:(t,n)=>{console.log("==========================Received option: ",n),r(n),e("/via/".concat(t))}})}),(0,l.jsx)(i.qh,{path:"/via/:channelName",element:(0,l.jsx)(A.jI,{client:t,children:(0,l.jsx)(s.q,{option:n})})})]})})})})}s=(d.then?(await d)():d)[0];const p=h;r()}catch(u){r(u)}}))},172:(e,t,n)=>{"use strict";n.d(t,{$:()=>a});var r=n(43);const i=n.p+"static/media/join.3f4ff8737f20bd1c7c9b.png";var o=n(579);const a=e=>{let{connectToVideo:t}=e;const[n,a]=(0,r.useState)(""),[s,A]=(0,r.useState)(""),[c,l]=(0,r.useState)(""),[d,u]=(0,r.useState)(""),[h,p]=(0,r.useState)(!1),[f,E]=(0,r.useState)(""),[g,m]=(0,r.useState)(!1),_=(e,t)=>{e.preventDefault();if(""===n.trim())return u("\u26a0\ufe0f Channel name can't be empty."),a(""),m(!0),void setTimeout((()=>m(!1)),3e3);p(!0)},C=e=>{E(e),p(!1),console.log("==================================calling for video component: ",f),t(n,e)};return(0,o.jsxs)("div",{className:"form-container",children:[(0,o.jsxs)("div",{className:"form-card",children:[(0,o.jsxs)("div",{className:"form-section",children:[(0,o.jsx)("h2",{className:"title",children:"Join using Channel ID"}),(0,o.jsx)("div",{className:"circle",children:(0,o.jsx)("img",{src:i,alt:"Join"})}),(0,o.jsxs)("form",{onSubmit:e=>_(e),children:[(0,o.jsx)("input",{id:"joinChannel",type:"text",placeholder:"Enter Existing Channel ID",value:c,className:"input",onChange:e=>{l(e.target.value),A(""),a(e.target.value),u("")}}),(0,o.jsx)("button",{className:"button",type:"submit",children:"Join"})]})]}),(0,o.jsx)("div",{className:"divider-container",children:(0,o.jsx)("div",{className:"divider"})}),(0,o.jsxs)("div",{className:"form-section",children:[(0,o.jsx)("h2",{className:"title",children:"Generate New Channel"}),(0,o.jsx)("div",{className:"circle",children:(0,o.jsx)("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQkAAADwCAYAAAATgpEBAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAACXsSURBVHhe7Z0JfFVnnffPdu/Nzc0KSQgJIRC2shRKgbZCS6mttdtMbbVatdqpHTs64+j7cfw4Or4f3zrOaPUdl3fU17W1jmOndnmxlmnR7tBKKS1b2SHshAAhhGx3Odv7/z3nBkIrByiQ3Hvz+4Yn55znPGch5/n/zv9Zj+77vkYIOWN0CUPCeIzskpB8BcY6GAyZtytFguQ7dIXPMxQJcj4YrLc7OQ9QJMj5gG/30yfnBZUiQcjgkvOCSpEghIRCkSCEhEKRICT3GdR6C4oEIbnPoNZbnEwk+isXm7MIGcKcTCT6KxebswgZwrC4QQgJhSJBCAmFIkEICYUiQQgJhSJBCAmFIkEICYUiQQgJhSJBCAmFIkEICYUiQQgJhSJBCAmFIkEICYUiQQgJhSJBCAmFIkEICYUiQQgJhSJBCAmFIkHIwJC300BSJAgZGPJ2GkiKBMk1OPFyjkGRILkGJ17OMSgShJBQKBKEkFAoEgMPy9wkr6BIDDwsc5O8giJBCAmFIkEICYUiQUjhcU7rvSgShBQe57TeiyJBCAmFIkEICeV0RILt+uR8wzz2dnLmb6L7PpvtCSEnh8UNQkgoFAlCcpOcKW5QJAjJTXKmHoAiQQgJhSJBCAmFInFuYVMeKTgoEucWtieHQxHNQygSZCChiOYhFAlCSCgUCUJIKBQJQkgoFAlCSCgUCUJIKBQJQkgoFAlCSCgUCUKGJqfdsY0iQfrDHpFDh9Pu2EaRIP1hj0jyNigShJBQKBKEkFAoEoScPQVdl0ORIOTsKei6HIoEISQUigQhJBSKBCEkFIoEISQUigQhJBSKBCEkFIoEISQUigQhJBSKBCEkFIoEISQUigQhJBTd9zmFwBAGLwkMTurLBFgyQ5AToEgMHSzP8+o7unsu3tmyf8aB9iMjvXhJeW+vHYlEdT+hx9LVlUVtiVhke31V1cp4LLpe1/X27LFkCEORKHwSR7t7rly+buON29o7puxq2V+7t6V1+OGjR+M9vcmI47iGZuhaJGa5pYnSdO2wyq4x9SMPjR0xYs+FDSNXTGka82TEstbKeZhRzpz+XlreQpEoXIp6kqm5q7Zvv2vx8tUXrdq8eXTbobYS13EM33U1yzQliR+UL7KzIQQ5QdcMw/JLYgmnoW5E+6XTp229Zvb0l5pG1jwox2xTSciQgiJReOCZ1qzbvuOvf7/sjQ88u+zViZ2dncWGrmOHZsjjNnT5haUkxtN/q0joEmFI8DxZL4q5oxrq2m+64rLl18+56NdVFeWPSyJXJSVDAopEYWG6nte0dN2WLz/wxBPXbW7eXisPWLdMQ/MdV/MkmBALKIUHOQg4USik9CERhgiEYRiaLeuuZWjRkrL0/DkXbb7rhmt+3TSi+seStCc4ghQ6FInCwXRcb/zTb6z52i8W/v76gy37y3TPCQrF8ox9TwTCEMOXGM+XeL2v9VtSIAscUwxJoURC5EKKJLaoiS3H27qpmfG4e9nMGbs+dfP1D04ZVfcdSd0bHEQKmaHWT6LPFAoN3fP9US+s2fCVn/72/924b+feMt0VIRDPAcaO2ofgQYtYKDdBPAtRAngP6hXx1r8K4iWdr8vxsm5K2oiIheFkzBVr1zb+4PEn7tpxsO1vJaUVHEAKmaEmEgXpNomnMGxzy4G7v/+bR24+0nakJCaWbYmnoEvRAmCpS5wv1u+KV4DgyTqCL/sQHwSIh8TjMFEWFz+ereowoqaksNOa29Ntrlm3fvTPnvjvv2rv6r5ZXYAUNENNJAqRos7e3su++/BjH29raytzMmnNEk/Bc0UCIA4wes8TY89uw4sQQehzH7DuHROKYBttHq5IiOPLMSbERgTDceS8uhaTIoiXTJnLV64Zt+iVZXe7rtukTkQKFopEniNexIgnl7/xt+vXbWzQfUeeqK85unesOCFryvh13ZS0iIBwoN5Bltn6B4TjeBIkHdLiGIiIWg/ExYfYyFq6tzf29Cuvzdmyd/8nggNIoUKRyG+Ku5KpeY8+9ccrPNsW90EkwfBEB0QY5MkGnoGQ9SgUEoHmzVPZtRyhfiAJytMwxIOQeFSC4kjPsfV9LS0Vi5e/fq3julPVQaQgoUjkMeLqD//ja6s/eOBAW4lsiEcgCuAFRnxKTvAe3g4EIeDtghJsiTeRyVjL1q4fu2nXnltUFClIKBL5i5Vx3MaHn3lhrrzddfRpUB2mJKAO4pSclpKcSFBEwVIyjiqyaFpL64GyVzduuVzuoSKbjBQYFIk8RYyy+EhvcsbO3buHo7MUOknhYUIofP9cdIiEihzPHkG9ReClIKjrScikU9a2ltZRKdtmkaNAoUjkLyXrd++dLS93eYa+6iyFhk30a4AVB0Z9NuBEJ8eXYg0qMVELuu9g27DWw0dmZneRAoMikadIkaJo9bbtE6WQgcoJWC0iZQ/e9mEGHm78p0TURzWS4nqCFDq0I52d8d2treNUBCk4KBJ5iq7rkR0tLdW6GC1aHFAnId6/Ml4sT87ZuRiqclTOgaIGGkWx3tvdG+1O2rXYjTSksKBI5CnyPrc6OjoTKGaoTlJKGVAfAaEI0oQBYTnTIL+yy0ANVP2HLDO2bXQl3RJZpUgUIBSJ/AQD84xkKhlRxQwYriAmrJbnG1wHHkufcHi+pyfTmUh2NykwKBL5ijgPadcTBwLeQ1Yc/ODNrlYlLiycLR7Oo9Zk6fm647rMSwUKH2yeorpYi6GiLiLYPm60AwFKN8fKFliJBBWZpPCgSOQpuhQ4olHT7TNVJQ3yS4nHAFQNBHUgAYap+0Y04mQ3SYGRyyJx/nN6HqP7uldekkhjtCdKD6oEIYYbNH9KseM8/PVwib7zwnPBSFEMINNMw6ssiqURHewlhUQuiwQz3MkRG3Uzo2trj8BYMapTiQTEQT3Sd6YQ2VOcElXSwVJdW9eKopYb07UORKkEpKBgcSNPEeNMXzC6cY+P/hFqzoegGRQygb4M/XtcHnv7n2KpBOIkZh6k6av36NvWVZ1ISVxNxb9H7SAFB0UiTxHj7J3WNGa9I15EGiNALVOEwdMsx9Ei6DsBg0ZHKzFm9dY/k6WEQDGCDRUvQQ1Blyi0bLiOJ/dgaZ5Ejhhe2d04svZNHEXyBvWUTweKRJ4iXkPP6OrhK4visbRmmporAoFBV1EJfcPGg96Rx3PD6S6BHK0CYgPx8ALxkA1MYBOxYprn+pqlm/6o6prDlSWJNTiO5A1B5jgNKBL5S7o0VrR5/iVzmjHm0/Xk7R4MuNL6hnEbvqGZskRQ89+qIPv/bDiepq+oItEKZBLEm3J6nBPjNXAdJCstL03Onz71TdMwdqvEpOCgSOQvnmloLXe8Z8GT4v57hhXRMIF+WoRCNyOyljV8GLYy7mzA9zT+XMju7xOIoGiBCDmfLCAQfWKDGWlcV4obkYjfNKqhbcb4MYskNqUOJAUHRSKPkSJHx6S6EYsum3nRbhvbkajm6pbmSDEDs173R9k7DLxv5YSgGjKP+Z/BEr+D+SxNFGVkM/AkJLn8aIahFRUn0tfMuWRNRUnJ8+oQUpAMlkicmIPJO8WOmuam/3H7rb/SrYidQUwkotmY6wHmLX/ltwYY/7EfJQ74CRCHQgU8HexDWrStIirwMlTBI5jz0rT8qZPG77v6kqm/lE1+fbyAGSyR6MuX5CwRb+JIU/Wwxz912/tedA0RCN3UXEx7L5bbZ/RB8I+FoNUDFZHBpLknxmMdHkQgDKivkEh5YPgmhyGeiq45hqmNrBt59KPXXrWwvDj+nCTl8yxgWNzIf9xYNLrtQ1dd/u/zL5m1JSPm7aG14wSBOC4Sx34gENllELAepAFBsQLZQw5W3oMh4qBrthQzEuVlydtvvOalSyZP+JmIVJc6gBQs+SISyKnk5KQS0cjSr9xx2zdnTZ+6WwmFRLpi6OprXaij6GsOVXaPvbIQr0D+SWrZh/1STEHQESAMcgL1jQ5LPBRJn5bY4mEVqdv/8r2v3HzZnPtMw2hWJyL9Gci8OiDXwrwE2VWS5+BZVh7q7n3fN379yJdeWf7aBMO1xfY99aFgTJZr2xnNd10MyJLEWYEQEcjKh/zr987Ah3tEKBzHlVVJI95JrLQ4+cnbbnnhtnmXfjMejSyXVNAOcnbA0HPaCCkShQWeZ3lnOv3ux59f+qmHfvfUgiNdnRF8y1MVHyQ7WhAIFDTU+FFEZkVCfsGRCFZR6Yl4OQAf5dF1b/z4pkOf/fAtj81qanwgalnoXUmBGCJQJAoPvJnirudN3bJ3/80/fPh3d6xYu7bBNMWVEK/Cc2xNdCKYhyL77PFbdqml+hygCIQtG1Ys6hfHi5M3XTVv9Uffs+CB6tLE84ah75JkQXkl98j5t3I+QpEoXEzP82qStnPR5r37r33s2ZeuXbpq1dhUMhUTcTBg5qjAhF+hvjiOFgzJCih+mJGIW11Z0XnDu+euvf7SWYvqKspeipjm5mwlJTPMEIMiUfhExKuotV1tzNFk78QdrQdnrG3eMXXTzj11LQcOVnT3JCOGZfnDyspSY0eNbJsypnH35Mb6dfVVw9YmotZWEYddaGaV8+Sq90DOMxSJoYMpAcWQSk/Xh3muW+L5WpE4BtnaSt01DT1l6nqnoRuH9WB+CHS1ZgYZ4lAkhiYou/df9gcZgpmCHIMiQc4XEKD+AfRltj4hYubLAygS5FxiSH6qTGYyU7vTmSn7u7tHt7d3DE+n0zHf86zieFF3SVFxd2Vx6ZHqysTGeDSy0TLNHXIcR5AOLhDxkwoBRYKcC+LJdOaizbv2vGdD64FZW3e3jNq7v3V4R+fRRHdPbyyTckzX94ziWMQuihU7pfF4unZEdUdjfe2BpvoR26c11C2tqxr+rGEYnAIvB6FIkLMhmrGdCzfv3X/Hk6+ueNfaTdvGtB5qq0wmkxHPzujorIWhIH1ljWDd0DCMXTctzTcNt7SsNDWxqaH10kkTN14yedwLExpGPSJisTd7CMkBKBLknYB8M2Lbnn0fefr1Ne97ccXKaQf3Hyx3XMfAl80NXwISKQ82KxGSz5DXIBSuxCPbobs3Rqta0agfjxfZ4xpHHbjp8rl/WnDxhQ+UJYoxRwW/5ZEDUCTImWLZrjtp2YZtn3to0TPXrd2wYaTueRbaV13XVpKAsSKSsZQoKGSBDlvBgDJJIUqhprORVSRxXF/N0QmxqKysTF4xZ9aG9189/9HxI2t+Ikd3BichgwVFgpwJESleTF+47LWv/tfvF1/Z1tpWbjrysld9ul3NjIj/ICJgSxyKFdCDQCHUbyUaGHCGLXT9NkxDTYOHuSpMkRlkRUzTGSmKu9OmXLDnnltuenhG0+jvirAcwpnI4ECRIKeLZTvu5N8tf/1rP/nNY9f1HO2MW66rRcQdwFAwx3ek+CB5CUUIZfZ9BQ6IBH5DIJQ8qG3lUQjoDt7nYbgOPgUggmFGISLe+AkTWj/7kVt/M3Nc4zdlP3p9kkEg29uOFAB4ljER/VrP90dmt88Vuut5DYtXr/nHnzz6+LVd3Z1xE16B5/lG1NI8y9BEIjRHruiKN5ERmcCkN754CqhzwJybaqoKicOHhNTIU4lXo0yzXoaHCXwlzpAAr0T3XGPrtq21P37sydu3tBz4tCSJqjshA4557733ZldJHiIWpRXjDX+4N3nDquYdd7+0bsPHW9qPXl5fNawzYppoUoQNni3Dmg8euvPr9//qrva2tjLNseEMaJZl6Y54E7YYuB+1fN0yHVvXTAwvx0gP8Q9UXQO8A0PiUAeRLYO87a4Qa6hdOEoJkCQ19EOdXSXtyfTIOZMn7imKWFskwbn4//SRvRkSBosb+QkGbY0+2H7k8o37Wq5cv33HxK079o5s3r2nqqOzM15aWpq6dt7lb77/qnkLG6oqHpW3c59YvJOHHUtm7AX/9PNffm/J8tcuiMrr3sukxaAt2SUegWH6o+vrjnzgxvf8aUxtzY6FL7/87qdefGVqkbgNlrgPHkQCk96gGOK5ql7CkG3lOQTnVwTr8hvFj+xtenKMo5tatKw0+anbbn3m9ivf9Tk5dqfaSQYMikR+kehNpefsPnT4+pfXbJy9duuWMdu276zpPNpRLKJhiIsefJjHjGhmNGFfMHFc64I5M1fNmz75hfphZU+JWMDA0Kx42iM6pUTRsGjF6v99309/dquIQ8TEoZJlPMw7YVj+pHHj93/pE3fcP75uxEIx4J5DXd0Lbv/qN7+TbGsvESVDDlO2DxFApaUv92halvIUcJ7+QhGAUhI+IagpD8WBF1IU98eOGXvw3k/e8YOJdbX3SQJ8j4gMECxu5D6wo7KO7p5r//Tmjn94ZMnSO3/7h+evelHe6nv37B2e6e2J6p4n73Vf/Hz0Q/A0T4wzY2fMloMHy1Zv2jR2w46d01s6uub22u6lRZFojWXqMREM+acmu+wTjD/3toh3pTJXfO3n//H3vV1Hyww3g3ZONWENrlhVU9X96ds/8OTsCWO/K57Cdjnh0eJotL2utrZmyRsrp3p2RkoZUvRA/YXcl/ryl1xGVWpKXH+BCLYgEMDTXHzPNDvNnlxP7+pOxeLFiaJZk5qWynU4hf8AQk8it0mIOFz16pZtH3r+jTUXr1q/sfHIofZi3XV0S2zKQh0g3ur49qeswHhVK4EYlpr+Xk6Ap4vB4EYs6lZXVPQ2NtS31VdXtdUMr+qoKCvttKxIb1NtzdZpDXXfkqTq0x1ZkDdGPbNq3df/5/d/+LGY5xi6ndJg9GiDcK0i75LZFzf/y9984vMlschiSd/3di/qyTjzP//9H/9i5cpVoyLiNcD0fdfRTLk/VdcQpDsG6iogHX34OBUqL9G3QrOkyCL/F3gtE8e3fv3v7r5v9PCKH6hkZECgJ5GbxFIZe/ba7bu++NNFi+9+/Jnn527atKXOSaaiMbEbuPwRSWRmzU0ZEwxQAmbHdrJfFY9FLFEQW/PtjCZegNHT3RXbt7elcuv2nSPfWL9hzIr1Wyasa97ZeOGkCa1NI6qeklP1eRXAtD1/wnceeeIfDhzcP8xIpTRLDDdiBl8IcyMxb/b06TsXzJjyIxEmzD3RZ7RexDR6mhrqoy+uXHlJMpWy8MVzX7wb0a0sKIbIAuKAVg61DAK+6wG9wGS9LoRFPBaJQV2Gnsw4kdqRtf7UxvonJIpzbA4Qx+Wb5AJ4e1c379t/zw9/t+h7//zzBz787JKXpx493F4cFcM0xWh8x5aHBvfd1RzXVq0HMDS8xm1Zd0UwUOZH5aCDb3qJYERkPSJpLNkPQzdc8QoyjpXq6YpWlpZkxo2s2SSHw8hhj30Ud/Qmp27esavGzdhoyUBrw7GPEgNxYMBb3+iw9cMT6kf+fv7sizc54uGg6dNFEaLPa0VLhyyCDwhhWl4IhQiPhOB7IJJe0mK+TdyS74mfIQfYyWR0zaYtY23HnYjTkIGBIpE7RDKOc9Hilev+7b6HHv3CI08tvqSlpaXcQGWkGLaHIKaGH0fWYHyuPD18bcuVfdir3tAQDSUisiW/4MZDRIJYpIfBYpp8teUPLy/vGl5aApHoj4iVVrL74OFp3T09cYgDzo6P82RwHtk2XE/v7DyayDjemOCQY+DEtqkbRyoryrs0KRd5niPeDe5NMhxm35ZVFCF8H/UVyIIoVhhIqoTMkPSIQUcrHIT6DHhGjuvqh9qOVHQkkxeqg8jpcNZ/J4pEblDUnUwu+M/nXvr2jx56+NZVq1eP1u2Maag3KCojxbqUwQti8FgGbjrWg23RDAliWhLw5sUheLyBQKCeAq58IBJqW/ZiWRSLZmKW2ao2lRkr8E2vxJvbd01zbVt1cECTiANPAoKBpesae/btr9rX1n6F7HprPirqTqemLVm5eqI6q9xPPBKVG0DrBnbL9XGPsobgybqcT4okIogSY+H/JXEAv+VycoQc7tj6oc7Okn3tnVNlk3n39Oh7pu8Y/qEHn1h3KjXvp4v+8M/3P7Zw/v59+0qi4mabnryt5U1r+OLmHwuR0wg4Bo81cOUDQwzEBMYefPQXJgfLM7R4LOqYhoFBVMp8s8gBfmzr7t31KK6gUjQrUeow1ZQpKtTadrD82eWrrhYjb1LHZJET1Ty1fOVdu3bsrTYznuq6rUnRCBWtrpuSc8g58YlydLWIyD3BhcA15BIQB+iDGuOBW5ZIVMYGV/e1nq7u2K4Dhxpl49j1yPkFOYYMHqaUryf95oVX/unRP74w206lo6g70FULAH4CSzjT0Pcb5hp4GH37sufMehy6YfqxaNQ2jk+VjxAkERNuaWsrRQZB/QaAWGAvBANxPb2pyLPLVkzbtLf1TtmNutQAT4vubT00Al2oLN2S4gPiIAKOZqniBzpuSxHETWu2BDR3wkOSk8oS9RDYlPvDteBByWX7xCLjpK32o0fLkUQlJOcdisQgInm/ovlg2/sefOKpeZlU0rIkIgIDxLtYd+TFj2CfYcAxQWFCjbeSNZxPrasAD0XP7jO0IhEJsbbe4HaOIzZpdHX2xIKP/UFcZDcMN9irDNix0/r+tkMVv/3j0r/oSqavkx1qt+w78PHrr/nF+MbRB3304BDjh6io7wP5robhG/iSmIFCjWxj4PhxMcAZgmwZXDXYFyAC42hSEktzHMcAQpEYPHTP94f/btny63pTyZjuOppnZ9S89+g5CeNApeQ7CRAJtBbAHwi+GB5cECAaYAEj9Dz1HfHg9d0PHGKZptyi7M0GZBa1nb0GXvxpEbfla9aMf2Lp8r9xPX8yDhWR6K4pL1l072fu/j8VVRVdUKEM6h3URfF9UblP9MaUG7NMSwXVhCv74UPB8QiKSIEYwYNRRQ5JIKLiRyyTk9EMIBSJwQMiUbxm6/ZG1VVZjADjG0xlg/2KCe8gwMDQnIgWEEeMDOvHgrgQqvIyG5+yXVOMrzh7T0DOIIitVpWXJ7GpKhHFQJWhZk0YSxNFB9fW2jsOF/128XNzl7y58YtyrgYkkNMfbKqt+q9vf+EzP6ysqe10IlHNixT5vbacJxqXY+Oe55uaKzcoOiWXg7chWhWoAq6vRAHXxPX64gzd9MoTxXJfZKCgSAwuflHEysAYTNU0KKaH1ymq8+XRoKnxnSxhTbBST1ZVvwMRA3gWKqgflUSCr6XtTEQuWZqN6cMX48w01o1oM00TDSSyM+jNidvD8RishTW5qhRdPL3t8KHyHz+y8MZlW5r/UfaPQBJD1/dMa6j7+Q+/+NlvTpo8ubXb1fXiiuGZ+Zddvvm+L3zhgU9+8PYXKiurk46IhOr+lRUCXESOlZUANJkiHtdPJGJ2zbBhByRG/TfI+Yc9LgcRyffFGdebvnTVm5PRMwlzNKh401QeQGD0WeM5g2XwD8YblCNUHYTEqPoItabe25ohxllfV9u+YOaFz5qGsU+S9je8RGcyNXPJG2un+o5tYEwIbgd9MtBvAlc4fjYxZNfVu7q7ipr3H2wc21BfWltZ8brE94phd1aWJJrnXzR998i6UebHbrzuv2+7at6/j62tWTRjQtOfrrhk1p5DXd0NLQcPl8ptilIGRS20lUI41UAwHa2wqvnVrx81quOW+XMXVZQUL5PLUigGAIrEICIGZNcOH6Y9s3Ltu3t6eotg1HCrlXcvRhGYH36f2RL0xUAgjv/IOeFiyDUw1Bt7a6qqOufOnLYqHo2sl0P6jE4S61HDtBqeeOnl+XYmbVqmCIJogydJglPgfPBbZImjROCwp6PzaPGmfa1jG0fXl4+sqFgtaXoQErHojsmj616vqyxbErXM9XL4YdPQWysT8Y1XzLxw9cxpUzq37Nwz9nDHkSK5jGpPwVgU6CYcCc2wVF+NiU1NrX8xd/avYxFrK6LJ+YciMbg48Uj0yEUXTPReWb/pwu5UqshxPbEHmB7K4wjKps8gwL7FzPqCmDGWEJ2+4ggKCaggFCv0y8rKU1MmjGkdUVH2guw8JhKyV4tGIomFLyz7yxQqVsVaMUDLdjLZ8+MfrtVPJCS4UvQ4fORIYuOufeNGj6qvrqusEEFQTaz4zughWUefjKBDN7RQ13ujprmnbljFxgVzLt7WevjI5N0t+ypxkzg3imCQDBRH9GjMmzNjavO7Z077QfY8ZACgSAwuKCH0VJeVbnvvZXO219fV+a5pRB15XceKYuni4ngqXlyciieKUyXFpclEcUkqUZpIJkpOI5SWJONFJaloSUk6lkikYvF4OlYSTxWVFKdKy8p6KyqGdVUMKz9aWprora2u6pxYX4sBXie0Ghjibhzs6r1s3dbtoyAtEAHHc9DqIWIgAoY0SiiQWv2SdTFq39c7jxwtXt+8a1xFRcXo0SNqdsBrkN1KTlTCE3Fh9OLNHO3JZGa8tmbNJMfxRMkCrwVehC0XGVFd033HDVf/obG6aiGOUUeS8w4GFGVXySCCz+OVOI5TL9ZSLeVw1Q8gsCgxH7yyYXpZmxEvQz00+QVfA6vHePt+cOwc6pyygl2u6euuH0xAcbQoFlsnu5RnnwWln6rmA2133/nVf73X6UlGPTulWRHIhQuPQTNFIlDPgYvA81GNqbKGYg3uwDAj/vCq6q4PXn/tKzfMnf2rytLiJyUBWiaQ8K1YGdedde/PfvnAc0uWTrZ0Q8dM2kY0qqU98SOsqDfv0jnb/vWvP/b5kmj0aUnf/17JeaRQRQIGka//sROt/u3boP//7VT7wZ9LA/rSnexvFYHh/q/7H35g8XMvTo4aaPbEuA1bFAA1GnKYyBbURAoGSsHgGuEHw9htG8Yd8YvKytLzLpnVfPOVl/9xxpiGX0dMA4LU57Xg2piJ+4KnV7zx1e8/+Jub0z29mEhH3bUtezGwLCae0RfuvOPpWy6bfY9EHw4OJQNBLhc3TpaxhxoworeG/pxqP/hzaRBOBZoxk02j6qznVqyc5zpORIIIAfwb8SDwhOQsWMCTwMrxZlZJE0G/B09PpZLW9p27qtY1b5vU1tV9sRWNT0sUFyXkDOUZ2x7b3t1702Mv/elz9z+26KqOjvY4ak500QhTijVp29ZixcXenBkzdt5z47Xfjlnm2uCqZKBgcYOcCtNx/Sm/ff7lb33/wf+8Xs0EgW9syI8yZsk/ainigOIGWj/QUQuehngHWsyKaJ4skc2sSFQzIpZTLUWQC5rGt1QNq+y27Yyxe/+B6jc3bK0XMVFzaOqer5kiQqisRIewUaNHt3/1njvvv2js6G/IqTHBDRlAKBLkdIh3p9PXfPn/Pvi9V19fOc4S80X/C8/FvA8iEqISGLWJ3pwQB7ScqMlpZIm+DujzoNbRwgLDR82sqIplBD04NEy36ckqjhGB0OUYfFC4O5PRyoYNT9/1/huWfPzqKz5jGgaaPZlhBxi8BAg5FalENPryV+76yL+NGzum1RZ7RlMtXjCYZg6Dt1AfoSa5QZOl7EOlpoURnWihENtXQ8BFBIIu6L4WRbOI52KGb8Nwbd2XYgwyI2bAQlNt2vW1RGmlff2V89780Px3fUsEoll2UyAGAXoS5HQxRASq97V3fPjLP7r/S1u2bRvhOxiQhuKG5CERAMxuDdAqgQoLzL0JDwJlDbWKdQFiAafBikRkFxwIT/YbskQ/C0klRZRINGHfeM0Va//+1uvuLY0XPSuHpdTBZMAZSJFADqEi5TeGGHL1/o7O93/9Vw99/rXVa8cZUuTAdP6oR0DRQxVD0Koq+UpVbKrHjgII/AQ8/kAo0MHLVh3HghGgmKlKlVsklCRKkx+64b2vffSay79RUhRbKqk5oGsQoSdBzhT06ajsTGWuenzpq/f87NGF81O9vbGYKIJv25qJ/hOmqbwINYMVqiNEJFR5RIoZEAegOmOZloYp9TBDNpwP0zS8aRMnHPj0B9736MxxjQ/FItZqSZpWB5BBgyJB3glwB4rTjje1ufXgDff/fvGHX16+aqwUPyKYmdu1M8qbUJWaIgpqyn/5QRxAXwpDihQppBMPw4xEvLqRI4/eevXlK266dNZ/DCtJLBWhwYAz9qrMASgS5GywPM+rSrnuhTtb2654csny659btnzK4fb2IilCGOoDO5IIAgGQ19D1MyiH6F4kFrUbGxs6PnD1lS/PnXLBM1WliWWWpSooe9QBJCegSJBzQUTEYrjt+009yXTT3sNHpjXv2z9uQ/PO8bta9w873NEV70kmo8PLyntrKit6xo2u3z99/NhNDSOqt1aXl24ssswdpmHsFQHBoC1myByDIkHOJai3jIlgVEjBosLz/XIJMclj6nMaUuxAD2vMZtdj6Hq7CEOXCANGiOJrXMyIOQpFgpwrUIbon5lUmSJYfRtIx4yXJ1AkCCGhsMclIeePk3lSeQVFgpDzR0G46RSJ/KUg3lIk96FI5C+sTCIDAkWCEBIKRSJ3YPGB5CQUidyBxQeSk1AkCCGhUCQIIaFQJAghoVAkCCGhUCQIIaFQJAghoVAkCBl48qpPDEWCkIEnr/rEUCQIIaFQJAghoVAkCCGhUCTeDgdaEdIPisTb4UArQvpBkSDk9BmSXiZFgpDTZ0h6mbksEqwbICQHyGWRYN0AITkAixuEkFAoEoSQUCgShJBQKBKEFcQkFIoEYQUxCYUiQQgJhSJBCAmFIkEICYUiQQgJhSJBCAmFIkEICYUiQQgJhSJBCAmFIkEICYUiQcjgkvPd4ikShAwuOd8tniJBCgkOVjsPUCRIIcHBaucBigQhJBSKBCEkFIoEISQUigQhJBSKBCEkFIoEISQUigQhJBSKBCEkFIoEISQUigQhJBSKBCEkFIoEISSUfBQJjvQjZADJR5HgSD9CBhAWNwghoVAkCCGhUCQIIaFQJAghoVAkCgO2+JDzBkWiMGCLDzlvUCQIIaFQJAghoVAkCCGhUCQICWfIVwpTJAgJZ8hXClMkCCGhUCQIIaFQJAghoVAkCCGhUCQIIaFQJAghoVAkch8O3iKDSn+RYGY8t5yrvycHb5FBpb9IMDOeW/j3JAUBixuEkBA07f8DtYxf0gFYtekAAAAASUVORK5CYII=",alt:"Generate"})}),(0,o.jsxs)("form",{onSubmit:e=>_(e),children:[(0,o.jsx)("input",{id:"generateChannel",type:"text",placeholder:"Enter New Channel ID",className:"input",value:s,onChange:e=>{A(e.target.value),l(""),a(e.target.value),u("")}}),(0,o.jsx)("button",{className:"button",type:"submit",children:"Generate"})]})]})]}),d&&g&&(0,o.jsxs)("div",{className:"error-message ".concat(g?"show":""),children:[" ",(0,o.jsx)("p",{style:{color:"black"},children:d})]}),h&&(0,o.jsx)("div",{className:"options-effect",style:{height:window.innerHeight,width:window.innerWidth},children:(0,o.jsxs)("div",{className:"options-container",children:[(0,o.jsx)("h3",{children:"Select an option:"}),(0,o.jsx)("button",{className:"option-button",onClick:()=>C("speech"),children:"Enable Speech Recognition"}),(0,o.jsx)("button",{className:"option-button",onClick:()=>C("gesture"),children:"Enable Gesture Detection"})]})}),(0,o.jsx)("div",{style:{padding:50}})]})}},564:(e,t,n)=>{"use strict";n.a(e,(async(e,r)=>{try{n.d(t,{q:()=>A});var i=n(43),o=(n(913),n(562)),a=n(579),s=e([o]);o=(s.then?(await s)():s)[0];const A=()=>{const[e,t]=(0,i.useState)("");return(0,a.jsx)("div",{children:(0,a.jsx)("div",{children:""!==e?(0,a.jsx)(o.u,{option:e}):(0,a.jsx)("div",{className:"options-effect",style:{height:window.innerHeight,width:window.innerWidth},children:(0,a.jsxs)("div",{className:"options-container",children:[(0,a.jsx)("h3",{children:"Select an option:"}),(0,a.jsx)("button",{className:"option-button",onClick:()=>t("speech"),children:"Enable Speech Recognition"}),(0,a.jsx)("button",{className:"option-button",onClick:()=>t("gesture"),children:"Enable Gesture Detection"})]})})})})};r()}catch(A){r(A)}}))},562:(e,t,n)=>{"use strict";n.a(e,(async(e,r)=>{try{n.d(t,{u:()=>h});var i=n(43),o=n(216),a=n(158),s=(n(913),n(239)),A=n.n(s),c=n(576),l=n(569),d=n(579),u=e([c]);c=(u.then?(await u)():u)[0];const h=e=>{let{option:t}=e;const{channelName:n}=(0,o.g)(),[r,s]=(0,i.useState)(!0),[u,h]=(0,i.useState)(!0),[p,f]=(0,i.useState)(!0),{localMicrophoneTrack:E}=(0,a.QG)(u),{localCameraTrack:g}=(0,a.hD)(p),m=(0,i.useRef)(null),_=(0,i.useRef)(null),[C,w]=(0,i.useState)("This is whee caption displays!"),[S,T]=(0,i.useState)(null),[v,y]=(0,i.useState)(!1),{transcript:I,resetTranscript:R}=(0,l.Vw)(),b=(0,o.Zp)(),O=e=>{w(e),console.log("===========================","updated caption: ",e)};(0,i.useEffect)((()=>{if("gesture"===t)return _.current=setInterval((()=>{B()}),1e3),()=>clearInterval(_.current)}),[g]),(0,i.useEffect)((()=>{if("gesture"===t){(async()=>{try{const e=await c.FilesetResolver.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm"),t=await c.GestureRecognizer.createFromOptions(e,{baseOptions:{modelAssetPath:"https://cvws.icloud-content.com/B/AfTB0ta39S9FrhRC0NKwLRe09idfAakwCDjuZAp8bpPMghZqAGDohNAn/gesture_recognizer.task?o=AiWR6nrGAiaL-_PFnK1UI7CdbEI5CIESDIJ5c-GXKkmN&v=1&x=3&a=CAogoEvtz2Jw0-O309SCssZOp3HgpDauEan0E8-aLJ9rPuESbxC7qpvfhzIYu4f34IcyIgEAUgS09idfWgTohNAnaidtOeKQl8Wzjk4G3urlRc2FhPN1S7DYbU-eP0kkT8lF5OAjlyyD9DlyJwiFz34dHGHpd0-Le06CslG-juTKfTOdcq6GxMHZycalA7CwN83Szw&e=1720069243&fl=&r=89cb38c0-9dde-4426-ae56-9b57e68cbeb2-1&k=smNDDkxlMymp0JCsjk2uHw&ckc=com.apple.clouddocs&ckz=com.apple.CloudDocs&p=157&s=N1jfzgDrVtHK39ros3ojRcTwBx0",delegate:"CPU"},runningMode:"IMAGE"});T(t),y(!0)}catch(e){console.error("Error initializing gesture recognizer:",e)}})()}}),[v]),(0,a.o9)({appid:"5d4f500c39834c95ae5a04635a3f0ab8",channel:n,token:null},r),(0,a.ZR)([E,g]);const B=()=>{const e=m.current;e&&A()(e).then((e=>{const t=e.toDataURL("image/png");v&&N(t)}))},N=async e=>{if(!S||!e)return void console.error("Gesture recognizer not loaded or image is null");const t=new Image;t.src=e,t.onload=async()=>{const e=await S.recognize(t);if(console.log("=========================================== results",e),e.gestures.length>0){const t=e.gestures[0][0].categoryName;O(t)}}},D=(0,a.iT)();return(0,i.useEffect)((()=>{if("speech"===t)return l.Ay.browserSupportsSpeechRecognition()?(l.Ay.startListening({continuous:!0}),console.log("========================listning started")):console.log("=======================speech recognition not supported"),()=>{l.Ay.stopListening(),R()}}),[]),(0,i.useEffect)((()=>{console.log("==================transcription changed",I),I&&"speech"===t&&O(I)}),[I]),t?(0,d.jsx)("div",{style:{height:window.innerHeight,width:window.innerWidth},children:(0,d.jsxs)("div",{className:"image-background",children:[(0,d.jsxs)("div",{className:"bottom-container",children:[(0,d.jsxs)("div",{className:"capNCam",children:[(0,d.jsx)("div",{className:"capContainer",children:(0,d.jsx)("p",{className:"cap",children:C})}),(0,d.jsx)("div",{className:"camContainer",children:(0,d.jsx)(a.Fd,{audioTrack:E,videoTrack:g,cameraOn:p,micOn:u,playAudio:!1,playVideo:p,className:""})})]}),(0,d.jsx)("div",{className:"ControlContainer",children:(0,d.jsxs)("div",{className:"micCallCamControl",children:[(0,d.jsx)("div",{className:"micControl",children:(0,d.jsx)("button",{className:"btn",onClick:()=>h((e=>!e)),children:"\ud83c\udf99\ufe0f"})}),(0,d.jsx)("div",{className:"callControl",children:(0,d.jsx)("button",{className:"callBtn",onClick:()=>{s(!1),b("/")},children:"\ud83d\udcde"})}),(0,d.jsx)("div",{className:"camControl",children:(0,d.jsx)("button",{className:"btn",onClick:()=>f((e=>!e)),children:"\ud83d\udcf7"})})]})})]}),(0,d.jsx)("div",{className:"remoteContainer",children:(0,d.jsx)("div",{className:"remoteVideoContainer",ref:m,style:{height:window.innerHeight-25*window.innerHeight/100},children:D.map((e=>(0,d.jsx)("div",{className:"remote-video-container",children:(0,d.jsx)(a.aG,{user:e})},e.uid)))})})]})}):(0,d.jsx)("div",{children:"Loading..."})};r()}catch(h){r(h)}}))},812:(e,t,n)=>{"use strict";n.a(e,(async(e,t)=>{try{var r=n(43),i=n(391),o=n(475),a=(n(555),n(111)),s=n(31),A=n(579),c=e([a]);a=(c.then?(await c)():c)[0];i.createRoot(document.getElementById("root")).render((0,A.jsx)(r.StrictMode,{children:(0,A.jsx)(o.Kd,{children:(0,A.jsx)(a.A,{})})})),(0,s.A)(),t()}catch(l){t(l)}}))},31:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});const r=e=>{e&&e instanceof Function&&n.e(453).then(n.bind(n,834)).then((t=>{let{getCLS:n,getFID:r,getFCP:i,getLCP:o,getTTFB:a}=t;n(e),r(e),i(e),o(e),a(e)}))}},387:(e,t,n)=>{"use strict";function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},r.apply(this,arguments)}var i;n.d(t,{Gh:()=>U,HS:()=>L,Oi:()=>s,Rr:()=>u,pX:()=>Q,pb:()=>B,rc:()=>i,tH:()=>x,ue:()=>f,yD:()=>P,zR:()=>a}),function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(i||(i={}));const o="popstate";function a(e){return void 0===e&&(e={}),h((function(e,t){let{pathname:n,search:r,hash:i}=e.location;return l("",{pathname:n,search:r,hash:i},t.state&&t.state.usr||null,t.state&&t.state.key||"default")}),(function(e,t){return"string"===typeof t?t:d(t)}),null,e)}function s(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function A(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(n){}}}function c(e,t){return{usr:e.state,key:e.key,idx:t}}function l(e,t,n,i){return void 0===n&&(n=null),r({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?u(t):t,{state:n,key:t&&t.key||i||Math.random().toString(36).substr(2,8)})}function d(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),r&&"#"!==r&&(t+="#"===r.charAt(0)?r:"#"+r),t}function u(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function h(e,t,n,a){void 0===a&&(a={});let{window:A=document.defaultView,v5Compat:u=!1}=a,h=A.history,p=i.Pop,f=null,E=g();function g(){return(h.state||{idx:null}).idx}function m(){p=i.Pop;let e=g(),t=null==e?null:e-E;E=e,f&&f({action:p,location:C.location,delta:t})}function _(e){let t="null"!==A.location.origin?A.location.origin:A.location.href,n="string"===typeof e?e:d(e);return n=n.replace(/ $/,"%20"),s(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}null==E&&(E=0,h.replaceState(r({},h.state,{idx:E}),""));let C={get action(){return p},get location(){return e(A,h)},listen(e){if(f)throw new Error("A history only accepts one active listener");return A.addEventListener(o,m),f=e,()=>{A.removeEventListener(o,m),f=null}},createHref:e=>t(A,e),createURL:_,encodeLocation(e){let t=_(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){p=i.Push;let r=l(C.location,e,t);n&&n(r,e),E=g()+1;let o=c(r,E),a=C.createHref(r);try{h.pushState(o,"",a)}catch(s){if(s instanceof DOMException&&"DataCloneError"===s.name)throw s;A.location.assign(a)}u&&f&&f({action:p,location:C.location,delta:1})},replace:function(e,t){p=i.Replace;let r=l(C.location,e,t);n&&n(r,e),E=g();let o=c(r,E),a=C.createHref(r);h.replaceState(o,"",a),u&&f&&f({action:p,location:C.location,delta:0})},go:e=>h.go(e)};return C}var p;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(p||(p={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function f(e,t,n){return void 0===n&&(n="/"),E(e,t,n,!1)}function E(e,t,n,r){let i=B(("string"===typeof t?u(t):t).pathname||"/",n);if(null==i)return null;let o=g(e);!function(e){e.sort(((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every(((e,n)=>e===t[n]));return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((e=>e.childrenIndex)),t.routesMeta.map((e=>e.childrenIndex)))))}(o);let a=null;for(let s=0;null==a&&s<o.length;++s){let e=O(i);a=R(o[s],e,r)}return a}function g(e,t,n,r){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===r&&(r="");let i=(e,i,o)=>{let a={relativePath:void 0===o?e.path||"":o,caseSensitive:!0===e.caseSensitive,childrenIndex:i,route:e};a.relativePath.startsWith("/")&&(s(a.relativePath.startsWith(r),'Absolute route path "'+a.relativePath+'" nested under path "'+r+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),a.relativePath=a.relativePath.slice(r.length));let A=L([r,a.relativePath]),c=n.concat(a);e.children&&e.children.length>0&&(s(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+A+'".'),g(e.children,t,c,A)),(null!=e.path||e.index)&&t.push({path:A,score:I(A,e.index),routesMeta:c})};return e.forEach(((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let r of m(e.path))i(e,t,r);else i(e,t)})),t}function m(e){let t=e.split("/");if(0===t.length)return[];let[n,...r]=t,i=n.endsWith("?"),o=n.replace(/\?$/,"");if(0===r.length)return i?[o,""]:[o];let a=m(r.join("/")),s=[];return s.push(...a.map((e=>""===e?o:[o,e].join("/")))),i&&s.push(...a),s.map((t=>e.startsWith("/")&&""===t?"/":t))}const _=/^:[\w-]+$/,C=3,w=2,S=1,T=10,v=-2,y=e=>"*"===e;function I(e,t){let n=e.split("/"),r=n.length;return n.some(y)&&(r+=v),t&&(r+=w),n.filter((e=>!y(e))).reduce(((e,t)=>e+(_.test(t)?C:""===t?S:T)),r)}function R(e,t,n){void 0===n&&(n=!1);let{routesMeta:r}=e,i={},o="/",a=[];for(let s=0;s<r.length;++s){let e=r[s],A=s===r.length-1,c="/"===o?t:t.slice(o.length)||"/",l=b({path:e.relativePath,caseSensitive:e.caseSensitive,end:A},c),d=e.route;if(!l&&A&&n&&!r[r.length-1].route.index&&(l=b({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},c)),!l)return null;Object.assign(i,l.params),a.push({params:i,pathname:L([o,l.pathname]),pathnameBase:k(L([o,l.pathnameBase])),route:d}),"/"!==l.pathnameBase&&(o=L([o,l.pathnameBase]))}return a}function b(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);A("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let r=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,((e,t,n)=>(r.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)")));e.endsWith("*")?(r.push({paramName:"*"}),i+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":""!==e&&"/"!==e&&(i+="(?:(?=\\/|$))");let o=new RegExp(i,t?void 0:"i");return[o,r]}(e.path,e.caseSensitive,e.end),i=t.match(n);if(!i)return null;let o=i[0],a=o.replace(/(.)\/+$/,"$1"),s=i.slice(1);return{params:r.reduce(((e,t,n)=>{let{paramName:r,isOptional:i}=t;if("*"===r){let e=s[n]||"";a=o.slice(0,o.length-e.length).replace(/(.)\/+$/,"$1")}const A=s[n];return e[r]=i&&!A?void 0:(A||"").replace(/%2F/g,"/"),e}),{}),pathname:o,pathnameBase:a,pattern:e}}function O(e){try{return e.split("/").map((e=>decodeURIComponent(e).replace(/\//g,"%2F"))).join("/")}catch(t){return A(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function B(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?null:e.slice(n)||"/"}function N(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function D(e){return e.filter(((e,t)=>0===t||e.route.path&&e.route.path.length>0))}function P(e,t){let n=D(e);return t?n.map(((t,n)=>n===e.length-1?t.pathname:t.pathnameBase)):n.map((e=>e.pathnameBase))}function U(e,t,n,i){let o;void 0===i&&(i=!1),"string"===typeof e?o=u(e):(o=r({},e),s(!o.pathname||!o.pathname.includes("?"),N("?","pathname","search",o)),s(!o.pathname||!o.pathname.includes("#"),N("#","pathname","hash",o)),s(!o.search||!o.search.includes("#"),N("#","search","hash",o)));let a,A=""===e||""===o.pathname,c=A?"/":o.pathname;if(null==c)a=n;else{let e=t.length-1;if(!i&&c.startsWith("..")){let t=c.split("/");for(;".."===t[0];)t.shift(),e-=1;o.pathname=t.join("/")}a=e>=0?t[e]:"/"}let l=function(e,t){void 0===t&&(t="/");let{pathname:n,search:r="",hash:i=""}="string"===typeof e?u(e):e,o=n?n.startsWith("/")?n:function(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)})),n.length>1?n.join("/"):"/"}(n,t):t;return{pathname:o,search:M(r),hash:F(i)}}(o,a),d=c&&"/"!==c&&c.endsWith("/"),h=(A||"."===c)&&n.endsWith("/");return l.pathname.endsWith("/")||!d&&!h||(l.pathname+="/"),l}const L=e=>e.join("/").replace(/\/\/+/g,"/"),k=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),M=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",F=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";class x extends Error{}function Q(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const V=["post","put","patch","delete"],H=(new Set(V),["get",...V]);new Set(H),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred")},239:function(e){e.exports=function(){"use strict";var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};function t(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var n=function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)};function r(e,t,n,r){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function a(e){try{A(r.next(e))}catch(Mt){o(Mt)}}function s(e){try{A(r.throw(e))}catch(Mt){o(Mt)}}function A(e){e.done?n(e.value):i(e.value).then(a,s)}A((r=r.apply(e,t||[])).next())}))}function i(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(e){return function(t){return A([e,t])}}function A(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(Mt){o=[6,Mt],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}}function o(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||t)}for(var a=function(){function e(e,t,n,r){this.left=e,this.top=t,this.width=n,this.height=r}return e.prototype.add=function(t,n,r,i){return new e(this.left+t,this.top+n,this.width+r,this.height+i)},e.fromClientRect=function(t,n){return new e(n.left+t.windowBounds.left,n.top+t.windowBounds.top,n.width,n.height)},e.fromDOMRectList=function(t,n){var r=Array.from(n).find((function(e){return 0!==e.width}));return r?new e(r.left+t.windowBounds.left,r.top+t.windowBounds.top,r.width,r.height):e.EMPTY},e.EMPTY=new e(0,0,0,0),e}(),s=function(e,t){return a.fromClientRect(e,t.getBoundingClientRect())},A=function(e){var t=e.body,n=e.documentElement;if(!t||!n)throw new Error("Unable to get document size");var r=Math.max(Math.max(t.scrollWidth,n.scrollWidth),Math.max(t.offsetWidth,n.offsetWidth),Math.max(t.clientWidth,n.clientWidth)),i=Math.max(Math.max(t.scrollHeight,n.scrollHeight),Math.max(t.offsetHeight,n.offsetHeight),Math.max(t.clientHeight,n.clientHeight));return new a(0,0,r,i)},c=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=e.charCodeAt(n++);if(i>=55296&&i<=56319&&n<r){var o=e.charCodeAt(n++);56320===(64512&o)?t.push(((1023&i)<<10)+(1023&o)+65536):(t.push(i),n--)}else t.push(i)}return t},l=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,e);var n=e.length;if(!n)return"";for(var r=[],i=-1,o="";++i<n;){var a=e[i];a<=65535?r.push(a):(a-=65536,r.push(55296+(a>>10),a%1024+56320)),(i+1===n||r.length>16384)&&(o+=String.fromCharCode.apply(String,r),r.length=0)}return o},d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u="undefined"===typeof Uint8Array?[]:new Uint8Array(256),h=0;h<d.length;h++)u[d.charCodeAt(h)]=h;for(var p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f="undefined"===typeof Uint8Array?[]:new Uint8Array(256),E=0;E<p.length;E++)f[p.charCodeAt(E)]=E;for(var g=function(e){var t,n,r,i,o,a=.75*e.length,s=e.length,A=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var c="undefined"!==typeof ArrayBuffer&&"undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint8Array.prototype.slice?new ArrayBuffer(a):new Array(a),l=Array.isArray(c)?c:new Uint8Array(c);for(t=0;t<s;t+=4)n=f[e.charCodeAt(t)],r=f[e.charCodeAt(t+1)],i=f[e.charCodeAt(t+2)],o=f[e.charCodeAt(t+3)],l[A++]=n<<2|r>>4,l[A++]=(15&r)<<4|i>>2,l[A++]=(3&i)<<6|63&o;return c},m=function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n.push(e[r+1]<<8|e[r]);return n},_=function(e){for(var t=e.length,n=[],r=0;r<t;r+=4)n.push(e[r+3]<<24|e[r+2]<<16|e[r+1]<<8|e[r]);return n},C=5,w=11,S=2,T=65536>>C,v=(1<<C)-1,y=T+(1024>>C)+32,I=65536>>w,R=(1<<w-C)-1,b=function(e,t,n){return e.slice?e.slice(t,n):new Uint16Array(Array.prototype.slice.call(e,t,n))},O=function(e,t,n){return e.slice?e.slice(t,n):new Uint32Array(Array.prototype.slice.call(e,t,n))},B=function(e,t){var n=g(e),r=Array.isArray(n)?_(n):new Uint32Array(n),i=Array.isArray(n)?m(n):new Uint16Array(n),o=24,a=b(i,o/2,r[4]/2),s=2===r[5]?b(i,(o+r[4])/2):O(r,Math.ceil((o+r[4])/4));return new N(r[0],r[1],r[2],r[3],a,s)},N=function(){function e(e,t,n,r,i,o){this.initialValue=e,this.errorValue=t,this.highStart=n,this.highValueIndex=r,this.index=i,this.data=o}return e.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=((t=this.index[e>>C])<<S)+(e&v),this.data[t];if(e<=65535)return t=((t=this.index[T+(e-55296>>C)])<<S)+(e&v),this.data[t];if(e<this.highStart)return t=y-I+(e>>w),t=this.index[t],t+=e>>C&R,t=((t=this.index[t])<<S)+(e&v),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},e}(),D="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",P="undefined"===typeof Uint8Array?[]:new Uint8Array(256),U=0;U<D.length;U++)P[D.charCodeAt(U)]=U;var L=50,k=1,M=2,F=3,x=4,Q=5,V=7,H=8,K=9,j=10,G=11,W=12,Y=13,J=14,X=15,z=16,q=17,Z=18,$=19,ee=20,te=21,ne=22,re=23,ie=24,oe=25,ae=26,se=27,Ae=28,ce=29,le=30,de=31,ue=32,he=33,pe=34,fe=35,Ee=36,ge=37,me=38,_e=39,Ce=40,we=41,Se=42,Te=43,ve=[9001,65288],ye="!",Ie="\xd7",Re="\xf7",be=B("KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA=="),Oe=[le,Ee],Be=[k,M,F,Q],Ne=[j,H],De=[se,ae],Pe=Be.concat(Ne),Ue=[me,_e,Ce,pe,fe],Le=[X,Y],ke=function(e,t){void 0===t&&(t="strict");var n=[],r=[],i=[];return e.forEach((function(e,o){var a=be.get(e);if(a>L?(i.push(!0),a-=L):i.push(!1),-1!==["normal","auto","loose"].indexOf(t)&&-1!==[8208,8211,12316,12448].indexOf(e))return r.push(o),n.push(z);if(a===x||a===G){if(0===o)return r.push(o),n.push(le);var s=n[o-1];return-1===Pe.indexOf(s)?(r.push(r[o-1]),n.push(s)):(r.push(o),n.push(le))}return r.push(o),a===de?n.push("strict"===t?te:ge):a===Se||a===ce?n.push(le):a===Te?e>=131072&&e<=196605||e>=196608&&e<=262141?n.push(ge):n.push(le):void n.push(a)})),[r,n,i]},Me=function(e,t,n,r){var i=r[n];if(Array.isArray(e)?-1!==e.indexOf(i):e===i)for(var o=n;o<=r.length;){if((A=r[++o])===t)return!0;if(A!==j)break}if(i===j)for(o=n;o>0;){var a=r[--o];if(Array.isArray(e)?-1!==e.indexOf(a):e===a)for(var s=n;s<=r.length;){var A;if((A=r[++s])===t)return!0;if(A!==j)break}if(a!==j)break}return!1},Fe=function(e,t){for(var n=e;n>=0;){var r=t[n];if(r!==j)return r;n--}return 0},xe=function(e,t,n,r,i){if(0===n[r])return Ie;var o=r-1;if(Array.isArray(i)&&!0===i[o])return Ie;var a=o-1,s=o+1,A=t[o],c=a>=0?t[a]:0,l=t[s];if(A===M&&l===F)return Ie;if(-1!==Be.indexOf(A))return ye;if(-1!==Be.indexOf(l))return Ie;if(-1!==Ne.indexOf(l))return Ie;if(Fe(o,t)===H)return Re;if(be.get(e[o])===G)return Ie;if((A===ue||A===he)&&be.get(e[s])===G)return Ie;if(A===V||l===V)return Ie;if(A===K)return Ie;if(-1===[j,Y,X].indexOf(A)&&l===K)return Ie;if(-1!==[q,Z,$,ie,Ae].indexOf(l))return Ie;if(Fe(o,t)===ne)return Ie;if(Me(re,ne,o,t))return Ie;if(Me([q,Z],te,o,t))return Ie;if(Me(W,W,o,t))return Ie;if(A===j)return Re;if(A===re||l===re)return Ie;if(l===z||A===z)return Re;if(-1!==[Y,X,te].indexOf(l)||A===J)return Ie;if(c===Ee&&-1!==Le.indexOf(A))return Ie;if(A===Ae&&l===Ee)return Ie;if(l===ee)return Ie;if(-1!==Oe.indexOf(l)&&A===oe||-1!==Oe.indexOf(A)&&l===oe)return Ie;if(A===se&&-1!==[ge,ue,he].indexOf(l)||-1!==[ge,ue,he].indexOf(A)&&l===ae)return Ie;if(-1!==Oe.indexOf(A)&&-1!==De.indexOf(l)||-1!==De.indexOf(A)&&-1!==Oe.indexOf(l))return Ie;if(-1!==[se,ae].indexOf(A)&&(l===oe||-1!==[ne,X].indexOf(l)&&t[s+1]===oe)||-1!==[ne,X].indexOf(A)&&l===oe||A===oe&&-1!==[oe,Ae,ie].indexOf(l))return Ie;if(-1!==[oe,Ae,ie,q,Z].indexOf(l))for(var d=o;d>=0;){if((u=t[d])===oe)return Ie;if(-1===[Ae,ie].indexOf(u))break;d--}if(-1!==[se,ae].indexOf(l))for(d=-1!==[q,Z].indexOf(A)?a:o;d>=0;){var u;if((u=t[d])===oe)return Ie;if(-1===[Ae,ie].indexOf(u))break;d--}if(me===A&&-1!==[me,_e,pe,fe].indexOf(l)||-1!==[_e,pe].indexOf(A)&&-1!==[_e,Ce].indexOf(l)||-1!==[Ce,fe].indexOf(A)&&l===Ce)return Ie;if(-1!==Ue.indexOf(A)&&-1!==[ee,ae].indexOf(l)||-1!==Ue.indexOf(l)&&A===se)return Ie;if(-1!==Oe.indexOf(A)&&-1!==Oe.indexOf(l))return Ie;if(A===ie&&-1!==Oe.indexOf(l))return Ie;if(-1!==Oe.concat(oe).indexOf(A)&&l===ne&&-1===ve.indexOf(e[s])||-1!==Oe.concat(oe).indexOf(l)&&A===Z)return Ie;if(A===we&&l===we){for(var h=n[o],p=1;h>0&&t[--h]===we;)p++;if(p%2!==0)return Ie}return A===ue&&l===he?Ie:Re},Qe=function(e,t){t||(t={lineBreak:"normal",wordBreak:"normal"});var n=ke(e,t.lineBreak),r=n[0],i=n[1],o=n[2];"break-all"!==t.wordBreak&&"break-word"!==t.wordBreak||(i=i.map((function(e){return-1!==[oe,le,Se].indexOf(e)?ge:e})));var a="keep-all"===t.wordBreak?o.map((function(t,n){return t&&e[n]>=19968&&e[n]<=40959})):void 0;return[r,i,a]},Ve=function(){function e(e,t,n,r){this.codePoints=e,this.required=t===ye,this.start=n,this.end=r}return e.prototype.slice=function(){return l.apply(void 0,this.codePoints.slice(this.start,this.end))},e}(),He=function(e,t){var n=c(e),r=Qe(n,t),i=r[0],o=r[1],a=r[2],s=n.length,A=0,l=0;return{next:function(){if(l>=s)return{done:!0,value:null};for(var e=Ie;l<s&&(e=xe(n,o,i,++l,a))===Ie;);if(e!==Ie||l===s){var t=new Ve(n,e,A,l);return A=l,{value:t,done:!1}}return{done:!0,value:null}}}},Ke=1,je=2,Ge=4,We=8,Ye=10,Je=47,Xe=92,ze=9,qe=32,Ze=34,$e=61,et=35,tt=36,nt=37,rt=39,it=40,ot=41,at=95,st=45,At=33,ct=60,lt=62,dt=64,ut=91,ht=93,pt=61,ft=123,Et=63,gt=125,mt=124,_t=126,Ct=128,wt=65533,St=42,Tt=43,vt=44,yt=58,It=59,Rt=46,bt=0,Ot=8,Bt=11,Nt=14,Dt=31,Pt=127,Ut=-1,Lt=48,kt=97,Mt=101,Ft=102,xt=117,Qt=122,Vt=65,Ht=69,Kt=70,jt=85,Gt=90,Wt=function(e){return e>=Lt&&e<=57},Yt=function(e){return e>=55296&&e<=57343},Jt=function(e){return Wt(e)||e>=Vt&&e<=Kt||e>=kt&&e<=Ft},Xt=function(e){return e>=kt&&e<=Qt},zt=function(e){return e>=Vt&&e<=Gt},qt=function(e){return Xt(e)||zt(e)},Zt=function(e){return e>=Ct},$t=function(e){return e===Ye||e===ze||e===qe},en=function(e){return qt(e)||Zt(e)||e===at},tn=function(e){return en(e)||Wt(e)||e===st},nn=function(e){return e>=bt&&e<=Ot||e===Bt||e>=Nt&&e<=Dt||e===Pt},rn=function(e,t){return e===Xe&&t!==Ye},on=function(e,t,n){return e===st?en(t)||rn(t,n):!!en(e)||!(e!==Xe||!rn(e,t))},an=function(e,t,n){return e===Tt||e===st?!!Wt(t)||t===Rt&&Wt(n):Wt(e===Rt?t:e)},sn=function(e){var t=0,n=1;e[t]!==Tt&&e[t]!==st||(e[t]===st&&(n=-1),t++);for(var r=[];Wt(e[t]);)r.push(e[t++]);var i=r.length?parseInt(l.apply(void 0,r),10):0;e[t]===Rt&&t++;for(var o=[];Wt(e[t]);)o.push(e[t++]);var a=o.length,s=a?parseInt(l.apply(void 0,o),10):0;e[t]!==Ht&&e[t]!==Mt||t++;var A=1;e[t]!==Tt&&e[t]!==st||(e[t]===st&&(A=-1),t++);for(var c=[];Wt(e[t]);)c.push(e[t++]);var d=c.length?parseInt(l.apply(void 0,c),10):0;return n*(i+s*Math.pow(10,-a))*Math.pow(10,A*d)},An={type:2},cn={type:3},ln={type:4},dn={type:13},un={type:8},hn={type:21},pn={type:9},fn={type:10},En={type:11},gn={type:12},mn={type:14},_n={type:23},Cn={type:1},wn={type:25},Sn={type:24},Tn={type:26},vn={type:27},yn={type:28},In={type:29},Rn={type:31},bn={type:32},On=function(){function e(){this._value=[]}return e.prototype.write=function(e){this._value=this._value.concat(c(e))},e.prototype.read=function(){for(var e=[],t=this.consumeToken();t!==bn;)e.push(t),t=this.consumeToken();return e},e.prototype.consumeToken=function(){var e=this.consumeCodePoint();switch(e){case Ze:return this.consumeStringToken(Ze);case et:var t=this.peekCodePoint(0),n=this.peekCodePoint(1),r=this.peekCodePoint(2);if(tn(t)||rn(n,r)){var i=on(t,n,r)?je:Ke;return{type:5,value:this.consumeName(),flags:i}}break;case tt:if(this.peekCodePoint(0)===$e)return this.consumeCodePoint(),dn;break;case rt:return this.consumeStringToken(rt);case it:return An;case ot:return cn;case St:if(this.peekCodePoint(0)===$e)return this.consumeCodePoint(),mn;break;case Tt:if(an(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case vt:return ln;case st:var o=e,a=this.peekCodePoint(0),s=this.peekCodePoint(1);if(an(o,a,s))return this.reconsumeCodePoint(e),this.consumeNumericToken();if(on(o,a,s))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();if(a===st&&s===lt)return this.consumeCodePoint(),this.consumeCodePoint(),Sn;break;case Rt:if(an(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case Je:if(this.peekCodePoint(0)===St)for(this.consumeCodePoint();;){var A=this.consumeCodePoint();if(A===St&&(A=this.consumeCodePoint())===Je)return this.consumeToken();if(A===Ut)return this.consumeToken()}break;case yt:return Tn;case It:return vn;case ct:if(this.peekCodePoint(0)===At&&this.peekCodePoint(1)===st&&this.peekCodePoint(2)===st)return this.consumeCodePoint(),this.consumeCodePoint(),wn;break;case dt:var c=this.peekCodePoint(0),d=this.peekCodePoint(1),u=this.peekCodePoint(2);if(on(c,d,u))return{type:7,value:this.consumeName()};break;case ut:return yn;case Xe:if(rn(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();break;case ht:return In;case pt:if(this.peekCodePoint(0)===$e)return this.consumeCodePoint(),un;break;case ft:return En;case gt:return gn;case xt:case jt:var h=this.peekCodePoint(0),p=this.peekCodePoint(1);return h!==Tt||!Jt(p)&&p!==Et||(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(e),this.consumeIdentLikeToken();case mt:if(this.peekCodePoint(0)===$e)return this.consumeCodePoint(),pn;if(this.peekCodePoint(0)===mt)return this.consumeCodePoint(),hn;break;case _t:if(this.peekCodePoint(0)===$e)return this.consumeCodePoint(),fn;break;case Ut:return bn}return $t(e)?(this.consumeWhiteSpace(),Rn):Wt(e)?(this.reconsumeCodePoint(e),this.consumeNumericToken()):en(e)?(this.reconsumeCodePoint(e),this.consumeIdentLikeToken()):{type:6,value:l(e)}},e.prototype.consumeCodePoint=function(){var e=this._value.shift();return"undefined"===typeof e?-1:e},e.prototype.reconsumeCodePoint=function(e){this._value.unshift(e)},e.prototype.peekCodePoint=function(e){return e>=this._value.length?-1:this._value[e]},e.prototype.consumeUnicodeRangeToken=function(){for(var e=[],t=this.consumeCodePoint();Jt(t)&&e.length<6;)e.push(t),t=this.consumeCodePoint();for(var n=!1;t===Et&&e.length<6;)e.push(t),t=this.consumeCodePoint(),n=!0;if(n)return{type:30,start:parseInt(l.apply(void 0,e.map((function(e){return e===Et?Lt:e}))),16),end:parseInt(l.apply(void 0,e.map((function(e){return e===Et?Kt:e}))),16)};var r=parseInt(l.apply(void 0,e),16);if(this.peekCodePoint(0)===st&&Jt(this.peekCodePoint(1))){this.consumeCodePoint(),t=this.consumeCodePoint();for(var i=[];Jt(t)&&i.length<6;)i.push(t),t=this.consumeCodePoint();return{type:30,start:r,end:parseInt(l.apply(void 0,i),16)}}return{type:30,start:r,end:r}},e.prototype.consumeIdentLikeToken=function(){var e=this.consumeName();return"url"===e.toLowerCase()&&this.peekCodePoint(0)===it?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===it?(this.consumeCodePoint(),{type:19,value:e}):{type:20,value:e}},e.prototype.consumeUrlToken=function(){var e=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===Ut)return{type:22,value:""};var t=this.peekCodePoint(0);if(t===rt||t===Ze){var n=this.consumeStringToken(this.consumeCodePoint());return 0===n.type&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===Ut||this.peekCodePoint(0)===ot)?(this.consumeCodePoint(),{type:22,value:n.value}):(this.consumeBadUrlRemnants(),_n)}for(;;){var r=this.consumeCodePoint();if(r===Ut||r===ot)return{type:22,value:l.apply(void 0,e)};if($t(r))return this.consumeWhiteSpace(),this.peekCodePoint(0)===Ut||this.peekCodePoint(0)===ot?(this.consumeCodePoint(),{type:22,value:l.apply(void 0,e)}):(this.consumeBadUrlRemnants(),_n);if(r===Ze||r===rt||r===it||nn(r))return this.consumeBadUrlRemnants(),_n;if(r===Xe){if(!rn(r,this.peekCodePoint(0)))return this.consumeBadUrlRemnants(),_n;e.push(this.consumeEscapedCodePoint())}else e.push(r)}},e.prototype.consumeWhiteSpace=function(){for(;$t(this.peekCodePoint(0));)this.consumeCodePoint()},e.prototype.consumeBadUrlRemnants=function(){for(;;){var e=this.consumeCodePoint();if(e===ot||e===Ut)return;rn(e,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},e.prototype.consumeStringSlice=function(e){for(var t=5e4,n="";e>0;){var r=Math.min(t,e);n+=l.apply(void 0,this._value.splice(0,r)),e-=r}return this._value.shift(),n},e.prototype.consumeStringToken=function(e){for(var t="",n=0;;){var r=this._value[n];if(r===Ut||void 0===r||r===e)return{type:0,value:t+=this.consumeStringSlice(n)};if(r===Ye)return this._value.splice(0,n),Cn;if(r===Xe){var i=this._value[n+1];i!==Ut&&void 0!==i&&(i===Ye?(t+=this.consumeStringSlice(n),n=-1,this._value.shift()):rn(r,i)&&(t+=this.consumeStringSlice(n),t+=l(this.consumeEscapedCodePoint()),n=-1))}n++}},e.prototype.consumeNumber=function(){var e=[],t=Ge,n=this.peekCodePoint(0);for(n!==Tt&&n!==st||e.push(this.consumeCodePoint());Wt(this.peekCodePoint(0));)e.push(this.consumeCodePoint());n=this.peekCodePoint(0);var r=this.peekCodePoint(1);if(n===Rt&&Wt(r))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=We;Wt(this.peekCodePoint(0));)e.push(this.consumeCodePoint());n=this.peekCodePoint(0),r=this.peekCodePoint(1);var i=this.peekCodePoint(2);if((n===Ht||n===Mt)&&((r===Tt||r===st)&&Wt(i)||Wt(r)))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=We;Wt(this.peekCodePoint(0));)e.push(this.consumeCodePoint());return[sn(e),t]},e.prototype.consumeNumericToken=function(){var e=this.consumeNumber(),t=e[0],n=e[1],r=this.peekCodePoint(0),i=this.peekCodePoint(1),o=this.peekCodePoint(2);return on(r,i,o)?{type:15,number:t,flags:n,unit:this.consumeName()}:r===nt?(this.consumeCodePoint(),{type:16,number:t,flags:n}):{type:17,number:t,flags:n}},e.prototype.consumeEscapedCodePoint=function(){var e=this.consumeCodePoint();if(Jt(e)){for(var t=l(e);Jt(this.peekCodePoint(0))&&t.length<6;)t+=l(this.consumeCodePoint());$t(this.peekCodePoint(0))&&this.consumeCodePoint();var n=parseInt(t,16);return 0===n||Yt(n)||n>1114111?wt:n}return e===Ut?wt:e},e.prototype.consumeName=function(){for(var e="";;){var t=this.consumeCodePoint();if(tn(t))e+=l(t);else{if(!rn(t,this.peekCodePoint(0)))return this.reconsumeCodePoint(t),e;e+=l(this.consumeEscapedCodePoint())}}},e}(),Bn=function(){function e(e){this._tokens=e}return e.create=function(t){var n=new On;return n.write(t),new e(n.read())},e.parseValue=function(t){return e.create(t).parseComponentValue()},e.parseValues=function(t){return e.create(t).parseComponentValues()},e.prototype.parseComponentValue=function(){for(var e=this.consumeToken();31===e.type;)e=this.consumeToken();if(32===e.type)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(e);var t=this.consumeComponentValue();do{e=this.consumeToken()}while(31===e.type);if(32===e.type)return t;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},e.prototype.parseComponentValues=function(){for(var e=[];;){var t=this.consumeComponentValue();if(32===t.type)return e;e.push(t),e.push()}},e.prototype.consumeComponentValue=function(){var e=this.consumeToken();switch(e.type){case 11:case 28:case 2:return this.consumeSimpleBlock(e.type);case 19:return this.consumeFunction(e)}return e},e.prototype.consumeSimpleBlock=function(e){for(var t={type:e,values:[]},n=this.consumeToken();;){if(32===n.type||xn(n,e))return t;this.reconsumeToken(n),t.values.push(this.consumeComponentValue()),n=this.consumeToken()}},e.prototype.consumeFunction=function(e){for(var t={name:e.value,values:[],type:18};;){var n=this.consumeToken();if(32===n.type||3===n.type)return t;this.reconsumeToken(n),t.values.push(this.consumeComponentValue())}},e.prototype.consumeToken=function(){var e=this._tokens.shift();return"undefined"===typeof e?bn:e},e.prototype.reconsumeToken=function(e){this._tokens.unshift(e)},e}(),Nn=function(e){return 15===e.type},Dn=function(e){return 17===e.type},Pn=function(e){return 20===e.type},Un=function(e){return 0===e.type},Ln=function(e,t){return Pn(e)&&e.value===t},kn=function(e){return 31!==e.type},Mn=function(e){return 31!==e.type&&4!==e.type},Fn=function(e){var t=[],n=[];return e.forEach((function(e){if(4===e.type){if(0===n.length)throw new Error("Error parsing function args, zero tokens for arg");return t.push(n),void(n=[])}31!==e.type&&n.push(e)})),n.length&&t.push(n),t},xn=function(e,t){return 11===t&&12===e.type||28===t&&29===e.type||2===t&&3===e.type},Qn=function(e){return 17===e.type||15===e.type},Vn=function(e){return 16===e.type||Qn(e)},Hn=function(e){return e.length>1?[e[0],e[1]]:[e[0]]},Kn={type:17,number:0,flags:Ge},jn={type:16,number:50,flags:Ge},Gn={type:16,number:100,flags:Ge},Wn=function(e,t,n){var r=e[0],i=e[1];return[Yn(r,t),Yn("undefined"!==typeof i?i:r,n)]},Yn=function(e,t){if(16===e.type)return e.number/100*t;if(Nn(e))switch(e.unit){case"rem":case"em":return 16*e.number;default:return e.number}return e.number},Jn="deg",Xn="grad",zn="rad",qn="turn",Zn={name:"angle",parse:function(e,t){if(15===t.type)switch(t.unit){case Jn:return Math.PI*t.number/180;case Xn:return Math.PI/200*t.number;case zn:return t.number;case qn:return 2*Math.PI*t.number}throw new Error("Unsupported angle type")}},$n=function(e){return 15===e.type&&(e.unit===Jn||e.unit===Xn||e.unit===zn||e.unit===qn)},er=function(e){switch(e.filter(Pn).map((function(e){return e.value})).join(" ")){case"to bottom right":case"to right bottom":case"left top":case"top left":return[Kn,Kn];case"to top":case"bottom":return tr(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[Kn,Gn];case"to right":case"left":return tr(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[Gn,Gn];case"to bottom":case"top":return tr(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[Gn,Kn];case"to left":case"right":return tr(270)}return 0},tr=function(e){return Math.PI*e/180},nr={name:"color",parse:function(e,t){if(18===t.type){var n=lr[t.name];if("undefined"===typeof n)throw new Error('Attempting to parse an unsupported color function "'+t.name+'"');return n(e,t.values)}if(5===t.type){if(3===t.value.length){var r=t.value.substring(0,1),i=t.value.substring(1,2),o=t.value.substring(2,3);return or(parseInt(r+r,16),parseInt(i+i,16),parseInt(o+o,16),1)}if(4===t.value.length){r=t.value.substring(0,1),i=t.value.substring(1,2),o=t.value.substring(2,3);var a=t.value.substring(3,4);return or(parseInt(r+r,16),parseInt(i+i,16),parseInt(o+o,16),parseInt(a+a,16)/255)}if(6===t.value.length)return r=t.value.substring(0,2),i=t.value.substring(2,4),o=t.value.substring(4,6),or(parseInt(r,16),parseInt(i,16),parseInt(o,16),1);if(8===t.value.length)return r=t.value.substring(0,2),i=t.value.substring(2,4),o=t.value.substring(4,6),a=t.value.substring(6,8),or(parseInt(r,16),parseInt(i,16),parseInt(o,16),parseInt(a,16)/255)}if(20===t.type){var s=ur[t.value.toUpperCase()];if("undefined"!==typeof s)return s}return ur.TRANSPARENT}},rr=function(e){return 0===(255&e)},ir=function(e){var t=255&e,n=255&e>>8,r=255&e>>16,i=255&e>>24;return t<255?"rgba("+i+","+r+","+n+","+t/255+")":"rgb("+i+","+r+","+n+")"},or=function(e,t,n,r){return(e<<24|t<<16|n<<8|Math.round(255*r))>>>0},ar=function(e,t){if(17===e.type)return e.number;if(16===e.type){var n=3===t?1:255;return 3===t?e.number/100*n:Math.round(e.number/100*n)}return 0},sr=function(e,t){var n=t.filter(Mn);if(3===n.length){var r=n.map(ar),i=r[0],o=r[1],a=r[2];return or(i,o,a,1)}if(4===n.length){var s=n.map(ar),A=(i=s[0],o=s[1],a=s[2],s[3]);return or(i,o,a,A)}return 0};function Ar(e,t,n){return n<0&&(n+=1),n>=1&&(n-=1),n<1/6?(t-e)*n*6+e:n<.5?t:n<2/3?6*(t-e)*(2/3-n)+e:e}var cr=function(e,t){var n=t.filter(Mn),r=n[0],i=n[1],o=n[2],a=n[3],s=(17===r.type?tr(r.number):Zn.parse(e,r))/(2*Math.PI),A=Vn(i)?i.number/100:0,c=Vn(o)?o.number/100:0,l="undefined"!==typeof a&&Vn(a)?Yn(a,1):1;if(0===A)return or(255*c,255*c,255*c,1);var d=c<=.5?c*(A+1):c+A-c*A,u=2*c-d,h=Ar(u,d,s+1/3),p=Ar(u,d,s),f=Ar(u,d,s-1/3);return or(255*h,255*p,255*f,l)},lr={hsl:cr,hsla:cr,rgb:sr,rgba:sr},dr=function(e,t){return nr.parse(e,Bn.create(t).parseComponentValue())},ur={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},hr={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(e,t){return t.map((function(e){if(Pn(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0}))}},pr={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},fr=function(e,t){var n=nr.parse(e,t[0]),r=t[1];return r&&Vn(r)?{color:n,stop:r}:{color:n,stop:null}},Er=function(e,t){var n=e[0],r=e[e.length-1];null===n.stop&&(n.stop=Kn),null===r.stop&&(r.stop=Gn);for(var i=[],o=0,a=0;a<e.length;a++){var s=e[a].stop;if(null!==s){var A=Yn(s,t);A>o?i.push(A):i.push(o),o=A}else i.push(null)}var c=null;for(a=0;a<i.length;a++){var l=i[a];if(null===l)null===c&&(c=a);else if(null!==c){for(var d=a-c,u=(l-i[c-1])/(d+1),h=1;h<=d;h++)i[c+h-1]=u*h;c=null}}return e.map((function(e,n){return{color:e.color,stop:Math.max(Math.min(1,i[n]/t),0)}}))},gr=function(e,t,n){var r=t/2,i=n/2,o=Yn(e[0],t)-r,a=i-Yn(e[1],n);return(Math.atan2(a,o)+2*Math.PI)%(2*Math.PI)},mr=function(e,t,n){var r="number"===typeof e?e:gr(e,t,n),i=Math.abs(t*Math.sin(r))+Math.abs(n*Math.cos(r)),o=t/2,a=n/2,s=i/2,A=Math.sin(r-Math.PI/2)*s,c=Math.cos(r-Math.PI/2)*s;return[i,o-c,o+c,a-A,a+A]},_r=function(e,t){return Math.sqrt(e*e+t*t)},Cr=function(e,t,n,r,i){return[[0,0],[0,t],[e,0],[e,t]].reduce((function(e,t){var o=t[0],a=t[1],s=_r(n-o,r-a);return(i?s<e.optimumDistance:s>e.optimumDistance)?{optimumCorner:t,optimumDistance:s}:e}),{optimumDistance:i?1/0:-1/0,optimumCorner:null}).optimumCorner},wr=function(e,t,n,r,i){var o=0,a=0;switch(e.size){case 0:0===e.shape?o=a=Math.min(Math.abs(t),Math.abs(t-r),Math.abs(n),Math.abs(n-i)):1===e.shape&&(o=Math.min(Math.abs(t),Math.abs(t-r)),a=Math.min(Math.abs(n),Math.abs(n-i)));break;case 2:if(0===e.shape)o=a=Math.min(_r(t,n),_r(t,n-i),_r(t-r,n),_r(t-r,n-i));else if(1===e.shape){var s=Math.min(Math.abs(n),Math.abs(n-i))/Math.min(Math.abs(t),Math.abs(t-r)),A=Cr(r,i,t,n,!0),c=A[0],l=A[1];a=s*(o=_r(c-t,(l-n)/s))}break;case 1:0===e.shape?o=a=Math.max(Math.abs(t),Math.abs(t-r),Math.abs(n),Math.abs(n-i)):1===e.shape&&(o=Math.max(Math.abs(t),Math.abs(t-r)),a=Math.max(Math.abs(n),Math.abs(n-i)));break;case 3:if(0===e.shape)o=a=Math.max(_r(t,n),_r(t,n-i),_r(t-r,n),_r(t-r,n-i));else if(1===e.shape){s=Math.max(Math.abs(n),Math.abs(n-i))/Math.max(Math.abs(t),Math.abs(t-r));var d=Cr(r,i,t,n,!1);c=d[0],l=d[1],a=s*(o=_r(c-t,(l-n)/s))}}return Array.isArray(e.size)&&(o=Yn(e.size[0],r),a=2===e.size.length?Yn(e.size[1],i):o),[o,a]},Sr=function(e,t){var n=tr(180),r=[];return Fn(t).forEach((function(t,i){if(0===i){var o=t[0];if(20===o.type&&-1!==["top","left","right","bottom"].indexOf(o.value))return void(n=er(t));if($n(o))return void(n=(Zn.parse(e,o)+tr(270))%tr(360))}var a=fr(e,t);r.push(a)})),{angle:n,stops:r,type:1}},Tr="closest-side",vr="farthest-side",yr="closest-corner",Ir="farthest-corner",Rr="circle",br="ellipse",Or="cover",Br="contain",Nr=function(e,t){var n=0,r=3,i=[],o=[];return Fn(t).forEach((function(t,a){var s=!0;if(0===a?s=t.reduce((function(e,t){if(Pn(t))switch(t.value){case"center":return o.push(jn),!1;case"top":case"left":return o.push(Kn),!1;case"right":case"bottom":return o.push(Gn),!1}else if(Vn(t)||Qn(t))return o.push(t),!1;return e}),s):1===a&&(s=t.reduce((function(e,t){if(Pn(t))switch(t.value){case Rr:return n=0,!1;case br:return n=1,!1;case Br:case Tr:return r=0,!1;case vr:return r=1,!1;case yr:return r=2,!1;case Or:case Ir:return r=3,!1}else if(Qn(t)||Vn(t))return Array.isArray(r)||(r=[]),r.push(t),!1;return e}),s)),s){var A=fr(e,t);i.push(A)}})),{size:r,shape:n,stops:i,position:o,type:2}},Dr=function(e){return 1===e.type},Pr=function(e){return 2===e.type},Ur={name:"image",parse:function(e,t){if(22===t.type){var n={url:t.value,type:0};return e.cache.addImage(t.value),n}if(18===t.type){var r=Mr[t.name];if("undefined"===typeof r)throw new Error('Attempting to parse an unsupported image function "'+t.name+'"');return r(e,t.values)}throw new Error("Unsupported image type "+t.type)}};function Lr(e){return!(20===e.type&&"none"===e.value)&&(18!==e.type||!!Mr[e.name])}var kr,Mr={"linear-gradient":function(e,t){var n=tr(180),r=[];return Fn(t).forEach((function(t,i){if(0===i){var o=t[0];if(20===o.type&&"to"===o.value)return void(n=er(t));if($n(o))return void(n=Zn.parse(e,o))}var a=fr(e,t);r.push(a)})),{angle:n,stops:r,type:1}},"-moz-linear-gradient":Sr,"-ms-linear-gradient":Sr,"-o-linear-gradient":Sr,"-webkit-linear-gradient":Sr,"radial-gradient":function(e,t){var n=0,r=3,i=[],o=[];return Fn(t).forEach((function(t,a){var s=!0;if(0===a){var A=!1;s=t.reduce((function(e,t){if(A)if(Pn(t))switch(t.value){case"center":return o.push(jn),e;case"top":case"left":return o.push(Kn),e;case"right":case"bottom":return o.push(Gn),e}else(Vn(t)||Qn(t))&&o.push(t);else if(Pn(t))switch(t.value){case Rr:return n=0,!1;case br:return n=1,!1;case"at":return A=!0,!1;case Tr:return r=0,!1;case Or:case vr:return r=1,!1;case Br:case yr:return r=2,!1;case Ir:return r=3,!1}else if(Qn(t)||Vn(t))return Array.isArray(r)||(r=[]),r.push(t),!1;return e}),s)}if(s){var c=fr(e,t);i.push(c)}})),{size:r,shape:n,stops:i,position:o,type:2}},"-moz-radial-gradient":Nr,"-ms-radial-gradient":Nr,"-o-radial-gradient":Nr,"-webkit-radial-gradient":Nr,"-webkit-gradient":function(e,t){var n=tr(180),r=[],i=1,o=0,a=3,s=[];return Fn(t).forEach((function(t,n){var o=t[0];if(0===n){if(Pn(o)&&"linear"===o.value)return void(i=1);if(Pn(o)&&"radial"===o.value)return void(i=2)}if(18===o.type)if("from"===o.name){var a=nr.parse(e,o.values[0]);r.push({stop:Kn,color:a})}else if("to"===o.name)a=nr.parse(e,o.values[0]),r.push({stop:Gn,color:a});else if("color-stop"===o.name){var s=o.values.filter(Mn);if(2===s.length){a=nr.parse(e,s[1]);var A=s[0];Dn(A)&&r.push({stop:{type:16,number:100*A.number,flags:A.flags},color:a})}}})),1===i?{angle:(n+tr(180))%tr(360),stops:r,type:i}:{size:a,shape:o,stops:r,position:s,type:i}}},Fr={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(e,t){if(0===t.length)return[];var n=t[0];return 20===n.type&&"none"===n.value?[]:t.filter((function(e){return Mn(e)&&Lr(e)})).map((function(t){return Ur.parse(e,t)}))}},xr={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(e,t){return t.map((function(e){if(Pn(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0}))}},Qr={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(e,t){return Fn(t).map((function(e){return e.filter(Vn)})).map(Hn)}},Vr={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(e,t){return Fn(t).map((function(e){return e.filter(Pn).map((function(e){return e.value})).join(" ")})).map(Hr)}},Hr=function(e){switch(e){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;default:return 0}};!function(e){e.AUTO="auto",e.CONTAIN="contain",e.COVER="cover"}(kr||(kr={}));var Kr,jr={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(e,t){return Fn(t).map((function(e){return e.filter(Gr)}))}},Gr=function(e){return Pn(e)||Vn(e)},Wr=function(e){return{name:"border-"+e+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},Yr=Wr("top"),Jr=Wr("right"),Xr=Wr("bottom"),zr=Wr("left"),qr=function(e){return{name:"border-radius-"+e,initialValue:"0 0",prefix:!1,type:1,parse:function(e,t){return Hn(t.filter(Vn))}}},Zr=qr("top-left"),$r=qr("top-right"),ei=qr("bottom-right"),ti=qr("bottom-left"),ni=function(e){return{name:"border-"+e+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(e,t){switch(t){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},ri=ni("top"),ii=ni("right"),oi=ni("bottom"),ai=ni("left"),si=function(e){return{name:"border-"+e+"-width",initialValue:"0",type:0,prefix:!1,parse:function(e,t){return Nn(t)?t.number:0}}},Ai=si("top"),ci=si("right"),li=si("bottom"),di=si("left"),ui={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},hi={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(e,t){return"rtl"===t?1:0}},pi={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(e,t){return t.filter(Pn).reduce((function(e,t){return e|fi(t.value)}),0)}},fi=function(e){switch(e){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},Ei={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},gi={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(e,t){return 20===t.type&&"normal"===t.value?0:17===t.type||15===t.type?t.number:0}};!function(e){e.NORMAL="normal",e.STRICT="strict"}(Kr||(Kr={}));var mi,_i={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){return"strict"===t?Kr.STRICT:Kr.NORMAL}},Ci={name:"line-height",initialValue:"normal",prefix:!1,type:4},wi=function(e,t){return Pn(e)&&"normal"===e.value?1.2*t:17===e.type?t*e.number:Vn(e)?Yn(e,t):t},Si={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(e,t){return 20===t.type&&"none"===t.value?null:Ur.parse(e,t)}},Ti={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(e,t){return"inside"===t?0:1}},vi={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;default:return-1}}},yi=function(e){return{name:"margin-"+e,initialValue:"0",prefix:!1,type:4}},Ii=yi("top"),Ri=yi("right"),bi=yi("bottom"),Oi=yi("left"),Bi={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(e,t){return t.filter(Pn).map((function(e){switch(e.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;default:return 0}}))}},Ni={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){return"break-word"===t?"break-word":"normal"}},Di=function(e){return{name:"padding-"+e,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},Pi=Di("top"),Ui=Di("right"),Li=Di("bottom"),ki=Di("left"),Mi={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(e,t){switch(t){case"right":return 2;case"center":case"justify":return 1;default:return 0}}},Fi={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(e,t){switch(t){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},xi={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return 1===t.length&&Ln(t[0],"none")?[]:Fn(t).map((function(t){for(var n={color:ur.TRANSPARENT,offsetX:Kn,offsetY:Kn,blur:Kn},r=0,i=0;i<t.length;i++){var o=t[i];Qn(o)?(0===r?n.offsetX=o:1===r?n.offsetY=o:n.blur=o,r++):n.color=nr.parse(e,o)}return n}))}},Qi={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},Vi={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(e,t){if(20===t.type&&"none"===t.value)return null;if(18===t.type){var n=Hi[t.name];if("undefined"===typeof n)throw new Error('Attempting to parse an unsupported transform function "'+t.name+'"');return n(t.values)}return null}},Hi={matrix:function(e){var t=e.filter((function(e){return 17===e.type})).map((function(e){return e.number}));return 6===t.length?t:null},matrix3d:function(e){var t=e.filter((function(e){return 17===e.type})).map((function(e){return e.number})),n=t[0],r=t[1];t[2],t[3];var i=t[4],o=t[5];t[6],t[7],t[8],t[9],t[10],t[11];var a=t[12],s=t[13];return t[14],t[15],16===t.length?[n,r,i,o,a,s]:null}},Ki={type:16,number:50,flags:Ge},ji=[Ki,Ki],Gi={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(e,t){var n=t.filter(Vn);return 2!==n.length?ji:[n[0],n[1]]}},Wi={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"hidden":return 1;case"collapse":return 2;default:return 0}}};!function(e){e.NORMAL="normal",e.BREAK_ALL="break-all",e.KEEP_ALL="keep-all"}(mi||(mi={}));for(var Yi={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){switch(t){case"break-all":return mi.BREAK_ALL;case"keep-all":return mi.KEEP_ALL;default:return mi.NORMAL}}},Ji={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(e,t){if(20===t.type)return{auto:!0,order:0};if(Dn(t))return{auto:!1,order:t.number};throw new Error("Invalid z-index number parsed")}},Xi={name:"time",parse:function(e,t){if(15===t.type)switch(t.unit.toLowerCase()){case"s":return 1e3*t.number;case"ms":return t.number}throw new Error("Unsupported time type")}},zi={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(e,t){return Dn(t)?t.number:1}},qi={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Zi={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(e,t){return t.filter(Pn).map((function(e){switch(e.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0})).filter((function(e){return 0!==e}))}},$i={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(e,t){var n=[],r=[];return t.forEach((function(e){switch(e.type){case 20:case 0:n.push(e.value);break;case 17:n.push(e.number.toString());break;case 4:r.push(n.join(" ")),n.length=0}})),n.length&&r.push(n.join(" ")),r.map((function(e){return-1===e.indexOf(" ")?e:"'"+e+"'"}))}},eo={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},to={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(e,t){return Dn(t)?t.number:Pn(t)&&"bold"===t.value?700:400}},no={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return t.filter(Pn).map((function(e){return e.value}))}},ro={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){switch(t){case"oblique":return"oblique";case"italic":return"italic";default:return"normal"}}},io=function(e,t){return 0!==(e&t)},oo={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(e,t){if(0===t.length)return[];var n=t[0];return 20===n.type&&"none"===n.value?[]:t}},ao={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(0===t.length)return null;var n=t[0];if(20===n.type&&"none"===n.value)return null;for(var r=[],i=t.filter(kn),o=0;o<i.length;o++){var a=i[o],s=i[o+1];if(20===a.type){var A=s&&Dn(s)?s.number:1;r.push({counter:a.value,increment:A})}}return r}},so={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(0===t.length)return[];for(var n=[],r=t.filter(kn),i=0;i<r.length;i++){var o=r[i],a=r[i+1];if(Pn(o)&&"none"!==o.value){var s=a&&Dn(a)?a.number:0;n.push({counter:o.value,reset:s})}}return n}},Ao={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(e,t){return t.filter(Nn).map((function(t){return Xi.parse(e,t)}))}},co={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(0===t.length)return null;var n=t[0];if(20===n.type&&"none"===n.value)return null;var r=[],i=t.filter(Un);if(i.length%2!==0)return null;for(var o=0;o<i.length;o+=2){var a=i[o].value,s=i[o+1].value;r.push({open:a,close:s})}return r}},lo=function(e,t,n){if(!e)return"";var r=e[Math.min(t,e.length-1)];return r?n?r.open:r.close:""},uo={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return 1===t.length&&Ln(t[0],"none")?[]:Fn(t).map((function(t){for(var n={color:255,offsetX:Kn,offsetY:Kn,blur:Kn,spread:Kn,inset:!1},r=0,i=0;i<t.length;i++){var o=t[i];Ln(o,"inset")?n.inset=!0:Qn(o)?(0===r?n.offsetX=o:1===r?n.offsetY=o:2===r?n.blur=o:n.spread=o,r++):n.color=nr.parse(e,o)}return n}))}},ho={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(e,t){var n=[0,1,2],r=[];return t.filter(Pn).forEach((function(e){switch(e.value){case"stroke":r.push(1);break;case"fill":r.push(0);break;case"markers":r.push(2)}})),n.forEach((function(e){-1===r.indexOf(e)&&r.push(e)})),r}},po={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},fo={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(e,t){return Nn(t)?t.number:0}},Eo=function(){function e(e,t){var n,r;this.animationDuration=_o(e,Ao,t.animationDuration),this.backgroundClip=_o(e,hr,t.backgroundClip),this.backgroundColor=_o(e,pr,t.backgroundColor),this.backgroundImage=_o(e,Fr,t.backgroundImage),this.backgroundOrigin=_o(e,xr,t.backgroundOrigin),this.backgroundPosition=_o(e,Qr,t.backgroundPosition),this.backgroundRepeat=_o(e,Vr,t.backgroundRepeat),this.backgroundSize=_o(e,jr,t.backgroundSize),this.borderTopColor=_o(e,Yr,t.borderTopColor),this.borderRightColor=_o(e,Jr,t.borderRightColor),this.borderBottomColor=_o(e,Xr,t.borderBottomColor),this.borderLeftColor=_o(e,zr,t.borderLeftColor),this.borderTopLeftRadius=_o(e,Zr,t.borderTopLeftRadius),this.borderTopRightRadius=_o(e,$r,t.borderTopRightRadius),this.borderBottomRightRadius=_o(e,ei,t.borderBottomRightRadius),this.borderBottomLeftRadius=_o(e,ti,t.borderBottomLeftRadius),this.borderTopStyle=_o(e,ri,t.borderTopStyle),this.borderRightStyle=_o(e,ii,t.borderRightStyle),this.borderBottomStyle=_o(e,oi,t.borderBottomStyle),this.borderLeftStyle=_o(e,ai,t.borderLeftStyle),this.borderTopWidth=_o(e,Ai,t.borderTopWidth),this.borderRightWidth=_o(e,ci,t.borderRightWidth),this.borderBottomWidth=_o(e,li,t.borderBottomWidth),this.borderLeftWidth=_o(e,di,t.borderLeftWidth),this.boxShadow=_o(e,uo,t.boxShadow),this.color=_o(e,ui,t.color),this.direction=_o(e,hi,t.direction),this.display=_o(e,pi,t.display),this.float=_o(e,Ei,t.cssFloat),this.fontFamily=_o(e,$i,t.fontFamily),this.fontSize=_o(e,eo,t.fontSize),this.fontStyle=_o(e,ro,t.fontStyle),this.fontVariant=_o(e,no,t.fontVariant),this.fontWeight=_o(e,to,t.fontWeight),this.letterSpacing=_o(e,gi,t.letterSpacing),this.lineBreak=_o(e,_i,t.lineBreak),this.lineHeight=_o(e,Ci,t.lineHeight),this.listStyleImage=_o(e,Si,t.listStyleImage),this.listStylePosition=_o(e,Ti,t.listStylePosition),this.listStyleType=_o(e,vi,t.listStyleType),this.marginTop=_o(e,Ii,t.marginTop),this.marginRight=_o(e,Ri,t.marginRight),this.marginBottom=_o(e,bi,t.marginBottom),this.marginLeft=_o(e,Oi,t.marginLeft),this.opacity=_o(e,zi,t.opacity);var i=_o(e,Bi,t.overflow);this.overflowX=i[0],this.overflowY=i[i.length>1?1:0],this.overflowWrap=_o(e,Ni,t.overflowWrap),this.paddingTop=_o(e,Pi,t.paddingTop),this.paddingRight=_o(e,Ui,t.paddingRight),this.paddingBottom=_o(e,Li,t.paddingBottom),this.paddingLeft=_o(e,ki,t.paddingLeft),this.paintOrder=_o(e,ho,t.paintOrder),this.position=_o(e,Fi,t.position),this.textAlign=_o(e,Mi,t.textAlign),this.textDecorationColor=_o(e,qi,null!==(n=t.textDecorationColor)&&void 0!==n?n:t.color),this.textDecorationLine=_o(e,Zi,null!==(r=t.textDecorationLine)&&void 0!==r?r:t.textDecoration),this.textShadow=_o(e,xi,t.textShadow),this.textTransform=_o(e,Qi,t.textTransform),this.transform=_o(e,Vi,t.transform),this.transformOrigin=_o(e,Gi,t.transformOrigin),this.visibility=_o(e,Wi,t.visibility),this.webkitTextStrokeColor=_o(e,po,t.webkitTextStrokeColor),this.webkitTextStrokeWidth=_o(e,fo,t.webkitTextStrokeWidth),this.wordBreak=_o(e,Yi,t.wordBreak),this.zIndex=_o(e,Ji,t.zIndex)}return e.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&0===this.visibility},e.prototype.isTransparent=function(){return rr(this.backgroundColor)},e.prototype.isTransformed=function(){return null!==this.transform},e.prototype.isPositioned=function(){return 0!==this.position},e.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},e.prototype.isFloating=function(){return 0!==this.float},e.prototype.isInlineLevel=function(){return io(this.display,4)||io(this.display,33554432)||io(this.display,268435456)||io(this.display,536870912)||io(this.display,67108864)||io(this.display,134217728)},e}(),go=function(){function e(e,t){this.content=_o(e,oo,t.content),this.quotes=_o(e,co,t.quotes)}return e}(),mo=function(){function e(e,t){this.counterIncrement=_o(e,ao,t.counterIncrement),this.counterReset=_o(e,so,t.counterReset)}return e}(),_o=function(e,t,n){var r=new On,i=null!==n&&"undefined"!==typeof n?n.toString():t.initialValue;r.write(i);var o=new Bn(r.read());switch(t.type){case 2:var a=o.parseComponentValue();return t.parse(e,Pn(a)?a.value:t.initialValue);case 0:return t.parse(e,o.parseComponentValue());case 1:return t.parse(e,o.parseComponentValues());case 4:return o.parseComponentValue();case 3:switch(t.format){case"angle":return Zn.parse(e,o.parseComponentValue());case"color":return nr.parse(e,o.parseComponentValue());case"image":return Ur.parse(e,o.parseComponentValue());case"length":var s=o.parseComponentValue();return Qn(s)?s:Kn;case"length-percentage":var A=o.parseComponentValue();return Vn(A)?A:Kn;case"time":return Xi.parse(e,o.parseComponentValue())}}},Co="data-html2canvas-debug",wo=function(e){switch(e.getAttribute(Co)){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},So=function(e,t){var n=wo(e);return 1===n||t===n},To=function(){function e(e,t){this.context=e,this.textNodes=[],this.elements=[],this.flags=0,So(t,3),this.styles=new Eo(e,window.getComputedStyle(t,null)),ls(t)&&(this.styles.animationDuration.some((function(e){return e>0}))&&(t.style.animationDuration="0s"),null!==this.styles.transform&&(t.style.transform="none")),this.bounds=s(this.context,t),So(t,4)&&(this.flags|=16)}return e}(),vo="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",yo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Io="undefined"===typeof Uint8Array?[]:new Uint8Array(256),Ro=0;Ro<yo.length;Ro++)Io[yo.charCodeAt(Ro)]=Ro;for(var bo=function(e){var t,n,r,i,o,a=.75*e.length,s=e.length,A=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var c="undefined"!==typeof ArrayBuffer&&"undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint8Array.prototype.slice?new ArrayBuffer(a):new Array(a),l=Array.isArray(c)?c:new Uint8Array(c);for(t=0;t<s;t+=4)n=Io[e.charCodeAt(t)],r=Io[e.charCodeAt(t+1)],i=Io[e.charCodeAt(t+2)],o=Io[e.charCodeAt(t+3)],l[A++]=n<<2|r>>4,l[A++]=(15&r)<<4|i>>2,l[A++]=(3&i)<<6|63&o;return c},Oo=function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n.push(e[r+1]<<8|e[r]);return n},Bo=function(e){for(var t=e.length,n=[],r=0;r<t;r+=4)n.push(e[r+3]<<24|e[r+2]<<16|e[r+1]<<8|e[r]);return n},No=5,Do=11,Po=2,Uo=65536>>No,Lo=(1<<No)-1,ko=Uo+(1024>>No)+32,Mo=65536>>Do,Fo=(1<<Do-No)-1,xo=function(e,t,n){return e.slice?e.slice(t,n):new Uint16Array(Array.prototype.slice.call(e,t,n))},Qo=function(e,t,n){return e.slice?e.slice(t,n):new Uint32Array(Array.prototype.slice.call(e,t,n))},Vo=function(e,t){var n=bo(e),r=Array.isArray(n)?Bo(n):new Uint32Array(n),i=Array.isArray(n)?Oo(n):new Uint16Array(n),o=24,a=xo(i,o/2,r[4]/2),s=2===r[5]?xo(i,(o+r[4])/2):Qo(r,Math.ceil((o+r[4])/4));return new Ho(r[0],r[1],r[2],r[3],a,s)},Ho=function(){function e(e,t,n,r,i,o){this.initialValue=e,this.errorValue=t,this.highStart=n,this.highValueIndex=r,this.index=i,this.data=o}return e.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=((t=this.index[e>>No])<<Po)+(e&Lo),this.data[t];if(e<=65535)return t=((t=this.index[Uo+(e-55296>>No)])<<Po)+(e&Lo),this.data[t];if(e<this.highStart)return t=ko-Mo+(e>>Do),t=this.index[t],t+=e>>No&Fo,t=((t=this.index[t])<<Po)+(e&Lo),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},e}(),Ko="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",jo="undefined"===typeof Uint8Array?[]:new Uint8Array(256),Go=0;Go<Ko.length;Go++)jo[Ko.charCodeAt(Go)]=Go;var Wo,Yo=1,Jo=2,Xo=3,zo=4,qo=5,Zo=7,$o=8,ea=9,ta=10,na=11,ra=12,ia=13,oa=14,aa=15,sa=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=e.charCodeAt(n++);if(i>=55296&&i<=56319&&n<r){var o=e.charCodeAt(n++);56320===(64512&o)?t.push(((1023&i)<<10)+(1023&o)+65536):(t.push(i),n--)}else t.push(i)}return t},Aa=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,e);var n=e.length;if(!n)return"";for(var r=[],i=-1,o="";++i<n;){var a=e[i];a<=65535?r.push(a):(a-=65536,r.push(55296+(a>>10),a%1024+56320)),(i+1===n||r.length>16384)&&(o+=String.fromCharCode.apply(String,r),r.length=0)}return o},ca=Vo(vo),la="\xd7",da="\xf7",ua=function(e){return ca.get(e)},ha=function(e,t,n){var r=n-2,i=t[r],o=t[n-1],a=t[n];if(o===Jo&&a===Xo)return la;if(o===Jo||o===Xo||o===zo)return da;if(a===Jo||a===Xo||a===zo)return da;if(o===$o&&-1!==[$o,ea,na,ra].indexOf(a))return la;if((o===na||o===ea)&&(a===ea||a===ta))return la;if((o===ra||o===ta)&&a===ta)return la;if(a===ia||a===qo)return la;if(a===Zo)return la;if(o===Yo)return la;if(o===ia&&a===oa){for(;i===qo;)i=t[--r];if(i===oa)return la}if(o===aa&&a===aa){for(var s=0;i===aa;)s++,i=t[--r];if(s%2===0)return la}return da},pa=function(e){var t=sa(e),n=t.length,r=0,i=0,o=t.map(ua);return{next:function(){if(r>=n)return{done:!0,value:null};for(var e=la;r<n&&(e=ha(t,o,++r))===la;);if(e!==la||r===n){var a=Aa.apply(null,t.slice(i,r));return i=r,{value:a,done:!1}}return{done:!0,value:null}}}},fa=function(e){for(var t,n=pa(e),r=[];!(t=n.next()).done;)t.value&&r.push(t.value.slice());return r},Ea=function(e){var t=123;if(e.createRange){var n=e.createRange();if(n.getBoundingClientRect){var r=e.createElement("boundtest");r.style.height=t+"px",r.style.display="block",e.body.appendChild(r),n.selectNode(r);var i=n.getBoundingClientRect(),o=Math.round(i.height);if(e.body.removeChild(r),o===t)return!0}}return!1},ga=function(e){var t=e.createElement("boundtest");t.style.width="50px",t.style.display="block",t.style.fontSize="12px",t.style.letterSpacing="0px",t.style.wordSpacing="0px",e.body.appendChild(t);var n=e.createRange();t.innerHTML="function"===typeof"".repeat?"&#128104;".repeat(10):"";var r=t.firstChild,i=c(r.data).map((function(e){return l(e)})),o=0,a={},s=i.every((function(e,t){n.setStart(r,o),n.setEnd(r,o+e.length);var i=n.getBoundingClientRect();o+=e.length;var s=i.x>a.x||i.y>a.y;return a=i,0===t||s}));return e.body.removeChild(t),s},ma=function(){return"undefined"!==typeof(new Image).crossOrigin},_a=function(){return"string"===typeof(new XMLHttpRequest).responseType},Ca=function(e){var t=new Image,n=e.createElement("canvas"),r=n.getContext("2d");if(!r)return!1;t.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{r.drawImage(t,0,0),n.toDataURL()}catch(Mt){return!1}return!0},wa=function(e){return 0===e[0]&&255===e[1]&&0===e[2]&&255===e[3]},Sa=function(e){var t=e.createElement("canvas"),n=100;t.width=n,t.height=n;var r=t.getContext("2d");if(!r)return Promise.reject(!1);r.fillStyle="rgb(0, 255, 0)",r.fillRect(0,0,n,n);var i=new Image,o=t.toDataURL();i.src=o;var a=Ta(n,n,0,0,i);return r.fillStyle="red",r.fillRect(0,0,n,n),va(a).then((function(t){r.drawImage(t,0,0);var i=r.getImageData(0,0,n,n).data;r.fillStyle="red",r.fillRect(0,0,n,n);var a=e.createElement("div");return a.style.backgroundImage="url("+o+")",a.style.height=n+"px",wa(i)?va(Ta(n,n,0,0,a)):Promise.reject(!1)})).then((function(e){return r.drawImage(e,0,0),wa(r.getImageData(0,0,n,n).data)})).catch((function(){return!1}))},Ta=function(e,t,n,r,i){var o="http://www.w3.org/2000/svg",a=document.createElementNS(o,"svg"),s=document.createElementNS(o,"foreignObject");return a.setAttributeNS(null,"width",e.toString()),a.setAttributeNS(null,"height",t.toString()),s.setAttributeNS(null,"width","100%"),s.setAttributeNS(null,"height","100%"),s.setAttributeNS(null,"x",n.toString()),s.setAttributeNS(null,"y",r.toString()),s.setAttributeNS(null,"externalResourcesRequired","true"),a.appendChild(s),s.appendChild(i),a},va=function(e){return new Promise((function(t,n){var r=new Image;r.onload=function(){return t(r)},r.onerror=n,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(e))}))},ya={get SUPPORT_RANGE_BOUNDS(){var e=Ea(document);return Object.defineProperty(ya,"SUPPORT_RANGE_BOUNDS",{value:e}),e},get SUPPORT_WORD_BREAKING(){var e=ya.SUPPORT_RANGE_BOUNDS&&ga(document);return Object.defineProperty(ya,"SUPPORT_WORD_BREAKING",{value:e}),e},get SUPPORT_SVG_DRAWING(){var e=Ca(document);return Object.defineProperty(ya,"SUPPORT_SVG_DRAWING",{value:e}),e},get SUPPORT_FOREIGNOBJECT_DRAWING(){var e="function"===typeof Array.from&&"function"===typeof window.fetch?Sa(document):Promise.resolve(!1);return Object.defineProperty(ya,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:e}),e},get SUPPORT_CORS_IMAGES(){var e=ma();return Object.defineProperty(ya,"SUPPORT_CORS_IMAGES",{value:e}),e},get SUPPORT_RESPONSE_TYPE(){var e=_a();return Object.defineProperty(ya,"SUPPORT_RESPONSE_TYPE",{value:e}),e},get SUPPORT_CORS_XHR(){var e="withCredentials"in new XMLHttpRequest;return Object.defineProperty(ya,"SUPPORT_CORS_XHR",{value:e}),e},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var e=!("undefined"===typeof Intl||!Intl.Segmenter);return Object.defineProperty(ya,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:e}),e}},Ia=function(){function e(e,t){this.text=e,this.bounds=t}return e}(),Ra=function(e,t,n,r){var i=Da(t,n),o=[],s=0;return i.forEach((function(t){if(n.textDecorationLine.length||t.trim().length>0)if(ya.SUPPORT_RANGE_BOUNDS){var i=Oa(r,s,t.length).getClientRects();if(i.length>1){var A=Ba(t),c=0;A.forEach((function(t){o.push(new Ia(t,a.fromDOMRectList(e,Oa(r,c+s,t.length).getClientRects()))),c+=t.length}))}else o.push(new Ia(t,a.fromDOMRectList(e,i)))}else{var l=r.splitText(t.length);o.push(new Ia(t,ba(e,r))),r=l}else ya.SUPPORT_RANGE_BOUNDS||(r=r.splitText(t.length));s+=t.length})),o},ba=function(e,t){var n=t.ownerDocument;if(n){var r=n.createElement("html2canvaswrapper");r.appendChild(t.cloneNode(!0));var i=t.parentNode;if(i){i.replaceChild(r,t);var o=s(e,r);return r.firstChild&&i.replaceChild(r.firstChild,r),o}}return a.EMPTY},Oa=function(e,t,n){var r=e.ownerDocument;if(!r)throw new Error("Node has no owner document");var i=r.createRange();return i.setStart(e,t),i.setEnd(e,t+n),i},Ba=function(e){if(ya.SUPPORT_NATIVE_TEXT_SEGMENTATION){var t=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(t.segment(e)).map((function(e){return e.segment}))}return fa(e)},Na=function(e,t){if(ya.SUPPORT_NATIVE_TEXT_SEGMENTATION){var n=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(n.segment(e)).map((function(e){return e.segment}))}return Ua(e,t)},Da=function(e,t){return 0!==t.letterSpacing?Ba(e):Na(e,t)},Pa=[32,160,4961,65792,65793,4153,4241],Ua=function(e,t){for(var n,r=He(e,{lineBreak:t.lineBreak,wordBreak:"break-word"===t.overflowWrap?"break-word":t.wordBreak}),i=[],o=function(){if(n.value){var e=n.value.slice(),t=c(e),r="";t.forEach((function(e){-1===Pa.indexOf(e)?r+=l(e):(r.length&&i.push(r),i.push(l(e)),r="")})),r.length&&i.push(r)}};!(n=r.next()).done;)o();return i},La=function(){function e(e,t,n){this.text=ka(t.data,n.textTransform),this.textBounds=Ra(e,this.text,n,t)}return e}(),ka=function(e,t){switch(t){case 1:return e.toLowerCase();case 3:return e.replace(Ma,Fa);case 2:return e.toUpperCase();default:return e}},Ma=/(^|\s|:|-|\(|\))([a-z])/g,Fa=function(e,t,n){return e.length>0?t+n.toUpperCase():e},xa=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.src=n.currentSrc||n.src,r.intrinsicWidth=n.naturalWidth,r.intrinsicHeight=n.naturalHeight,r.context.cache.addImage(r.src),r}return t(n,e),n}(To),Qa=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.canvas=n,r.intrinsicWidth=n.width,r.intrinsicHeight=n.height,r}return t(n,e),n}(To),Va=function(e){function n(t,n){var r=e.call(this,t,n)||this,i=new XMLSerializer,o=s(t,n);return n.setAttribute("width",o.width+"px"),n.setAttribute("height",o.height+"px"),r.svg="data:image/svg+xml,"+encodeURIComponent(i.serializeToString(n)),r.intrinsicWidth=n.width.baseVal.value,r.intrinsicHeight=n.height.baseVal.value,r.context.cache.addImage(r.svg),r}return t(n,e),n}(To),Ha=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.value=n.value,r}return t(n,e),n}(To),Ka=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.start=n.start,r.reversed="boolean"===typeof n.reversed&&!0===n.reversed,r}return t(n,e),n}(To),ja=[{type:15,flags:0,unit:"px",number:3}],Ga=[{type:16,flags:0,number:50}],Wa=function(e){return e.width>e.height?new a(e.left+(e.width-e.height)/2,e.top,e.height,e.height):e.width<e.height?new a(e.left,e.top+(e.height-e.width)/2,e.width,e.width):e},Ya=function(e){var t=e.type===za?new Array(e.value.length+1).join("\u2022"):e.value;return 0===t.length?e.placeholder||"":t},Ja="checkbox",Xa="radio",za="password",qa=707406591,Za=function(e){function n(t,n){var r=e.call(this,t,n)||this;switch(r.type=n.type.toLowerCase(),r.checked=n.checked,r.value=Ya(n),r.type!==Ja&&r.type!==Xa||(r.styles.backgroundColor=3739148031,r.styles.borderTopColor=r.styles.borderRightColor=r.styles.borderBottomColor=r.styles.borderLeftColor=2779096575,r.styles.borderTopWidth=r.styles.borderRightWidth=r.styles.borderBottomWidth=r.styles.borderLeftWidth=1,r.styles.borderTopStyle=r.styles.borderRightStyle=r.styles.borderBottomStyle=r.styles.borderLeftStyle=1,r.styles.backgroundClip=[0],r.styles.backgroundOrigin=[0],r.bounds=Wa(r.bounds)),r.type){case Ja:r.styles.borderTopRightRadius=r.styles.borderTopLeftRadius=r.styles.borderBottomRightRadius=r.styles.borderBottomLeftRadius=ja;break;case Xa:r.styles.borderTopRightRadius=r.styles.borderTopLeftRadius=r.styles.borderBottomRightRadius=r.styles.borderBottomLeftRadius=Ga}return r}return t(n,e),n}(To),$a=function(e){function n(t,n){var r=e.call(this,t,n)||this,i=n.options[n.selectedIndex||0];return r.value=i&&i.text||"",r}return t(n,e),n}(To),es=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.value=n.value,r}return t(n,e),n}(To),ts=function(e){function n(t,n){var r=e.call(this,t,n)||this;r.src=n.src,r.width=parseInt(n.width,10)||0,r.height=parseInt(n.height,10)||0,r.backgroundColor=r.styles.backgroundColor;try{if(n.contentWindow&&n.contentWindow.document&&n.contentWindow.document.documentElement){r.tree=os(t,n.contentWindow.document.documentElement);var i=n.contentWindow.document.documentElement?dr(t,getComputedStyle(n.contentWindow.document.documentElement).backgroundColor):ur.TRANSPARENT,o=n.contentWindow.document.body?dr(t,getComputedStyle(n.contentWindow.document.body).backgroundColor):ur.TRANSPARENT;r.backgroundColor=rr(i)?rr(o)?r.styles.backgroundColor:o:i}}catch(Mt){}return r}return t(n,e),n}(To),ns=["OL","UL","MENU"],rs=function(e,t,n,r){for(var i=t.firstChild,o=void 0;i;i=o)if(o=i.nextSibling,As(i)&&i.data.trim().length>0)n.textNodes.push(new La(e,i,n.styles));else if(cs(i))if(Is(i)&&i.assignedNodes)i.assignedNodes().forEach((function(t){return rs(e,t,n,r)}));else{var a=is(e,i);a.styles.isVisible()&&(as(i,a,r)?a.flags|=4:ss(a.styles)&&(a.flags|=2),-1!==ns.indexOf(i.tagName)&&(a.flags|=8),n.elements.push(a),i.slot,i.shadowRoot?rs(e,i.shadowRoot,a,r):vs(i)||Es(i)||ys(i)||rs(e,i,a,r))}},is=function(e,t){return Cs(t)?new xa(e,t):ms(t)?new Qa(e,t):Es(t)?new Va(e,t):us(t)?new Ha(e,t):hs(t)?new Ka(e,t):ps(t)?new Za(e,t):ys(t)?new $a(e,t):vs(t)?new es(e,t):ws(t)?new ts(e,t):new To(e,t)},os=function(e,t){var n=is(e,t);return n.flags|=4,rs(e,t,n,n),n},as=function(e,t,n){return t.styles.isPositionedWithZIndex()||t.styles.opacity<1||t.styles.isTransformed()||gs(e)&&n.styles.isTransparent()},ss=function(e){return e.isPositioned()||e.isFloating()},As=function(e){return e.nodeType===Node.TEXT_NODE},cs=function(e){return e.nodeType===Node.ELEMENT_NODE},ls=function(e){return cs(e)&&"undefined"!==typeof e.style&&!ds(e)},ds=function(e){return"object"===typeof e.className},us=function(e){return"LI"===e.tagName},hs=function(e){return"OL"===e.tagName},ps=function(e){return"INPUT"===e.tagName},fs=function(e){return"HTML"===e.tagName},Es=function(e){return"svg"===e.tagName},gs=function(e){return"BODY"===e.tagName},ms=function(e){return"CANVAS"===e.tagName},_s=function(e){return"VIDEO"===e.tagName},Cs=function(e){return"IMG"===e.tagName},ws=function(e){return"IFRAME"===e.tagName},Ss=function(e){return"STYLE"===e.tagName},Ts=function(e){return"SCRIPT"===e.tagName},vs=function(e){return"TEXTAREA"===e.tagName},ys=function(e){return"SELECT"===e.tagName},Is=function(e){return"SLOT"===e.tagName},Rs=function(e){return e.tagName.indexOf("-")>0},bs=function(){function e(){this.counters={}}return e.prototype.getCounterValue=function(e){var t=this.counters[e];return t&&t.length?t[t.length-1]:1},e.prototype.getCounterValues=function(e){var t=this.counters[e];return t||[]},e.prototype.pop=function(e){var t=this;e.forEach((function(e){return t.counters[e].pop()}))},e.prototype.parse=function(e){var t=this,n=e.counterIncrement,r=e.counterReset,i=!0;null!==n&&n.forEach((function(e){var n=t.counters[e.counter];n&&0!==e.increment&&(i=!1,n.length||n.push(1),n[Math.max(0,n.length-1)]+=e.increment)}));var o=[];return i&&r.forEach((function(e){var n=t.counters[e.counter];o.push(e.counter),n||(n=t.counters[e.counter]=[]),n.push(e.reset)})),o},e}(),Os={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},Bs={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["\u0554","\u0553","\u0552","\u0551","\u0550","\u054f","\u054e","\u054d","\u054c","\u054b","\u054a","\u0549","\u0548","\u0547","\u0546","\u0545","\u0544","\u0543","\u0542","\u0541","\u0540","\u053f","\u053e","\u053d","\u053c","\u053b","\u053a","\u0539","\u0538","\u0537","\u0536","\u0535","\u0534","\u0533","\u0532","\u0531"]},Ns={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["\u05d9\u05f3","\u05d8\u05f3","\u05d7\u05f3","\u05d6\u05f3","\u05d5\u05f3","\u05d4\u05f3","\u05d3\u05f3","\u05d2\u05f3","\u05d1\u05f3","\u05d0\u05f3","\u05ea","\u05e9","\u05e8","\u05e7","\u05e6","\u05e4","\u05e2","\u05e1","\u05e0","\u05de","\u05dc","\u05db","\u05d9\u05d8","\u05d9\u05d7","\u05d9\u05d6","\u05d8\u05d6","\u05d8\u05d5","\u05d9","\u05d8","\u05d7","\u05d6","\u05d5","\u05d4","\u05d3","\u05d2","\u05d1","\u05d0"]},Ds={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["\u10f5","\u10f0","\u10ef","\u10f4","\u10ee","\u10ed","\u10ec","\u10eb","\u10ea","\u10e9","\u10e8","\u10e7","\u10e6","\u10e5","\u10e4","\u10f3","\u10e2","\u10e1","\u10e0","\u10df","\u10de","\u10dd","\u10f2","\u10dc","\u10db","\u10da","\u10d9","\u10d8","\u10d7","\u10f1","\u10d6","\u10d5","\u10d4","\u10d3","\u10d2","\u10d1","\u10d0"]},Ps=function(e,t,n,r,i,o){return e<t||e>n?Ws(e,i,o.length>0):r.integers.reduce((function(t,n,i){for(;e>=n;)e-=n,t+=r.values[i];return t}),"")+o},Us=function(e,t,n,r){var i="";do{n||e--,i=r(e)+i,e/=t}while(e*t>=t);return i},Ls=function(e,t,n,r,i){var o=n-t+1;return(e<0?"-":"")+(Us(Math.abs(e),o,r,(function(e){return l(Math.floor(e%o)+t)}))+i)},ks=function(e,t,n){void 0===n&&(n=". ");var r=t.length;return Us(Math.abs(e),r,!1,(function(e){return t[Math.floor(e%r)]}))+n},Ms=1,Fs=2,xs=4,Qs=8,Vs=function(e,t,n,r,i,o){if(e<-9999||e>9999)return Ws(e,4,i.length>0);var a=Math.abs(e),s=i;if(0===a)return t[0]+s;for(var A=0;a>0&&A<=4;A++){var c=a%10;0===c&&io(o,Ms)&&""!==s?s=t[c]+s:c>1||1===c&&0===A||1===c&&1===A&&io(o,Fs)||1===c&&1===A&&io(o,xs)&&e>100||1===c&&A>1&&io(o,Qs)?s=t[c]+(A>0?n[A-1]:"")+s:1===c&&A>0&&(s=n[A-1]+s),a=Math.floor(a/10)}return(e<0?r:"")+s},Hs="\u5341\u767e\u5343\u842c",Ks="\u62fe\u4f70\u4edf\u842c",js="\u30de\u30a4\u30ca\u30b9",Gs="\ub9c8\uc774\ub108\uc2a4",Ws=function(e,t,n){var r=n?". ":"",i=n?"\u3001":"",o=n?", ":"",a=n?" ":"";switch(t){case 0:return"\u2022"+a;case 1:return"\u25e6"+a;case 2:return"\u25fe"+a;case 5:var s=Ls(e,48,57,!0,r);return s.length<4?"0"+s:s;case 4:return ks(e,"\u3007\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d",i);case 6:return Ps(e,1,3999,Os,3,r).toLowerCase();case 7:return Ps(e,1,3999,Os,3,r);case 8:return Ls(e,945,969,!1,r);case 9:return Ls(e,97,122,!1,r);case 10:return Ls(e,65,90,!1,r);case 11:return Ls(e,1632,1641,!0,r);case 12:case 49:return Ps(e,1,9999,Bs,3,r);case 35:return Ps(e,1,9999,Bs,3,r).toLowerCase();case 13:return Ls(e,2534,2543,!0,r);case 14:case 30:return Ls(e,6112,6121,!0,r);case 15:return ks(e,"\u5b50\u4e11\u5bc5\u536f\u8fb0\u5df3\u5348\u672a\u7533\u9149\u620c\u4ea5",i);case 16:return ks(e,"\u7532\u4e59\u4e19\u4e01\u620a\u5df1\u5e9a\u8f9b\u58ec\u7678",i);case 17:case 48:return Vs(e,"\u96f6\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d",Hs,"\u8ca0",i,Fs|xs|Qs);case 47:return Vs(e,"\u96f6\u58f9\u8cb3\u53c3\u8086\u4f0d\u9678\u67d2\u634c\u7396",Ks,"\u8ca0",i,Ms|Fs|xs|Qs);case 42:return Vs(e,"\u96f6\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d",Hs,"\u8d1f",i,Fs|xs|Qs);case 41:return Vs(e,"\u96f6\u58f9\u8d30\u53c1\u8086\u4f0d\u9646\u67d2\u634c\u7396",Ks,"\u8d1f",i,Ms|Fs|xs|Qs);case 26:return Vs(e,"\u3007\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d","\u5341\u767e\u5343\u4e07",js,i,0);case 25:return Vs(e,"\u96f6\u58f1\u5f10\u53c2\u56db\u4f0d\u516d\u4e03\u516b\u4e5d","\u62fe\u767e\u5343\u4e07",js,i,Ms|Fs|xs);case 31:return Vs(e,"\uc601\uc77c\uc774\uc0bc\uc0ac\uc624\uc721\uce60\ud314\uad6c","\uc2ed\ubc31\ucc9c\ub9cc",Gs,o,Ms|Fs|xs);case 33:return Vs(e,"\u96f6\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d","\u5341\u767e\u5343\u842c",Gs,o,0);case 32:return Vs(e,"\u96f6\u58f9\u8cb3\u53c3\u56db\u4e94\u516d\u4e03\u516b\u4e5d","\u62fe\u767e\u5343",Gs,o,Ms|Fs|xs);case 18:return Ls(e,2406,2415,!0,r);case 20:return Ps(e,1,19999,Ds,3,r);case 21:return Ls(e,2790,2799,!0,r);case 22:return Ls(e,2662,2671,!0,r);case 22:return Ps(e,1,10999,Ns,3,r);case 23:return ks(e,"\u3042\u3044\u3046\u3048\u304a\u304b\u304d\u304f\u3051\u3053\u3055\u3057\u3059\u305b\u305d\u305f\u3061\u3064\u3066\u3068\u306a\u306b\u306c\u306d\u306e\u306f\u3072\u3075\u3078\u307b\u307e\u307f\u3080\u3081\u3082\u3084\u3086\u3088\u3089\u308a\u308b\u308c\u308d\u308f\u3090\u3091\u3092\u3093");case 24:return ks(e,"\u3044\u308d\u306f\u306b\u307b\u3078\u3068\u3061\u308a\u306c\u308b\u3092\u308f\u304b\u3088\u305f\u308c\u305d\u3064\u306d\u306a\u3089\u3080\u3046\u3090\u306e\u304a\u304f\u3084\u307e\u3051\u3075\u3053\u3048\u3066\u3042\u3055\u304d\u3086\u3081\u307f\u3057\u3091\u3072\u3082\u305b\u3059");case 27:return Ls(e,3302,3311,!0,r);case 28:return ks(e,"\u30a2\u30a4\u30a6\u30a8\u30aa\u30ab\u30ad\u30af\u30b1\u30b3\u30b5\u30b7\u30b9\u30bb\u30bd\u30bf\u30c1\u30c4\u30c6\u30c8\u30ca\u30cb\u30cc\u30cd\u30ce\u30cf\u30d2\u30d5\u30d8\u30db\u30de\u30df\u30e0\u30e1\u30e2\u30e4\u30e6\u30e8\u30e9\u30ea\u30eb\u30ec\u30ed\u30ef\u30f0\u30f1\u30f2\u30f3",i);case 29:return ks(e,"\u30a4\u30ed\u30cf\u30cb\u30db\u30d8\u30c8\u30c1\u30ea\u30cc\u30eb\u30f2\u30ef\u30ab\u30e8\u30bf\u30ec\u30bd\u30c4\u30cd\u30ca\u30e9\u30e0\u30a6\u30f0\u30ce\u30aa\u30af\u30e4\u30de\u30b1\u30d5\u30b3\u30a8\u30c6\u30a2\u30b5\u30ad\u30e6\u30e1\u30df\u30b7\u30f1\u30d2\u30e2\u30bb\u30b9",i);case 34:return Ls(e,3792,3801,!0,r);case 37:return Ls(e,6160,6169,!0,r);case 38:return Ls(e,4160,4169,!0,r);case 39:return Ls(e,2918,2927,!0,r);case 40:return Ls(e,1776,1785,!0,r);case 43:return Ls(e,3046,3055,!0,r);case 44:return Ls(e,3174,3183,!0,r);case 45:return Ls(e,3664,3673,!0,r);case 46:return Ls(e,3872,3881,!0,r);default:return Ls(e,48,57,!0,r)}},Ys="data-html2canvas-ignore",Js=function(){function e(e,t,n){if(this.context=e,this.options=n,this.scrolledElements=[],this.referenceElement=t,this.counters=new bs,this.quoteDepth=0,!t.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(t.ownerDocument.documentElement,!1)}return e.prototype.toIFrame=function(e,t){var n=this,o=zs(e,t);if(!o.contentWindow)return Promise.reject("Unable to find iframe window");var a=e.defaultView.pageXOffset,s=e.defaultView.pageYOffset,A=o.contentWindow,c=A.document,l=$s(o).then((function(){return r(n,void 0,void 0,(function(){var e,n;return i(this,(function(r){switch(r.label){case 0:return this.scrolledElements.forEach(iA),A&&(A.scrollTo(t.left,t.top),!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)||A.scrollY===t.top&&A.scrollX===t.left||(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(A.scrollX-t.left,A.scrollY-t.top,0,0))),e=this.options.onclone,"undefined"===typeof(n=this.clonedReferenceElement)?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:c.fonts&&c.fonts.ready?[4,c.fonts.ready]:[3,2];case 1:r.sent(),r.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,Zs(c)]:[3,4];case 3:r.sent(),r.label=4;case 4:return"function"===typeof e?[2,Promise.resolve().then((function(){return e(c,n)})).then((function(){return o}))]:[2,o]}}))}))}));return c.open(),c.write(nA(document.doctype)+"<html></html>"),rA(this.referenceElement.ownerDocument,a,s),c.replaceChild(c.adoptNode(this.documentElement),c.documentElement),c.close(),l},e.prototype.createElementClone=function(e){if(So(e,2),ms(e))return this.createCanvasClone(e);if(_s(e))return this.createVideoClone(e);if(Ss(e))return this.createStyleClone(e);var t=e.cloneNode(!1);return Cs(t)&&(Cs(e)&&e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),"lazy"===t.loading&&(t.loading="eager")),Rs(t)?this.createCustomElementClone(t):t},e.prototype.createCustomElementClone=function(e){var t=document.createElement("html2canvascustomelement");return tA(e.style,t),t},e.prototype.createStyleClone=function(e){try{var t=e.sheet;if(t&&t.cssRules){var n=[].slice.call(t.cssRules,0).reduce((function(e,t){return t&&"string"===typeof t.cssText?e+t.cssText:e}),""),r=e.cloneNode(!1);return r.textContent=n,r}}catch(Mt){if(this.context.logger.error("Unable to access cssRules property",Mt),"SecurityError"!==Mt.name)throw Mt}return e.cloneNode(!1)},e.prototype.createCanvasClone=function(e){var t;if(this.options.inlineImages&&e.ownerDocument){var n=e.ownerDocument.createElement("img");try{return n.src=e.toDataURL(),n}catch(Mt){this.context.logger.info("Unable to inline canvas contents, canvas is tainted",e)}}var r=e.cloneNode(!1);try{r.width=e.width,r.height=e.height;var i=e.getContext("2d"),o=r.getContext("2d");if(o)if(!this.options.allowTaint&&i)o.putImageData(i.getImageData(0,0,e.width,e.height),0,0);else{var a=null!==(t=e.getContext("webgl2"))&&void 0!==t?t:e.getContext("webgl");if(a){var s=a.getContextAttributes();!1===(null===s||void 0===s?void 0:s.preserveDrawingBuffer)&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",e)}o.drawImage(e,0,0)}return r}catch(Mt){this.context.logger.info("Unable to clone canvas as it is tainted",e)}return r},e.prototype.createVideoClone=function(e){var t=e.ownerDocument.createElement("canvas");t.width=e.offsetWidth,t.height=e.offsetHeight;var n=t.getContext("2d");try{return n&&(n.drawImage(e,0,0,t.width,t.height),this.options.allowTaint||n.getImageData(0,0,t.width,t.height)),t}catch(Mt){this.context.logger.info("Unable to clone video as it is tainted",e)}var r=e.ownerDocument.createElement("canvas");return r.width=e.offsetWidth,r.height=e.offsetHeight,r},e.prototype.appendChildNode=function(e,t,n){cs(t)&&(Ts(t)||t.hasAttribute(Ys)||"function"===typeof this.options.ignoreElements&&this.options.ignoreElements(t))||this.options.copyStyles&&cs(t)&&Ss(t)||e.appendChild(this.cloneNode(t,n))},e.prototype.cloneChildNodes=function(e,t,n){for(var r=this,i=e.shadowRoot?e.shadowRoot.firstChild:e.firstChild;i;i=i.nextSibling)if(cs(i)&&Is(i)&&"function"===typeof i.assignedNodes){var o=i.assignedNodes();o.length&&o.forEach((function(e){return r.appendChildNode(t,e,n)}))}else this.appendChildNode(t,i,n)},e.prototype.cloneNode=function(e,t){if(As(e))return document.createTextNode(e.data);if(!e.ownerDocument)return e.cloneNode(!1);var n=e.ownerDocument.defaultView;if(n&&cs(e)&&(ls(e)||ds(e))){var r=this.createElementClone(e);r.style.transitionProperty="none";var i=n.getComputedStyle(e),o=n.getComputedStyle(e,":before"),a=n.getComputedStyle(e,":after");this.referenceElement===e&&ls(r)&&(this.clonedReferenceElement=r),gs(r)&&lA(r);var s=this.counters.parse(new mo(this.context,i)),A=this.resolvePseudoContent(e,r,o,Wo.BEFORE);Rs(e)&&(t=!0),_s(e)||this.cloneChildNodes(e,r,t),A&&r.insertBefore(A,r.firstChild);var c=this.resolvePseudoContent(e,r,a,Wo.AFTER);return c&&r.appendChild(c),this.counters.pop(s),(i&&(this.options.copyStyles||ds(e))&&!ws(e)||t)&&tA(i,r),0===e.scrollTop&&0===e.scrollLeft||this.scrolledElements.push([r,e.scrollLeft,e.scrollTop]),(vs(e)||ys(e))&&(vs(r)||ys(r))&&(r.value=e.value),r}return e.cloneNode(!1)},e.prototype.resolvePseudoContent=function(e,t,n,r){var i=this;if(n){var o=n.content,a=t.ownerDocument;if(a&&o&&"none"!==o&&"-moz-alt-content"!==o&&"none"!==n.display){this.counters.parse(new mo(this.context,n));var s=new go(this.context,n),A=a.createElement("html2canvaspseudoelement");tA(n,A),s.content.forEach((function(t){if(0===t.type)A.appendChild(a.createTextNode(t.value));else if(22===t.type){var n=a.createElement("img");n.src=t.value,n.style.opacity="1",A.appendChild(n)}else if(18===t.type){if("attr"===t.name){var r=t.values.filter(Pn);r.length&&A.appendChild(a.createTextNode(e.getAttribute(r[0].value)||""))}else if("counter"===t.name){var o=t.values.filter(Mn),c=o[0],l=o[1];if(c&&Pn(c)){var d=i.counters.getCounterValue(c.value),u=l&&Pn(l)?vi.parse(i.context,l.value):3;A.appendChild(a.createTextNode(Ws(d,u,!1)))}}else if("counters"===t.name){var h=t.values.filter(Mn),p=(c=h[0],h[1]);if(l=h[2],c&&Pn(c)){var f=i.counters.getCounterValues(c.value),E=l&&Pn(l)?vi.parse(i.context,l.value):3,g=p&&0===p.type?p.value:"",m=f.map((function(e){return Ws(e,E,!1)})).join(g);A.appendChild(a.createTextNode(m))}}}else if(20===t.type)switch(t.value){case"open-quote":A.appendChild(a.createTextNode(lo(s.quotes,i.quoteDepth++,!0)));break;case"close-quote":A.appendChild(a.createTextNode(lo(s.quotes,--i.quoteDepth,!1)));break;default:A.appendChild(a.createTextNode(t.value))}})),A.className=sA+" "+AA;var c=r===Wo.BEFORE?" "+sA:" "+AA;return ds(t)?t.className.baseValue+=c:t.className+=c,A}}},e.destroy=function(e){return!!e.parentNode&&(e.parentNode.removeChild(e),!0)},e}();!function(e){e[e.BEFORE=0]="BEFORE",e[e.AFTER=1]="AFTER"}(Wo||(Wo={}));var Xs,zs=function(e,t){var n=e.createElement("iframe");return n.className="html2canvas-container",n.style.visibility="hidden",n.style.position="fixed",n.style.left="-10000px",n.style.top="0px",n.style.border="0",n.width=t.width.toString(),n.height=t.height.toString(),n.scrolling="no",n.setAttribute(Ys,"true"),e.body.appendChild(n),n},qs=function(e){return new Promise((function(t){e.complete?t():e.src?(e.onload=t,e.onerror=t):t()}))},Zs=function(e){return Promise.all([].slice.call(e.images,0).map(qs))},$s=function(e){return new Promise((function(t,n){var r=e.contentWindow;if(!r)return n("No window assigned for iframe");var i=r.document;r.onload=e.onload=function(){r.onload=e.onload=null;var n=setInterval((function(){i.body.childNodes.length>0&&"complete"===i.readyState&&(clearInterval(n),t(e))}),50)}}))},eA=["all","d","content"],tA=function(e,t){for(var n=e.length-1;n>=0;n--){var r=e.item(n);-1===eA.indexOf(r)&&t.style.setProperty(r,e.getPropertyValue(r))}return t},nA=function(e){var t="";return e&&(t+="<!DOCTYPE ",e.name&&(t+=e.name),e.internalSubset&&(t+=e.internalSubset),e.publicId&&(t+='"'+e.publicId+'"'),e.systemId&&(t+='"'+e.systemId+'"'),t+=">"),t},rA=function(e,t,n){e&&e.defaultView&&(t!==e.defaultView.pageXOffset||n!==e.defaultView.pageYOffset)&&e.defaultView.scrollTo(t,n)},iA=function(e){var t=e[0],n=e[1],r=e[2];t.scrollLeft=n,t.scrollTop=r},oA=":before",aA=":after",sA="___html2canvas___pseudoelement_before",AA="___html2canvas___pseudoelement_after",cA='{\n    content: "" !important;\n    display: none !important;\n}',lA=function(e){dA(e,"."+sA+oA+cA+"\n         ."+AA+aA+cA)},dA=function(e,t){var n=e.ownerDocument;if(n){var r=n.createElement("style");r.textContent=t,e.appendChild(r)}},uA=function(){function e(){}return e.getOrigin=function(t){var n=e._link;return n?(n.href=t,n.href=n.href,n.protocol+n.hostname+n.port):"about:blank"},e.isSameOrigin=function(t){return e.getOrigin(t)===e._origin},e.setContext=function(t){e._link=t.document.createElement("a"),e._origin=e.getOrigin(t.location.href)},e._origin="about:blank",e}(),hA=function(){function e(e,t){this.context=e,this._options=t,this._cache={}}return e.prototype.addImage=function(e){var t=Promise.resolve();return this.has(e)?t:CA(e)||gA(e)?((this._cache[e]=this.loadImage(e)).catch((function(){})),t):t},e.prototype.match=function(e){return this._cache[e]},e.prototype.loadImage=function(e){return r(this,void 0,void 0,(function(){var t,n,r,o,a=this;return i(this,(function(i){switch(i.label){case 0:return t=uA.isSameOrigin(e),n=!mA(e)&&!0===this._options.useCORS&&ya.SUPPORT_CORS_IMAGES&&!t,r=!mA(e)&&!t&&!CA(e)&&"string"===typeof this._options.proxy&&ya.SUPPORT_CORS_XHR&&!n,t||!1!==this._options.allowTaint||mA(e)||CA(e)||r||n?(o=e,r?[4,this.proxy(o)]:[3,2]):[2];case 1:o=i.sent(),i.label=2;case 2:return this.context.logger.debug("Added image "+e.substring(0,256)),[4,new Promise((function(e,t){var r=new Image;r.onload=function(){return e(r)},r.onerror=t,(_A(o)||n)&&(r.crossOrigin="anonymous"),r.src=o,!0===r.complete&&setTimeout((function(){return e(r)}),500),a._options.imageTimeout>0&&setTimeout((function(){return t("Timed out ("+a._options.imageTimeout+"ms) loading image")}),a._options.imageTimeout)}))];case 3:return[2,i.sent()]}}))}))},e.prototype.has=function(e){return"undefined"!==typeof this._cache[e]},e.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},e.prototype.proxy=function(e){var t=this,n=this._options.proxy;if(!n)throw new Error("No proxy defined");var r=e.substring(0,256);return new Promise((function(i,o){var a=ya.SUPPORT_RESPONSE_TYPE?"blob":"text",s=new XMLHttpRequest;s.onload=function(){if(200===s.status)if("text"===a)i(s.response);else{var e=new FileReader;e.addEventListener("load",(function(){return i(e.result)}),!1),e.addEventListener("error",(function(e){return o(e)}),!1),e.readAsDataURL(s.response)}else o("Failed to proxy resource "+r+" with status code "+s.status)},s.onerror=o;var A=n.indexOf("?")>-1?"&":"?";if(s.open("GET",""+n+A+"url="+encodeURIComponent(e)+"&responseType="+a),"text"!==a&&s instanceof XMLHttpRequest&&(s.responseType=a),t._options.imageTimeout){var c=t._options.imageTimeout;s.timeout=c,s.ontimeout=function(){return o("Timed out ("+c+"ms) proxying "+r)}}s.send()}))},e}(),pA=/^data:image\/svg\+xml/i,fA=/^data:image\/.*;base64,/i,EA=/^data:image\/.*/i,gA=function(e){return ya.SUPPORT_SVG_DRAWING||!wA(e)},mA=function(e){return EA.test(e)},_A=function(e){return fA.test(e)},CA=function(e){return"blob"===e.substr(0,4)},wA=function(e){return"svg"===e.substr(-3).toLowerCase()||pA.test(e)},SA=function(){function e(e,t){this.type=0,this.x=e,this.y=t}return e.prototype.add=function(t,n){return new e(this.x+t,this.y+n)},e}(),TA=function(e,t,n){return new SA(e.x+(t.x-e.x)*n,e.y+(t.y-e.y)*n)},vA=function(){function e(e,t,n,r){this.type=1,this.start=e,this.startControl=t,this.endControl=n,this.end=r}return e.prototype.subdivide=function(t,n){var r=TA(this.start,this.startControl,t),i=TA(this.startControl,this.endControl,t),o=TA(this.endControl,this.end,t),a=TA(r,i,t),s=TA(i,o,t),A=TA(a,s,t);return n?new e(this.start,r,a,A):new e(A,s,o,this.end)},e.prototype.add=function(t,n){return new e(this.start.add(t,n),this.startControl.add(t,n),this.endControl.add(t,n),this.end.add(t,n))},e.prototype.reverse=function(){return new e(this.end,this.endControl,this.startControl,this.start)},e}(),yA=function(e){return 1===e.type},IA=function(){function e(e){var t=e.styles,n=e.bounds,r=Wn(t.borderTopLeftRadius,n.width,n.height),i=r[0],o=r[1],a=Wn(t.borderTopRightRadius,n.width,n.height),s=a[0],A=a[1],c=Wn(t.borderBottomRightRadius,n.width,n.height),l=c[0],d=c[1],u=Wn(t.borderBottomLeftRadius,n.width,n.height),h=u[0],p=u[1],f=[];f.push((i+s)/n.width),f.push((h+l)/n.width),f.push((o+p)/n.height),f.push((A+d)/n.height);var E=Math.max.apply(Math,f);E>1&&(i/=E,o/=E,s/=E,A/=E,l/=E,d/=E,h/=E,p/=E);var g=n.width-s,m=n.height-d,_=n.width-l,C=n.height-p,w=t.borderTopWidth,S=t.borderRightWidth,T=t.borderBottomWidth,v=t.borderLeftWidth,y=Yn(t.paddingTop,e.bounds.width),I=Yn(t.paddingRight,e.bounds.width),R=Yn(t.paddingBottom,e.bounds.width),b=Yn(t.paddingLeft,e.bounds.width);this.topLeftBorderDoubleOuterBox=i>0||o>0?RA(n.left+v/3,n.top+w/3,i-v/3,o-w/3,Xs.TOP_LEFT):new SA(n.left+v/3,n.top+w/3),this.topRightBorderDoubleOuterBox=i>0||o>0?RA(n.left+g,n.top+w/3,s-S/3,A-w/3,Xs.TOP_RIGHT):new SA(n.left+n.width-S/3,n.top+w/3),this.bottomRightBorderDoubleOuterBox=l>0||d>0?RA(n.left+_,n.top+m,l-S/3,d-T/3,Xs.BOTTOM_RIGHT):new SA(n.left+n.width-S/3,n.top+n.height-T/3),this.bottomLeftBorderDoubleOuterBox=h>0||p>0?RA(n.left+v/3,n.top+C,h-v/3,p-T/3,Xs.BOTTOM_LEFT):new SA(n.left+v/3,n.top+n.height-T/3),this.topLeftBorderDoubleInnerBox=i>0||o>0?RA(n.left+2*v/3,n.top+2*w/3,i-2*v/3,o-2*w/3,Xs.TOP_LEFT):new SA(n.left+2*v/3,n.top+2*w/3),this.topRightBorderDoubleInnerBox=i>0||o>0?RA(n.left+g,n.top+2*w/3,s-2*S/3,A-2*w/3,Xs.TOP_RIGHT):new SA(n.left+n.width-2*S/3,n.top+2*w/3),this.bottomRightBorderDoubleInnerBox=l>0||d>0?RA(n.left+_,n.top+m,l-2*S/3,d-2*T/3,Xs.BOTTOM_RIGHT):new SA(n.left+n.width-2*S/3,n.top+n.height-2*T/3),this.bottomLeftBorderDoubleInnerBox=h>0||p>0?RA(n.left+2*v/3,n.top+C,h-2*v/3,p-2*T/3,Xs.BOTTOM_LEFT):new SA(n.left+2*v/3,n.top+n.height-2*T/3),this.topLeftBorderStroke=i>0||o>0?RA(n.left+v/2,n.top+w/2,i-v/2,o-w/2,Xs.TOP_LEFT):new SA(n.left+v/2,n.top+w/2),this.topRightBorderStroke=i>0||o>0?RA(n.left+g,n.top+w/2,s-S/2,A-w/2,Xs.TOP_RIGHT):new SA(n.left+n.width-S/2,n.top+w/2),this.bottomRightBorderStroke=l>0||d>0?RA(n.left+_,n.top+m,l-S/2,d-T/2,Xs.BOTTOM_RIGHT):new SA(n.left+n.width-S/2,n.top+n.height-T/2),this.bottomLeftBorderStroke=h>0||p>0?RA(n.left+v/2,n.top+C,h-v/2,p-T/2,Xs.BOTTOM_LEFT):new SA(n.left+v/2,n.top+n.height-T/2),this.topLeftBorderBox=i>0||o>0?RA(n.left,n.top,i,o,Xs.TOP_LEFT):new SA(n.left,n.top),this.topRightBorderBox=s>0||A>0?RA(n.left+g,n.top,s,A,Xs.TOP_RIGHT):new SA(n.left+n.width,n.top),this.bottomRightBorderBox=l>0||d>0?RA(n.left+_,n.top+m,l,d,Xs.BOTTOM_RIGHT):new SA(n.left+n.width,n.top+n.height),this.bottomLeftBorderBox=h>0||p>0?RA(n.left,n.top+C,h,p,Xs.BOTTOM_LEFT):new SA(n.left,n.top+n.height),this.topLeftPaddingBox=i>0||o>0?RA(n.left+v,n.top+w,Math.max(0,i-v),Math.max(0,o-w),Xs.TOP_LEFT):new SA(n.left+v,n.top+w),this.topRightPaddingBox=s>0||A>0?RA(n.left+Math.min(g,n.width-S),n.top+w,g>n.width+S?0:Math.max(0,s-S),Math.max(0,A-w),Xs.TOP_RIGHT):new SA(n.left+n.width-S,n.top+w),this.bottomRightPaddingBox=l>0||d>0?RA(n.left+Math.min(_,n.width-v),n.top+Math.min(m,n.height-T),Math.max(0,l-S),Math.max(0,d-T),Xs.BOTTOM_RIGHT):new SA(n.left+n.width-S,n.top+n.height-T),this.bottomLeftPaddingBox=h>0||p>0?RA(n.left+v,n.top+Math.min(C,n.height-T),Math.max(0,h-v),Math.max(0,p-T),Xs.BOTTOM_LEFT):new SA(n.left+v,n.top+n.height-T),this.topLeftContentBox=i>0||o>0?RA(n.left+v+b,n.top+w+y,Math.max(0,i-(v+b)),Math.max(0,o-(w+y)),Xs.TOP_LEFT):new SA(n.left+v+b,n.top+w+y),this.topRightContentBox=s>0||A>0?RA(n.left+Math.min(g,n.width+v+b),n.top+w+y,g>n.width+v+b?0:s-v+b,A-(w+y),Xs.TOP_RIGHT):new SA(n.left+n.width-(S+I),n.top+w+y),this.bottomRightContentBox=l>0||d>0?RA(n.left+Math.min(_,n.width-(v+b)),n.top+Math.min(m,n.height+w+y),Math.max(0,l-(S+I)),d-(T+R),Xs.BOTTOM_RIGHT):new SA(n.left+n.width-(S+I),n.top+n.height-(T+R)),this.bottomLeftContentBox=h>0||p>0?RA(n.left+v+b,n.top+C,Math.max(0,h-(v+b)),p-(T+R),Xs.BOTTOM_LEFT):new SA(n.left+v+b,n.top+n.height-(T+R))}return e}();!function(e){e[e.TOP_LEFT=0]="TOP_LEFT",e[e.TOP_RIGHT=1]="TOP_RIGHT",e[e.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",e[e.BOTTOM_LEFT=3]="BOTTOM_LEFT"}(Xs||(Xs={}));var RA=function(e,t,n,r,i){var o=(Math.sqrt(2)-1)/3*4,a=n*o,s=r*o,A=e+n,c=t+r;switch(i){case Xs.TOP_LEFT:return new vA(new SA(e,c),new SA(e,c-s),new SA(A-a,t),new SA(A,t));case Xs.TOP_RIGHT:return new vA(new SA(e,t),new SA(e+a,t),new SA(A,c-s),new SA(A,c));case Xs.BOTTOM_RIGHT:return new vA(new SA(A,t),new SA(A,t+s),new SA(e+a,c),new SA(e,c));case Xs.BOTTOM_LEFT:default:return new vA(new SA(A,c),new SA(A-a,c),new SA(e,t+s),new SA(e,t))}},bA=function(e){return[e.topLeftBorderBox,e.topRightBorderBox,e.bottomRightBorderBox,e.bottomLeftBorderBox]},OA=function(e){return[e.topLeftContentBox,e.topRightContentBox,e.bottomRightContentBox,e.bottomLeftContentBox]},BA=function(e){return[e.topLeftPaddingBox,e.topRightPaddingBox,e.bottomRightPaddingBox,e.bottomLeftPaddingBox]},NA=function(){function e(e,t,n){this.offsetX=e,this.offsetY=t,this.matrix=n,this.type=0,this.target=6}return e}(),DA=function(){function e(e,t){this.path=e,this.target=t,this.type=1}return e}(),PA=function(){function e(e){this.opacity=e,this.type=2,this.target=6}return e}(),UA=function(e){return 0===e.type},LA=function(e){return 1===e.type},kA=function(e){return 2===e.type},MA=function(e,t){return e.length===t.length&&e.some((function(e,n){return e===t[n]}))},FA=function(e,t,n,r,i){return e.map((function(e,o){switch(o){case 0:return e.add(t,n);case 1:return e.add(t+r,n);case 2:return e.add(t+r,n+i);case 3:return e.add(t,n+i)}return e}))},xA=function(){function e(e){this.element=e,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return e}(),QA=function(){function e(e,t){if(this.container=e,this.parent=t,this.effects=[],this.curves=new IA(this.container),this.container.styles.opacity<1&&this.effects.push(new PA(this.container.styles.opacity)),null!==this.container.styles.transform){var n=this.container.bounds.left+this.container.styles.transformOrigin[0].number,r=this.container.bounds.top+this.container.styles.transformOrigin[1].number,i=this.container.styles.transform;this.effects.push(new NA(n,r,i))}if(0!==this.container.styles.overflowX){var o=bA(this.curves),a=BA(this.curves);MA(o,a)?this.effects.push(new DA(o,6)):(this.effects.push(new DA(o,2)),this.effects.push(new DA(a,4)))}}return e.prototype.getEffects=function(e){for(var t=-1===[2,3].indexOf(this.container.styles.position),n=this.parent,r=this.effects.slice(0);n;){var i=n.effects.filter((function(e){return!LA(e)}));if(t||0!==n.container.styles.position||!n.parent){if(r.unshift.apply(r,i),t=-1===[2,3].indexOf(n.container.styles.position),0!==n.container.styles.overflowX){var o=bA(n.curves),a=BA(n.curves);MA(o,a)||r.unshift(new DA(a,6))}}else r.unshift.apply(r,i);n=n.parent}return r.filter((function(t){return io(t.target,e)}))},e}(),VA=function(e,t,n,r){e.container.elements.forEach((function(i){var o=io(i.flags,4),a=io(i.flags,2),s=new QA(i,e);io(i.styles.display,2048)&&r.push(s);var A=io(i.flags,8)?[]:r;if(o||a){var c=o||i.styles.isPositioned()?n:t,l=new xA(s);if(i.styles.isPositioned()||i.styles.opacity<1||i.styles.isTransformed()){var d=i.styles.zIndex.order;if(d<0){var u=0;c.negativeZIndex.some((function(e,t){return d>e.element.container.styles.zIndex.order?(u=t,!1):u>0})),c.negativeZIndex.splice(u,0,l)}else if(d>0){var h=0;c.positiveZIndex.some((function(e,t){return d>=e.element.container.styles.zIndex.order?(h=t+1,!1):h>0})),c.positiveZIndex.splice(h,0,l)}else c.zeroOrAutoZIndexOrTransformedOrOpacity.push(l)}else i.styles.isFloating()?c.nonPositionedFloats.push(l):c.nonPositionedInlineLevel.push(l);VA(s,l,o?l:n,A)}else i.styles.isInlineLevel()?t.inlineLevel.push(s):t.nonInlineLevel.push(s),VA(s,t,n,A);io(i.flags,8)&&HA(i,A)}))},HA=function(e,t){for(var n=e instanceof Ka?e.start:1,r=e instanceof Ka&&e.reversed,i=0;i<t.length;i++){var o=t[i];o.container instanceof Ha&&"number"===typeof o.container.value&&0!==o.container.value&&(n=o.container.value),o.listValue=Ws(n,o.container.styles.listStyleType,!0),n+=r?-1:1}},KA=function(e){var t=new QA(e,null),n=new xA(t),r=[];return VA(t,n,n,r),HA(t.container,r),n},jA=function(e,t){switch(t){case 0:return XA(e.topLeftBorderBox,e.topLeftPaddingBox,e.topRightBorderBox,e.topRightPaddingBox);case 1:return XA(e.topRightBorderBox,e.topRightPaddingBox,e.bottomRightBorderBox,e.bottomRightPaddingBox);case 2:return XA(e.bottomRightBorderBox,e.bottomRightPaddingBox,e.bottomLeftBorderBox,e.bottomLeftPaddingBox);default:return XA(e.bottomLeftBorderBox,e.bottomLeftPaddingBox,e.topLeftBorderBox,e.topLeftPaddingBox)}},GA=function(e,t){switch(t){case 0:return XA(e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox,e.topRightBorderBox,e.topRightBorderDoubleOuterBox);case 1:return XA(e.topRightBorderBox,e.topRightBorderDoubleOuterBox,e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox);case 2:return XA(e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox,e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox);default:return XA(e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox,e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox)}},WA=function(e,t){switch(t){case 0:return XA(e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox,e.topRightBorderDoubleInnerBox,e.topRightPaddingBox);case 1:return XA(e.topRightBorderDoubleInnerBox,e.topRightPaddingBox,e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox);case 2:return XA(e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox,e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox);default:return XA(e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox,e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox)}},YA=function(e,t){switch(t){case 0:return JA(e.topLeftBorderStroke,e.topRightBorderStroke);case 1:return JA(e.topRightBorderStroke,e.bottomRightBorderStroke);case 2:return JA(e.bottomRightBorderStroke,e.bottomLeftBorderStroke);default:return JA(e.bottomLeftBorderStroke,e.topLeftBorderStroke)}},JA=function(e,t){var n=[];return yA(e)?n.push(e.subdivide(.5,!1)):n.push(e),yA(t)?n.push(t.subdivide(.5,!0)):n.push(t),n},XA=function(e,t,n,r){var i=[];return yA(e)?i.push(e.subdivide(.5,!1)):i.push(e),yA(n)?i.push(n.subdivide(.5,!0)):i.push(n),yA(r)?i.push(r.subdivide(.5,!0).reverse()):i.push(r),yA(t)?i.push(t.subdivide(.5,!1).reverse()):i.push(t),i},zA=function(e){var t=e.bounds,n=e.styles;return t.add(n.borderLeftWidth,n.borderTopWidth,-(n.borderRightWidth+n.borderLeftWidth),-(n.borderTopWidth+n.borderBottomWidth))},qA=function(e){var t=e.styles,n=e.bounds,r=Yn(t.paddingLeft,n.width),i=Yn(t.paddingRight,n.width),o=Yn(t.paddingTop,n.width),a=Yn(t.paddingBottom,n.width);return n.add(r+t.borderLeftWidth,o+t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth+r+i),-(t.borderTopWidth+t.borderBottomWidth+o+a))},ZA=function(e,t){return 0===e?t.bounds:2===e?qA(t):zA(t)},$A=function(e,t){return 0===e?t.bounds:2===e?qA(t):zA(t)},ec=function(e,t,n){var r=ZA(ic(e.styles.backgroundOrigin,t),e),i=$A(ic(e.styles.backgroundClip,t),e),o=rc(ic(e.styles.backgroundSize,t),n,r),a=o[0],s=o[1],A=Wn(ic(e.styles.backgroundPosition,t),r.width-a,r.height-s);return[oc(ic(e.styles.backgroundRepeat,t),A,o,r,i),Math.round(r.left+A[0]),Math.round(r.top+A[1]),a,s]},tc=function(e){return Pn(e)&&e.value===kr.AUTO},nc=function(e){return"number"===typeof e},rc=function(e,t,n){var r=t[0],i=t[1],o=t[2],a=e[0],s=e[1];if(!a)return[0,0];if(Vn(a)&&s&&Vn(s))return[Yn(a,n.width),Yn(s,n.height)];var A=nc(o);if(Pn(a)&&(a.value===kr.CONTAIN||a.value===kr.COVER))return nc(o)?n.width/n.height<o!==(a.value===kr.COVER)?[n.width,n.width/o]:[n.height*o,n.height]:[n.width,n.height];var c=nc(r),l=nc(i),d=c||l;if(tc(a)&&(!s||tc(s)))return c&&l?[r,i]:A||d?d&&A?[c?r:i*o,l?i:r/o]:[c?r:n.width,l?i:n.height]:[n.width,n.height];if(A){var u=0,h=0;return Vn(a)?u=Yn(a,n.width):Vn(s)&&(h=Yn(s,n.height)),tc(a)?u=h*o:s&&!tc(s)||(h=u/o),[u,h]}var p=null,f=null;if(Vn(a)?p=Yn(a,n.width):s&&Vn(s)&&(f=Yn(s,n.height)),null===p||s&&!tc(s)||(f=c&&l?p/r*i:n.height),null!==f&&tc(a)&&(p=c&&l?f/i*r:n.width),null!==p&&null!==f)return[p,f];throw new Error("Unable to calculate background-size for element")},ic=function(e,t){var n=e[t];return"undefined"===typeof n?e[0]:n},oc=function(e,t,n,r,i){var o=t[0],a=t[1],s=n[0],A=n[1];switch(e){case 2:return[new SA(Math.round(r.left),Math.round(r.top+a)),new SA(Math.round(r.left+r.width),Math.round(r.top+a)),new SA(Math.round(r.left+r.width),Math.round(A+r.top+a)),new SA(Math.round(r.left),Math.round(A+r.top+a))];case 3:return[new SA(Math.round(r.left+o),Math.round(r.top)),new SA(Math.round(r.left+o+s),Math.round(r.top)),new SA(Math.round(r.left+o+s),Math.round(r.height+r.top)),new SA(Math.round(r.left+o),Math.round(r.height+r.top))];case 1:return[new SA(Math.round(r.left+o),Math.round(r.top+a)),new SA(Math.round(r.left+o+s),Math.round(r.top+a)),new SA(Math.round(r.left+o+s),Math.round(r.top+a+A)),new SA(Math.round(r.left+o),Math.round(r.top+a+A))];default:return[new SA(Math.round(i.left),Math.round(i.top)),new SA(Math.round(i.left+i.width),Math.round(i.top)),new SA(Math.round(i.left+i.width),Math.round(i.height+i.top)),new SA(Math.round(i.left),Math.round(i.height+i.top))]}},ac="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",sc="Hidden Text",Ac=function(){function e(e){this._data={},this._document=e}return e.prototype.parseMetrics=function(e,t){var n=this._document.createElement("div"),r=this._document.createElement("img"),i=this._document.createElement("span"),o=this._document.body;n.style.visibility="hidden",n.style.fontFamily=e,n.style.fontSize=t,n.style.margin="0",n.style.padding="0",n.style.whiteSpace="nowrap",o.appendChild(n),r.src=ac,r.width=1,r.height=1,r.style.margin="0",r.style.padding="0",r.style.verticalAlign="baseline",i.style.fontFamily=e,i.style.fontSize=t,i.style.margin="0",i.style.padding="0",i.appendChild(this._document.createTextNode(sc)),n.appendChild(i),n.appendChild(r);var a=r.offsetTop-i.offsetTop+2;n.removeChild(i),n.appendChild(this._document.createTextNode(sc)),n.style.lineHeight="normal",r.style.verticalAlign="super";var s=r.offsetTop-n.offsetTop+2;return o.removeChild(n),{baseline:a,middle:s}},e.prototype.getMetrics=function(e,t){var n=e+" "+t;return"undefined"===typeof this._data[n]&&(this._data[n]=this.parseMetrics(e,t)),this._data[n]},e}(),cc=function(){function e(e,t){this.context=e,this.options=t}return e}(),lc=1e4,dc=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r._activeEffects=[],r.canvas=n.canvas?n.canvas:document.createElement("canvas"),r.ctx=r.canvas.getContext("2d"),n.canvas||(r.canvas.width=Math.floor(n.width*n.scale),r.canvas.height=Math.floor(n.height*n.scale),r.canvas.style.width=n.width+"px",r.canvas.style.height=n.height+"px"),r.fontMetrics=new Ac(document),r.ctx.scale(r.options.scale,r.options.scale),r.ctx.translate(-n.x,-n.y),r.ctx.textBaseline="bottom",r._activeEffects=[],r.context.logger.debug("Canvas renderer initialized ("+n.width+"x"+n.height+") with scale "+n.scale),r}return t(n,e),n.prototype.applyEffects=function(e){for(var t=this;this._activeEffects.length;)this.popEffect();e.forEach((function(e){return t.applyEffect(e)}))},n.prototype.applyEffect=function(e){this.ctx.save(),kA(e)&&(this.ctx.globalAlpha=e.opacity),UA(e)&&(this.ctx.translate(e.offsetX,e.offsetY),this.ctx.transform(e.matrix[0],e.matrix[1],e.matrix[2],e.matrix[3],e.matrix[4],e.matrix[5]),this.ctx.translate(-e.offsetX,-e.offsetY)),LA(e)&&(this.path(e.path),this.ctx.clip()),this._activeEffects.push(e)},n.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},n.prototype.renderStack=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return e.element.container.styles.isVisible()?[4,this.renderStackContent(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},n.prototype.renderNode=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return io(e.container.flags,16),e.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(e)]:[3,3];case 1:return t.sent(),[4,this.renderNodeContent(e)];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},n.prototype.renderTextWithLetterSpacing=function(e,t,n){var r=this;0===t?this.ctx.fillText(e.text,e.bounds.left,e.bounds.top+n):Ba(e.text).reduce((function(t,i){return r.ctx.fillText(i,t,e.bounds.top+n),t+r.ctx.measureText(i).width}),e.bounds.left)},n.prototype.createFontStyle=function(e){var t=e.fontVariant.filter((function(e){return"normal"===e||"small-caps"===e})).join(""),n=Ec(e.fontFamily).join(", "),r=Nn(e.fontSize)?""+e.fontSize.number+e.fontSize.unit:e.fontSize.number+"px";return[[e.fontStyle,t,e.fontWeight,r,n].join(" "),n,r]},n.prototype.renderTextNode=function(e,t){return r(this,void 0,void 0,(function(){var n,r,o,a,s,A,c,l,d=this;return i(this,(function(i){return n=this.createFontStyle(t),r=n[0],o=n[1],a=n[2],this.ctx.font=r,this.ctx.direction=1===t.direction?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",s=this.fontMetrics.getMetrics(o,a),A=s.baseline,c=s.middle,l=t.paintOrder,e.textBounds.forEach((function(e){l.forEach((function(n){switch(n){case 0:d.ctx.fillStyle=ir(t.color),d.renderTextWithLetterSpacing(e,t.letterSpacing,A);var r=t.textShadow;r.length&&e.text.trim().length&&(r.slice(0).reverse().forEach((function(n){d.ctx.shadowColor=ir(n.color),d.ctx.shadowOffsetX=n.offsetX.number*d.options.scale,d.ctx.shadowOffsetY=n.offsetY.number*d.options.scale,d.ctx.shadowBlur=n.blur.number,d.renderTextWithLetterSpacing(e,t.letterSpacing,A)})),d.ctx.shadowColor="",d.ctx.shadowOffsetX=0,d.ctx.shadowOffsetY=0,d.ctx.shadowBlur=0),t.textDecorationLine.length&&(d.ctx.fillStyle=ir(t.textDecorationColor||t.color),t.textDecorationLine.forEach((function(t){switch(t){case 1:d.ctx.fillRect(e.bounds.left,Math.round(e.bounds.top+A),e.bounds.width,1);break;case 2:d.ctx.fillRect(e.bounds.left,Math.round(e.bounds.top),e.bounds.width,1);break;case 3:d.ctx.fillRect(e.bounds.left,Math.ceil(e.bounds.top+c),e.bounds.width,1)}})));break;case 1:t.webkitTextStrokeWidth&&e.text.trim().length&&(d.ctx.strokeStyle=ir(t.webkitTextStrokeColor),d.ctx.lineWidth=t.webkitTextStrokeWidth,d.ctx.lineJoin=window.chrome?"miter":"round",d.ctx.strokeText(e.text,e.bounds.left,e.bounds.top+A)),d.ctx.strokeStyle="",d.ctx.lineWidth=0,d.ctx.lineJoin="miter"}}))})),[2]}))}))},n.prototype.renderReplacedElement=function(e,t,n){if(n&&e.intrinsicWidth>0&&e.intrinsicHeight>0){var r=qA(e),i=BA(t);this.path(i),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(n,0,0,e.intrinsicWidth,e.intrinsicHeight,r.left,r.top,r.width,r.height),this.ctx.restore()}},n.prototype.renderNodeContent=function(e){return r(this,void 0,void 0,(function(){var t,r,o,s,A,c,l,d,u,h,p,f,E,g,m,_,C,w;return i(this,(function(i){switch(i.label){case 0:this.applyEffects(e.getEffects(4)),t=e.container,r=e.curves,o=t.styles,s=0,A=t.textNodes,i.label=1;case 1:return s<A.length?(c=A[s],[4,this.renderTextNode(c,o)]):[3,4];case 2:i.sent(),i.label=3;case 3:return s++,[3,1];case 4:if(!(t instanceof xa))return[3,8];i.label=5;case 5:return i.trys.push([5,7,,8]),[4,this.context.cache.match(t.src)];case 6:return m=i.sent(),this.renderReplacedElement(t,r,m),[3,8];case 7:return i.sent(),this.context.logger.error("Error loading image "+t.src),[3,8];case 8:if(t instanceof Qa&&this.renderReplacedElement(t,r,t.canvas),!(t instanceof Va))return[3,12];i.label=9;case 9:return i.trys.push([9,11,,12]),[4,this.context.cache.match(t.svg)];case 10:return m=i.sent(),this.renderReplacedElement(t,r,m),[3,12];case 11:return i.sent(),this.context.logger.error("Error loading svg "+t.svg.substring(0,255)),[3,12];case 12:return t instanceof ts&&t.tree?[4,new n(this.context,{scale:this.options.scale,backgroundColor:t.backgroundColor,x:0,y:0,width:t.width,height:t.height}).render(t.tree)]:[3,14];case 13:l=i.sent(),t.width&&t.height&&this.ctx.drawImage(l,0,0,t.width,t.height,t.bounds.left,t.bounds.top,t.bounds.width,t.bounds.height),i.label=14;case 14:if(t instanceof Za&&(d=Math.min(t.bounds.width,t.bounds.height),t.type===Ja?t.checked&&(this.ctx.save(),this.path([new SA(t.bounds.left+.39363*d,t.bounds.top+.79*d),new SA(t.bounds.left+.16*d,t.bounds.top+.5549*d),new SA(t.bounds.left+.27347*d,t.bounds.top+.44071*d),new SA(t.bounds.left+.39694*d,t.bounds.top+.5649*d),new SA(t.bounds.left+.72983*d,t.bounds.top+.23*d),new SA(t.bounds.left+.84*d,t.bounds.top+.34085*d),new SA(t.bounds.left+.39363*d,t.bounds.top+.79*d)]),this.ctx.fillStyle=ir(qa),this.ctx.fill(),this.ctx.restore()):t.type===Xa&&t.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(t.bounds.left+d/2,t.bounds.top+d/2,d/4,0,2*Math.PI,!0),this.ctx.fillStyle=ir(qa),this.ctx.fill(),this.ctx.restore())),uc(t)&&t.value.length){switch(u=this.createFontStyle(o),C=u[0],h=u[1],p=this.fontMetrics.getMetrics(C,h).baseline,this.ctx.font=C,this.ctx.fillStyle=ir(o.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=pc(t.styles.textAlign),w=qA(t),f=0,t.styles.textAlign){case 1:f+=w.width/2;break;case 2:f+=w.width}E=w.add(f,0,0,-w.height/2+1),this.ctx.save(),this.path([new SA(w.left,w.top),new SA(w.left+w.width,w.top),new SA(w.left+w.width,w.top+w.height),new SA(w.left,w.top+w.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Ia(t.value,E),o.letterSpacing,p),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!io(t.styles.display,2048))return[3,20];if(null===t.styles.listStyleImage)return[3,19];if(0!==(g=t.styles.listStyleImage).type)return[3,18];m=void 0,_=g.url,i.label=15;case 15:return i.trys.push([15,17,,18]),[4,this.context.cache.match(_)];case 16:return m=i.sent(),this.ctx.drawImage(m,t.bounds.left-(m.width+10),t.bounds.top),[3,18];case 17:return i.sent(),this.context.logger.error("Error loading list-style-image "+_),[3,18];case 18:return[3,20];case 19:e.listValue&&-1!==t.styles.listStyleType&&(C=this.createFontStyle(o)[0],this.ctx.font=C,this.ctx.fillStyle=ir(o.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",w=new a(t.bounds.left,t.bounds.top+Yn(t.styles.paddingTop,t.bounds.width),t.bounds.width,wi(o.lineHeight,o.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Ia(e.listValue,w),o.letterSpacing,wi(o.lineHeight,o.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),i.label=20;case 20:return[2]}}))}))},n.prototype.renderStackContent=function(e){return r(this,void 0,void 0,(function(){var t,n,r,o,a,s,A,c,l,d,u,h,p,f,E;return i(this,(function(i){switch(i.label){case 0:return io(e.element.container.flags,16),[4,this.renderNodeBackgroundAndBorders(e.element)];case 1:i.sent(),t=0,n=e.negativeZIndex,i.label=2;case 2:return t<n.length?(E=n[t],[4,this.renderStack(E)]):[3,5];case 3:i.sent(),i.label=4;case 4:return t++,[3,2];case 5:return[4,this.renderNodeContent(e.element)];case 6:i.sent(),r=0,o=e.nonInlineLevel,i.label=7;case 7:return r<o.length?(E=o[r],[4,this.renderNode(E)]):[3,10];case 8:i.sent(),i.label=9;case 9:return r++,[3,7];case 10:a=0,s=e.nonPositionedFloats,i.label=11;case 11:return a<s.length?(E=s[a],[4,this.renderStack(E)]):[3,14];case 12:i.sent(),i.label=13;case 13:return a++,[3,11];case 14:A=0,c=e.nonPositionedInlineLevel,i.label=15;case 15:return A<c.length?(E=c[A],[4,this.renderStack(E)]):[3,18];case 16:i.sent(),i.label=17;case 17:return A++,[3,15];case 18:l=0,d=e.inlineLevel,i.label=19;case 19:return l<d.length?(E=d[l],[4,this.renderNode(E)]):[3,22];case 20:i.sent(),i.label=21;case 21:return l++,[3,19];case 22:u=0,h=e.zeroOrAutoZIndexOrTransformedOrOpacity,i.label=23;case 23:return u<h.length?(E=h[u],[4,this.renderStack(E)]):[3,26];case 24:i.sent(),i.label=25;case 25:return u++,[3,23];case 26:p=0,f=e.positiveZIndex,i.label=27;case 27:return p<f.length?(E=f[p],[4,this.renderStack(E)]):[3,30];case 28:i.sent(),i.label=29;case 29:return p++,[3,27];case 30:return[2]}}))}))},n.prototype.mask=function(e){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(e.slice(0).reverse()),this.ctx.closePath()},n.prototype.path=function(e){this.ctx.beginPath(),this.formatPath(e),this.ctx.closePath()},n.prototype.formatPath=function(e){var t=this;e.forEach((function(e,n){var r=yA(e)?e.start:e;0===n?t.ctx.moveTo(r.x,r.y):t.ctx.lineTo(r.x,r.y),yA(e)&&t.ctx.bezierCurveTo(e.startControl.x,e.startControl.y,e.endControl.x,e.endControl.y,e.end.x,e.end.y)}))},n.prototype.renderRepeat=function(e,t,n,r){this.path(e),this.ctx.fillStyle=t,this.ctx.translate(n,r),this.ctx.fill(),this.ctx.translate(-n,-r)},n.prototype.resizeImage=function(e,t,n){var r;if(e.width===t&&e.height===n)return e;var i=(null!==(r=this.canvas.ownerDocument)&&void 0!==r?r:document).createElement("canvas");return i.width=Math.max(1,t),i.height=Math.max(1,n),i.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t,n),i},n.prototype.renderBackgroundImage=function(e){return r(this,void 0,void 0,(function(){var t,n,r,o,a,s;return i(this,(function(A){switch(A.label){case 0:t=e.styles.backgroundImage.length-1,n=function(n){var o,a,s,A,c,l,d,u,h,p,f,E,g,m,_,C,w,S,T,v,y,I,R,b,O,B,N,D,P,U,L;return i(this,(function(i){switch(i.label){case 0:if(0!==n.type)return[3,5];o=void 0,a=n.url,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,r.context.cache.match(a)];case 2:return o=i.sent(),[3,4];case 3:return i.sent(),r.context.logger.error("Error loading background-image "+a),[3,4];case 4:return o&&(s=ec(e,t,[o.width,o.height,o.width/o.height]),C=s[0],I=s[1],R=s[2],T=s[3],v=s[4],m=r.ctx.createPattern(r.resizeImage(o,T,v),"repeat"),r.renderRepeat(C,m,I,R)),[3,6];case 5:Dr(n)?(A=ec(e,t,[null,null,null]),C=A[0],I=A[1],R=A[2],T=A[3],v=A[4],c=mr(n.angle,T,v),l=c[0],d=c[1],u=c[2],h=c[3],p=c[4],(f=document.createElement("canvas")).width=T,f.height=v,E=f.getContext("2d"),g=E.createLinearGradient(d,h,u,p),Er(n.stops,l).forEach((function(e){return g.addColorStop(e.stop,ir(e.color))})),E.fillStyle=g,E.fillRect(0,0,T,v),T>0&&v>0&&(m=r.ctx.createPattern(f,"repeat"),r.renderRepeat(C,m,I,R))):Pr(n)&&(_=ec(e,t,[null,null,null]),C=_[0],w=_[1],S=_[2],T=_[3],v=_[4],y=0===n.position.length?[jn]:n.position,I=Yn(y[0],T),R=Yn(y[y.length-1],v),b=wr(n,I,R,T,v),O=b[0],B=b[1],O>0&&B>0&&(N=r.ctx.createRadialGradient(w+I,S+R,0,w+I,S+R,O),Er(n.stops,2*O).forEach((function(e){return N.addColorStop(e.stop,ir(e.color))})),r.path(C),r.ctx.fillStyle=N,O!==B?(D=e.bounds.left+.5*e.bounds.width,P=e.bounds.top+.5*e.bounds.height,L=1/(U=B/O),r.ctx.save(),r.ctx.translate(D,P),r.ctx.transform(1,0,0,U,0,0),r.ctx.translate(-D,-P),r.ctx.fillRect(w,L*(S-P)+P,T,v*L),r.ctx.restore()):r.ctx.fill())),i.label=6;case 6:return t--,[2]}}))},r=this,o=0,a=e.styles.backgroundImage.slice(0).reverse(),A.label=1;case 1:return o<a.length?(s=a[o],[5,n(s)]):[3,4];case 2:A.sent(),A.label=3;case 3:return o++,[3,1];case 4:return[2]}}))}))},n.prototype.renderSolidBorder=function(e,t,n){return r(this,void 0,void 0,(function(){return i(this,(function(r){return this.path(jA(n,t)),this.ctx.fillStyle=ir(e),this.ctx.fill(),[2]}))}))},n.prototype.renderDoubleBorder=function(e,t,n,o){return r(this,void 0,void 0,(function(){var r,a;return i(this,(function(i){switch(i.label){case 0:return t<3?[4,this.renderSolidBorder(e,n,o)]:[3,2];case 1:return i.sent(),[2];case 2:return r=GA(o,n),this.path(r),this.ctx.fillStyle=ir(e),this.ctx.fill(),a=WA(o,n),this.path(a),this.ctx.fill(),[2]}}))}))},n.prototype.renderNodeBackgroundAndBorders=function(e){return r(this,void 0,void 0,(function(){var t,n,r,o,a,s,A,c,l=this;return i(this,(function(i){switch(i.label){case 0:return this.applyEffects(e.getEffects(2)),t=e.container.styles,n=!rr(t.backgroundColor)||t.backgroundImage.length,r=[{style:t.borderTopStyle,color:t.borderTopColor,width:t.borderTopWidth},{style:t.borderRightStyle,color:t.borderRightColor,width:t.borderRightWidth},{style:t.borderBottomStyle,color:t.borderBottomColor,width:t.borderBottomWidth},{style:t.borderLeftStyle,color:t.borderLeftColor,width:t.borderLeftWidth}],o=hc(ic(t.backgroundClip,0),e.curves),n||t.boxShadow.length?(this.ctx.save(),this.path(o),this.ctx.clip(),rr(t.backgroundColor)||(this.ctx.fillStyle=ir(t.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(e.container)]):[3,2];case 1:i.sent(),this.ctx.restore(),t.boxShadow.slice(0).reverse().forEach((function(t){l.ctx.save();var n=bA(e.curves),r=t.inset?0:lc,i=FA(n,-r+(t.inset?1:-1)*t.spread.number,(t.inset?1:-1)*t.spread.number,t.spread.number*(t.inset?-2:2),t.spread.number*(t.inset?-2:2));t.inset?(l.path(n),l.ctx.clip(),l.mask(i)):(l.mask(n),l.ctx.clip(),l.path(i)),l.ctx.shadowOffsetX=t.offsetX.number+r,l.ctx.shadowOffsetY=t.offsetY.number,l.ctx.shadowColor=ir(t.color),l.ctx.shadowBlur=t.blur.number,l.ctx.fillStyle=t.inset?ir(t.color):"rgba(0,0,0,1)",l.ctx.fill(),l.ctx.restore()})),i.label=2;case 2:a=0,s=0,A=r,i.label=3;case 3:return s<A.length?0!==(c=A[s]).style&&!rr(c.color)&&c.width>0?2!==c.style?[3,5]:[4,this.renderDashedDottedBorder(c.color,c.width,a,e.curves,2)]:[3,11]:[3,13];case 4:return i.sent(),[3,11];case 5:return 3!==c.style?[3,7]:[4,this.renderDashedDottedBorder(c.color,c.width,a,e.curves,3)];case 6:return i.sent(),[3,11];case 7:return 4!==c.style?[3,9]:[4,this.renderDoubleBorder(c.color,c.width,a,e.curves)];case 8:return i.sent(),[3,11];case 9:return[4,this.renderSolidBorder(c.color,a,e.curves)];case 10:i.sent(),i.label=11;case 11:a++,i.label=12;case 12:return s++,[3,3];case 13:return[2]}}))}))},n.prototype.renderDashedDottedBorder=function(e,t,n,o,a){return r(this,void 0,void 0,(function(){var r,s,A,c,l,d,u,h,p,f,E,g,m,_,C,w;return i(this,(function(i){return this.ctx.save(),r=YA(o,n),s=jA(o,n),2===a&&(this.path(s),this.ctx.clip()),yA(s[0])?(A=s[0].start.x,c=s[0].start.y):(A=s[0].x,c=s[0].y),yA(s[1])?(l=s[1].end.x,d=s[1].end.y):(l=s[1].x,d=s[1].y),u=0===n||2===n?Math.abs(A-l):Math.abs(c-d),this.ctx.beginPath(),3===a?this.formatPath(r):this.formatPath(s.slice(0,2)),h=t<3?3*t:2*t,p=t<3?2*t:t,3===a&&(h=t,p=t),f=!0,u<=2*h?f=!1:u<=2*h+p?(h*=E=u/(2*h+p),p*=E):(g=Math.floor((u+p)/(h+p)),m=(u-g*h)/(g-1),p=(_=(u-(g+1)*h)/g)<=0||Math.abs(p-m)<Math.abs(p-_)?m:_),f&&(3===a?this.ctx.setLineDash([0,h+p]):this.ctx.setLineDash([h,p])),3===a?(this.ctx.lineCap="round",this.ctx.lineWidth=t):this.ctx.lineWidth=2*t+1.1,this.ctx.strokeStyle=ir(e),this.ctx.stroke(),this.ctx.setLineDash([]),2===a&&(yA(s[0])&&(C=s[3],w=s[0],this.ctx.beginPath(),this.formatPath([new SA(C.end.x,C.end.y),new SA(w.start.x,w.start.y)]),this.ctx.stroke()),yA(s[1])&&(C=s[1],w=s[2],this.ctx.beginPath(),this.formatPath([new SA(C.end.x,C.end.y),new SA(w.start.x,w.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]}))}))},n.prototype.render=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=ir(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),t=KA(e),[4,this.renderStack(t)];case 1:return n.sent(),this.applyEffects([]),[2,this.canvas]}}))}))},n}(cc),uc=function(e){return e instanceof es||e instanceof $a||e instanceof Za&&e.type!==Xa&&e.type!==Ja},hc=function(e,t){switch(e){case 0:return bA(t);case 2:return OA(t);default:return BA(t)}},pc=function(e){switch(e){case 1:return"center";case 2:return"right";default:return"left"}},fc=["-apple-system","system-ui"],Ec=function(e){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?e.filter((function(e){return-1===fc.indexOf(e)})):e},gc=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.canvas=n.canvas?n.canvas:document.createElement("canvas"),r.ctx=r.canvas.getContext("2d"),r.options=n,r.canvas.width=Math.floor(n.width*n.scale),r.canvas.height=Math.floor(n.height*n.scale),r.canvas.style.width=n.width+"px",r.canvas.style.height=n.height+"px",r.ctx.scale(r.options.scale,r.options.scale),r.ctx.translate(-n.x,-n.y),r.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+n.width+"x"+n.height+" at "+n.x+","+n.y+") with scale "+n.scale),r}return t(n,e),n.prototype.render=function(e){return r(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return t=Ta(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,e),[4,mc(t)];case 1:return n=r.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=ir(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(n,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}}))}))},n}(cc),mc=function(e){return new Promise((function(t,n){var r=new Image;r.onload=function(){t(r)},r.onerror=n,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(e))}))},_c=function(){function e(e){var t=e.id,n=e.enabled;this.id=t,this.enabled=n,this.start=Date.now()}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!==typeof window&&window.console&&"function"===typeof console.debug?console.debug.apply(console,o([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.prototype.getTime=function(){return Date.now()-this.start},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&"undefined"!==typeof window&&window.console&&"function"===typeof console.info&&console.info.apply(console,o([this.id,this.getTime()+"ms"],e))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!==typeof window&&window.console&&"function"===typeof console.warn?console.warn.apply(console,o([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!==typeof window&&window.console&&"function"===typeof console.error?console.error.apply(console,o([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.instances={},e}(),Cc=function(){function e(t,n){var r;this.windowBounds=n,this.instanceName="#"+e.instanceCount++,this.logger=new _c({id:this.instanceName,enabled:t.logging}),this.cache=null!==(r=t.cache)&&void 0!==r?r:new hA(this,t)}return e.instanceCount=1,e}(),wc=function(e,t){return void 0===t&&(t={}),Sc(e,t)};"undefined"!==typeof window&&uA.setContext(window);var Sc=function(e,t){return r(void 0,void 0,void 0,(function(){var r,o,c,l,d,u,h,p,f,E,g,m,_,C,w,S,T,v,y,I,R,b,O,B,N,D,P,U,L,k,M,F,x,Q,V,H,K,j;return i(this,(function(i){switch(i.label){case 0:if(!e||"object"!==typeof e)return[2,Promise.reject("Invalid element provided as first argument")];if(!(r=e.ownerDocument))throw new Error("Element is not attached to a Document");if(!(o=r.defaultView))throw new Error("Document is not attached to a Window");return c={allowTaint:null!==(b=t.allowTaint)&&void 0!==b&&b,imageTimeout:null!==(O=t.imageTimeout)&&void 0!==O?O:15e3,proxy:t.proxy,useCORS:null!==(B=t.useCORS)&&void 0!==B&&B},l=n({logging:null===(N=t.logging)||void 0===N||N,cache:t.cache},c),d={windowWidth:null!==(D=t.windowWidth)&&void 0!==D?D:o.innerWidth,windowHeight:null!==(P=t.windowHeight)&&void 0!==P?P:o.innerHeight,scrollX:null!==(U=t.scrollX)&&void 0!==U?U:o.pageXOffset,scrollY:null!==(L=t.scrollY)&&void 0!==L?L:o.pageYOffset},u=new a(d.scrollX,d.scrollY,d.windowWidth,d.windowHeight),h=new Cc(l,u),p=null!==(k=t.foreignObjectRendering)&&void 0!==k&&k,f={allowTaint:null!==(M=t.allowTaint)&&void 0!==M&&M,onclone:t.onclone,ignoreElements:t.ignoreElements,inlineImages:p,copyStyles:p},h.logger.debug("Starting document clone with size "+u.width+"x"+u.height+" scrolled to "+-u.left+","+-u.top),E=new Js(h,e,f),(g=E.clonedReferenceElement)?[4,E.toIFrame(r,u)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return m=i.sent(),_=gs(g)||fs(g)?A(g.ownerDocument):s(h,g),C=_.width,w=_.height,S=_.left,T=_.top,v=Tc(h,g,t.backgroundColor),y={canvas:t.canvas,backgroundColor:v,scale:null!==(x=null!==(F=t.scale)&&void 0!==F?F:o.devicePixelRatio)&&void 0!==x?x:1,x:(null!==(Q=t.x)&&void 0!==Q?Q:0)+S,y:(null!==(V=t.y)&&void 0!==V?V:0)+T,width:null!==(H=t.width)&&void 0!==H?H:Math.ceil(C),height:null!==(K=t.height)&&void 0!==K?K:Math.ceil(w)},p?(h.logger.debug("Document cloned, using foreign object rendering"),[4,new gc(h,y).render(g)]):[3,3];case 2:return I=i.sent(),[3,5];case 3:return h.logger.debug("Document cloned, element located at "+S+","+T+" with size "+C+"x"+w+" using computed rendering"),h.logger.debug("Starting DOM parsing"),R=os(h,g),v===R.styles.backgroundColor&&(R.styles.backgroundColor=ur.TRANSPARENT),h.logger.debug("Starting renderer for element at "+y.x+","+y.y+" with size "+y.width+"x"+y.height),[4,new dc(h,y).render(R)];case 4:I=i.sent(),i.label=5;case 5:return(null===(j=t.removeContainer)||void 0===j||j)&&(Js.destroy(m)||h.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),h.logger.debug("Finished rendering"),[2,I]}}))}))},Tc=function(e,t,n){var r=t.ownerDocument,i=r.documentElement?dr(e,getComputedStyle(r.documentElement).backgroundColor):ur.TRANSPARENT,o=r.body?dr(e,getComputedStyle(r.body).backgroundColor):ur.TRANSPARENT,a="string"===typeof n?dr(e,n):null===n?ur.TRANSPARENT:4294967295;return t===r.documentElement?rr(i)?rr(o)?a:o:i:a};return wc}()},730:(e,t,n)=>{"use strict";var r=n(43),i=n(853);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,s={};function A(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(s[e]=t,e=0;e<t.length;e++)a.add(t[e])}var l=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,u=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,h={},p={};function f(e,t,n,r,i,o,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=a}var E={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){E[e]=new f(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];E[t]=new f(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){E[e]=new f(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){E[e]=new f(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){E[e]=new f(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){E[e]=new f(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){E[e]=new f(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){E[e]=new f(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){E[e]=new f(e,5,!1,e.toLowerCase(),null,!1,!1)}));var g=/[\-:]([a-z])/g;function m(e){return e[1].toUpperCase()}function _(e,t,n,r){var i=E.hasOwnProperty(t)?E[t]:null;(null!==i?0!==i.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!d.call(p,e)||!d.call(h,e)&&(u.test(e)?p[e]=!0:(h[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(g,m);E[t]=new f(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(g,m);E[t]=new f(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(g,m);E[t]=new f(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){E[e]=new f(e,1,!1,e.toLowerCase(),null,!1,!1)})),E.xlinkHref=new f("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){E[e]=new f(e,1,!1,e.toLowerCase(),null,!0,!0)}));var C=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for("react.element"),S=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),v=Symbol.for("react.strict_mode"),y=Symbol.for("react.profiler"),I=Symbol.for("react.provider"),R=Symbol.for("react.context"),b=Symbol.for("react.forward_ref"),O=Symbol.for("react.suspense"),B=Symbol.for("react.suspense_list"),N=Symbol.for("react.memo"),D=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var P=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var U=Symbol.iterator;function L(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=U&&e[U]||e["@@iterator"])?e:null}var k,M=Object.assign;function F(e){if(void 0===k)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);k=t&&t[1]||""}return"\n"+k+e}var x=!1;function Q(e,t){if(!e||x)return"";x=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var i=c.stack.split("\n"),o=r.stack.split("\n"),a=i.length-1,s=o.length-1;1<=a&&0<=s&&i[a]!==o[s];)s--;for(;1<=a&&0<=s;a--,s--)if(i[a]!==o[s]){if(1!==a||1!==s)do{if(a--,0>--s||i[a]!==o[s]){var A="\n"+i[a].replace(" at new "," at ");return e.displayName&&A.includes("<anonymous>")&&(A=A.replace("<anonymous>",e.displayName)),A}}while(1<=a&&0<=s);break}}}finally{x=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?F(e):""}function V(e){switch(e.tag){case 5:return F(e.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return e=Q(e.type,!1);case 11:return e=Q(e.type.render,!1);case 1:return e=Q(e.type,!0);default:return""}}function H(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case T:return"Fragment";case S:return"Portal";case y:return"Profiler";case v:return"StrictMode";case O:return"Suspense";case B:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case R:return(e.displayName||"Context")+".Consumer";case I:return(e._context.displayName||"Context")+".Provider";case b:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case N:return null!==(t=e.displayName||null)?t:H(e.type)||"Memo";case D:t=e._payload,e=e._init;try{return H(e(t))}catch(n){}}return null}function K(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return H(t);case 8:return t===v?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function j(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function G(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function W(e){e._valueTracker||(e._valueTracker=function(e){var t=G(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Y(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=G(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function J(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function X(e,t){var n=t.checked;return M({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function z(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=j(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function q(e,t){null!=(t=t.checked)&&_(e,"checked",t,!1)}function Z(e,t){q(e,t);var n=j(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,j(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&J(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+j(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return M({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ie(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(o(92));if(te(n)){if(1<n.length)throw Error(o(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:j(n)}}function oe(e,t){var n=j(t.value),r=j(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ae(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,le,de=(le=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return le(e,t)}))}:le);function ue(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var he={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function fe(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||he.hasOwnProperty(e)&&he[e]?(""+t).trim():t+"px"}function Ee(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=fe(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(he).forEach((function(e){pe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),he[t]=he[e]}))}));var ge=M({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function me(e,t){if(t){if(ge[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(o(62))}}function _e(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ce=null;function we(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Se=null,Te=null,ve=null;function ye(e){if(e=_i(e)){if("function"!==typeof Se)throw Error(o(280));var t=e.stateNode;t&&(t=wi(t),Se(e.stateNode,e.type,t))}}function Ie(e){Te?ve?ve.push(e):ve=[e]:Te=e}function Re(){if(Te){var e=Te,t=ve;if(ve=Te=null,ye(e),t)for(e=0;e<t.length;e++)ye(t[e])}}function be(e,t){return e(t)}function Oe(){}var Be=!1;function Ne(e,t,n){if(Be)return e(t,n);Be=!0;try{return be(e,t,n)}finally{Be=!1,(null!==Te||null!==ve)&&(Oe(),Re())}}function De(e,t){var n=e.stateNode;if(null===n)return null;var r=wi(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(o(231,t,typeof n));return n}var Pe=!1;if(l)try{var Ue={};Object.defineProperty(Ue,"passive",{get:function(){Pe=!0}}),window.addEventListener("test",Ue,Ue),window.removeEventListener("test",Ue,Ue)}catch(le){Pe=!1}function Le(e,t,n,r,i,o,a,s,A){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(l){this.onError(l)}}var ke=!1,Me=null,Fe=!1,xe=null,Qe={onError:function(e){ke=!0,Me=e}};function Ve(e,t,n,r,i,o,a,s,A){ke=!1,Me=null,Le.apply(Qe,arguments)}function He(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ke(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function je(e){if(He(e)!==e)throw Error(o(188))}function Ge(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=He(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var a=i.alternate;if(null===a){if(null!==(r=i.return)){n=r;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===n)return je(i),e;if(a===r)return je(i),t;a=a.sibling}throw Error(o(188))}if(n.return!==r.return)n=i,r=a;else{for(var s=!1,A=i.child;A;){if(A===n){s=!0,n=i,r=a;break}if(A===r){s=!0,r=i,n=a;break}A=A.sibling}if(!s){for(A=a.child;A;){if(A===n){s=!0,n=a,r=i;break}if(A===r){s=!0,r=a,n=i;break}A=A.sibling}if(!s)throw Error(o(189))}}if(n.alternate!==r)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(e))?We(e):null}function We(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=We(e);if(null!==t)return t;e=e.sibling}return null}var Ye=i.unstable_scheduleCallback,Je=i.unstable_cancelCallback,Xe=i.unstable_shouldYield,ze=i.unstable_requestPaint,qe=i.unstable_now,Ze=i.unstable_getCurrentPriorityLevel,$e=i.unstable_ImmediatePriority,et=i.unstable_UserBlockingPriority,tt=i.unstable_NormalPriority,nt=i.unstable_LowPriority,rt=i.unstable_IdlePriority,it=null,ot=null;var at=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(st(e)/At|0)|0},st=Math.log,At=Math.LN2;var ct=64,lt=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ut(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,o=e.pingedLanes,a=268435455&n;if(0!==a){var s=a&~i;0!==s?r=dt(s):0!==(o&=a)&&(r=dt(o))}else 0!==(a=n&~i)?r=dt(a):0!==o&&(r=dt(o));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&i)&&((i=r&-r)>=(o=t&-t)||16===i&&0!==(4194240&o)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-at(t)),r|=e[n],t&=~i;return r}function ht(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function ft(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function Et(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function gt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=n}function mt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-at(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var _t=0;function Ct(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var wt,St,Tt,vt,yt,It=!1,Rt=[],bt=null,Ot=null,Bt=null,Nt=new Map,Dt=new Map,Pt=[],Ut="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Lt(e,t){switch(e){case"focusin":case"focusout":bt=null;break;case"dragenter":case"dragleave":Ot=null;break;case"mouseover":case"mouseout":Bt=null;break;case"pointerover":case"pointerout":Nt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Dt.delete(t.pointerId)}}function kt(e,t,n,r,i,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},null!==t&&(null!==(t=_i(t))&&St(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function Mt(e){var t=mi(e.target);if(null!==t){var n=He(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ke(n)))return e.blockedOn=t,void yt(e.priority,(function(){Tt(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ft(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Xt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=_i(n))&&St(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);Ce=r,n.target.dispatchEvent(r),Ce=null,t.shift()}return!0}function xt(e,t,n){Ft(e)&&n.delete(t)}function Qt(){It=!1,null!==bt&&Ft(bt)&&(bt=null),null!==Ot&&Ft(Ot)&&(Ot=null),null!==Bt&&Ft(Bt)&&(Bt=null),Nt.forEach(xt),Dt.forEach(xt)}function Vt(e,t){e.blockedOn===t&&(e.blockedOn=null,It||(It=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Qt)))}function Ht(e){function t(t){return Vt(t,e)}if(0<Rt.length){Vt(Rt[0],e);for(var n=1;n<Rt.length;n++){var r=Rt[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==bt&&Vt(bt,e),null!==Ot&&Vt(Ot,e),null!==Bt&&Vt(Bt,e),Nt.forEach(t),Dt.forEach(t),n=0;n<Pt.length;n++)(r=Pt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Pt.length&&null===(n=Pt[0]).blockedOn;)Mt(n),null===n.blockedOn&&Pt.shift()}var Kt=C.ReactCurrentBatchConfig,jt=!0;function Gt(e,t,n,r){var i=_t,o=Kt.transition;Kt.transition=null;try{_t=1,Yt(e,t,n,r)}finally{_t=i,Kt.transition=o}}function Wt(e,t,n,r){var i=_t,o=Kt.transition;Kt.transition=null;try{_t=4,Yt(e,t,n,r)}finally{_t=i,Kt.transition=o}}function Yt(e,t,n,r){if(jt){var i=Xt(e,t,n,r);if(null===i)jr(e,t,r,Jt,n),Lt(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return bt=kt(bt,e,t,n,r,i),!0;case"dragenter":return Ot=kt(Ot,e,t,n,r,i),!0;case"mouseover":return Bt=kt(Bt,e,t,n,r,i),!0;case"pointerover":var o=i.pointerId;return Nt.set(o,kt(Nt.get(o)||null,e,t,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,Dt.set(o,kt(Dt.get(o)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(Lt(e,r),4&t&&-1<Ut.indexOf(e)){for(;null!==i;){var o=_i(i);if(null!==o&&wt(o),null===(o=Xt(e,t,n,r))&&jr(e,t,r,Jt,n),o===i)break;i=o}null!==i&&r.stopPropagation()}else jr(e,t,r,null,n)}}var Jt=null;function Xt(e,t,n,r){if(Jt=null,null!==(e=mi(e=we(r))))if(null===(t=He(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Ke(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Jt=e,null}function zt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ze()){case $e:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var qt=null,Zt=null,$t=null;function en(){if($t)return $t;var e,t,n=Zt,r=n.length,i="value"in qt?qt.value:qt.textContent,o=i.length;for(e=0;e<r&&n[e]===i[e];e++);var a=r-e;for(t=1;t<=a&&n[r-t]===i[o-t];t++);return $t=i.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function on(e){function t(t,n,r,i,o){for(var a in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return M(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var an,sn,An,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ln=on(cn),dn=M({},cn,{view:0,detail:0}),un=on(dn),hn=M({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:yn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==An&&(An&&"mousemove"===e.type?(an=e.screenX-An.screenX,sn=e.screenY-An.screenY):sn=an=0,An=e),an)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),pn=on(hn),fn=on(M({},hn,{dataTransfer:0})),En=on(M({},dn,{relatedTarget:0})),gn=on(M({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),mn=M({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),_n=on(mn),Cn=on(M({},cn,{data:0})),wn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Tn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function vn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Tn[e])&&!!t[e]}function yn(){return vn}var In=M({},dn,{key:function(e){if(e.key){var t=wn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Sn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:yn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Rn=on(In),bn=on(M({},hn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),On=on(M({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:yn})),Bn=on(M({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Nn=M({},hn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Dn=on(Nn),Pn=[9,13,27,32],Un=l&&"CompositionEvent"in window,Ln=null;l&&"documentMode"in document&&(Ln=document.documentMode);var kn=l&&"TextEvent"in window&&!Ln,Mn=l&&(!Un||Ln&&8<Ln&&11>=Ln),Fn=String.fromCharCode(32),xn=!1;function Qn(e,t){switch(e){case"keyup":return-1!==Pn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Vn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Hn=!1;var Kn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function jn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Kn[e.type]:"textarea"===t}function Gn(e,t,n,r){Ie(r),0<(t=Wr(t,"onChange")).length&&(n=new ln("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Wn=null,Yn=null;function Jn(e){Fr(e,0)}function Xn(e){if(Y(Ci(e)))return e}function zn(e,t){if("change"===e)return t}var qn=!1;if(l){var Zn;if(l){var $n="oninput"in document;if(!$n){var er=document.createElement("div");er.setAttribute("oninput","return;"),$n="function"===typeof er.oninput}Zn=$n}else Zn=!1;qn=Zn&&(!document.documentMode||9<document.documentMode)}function tr(){Wn&&(Wn.detachEvent("onpropertychange",nr),Yn=Wn=null)}function nr(e){if("value"===e.propertyName&&Xn(Yn)){var t=[];Gn(t,Yn,e,we(e)),Ne(Jn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Yn=n,(Wn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ir(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Xn(Yn)}function or(e,t){if("click"===e)return Xn(t)}function ar(e,t){if("input"===e||"change"===e)return Xn(t)}var sr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function Ar(e,t){if(sr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!d.call(t,i)||!sr(e[i],t[i]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function lr(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function dr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?dr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function ur(){for(var e=window,t=J();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=J((e=t.contentWindow).document)}return t}function hr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pr(e){var t=ur(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&dr(n.ownerDocument.documentElement,n)){if(null!==r&&hr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,o=Math.min(r.start,i);r=void 0===r.end?o:Math.min(r.end,i),!e.extend&&o>r&&(i=r,r=o,o=i),i=lr(n,o);var a=lr(n,r);i&&a&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),o>r?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var fr=l&&"documentMode"in document&&11>=document.documentMode,Er=null,gr=null,mr=null,_r=!1;function Cr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;_r||null==Er||Er!==J(r)||("selectionStart"in(r=Er)&&hr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},mr&&Ar(mr,r)||(mr=r,0<(r=Wr(gr,"onSelect")).length&&(t=new ln("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=Er)))}function wr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Sr={animationend:wr("Animation","AnimationEnd"),animationiteration:wr("Animation","AnimationIteration"),animationstart:wr("Animation","AnimationStart"),transitionend:wr("Transition","TransitionEnd")},Tr={},vr={};function yr(e){if(Tr[e])return Tr[e];if(!Sr[e])return e;var t,n=Sr[e];for(t in n)if(n.hasOwnProperty(t)&&t in vr)return Tr[e]=n[t];return e}l&&(vr=document.createElement("div").style,"AnimationEvent"in window||(delete Sr.animationend.animation,delete Sr.animationiteration.animation,delete Sr.animationstart.animation),"TransitionEvent"in window||delete Sr.transitionend.transition);var Ir=yr("animationend"),Rr=yr("animationiteration"),br=yr("animationstart"),Or=yr("transitionend"),Br=new Map,Nr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Dr(e,t){Br.set(e,t),A(t,[e])}for(var Pr=0;Pr<Nr.length;Pr++){var Ur=Nr[Pr];Dr(Ur.toLowerCase(),"on"+(Ur[0].toUpperCase()+Ur.slice(1)))}Dr(Ir,"onAnimationEnd"),Dr(Rr,"onAnimationIteration"),Dr(br,"onAnimationStart"),Dr("dblclick","onDoubleClick"),Dr("focusin","onFocus"),Dr("focusout","onBlur"),Dr(Or,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),A("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),A("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),A("onBeforeInput",["compositionend","keypress","textInput","paste"]),A("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),A("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),A("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Lr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),kr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Lr));function Mr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,a,s,A,c){if(Ve.apply(this,arguments),ke){if(!ke)throw Error(o(198));var l=Me;ke=!1,Me=null,Fe||(Fe=!0,xe=l)}}(r,t,void 0,e),e.currentTarget=null}function Fr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var o=void 0;if(t)for(var a=r.length-1;0<=a;a--){var s=r[a],A=s.instance,c=s.currentTarget;if(s=s.listener,A!==o&&i.isPropagationStopped())break e;Mr(i,s,c),o=A}else for(a=0;a<r.length;a++){if(A=(s=r[a]).instance,c=s.currentTarget,s=s.listener,A!==o&&i.isPropagationStopped())break e;Mr(i,s,c),o=A}}}if(Fe)throw e=xe,Fe=!1,xe=null,e}function xr(e,t){var n=t[fi];void 0===n&&(n=t[fi]=new Set);var r=e+"__bubble";n.has(r)||(Kr(t,e,2,!1),n.add(r))}function Qr(e,t,n){var r=0;t&&(r|=4),Kr(n,e,r,t)}var Vr="_reactListening"+Math.random().toString(36).slice(2);function Hr(e){if(!e[Vr]){e[Vr]=!0,a.forEach((function(t){"selectionchange"!==t&&(kr.has(t)||Qr(t,!1,e),Qr(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Vr]||(t[Vr]=!0,Qr("selectionchange",!1,t))}}function Kr(e,t,n,r){switch(zt(t)){case 1:var i=Gt;break;case 4:i=Wt;break;default:i=Yt}n=i.bind(null,t,n,e),i=void 0,!Pe||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function jr(e,t,n,r,i){var o=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var a=r.tag;if(3===a||4===a){var s=r.stateNode.containerInfo;if(s===i||8===s.nodeType&&s.parentNode===i)break;if(4===a)for(a=r.return;null!==a;){var A=a.tag;if((3===A||4===A)&&((A=a.stateNode.containerInfo)===i||8===A.nodeType&&A.parentNode===i))return;a=a.return}for(;null!==s;){if(null===(a=mi(s)))return;if(5===(A=a.tag)||6===A){r=o=a;continue e}s=s.parentNode}}r=r.return}Ne((function(){var r=o,i=we(n),a=[];e:{var s=Br.get(e);if(void 0!==s){var A=ln,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":A=Rn;break;case"focusin":c="focus",A=En;break;case"focusout":c="blur",A=En;break;case"beforeblur":case"afterblur":A=En;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":A=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":A=fn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":A=On;break;case Ir:case Rr:case br:A=gn;break;case Or:A=Bn;break;case"scroll":A=un;break;case"wheel":A=Dn;break;case"copy":case"cut":case"paste":A=_n;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":A=bn}var l=0!==(4&t),d=!l&&"scroll"===e,u=l?null!==s?s+"Capture":null:s;l=[];for(var h,p=r;null!==p;){var f=(h=p).stateNode;if(5===h.tag&&null!==f&&(h=f,null!==u&&(null!=(f=De(p,u))&&l.push(Gr(p,f,h)))),d)break;p=p.return}0<l.length&&(s=new A(s,c,null,n,i),a.push({event:s,listeners:l}))}}if(0===(7&t)){if(A="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===Ce||!(c=n.relatedTarget||n.fromElement)||!mi(c)&&!c[pi])&&(A||s)&&(s=i.window===i?i:(s=i.ownerDocument)?s.defaultView||s.parentWindow:window,A?(A=r,null!==(c=(c=n.relatedTarget||n.toElement)?mi(c):null)&&(c!==(d=He(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(A=null,c=r),A!==c)){if(l=pn,f="onMouseLeave",u="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(l=bn,f="onPointerLeave",u="onPointerEnter",p="pointer"),d=null==A?s:Ci(A),h=null==c?s:Ci(c),(s=new l(f,p+"leave",A,n,i)).target=d,s.relatedTarget=h,f=null,mi(i)===r&&((l=new l(u,p+"enter",c,n,i)).target=h,l.relatedTarget=d,f=l),d=f,A&&c)e:{for(u=c,p=0,h=l=A;h;h=Yr(h))p++;for(h=0,f=u;f;f=Yr(f))h++;for(;0<p-h;)l=Yr(l),p--;for(;0<h-p;)u=Yr(u),h--;for(;p--;){if(l===u||null!==u&&l===u.alternate)break e;l=Yr(l),u=Yr(u)}l=null}else l=null;null!==A&&Jr(a,s,A,l,!1),null!==c&&null!==d&&Jr(a,d,c,l,!0)}if("select"===(A=(s=r?Ci(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===A&&"file"===s.type)var E=zn;else if(jn(s))if(qn)E=ar;else{E=ir;var g=rr}else(A=s.nodeName)&&"input"===A.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(E=or);switch(E&&(E=E(e,r))?Gn(a,E,n,i):(g&&g(e,s,r),"focusout"===e&&(g=s._wrapperState)&&g.controlled&&"number"===s.type&&ee(s,"number",s.value)),g=r?Ci(r):window,e){case"focusin":(jn(g)||"true"===g.contentEditable)&&(Er=g,gr=r,mr=null);break;case"focusout":mr=gr=Er=null;break;case"mousedown":_r=!0;break;case"contextmenu":case"mouseup":case"dragend":_r=!1,Cr(a,n,i);break;case"selectionchange":if(fr)break;case"keydown":case"keyup":Cr(a,n,i)}var m;if(Un)e:{switch(e){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else Hn?Qn(e,n)&&(_="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(_="onCompositionStart");_&&(Mn&&"ko"!==n.locale&&(Hn||"onCompositionStart"!==_?"onCompositionEnd"===_&&Hn&&(m=en()):(Zt="value"in(qt=i)?qt.value:qt.textContent,Hn=!0)),0<(g=Wr(r,_)).length&&(_=new Cn(_,e,null,n,i),a.push({event:_,listeners:g}),m?_.data=m:null!==(m=Vn(n))&&(_.data=m))),(m=kn?function(e,t){switch(e){case"compositionend":return Vn(t);case"keypress":return 32!==t.which?null:(xn=!0,Fn);case"textInput":return(e=t.data)===Fn&&xn?null:e;default:return null}}(e,n):function(e,t){if(Hn)return"compositionend"===e||!Un&&Qn(e,t)?(e=en(),$t=Zt=qt=null,Hn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Mn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Wr(r,"onBeforeInput")).length&&(i=new Cn("onBeforeInput","beforeinput",null,n,i),a.push({event:i,listeners:r}),i.data=m))}Fr(a,t)}))}function Gr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Wr(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,o=i.stateNode;5===i.tag&&null!==o&&(i=o,null!=(o=De(e,n))&&r.unshift(Gr(e,o,i)),null!=(o=De(e,t))&&r.push(Gr(e,o,i))),e=e.return}return r}function Yr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Jr(e,t,n,r,i){for(var o=t._reactName,a=[];null!==n&&n!==r;){var s=n,A=s.alternate,c=s.stateNode;if(null!==A&&A===r)break;5===s.tag&&null!==c&&(s=c,i?null!=(A=De(n,o))&&a.unshift(Gr(n,A,s)):i||null!=(A=De(n,o))&&a.push(Gr(n,A,s))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var Xr=/\r\n?/g,zr=/\u0000|\uFFFD/g;function qr(e){return("string"===typeof e?e:""+e).replace(Xr,"\n").replace(zr,"")}function Zr(e,t,n){if(t=qr(t),qr(e)!==t&&n)throw Error(o(425))}function $r(){}var ei=null,ti=null;function ni(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ri="function"===typeof setTimeout?setTimeout:void 0,ii="function"===typeof clearTimeout?clearTimeout:void 0,oi="function"===typeof Promise?Promise:void 0,ai="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof oi?function(e){return oi.resolve(null).then(e).catch(si)}:ri;function si(e){setTimeout((function(){throw e}))}function Ai(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return e.removeChild(i),void Ht(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);Ht(t)}function ci(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function li(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var di=Math.random().toString(36).slice(2),ui="__reactFiber$"+di,hi="__reactProps$"+di,pi="__reactContainer$"+di,fi="__reactEvents$"+di,Ei="__reactListeners$"+di,gi="__reactHandles$"+di;function mi(e){var t=e[ui];if(t)return t;for(var n=e.parentNode;n;){if(t=n[pi]||n[ui]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=li(e);null!==e;){if(n=e[ui])return n;e=li(e)}return t}n=(e=n).parentNode}return null}function _i(e){return!(e=e[ui]||e[pi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function Ci(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function wi(e){return e[hi]||null}var Si=[],Ti=-1;function vi(e){return{current:e}}function yi(e){0>Ti||(e.current=Si[Ti],Si[Ti]=null,Ti--)}function Ii(e,t){Ti++,Si[Ti]=e.current,e.current=t}var Ri={},bi=vi(Ri),Oi=vi(!1),Bi=Ri;function Ni(e,t){var n=e.type.contextTypes;if(!n)return Ri;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,o={};for(i in n)o[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function Di(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Pi(){yi(Oi),yi(bi)}function Ui(e,t,n){if(bi.current!==Ri)throw Error(o(168));Ii(bi,t),Ii(Oi,n)}function Li(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error(o(108,K(e)||"Unknown",i));return M({},n,r)}function ki(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ri,Bi=bi.current,Ii(bi,e),Ii(Oi,Oi.current),!0}function Mi(e,t,n){var r=e.stateNode;if(!r)throw Error(o(169));n?(e=Li(e,t,Bi),r.__reactInternalMemoizedMergedChildContext=e,yi(Oi),yi(bi),Ii(bi,e)):yi(Oi),Ii(Oi,n)}var Fi=null,xi=!1,Qi=!1;function Vi(e){null===Fi?Fi=[e]:Fi.push(e)}function Hi(){if(!Qi&&null!==Fi){Qi=!0;var e=0,t=_t;try{var n=Fi;for(_t=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Fi=null,xi=!1}catch(i){throw null!==Fi&&(Fi=Fi.slice(e+1)),Ye($e,Hi),i}finally{_t=t,Qi=!1}}return null}var Ki=[],ji=0,Gi=null,Wi=0,Yi=[],Ji=0,Xi=null,zi=1,qi="";function Zi(e,t){Ki[ji++]=Wi,Ki[ji++]=Gi,Gi=e,Wi=t}function $i(e,t,n){Yi[Ji++]=zi,Yi[Ji++]=qi,Yi[Ji++]=Xi,Xi=e;var r=zi;e=qi;var i=32-at(r)-1;r&=~(1<<i),n+=1;var o=32-at(t)+i;if(30<o){var a=i-i%5;o=(r&(1<<a)-1).toString(32),r>>=a,i-=a,zi=1<<32-at(t)+i|n<<i|r,qi=o+e}else zi=1<<o|n<<i|r,qi=e}function eo(e){null!==e.return&&(Zi(e,1),$i(e,1,0))}function to(e){for(;e===Gi;)Gi=Ki[--ji],Ki[ji]=null,Wi=Ki[--ji],Ki[ji]=null;for(;e===Xi;)Xi=Yi[--Ji],Yi[Ji]=null,qi=Yi[--Ji],Yi[Ji]=null,zi=Yi[--Ji],Yi[Ji]=null}var no=null,ro=null,io=!1,oo=null;function ao(e,t){var n=Nc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function so(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,no=e,ro=ci(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,no=e,ro=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Xi?{id:zi,overflow:qi}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Nc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,no=e,ro=null,!0);default:return!1}}function Ao(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function co(e){if(io){var t=ro;if(t){var n=t;if(!so(e,t)){if(Ao(e))throw Error(o(418));t=ci(n.nextSibling);var r=no;t&&so(e,t)?ao(r,n):(e.flags=-4097&e.flags|2,io=!1,no=e)}}else{if(Ao(e))throw Error(o(418));e.flags=-4097&e.flags|2,io=!1,no=e}}}function lo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;no=e}function uo(e){if(e!==no)return!1;if(!io)return lo(e),io=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ni(e.type,e.memoizedProps)),t&&(t=ro)){if(Ao(e))throw ho(),Error(o(418));for(;t;)ao(e,t),t=ci(t.nextSibling)}if(lo(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ro=ci(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ro=null}}else ro=no?ci(e.stateNode.nextSibling):null;return!0}function ho(){for(var e=ro;e;)e=ci(e.nextSibling)}function po(){ro=no=null,io=!1}function fo(e){null===oo?oo=[e]:oo.push(e)}var Eo=C.ReactCurrentBatchConfig;function go(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var r=n.stateNode}if(!r)throw Error(o(147,e));var i=r,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=i.refs;null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function mo(e,t){throw e=Object.prototype.toString.call(t),Error(o(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function _o(e){return(0,e._init)(e._payload)}function Co(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Pc(e,t)).index=0,e.sibling=null,e}function a(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function A(e,t,n,r){return null===t||6!==t.tag?((t=Mc(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function c(e,t,n,r){var o=n.type;return o===T?d(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===o||"object"===typeof o&&null!==o&&o.$$typeof===D&&_o(o)===t.type)?((r=i(t,n.props)).ref=go(e,t,n),r.return=e,r):((r=Uc(n.type,n.key,n.props,null,e.mode,r)).ref=go(e,t,n),r.return=e,r)}function l(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Fc(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function d(e,t,n,r,o){return null===t||7!==t.tag?((t=Lc(n,e.mode,r,o)).return=e,t):((t=i(t,n)).return=e,t)}function u(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Mc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case w:return(n=Uc(t.type,t.key,t.props,null,e.mode,n)).ref=go(e,null,t),n.return=e,n;case S:return(t=Fc(t,e.mode,n)).return=e,t;case D:return u(e,(0,t._init)(t._payload),n)}if(te(t)||L(t))return(t=Lc(t,e.mode,n,null)).return=e,t;mo(e,t)}return null}function h(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==i?null:A(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case w:return n.key===i?c(e,t,n,r):null;case S:return n.key===i?l(e,t,n,r):null;case D:return h(e,t,(i=n._init)(n._payload),r)}if(te(n)||L(n))return null!==i?null:d(e,t,n,r,null);mo(e,n)}return null}function p(e,t,n,r,i){if("string"===typeof r&&""!==r||"number"===typeof r)return A(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case w:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i);case S:return l(t,e=e.get(null===r.key?n:r.key)||null,r,i);case D:return p(e,t,n,(0,r._init)(r._payload),i)}if(te(r)||L(r))return d(t,e=e.get(n)||null,r,i,null);mo(t,r)}return null}function f(i,o,s,A){for(var c=null,l=null,d=o,f=o=0,E=null;null!==d&&f<s.length;f++){d.index>f?(E=d,d=null):E=d.sibling;var g=h(i,d,s[f],A);if(null===g){null===d&&(d=E);break}e&&d&&null===g.alternate&&t(i,d),o=a(g,o,f),null===l?c=g:l.sibling=g,l=g,d=E}if(f===s.length)return n(i,d),io&&Zi(i,f),c;if(null===d){for(;f<s.length;f++)null!==(d=u(i,s[f],A))&&(o=a(d,o,f),null===l?c=d:l.sibling=d,l=d);return io&&Zi(i,f),c}for(d=r(i,d);f<s.length;f++)null!==(E=p(d,i,f,s[f],A))&&(e&&null!==E.alternate&&d.delete(null===E.key?f:E.key),o=a(E,o,f),null===l?c=E:l.sibling=E,l=E);return e&&d.forEach((function(e){return t(i,e)})),io&&Zi(i,f),c}function E(i,s,A,c){var l=L(A);if("function"!==typeof l)throw Error(o(150));if(null==(A=l.call(A)))throw Error(o(151));for(var d=l=null,f=s,E=s=0,g=null,m=A.next();null!==f&&!m.done;E++,m=A.next()){f.index>E?(g=f,f=null):g=f.sibling;var _=h(i,f,m.value,c);if(null===_){null===f&&(f=g);break}e&&f&&null===_.alternate&&t(i,f),s=a(_,s,E),null===d?l=_:d.sibling=_,d=_,f=g}if(m.done)return n(i,f),io&&Zi(i,E),l;if(null===f){for(;!m.done;E++,m=A.next())null!==(m=u(i,m.value,c))&&(s=a(m,s,E),null===d?l=m:d.sibling=m,d=m);return io&&Zi(i,E),l}for(f=r(i,f);!m.done;E++,m=A.next())null!==(m=p(f,i,E,m.value,c))&&(e&&null!==m.alternate&&f.delete(null===m.key?E:m.key),s=a(m,s,E),null===d?l=m:d.sibling=m,d=m);return e&&f.forEach((function(e){return t(i,e)})),io&&Zi(i,E),l}return function e(r,o,a,A){if("object"===typeof a&&null!==a&&a.type===T&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case w:e:{for(var c=a.key,l=o;null!==l;){if(l.key===c){if((c=a.type)===T){if(7===l.tag){n(r,l.sibling),(o=i(l,a.props.children)).return=r,r=o;break e}}else if(l.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===D&&_o(c)===l.type){n(r,l.sibling),(o=i(l,a.props)).ref=go(r,l,a),o.return=r,r=o;break e}n(r,l);break}t(r,l),l=l.sibling}a.type===T?((o=Lc(a.props.children,r.mode,A,a.key)).return=r,r=o):((A=Uc(a.type,a.key,a.props,null,r.mode,A)).ref=go(r,o,a),A.return=r,r=A)}return s(r);case S:e:{for(l=a.key;null!==o;){if(o.key===l){if(4===o.tag&&o.stateNode.containerInfo===a.containerInfo&&o.stateNode.implementation===a.implementation){n(r,o.sibling),(o=i(o,a.children||[])).return=r,r=o;break e}n(r,o);break}t(r,o),o=o.sibling}(o=Fc(a,r.mode,A)).return=r,r=o}return s(r);case D:return e(r,o,(l=a._init)(a._payload),A)}if(te(a))return f(r,o,a,A);if(L(a))return E(r,o,a,A);mo(r,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==o&&6===o.tag?(n(r,o.sibling),(o=i(o,a)).return=r,r=o):(n(r,o),(o=Mc(a,r.mode,A)).return=r,r=o),s(r)):n(r,o)}}var wo=Co(!0),So=Co(!1),To=vi(null),vo=null,yo=null,Io=null;function Ro(){Io=yo=vo=null}function bo(e){var t=To.current;yi(To),e._currentValue=t}function Oo(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Bo(e,t){vo=e,Io=yo=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(_s=!0),e.firstContext=null)}function No(e){var t=e._currentValue;if(Io!==e)if(e={context:e,memoizedValue:t,next:null},null===yo){if(null===vo)throw Error(o(308));yo=e,vo.dependencies={lanes:0,firstContext:e}}else yo=yo.next=e;return t}var Do=null;function Po(e){null===Do?Do=[e]:Do.push(e)}function Uo(e,t,n,r){var i=t.interleaved;return null===i?(n.next=n,Po(t)):(n.next=i.next,i.next=n),t.interleaved=n,Lo(e,r)}function Lo(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var ko=!1;function Mo(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Fo(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function xo(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Qo(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&bA)){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,Lo(e,n)}return null===(i=r.interleaved)?(t.next=t,Po(r)):(t.next=i.next,i.next=t),r.interleaved=t,Lo(e,n)}function Vo(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,mt(e,n)}}function Ho(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===o?i=o=a:o=o.next=a,n=n.next}while(null!==n);null===o?i=o=t:o=o.next=t}else i=o=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Ko(e,t,n,r){var i=e.updateQueue;ko=!1;var o=i.firstBaseUpdate,a=i.lastBaseUpdate,s=i.shared.pending;if(null!==s){i.shared.pending=null;var A=s,c=A.next;A.next=null,null===a?o=c:a.next=c,a=A;var l=e.alternate;null!==l&&((s=(l=l.updateQueue).lastBaseUpdate)!==a&&(null===s?l.firstBaseUpdate=c:s.next=c,l.lastBaseUpdate=A))}if(null!==o){var d=i.baseState;for(a=0,l=c=A=null,s=o;;){var u=s.lane,h=s.eventTime;if((r&u)===u){null!==l&&(l=l.next={eventTime:h,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var p=e,f=s;switch(u=t,h=n,f.tag){case 1:if("function"===typeof(p=f.payload)){d=p.call(h,d,u);break e}d=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(u="function"===typeof(p=f.payload)?p.call(h,d,u):p)||void 0===u)break e;d=M({},d,u);break e;case 2:ko=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(u=i.effects)?i.effects=[s]:u.push(s))}else h={eventTime:h,lane:u,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===l?(c=l=h,A=d):l=l.next=h,a|=u;if(null===(s=s.next)){if(null===(s=i.shared.pending))break;s=(u=s).next,u.next=null,i.lastBaseUpdate=u,i.shared.pending=null}}if(null===l&&(A=d),i.baseState=A,i.firstBaseUpdate=c,i.lastBaseUpdate=l,null!==(t=i.shared.interleaved)){i=t;do{a|=i.lane,i=i.next}while(i!==t)}else null===o&&(i.shared.lanes=0);kA|=a,e.lanes=a,e.memoizedState=d}}function jo(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!==typeof i)throw Error(o(191,i));i.call(r)}}}var Go={},Wo=vi(Go),Yo=vi(Go),Jo=vi(Go);function Xo(e){if(e===Go)throw Error(o(174));return e}function zo(e,t){switch(Ii(Jo,t),Ii(Yo,e),Ii(Wo,Go),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Ae(null,"");break;default:t=Ae(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}yi(Wo),Ii(Wo,t)}function qo(){yi(Wo),yi(Yo),yi(Jo)}function Zo(e){Xo(Jo.current);var t=Xo(Wo.current),n=Ae(t,e.type);t!==n&&(Ii(Yo,e),Ii(Wo,n))}function $o(e){Yo.current===e&&(yi(Wo),yi(Yo))}var ea=vi(0);function ta(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var na=[];function ra(){for(var e=0;e<na.length;e++)na[e]._workInProgressVersionPrimary=null;na.length=0}var ia=C.ReactCurrentDispatcher,oa=C.ReactCurrentBatchConfig,aa=0,sa=null,Aa=null,ca=null,la=!1,da=!1,ua=0,ha=0;function pa(){throw Error(o(321))}function fa(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!sr(e[n],t[n]))return!1;return!0}function Ea(e,t,n,r,i,a){if(aa=a,sa=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ia.current=null===e||null===e.memoizedState?$a:es,e=n(r,i),da){a=0;do{if(da=!1,ua=0,25<=a)throw Error(o(301));a+=1,ca=Aa=null,t.updateQueue=null,ia.current=ts,e=n(r,i)}while(da)}if(ia.current=Za,t=null!==Aa&&null!==Aa.next,aa=0,ca=Aa=sa=null,la=!1,t)throw Error(o(300));return e}function ga(){var e=0!==ua;return ua=0,e}function ma(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ca?sa.memoizedState=ca=e:ca=ca.next=e,ca}function _a(){if(null===Aa){var e=sa.alternate;e=null!==e?e.memoizedState:null}else e=Aa.next;var t=null===ca?sa.memoizedState:ca.next;if(null!==t)ca=t,Aa=e;else{if(null===e)throw Error(o(310));e={memoizedState:(Aa=e).memoizedState,baseState:Aa.baseState,baseQueue:Aa.baseQueue,queue:Aa.queue,next:null},null===ca?sa.memoizedState=ca=e:ca=ca.next=e}return ca}function Ca(e,t){return"function"===typeof t?t(e):t}function wa(e){var t=_a(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=Aa,i=r.baseQueue,a=n.pending;if(null!==a){if(null!==i){var s=i.next;i.next=a.next,a.next=s}r.baseQueue=i=a,n.pending=null}if(null!==i){a=i.next,r=r.baseState;var A=s=null,c=null,l=a;do{var d=l.lane;if((aa&d)===d)null!==c&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:e(r,l.action);else{var u={lane:d,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};null===c?(A=c=u,s=r):c=c.next=u,sa.lanes|=d,kA|=d}l=l.next}while(null!==l&&l!==a);null===c?s=r:c.next=A,sr(r,t.memoizedState)||(_s=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{a=i.lane,sa.lanes|=a,kA|=a,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Sa(e){var t=_a(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,a=t.memoizedState;if(null!==i){n.pending=null;var s=i=i.next;do{a=e(a,s.action),s=s.next}while(s!==i);sr(a,t.memoizedState)||(_s=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function Ta(){}function va(e,t){var n=sa,r=_a(),i=t(),a=!sr(r.memoizedState,i);if(a&&(r.memoizedState=i,_s=!0),r=r.queue,ka(Ra.bind(null,n,r,e),[e]),r.getSnapshot!==t||a||null!==ca&&1&ca.memoizedState.tag){if(n.flags|=2048,Na(9,Ia.bind(null,n,r,i,t),void 0,null),null===OA)throw Error(o(349));0!==(30&aa)||ya(n,t,i)}return i}function ya(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=sa.updateQueue)?(t={lastEffect:null,stores:null},sa.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Ia(e,t,n,r){t.value=n,t.getSnapshot=r,ba(t)&&Oa(e)}function Ra(e,t,n){return n((function(){ba(t)&&Oa(e)}))}function ba(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!sr(e,n)}catch(r){return!0}}function Oa(e){var t=Lo(e,1);null!==t&&nc(t,e,1,-1)}function Ba(e){var t=ma();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ca,lastRenderedState:e},t.queue=e,e=e.dispatch=Ja.bind(null,sa,e),[t.memoizedState,e]}function Na(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=sa.updateQueue)?(t={lastEffect:null,stores:null},sa.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Da(){return _a().memoizedState}function Pa(e,t,n,r){var i=ma();sa.flags|=e,i.memoizedState=Na(1|t,n,void 0,void 0===r?null:r)}function Ua(e,t,n,r){var i=_a();r=void 0===r?null:r;var o=void 0;if(null!==Aa){var a=Aa.memoizedState;if(o=a.destroy,null!==r&&fa(r,a.deps))return void(i.memoizedState=Na(t,n,o,r))}sa.flags|=e,i.memoizedState=Na(1|t,n,o,r)}function La(e,t){return Pa(8390656,8,e,t)}function ka(e,t){return Ua(2048,8,e,t)}function Ma(e,t){return Ua(4,2,e,t)}function Fa(e,t){return Ua(4,4,e,t)}function xa(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Qa(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ua(4,4,xa.bind(null,t,e),n)}function Va(){}function Ha(e,t){var n=_a();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&fa(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Ka(e,t){var n=_a();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&fa(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function ja(e,t,n){return 0===(21&aa)?(e.baseState&&(e.baseState=!1,_s=!0),e.memoizedState=n):(sr(n,t)||(n=ft(),sa.lanes|=n,kA|=n,e.baseState=!0),t)}function Ga(e,t){var n=_t;_t=0!==n&&4>n?n:4,e(!0);var r=oa.transition;oa.transition={};try{e(!1),t()}finally{_t=n,oa.transition=r}}function Wa(){return _a().memoizedState}function Ya(e,t,n){var r=tc(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Xa(e))za(t,n);else if(null!==(n=Uo(e,t,n,r))){nc(n,e,r,ec()),qa(n,t,r)}}function Ja(e,t,n){var r=tc(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Xa(e))za(t,i);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var a=t.lastRenderedState,s=o(a,n);if(i.hasEagerState=!0,i.eagerState=s,sr(s,a)){var A=t.interleaved;return null===A?(i.next=i,Po(t)):(i.next=A.next,A.next=i),void(t.interleaved=i)}}catch(c){}null!==(n=Uo(e,t,i,r))&&(nc(n,e,r,i=ec()),qa(n,t,r))}}function Xa(e){var t=e.alternate;return e===sa||null!==t&&t===sa}function za(e,t){da=la=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function qa(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,mt(e,n)}}var Za={readContext:No,useCallback:pa,useContext:pa,useEffect:pa,useImperativeHandle:pa,useInsertionEffect:pa,useLayoutEffect:pa,useMemo:pa,useReducer:pa,useRef:pa,useState:pa,useDebugValue:pa,useDeferredValue:pa,useTransition:pa,useMutableSource:pa,useSyncExternalStore:pa,useId:pa,unstable_isNewReconciler:!1},$a={readContext:No,useCallback:function(e,t){return ma().memoizedState=[e,void 0===t?null:t],e},useContext:No,useEffect:La,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Pa(4194308,4,xa.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Pa(4194308,4,e,t)},useInsertionEffect:function(e,t){return Pa(4,2,e,t)},useMemo:function(e,t){var n=ma();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=ma();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Ya.bind(null,sa,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},ma().memoizedState=e},useState:Ba,useDebugValue:Va,useDeferredValue:function(e){return ma().memoizedState=e},useTransition:function(){var e=Ba(!1),t=e[0];return e=Ga.bind(null,e[1]),ma().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=sa,i=ma();if(io){if(void 0===n)throw Error(o(407));n=n()}else{if(n=t(),null===OA)throw Error(o(349));0!==(30&aa)||ya(r,t,n)}i.memoizedState=n;var a={value:n,getSnapshot:t};return i.queue=a,La(Ra.bind(null,r,a,e),[e]),r.flags|=2048,Na(9,Ia.bind(null,r,a,n,t),void 0,null),n},useId:function(){var e=ma(),t=OA.identifierPrefix;if(io){var n=qi;t=":"+t+"R"+(n=(zi&~(1<<32-at(zi)-1)).toString(32)+n),0<(n=ua++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ha++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},es={readContext:No,useCallback:Ha,useContext:No,useEffect:ka,useImperativeHandle:Qa,useInsertionEffect:Ma,useLayoutEffect:Fa,useMemo:Ka,useReducer:wa,useRef:Da,useState:function(){return wa(Ca)},useDebugValue:Va,useDeferredValue:function(e){return ja(_a(),Aa.memoizedState,e)},useTransition:function(){return[wa(Ca)[0],_a().memoizedState]},useMutableSource:Ta,useSyncExternalStore:va,useId:Wa,unstable_isNewReconciler:!1},ts={readContext:No,useCallback:Ha,useContext:No,useEffect:ka,useImperativeHandle:Qa,useInsertionEffect:Ma,useLayoutEffect:Fa,useMemo:Ka,useReducer:Sa,useRef:Da,useState:function(){return Sa(Ca)},useDebugValue:Va,useDeferredValue:function(e){var t=_a();return null===Aa?t.memoizedState=e:ja(t,Aa.memoizedState,e)},useTransition:function(){return[Sa(Ca)[0],_a().memoizedState]},useMutableSource:Ta,useSyncExternalStore:va,useId:Wa,unstable_isNewReconciler:!1};function ns(e,t){if(e&&e.defaultProps){for(var n in t=M({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function rs(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:M({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var is={isMounted:function(e){return!!(e=e._reactInternals)&&He(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=ec(),i=tc(e),o=xo(r,i);o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=Qo(e,o,i))&&(nc(t,e,i,r),Vo(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=ec(),i=tc(e),o=xo(r,i);o.tag=1,o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=Qo(e,o,i))&&(nc(t,e,i,r),Vo(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ec(),r=tc(e),i=xo(n,r);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),null!==(t=Qo(e,i,r))&&(nc(t,e,r,n),Vo(t,e,r))}};function os(e,t,n,r,i,o,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,o,a):!t.prototype||!t.prototype.isPureReactComponent||(!Ar(n,r)||!Ar(i,o))}function as(e,t,n){var r=!1,i=Ri,o=t.contextType;return"object"===typeof o&&null!==o?o=No(o):(i=Di(t)?Bi:bi.current,o=(r=null!==(r=t.contextTypes)&&void 0!==r)?Ni(e,i):Ri),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=is,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=o),t}function ss(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&is.enqueueReplaceState(t,t.state,null)}function As(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs={},Mo(e);var o=t.contextType;"object"===typeof o&&null!==o?i.context=No(o):(o=Di(t)?Bi:bi.current,i.context=Ni(e,o)),i.state=e.memoizedState,"function"===typeof(o=t.getDerivedStateFromProps)&&(rs(e,t,o,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&is.enqueueReplaceState(i,i.state,null),Ko(e,n,i,r),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4194308)}function cs(e,t){try{var n="",r=t;do{n+=V(r),r=r.return}while(r);var i=n}catch(o){i="\nError generating stack: "+o.message+"\n"+o.stack}return{value:e,source:t,stack:i,digest:null}}function ls(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function ds(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var us="function"===typeof WeakMap?WeakMap:Map;function hs(e,t,n){(n=xo(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){jA||(jA=!0,GA=r),ds(0,t)},n}function ps(e,t,n){(n=xo(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){ds(0,t)}}var o=e.stateNode;return null!==o&&"function"===typeof o.componentDidCatch&&(n.callback=function(){ds(0,t),"function"!==typeof r&&(null===WA?WA=new Set([this]):WA.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function fs(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new us;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=yc.bind(null,e,t,n),t.then(e,e))}function Es(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function gs(e,t,n,r,i){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=xo(-1,1)).tag=2,Qo(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=i,e)}var ms=C.ReactCurrentOwner,_s=!1;function Cs(e,t,n,r){t.child=null===e?So(t,null,n,r):wo(t,e.child,n,r)}function ws(e,t,n,r,i){n=n.render;var o=t.ref;return Bo(t,i),r=Ea(e,t,n,r,o,i),n=ga(),null===e||_s?(io&&n&&eo(t),t.flags|=1,Cs(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,js(e,t,i))}function Ss(e,t,n,r,i){if(null===e){var o=n.type;return"function"!==typeof o||Dc(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Uc(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Ts(e,t,o,r,i))}if(o=e.child,0===(e.lanes&i)){var a=o.memoizedProps;if((n=null!==(n=n.compare)?n:Ar)(a,r)&&e.ref===t.ref)return js(e,t,i)}return t.flags|=1,(e=Pc(o,r)).ref=t.ref,e.return=t,t.child=e}function Ts(e,t,n,r,i){if(null!==e){var o=e.memoizedProps;if(Ar(o,r)&&e.ref===t.ref){if(_s=!1,t.pendingProps=r=o,0===(e.lanes&i))return t.lanes=e.lanes,js(e,t,i);0!==(131072&e.flags)&&(_s=!0)}}return Is(e,t,n,r,i)}function vs(e,t,n){var r=t.pendingProps,i=r.children,o=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ii(PA,DA),DA|=n;else{if(0===(1073741824&n))return e=null!==o?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ii(PA,DA),DA|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==o?o.baseLanes:n,Ii(PA,DA),DA|=r}else null!==o?(r=o.baseLanes|n,t.memoizedState=null):r=n,Ii(PA,DA),DA|=r;return Cs(e,t,i,n),t.child}function ys(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Is(e,t,n,r,i){var o=Di(n)?Bi:bi.current;return o=Ni(t,o),Bo(t,i),n=Ea(e,t,n,r,o,i),r=ga(),null===e||_s?(io&&r&&eo(t),t.flags|=1,Cs(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,js(e,t,i))}function Rs(e,t,n,r,i){if(Di(n)){var o=!0;ki(t)}else o=!1;if(Bo(t,i),null===t.stateNode)Ks(e,t),as(t,n,r),As(t,n,r,i),r=!0;else if(null===e){var a=t.stateNode,s=t.memoizedProps;a.props=s;var A=a.context,c=n.contextType;"object"===typeof c&&null!==c?c=No(c):c=Ni(t,c=Di(n)?Bi:bi.current);var l=n.getDerivedStateFromProps,d="function"===typeof l||"function"===typeof a.getSnapshotBeforeUpdate;d||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==r||A!==c)&&ss(t,a,r,c),ko=!1;var u=t.memoizedState;a.state=u,Ko(t,r,a,i),A=t.memoizedState,s!==r||u!==A||Oi.current||ko?("function"===typeof l&&(rs(t,n,l,r),A=t.memoizedState),(s=ko||os(t,n,s,r,u,A,c))?(d||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=A),a.props=r,a.state=A,a.context=c,r=s):("function"===typeof a.componentDidMount&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,Fo(e,t),s=t.memoizedProps,c=t.type===t.elementType?s:ns(t.type,s),a.props=c,d=t.pendingProps,u=a.context,"object"===typeof(A=n.contextType)&&null!==A?A=No(A):A=Ni(t,A=Di(n)?Bi:bi.current);var h=n.getDerivedStateFromProps;(l="function"===typeof h||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==d||u!==A)&&ss(t,a,r,A),ko=!1,u=t.memoizedState,a.state=u,Ko(t,r,a,i);var p=t.memoizedState;s!==d||u!==p||Oi.current||ko?("function"===typeof h&&(rs(t,n,h,r),p=t.memoizedState),(c=ko||os(t,n,c,r,u,p,A)||!1)?(l||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(r,p,A),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,p,A)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&u===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&u===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),a.props=r,a.state=p,a.context=A,r=c):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&u===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&u===e.memoizedState||(t.flags|=1024),r=!1)}return bs(e,t,n,r,o,i)}function bs(e,t,n,r,i,o){ys(e,t);var a=0!==(128&t.flags);if(!r&&!a)return i&&Mi(t,n,!1),js(e,t,o);r=t.stateNode,ms.current=t;var s=a&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&a?(t.child=wo(t,e.child,null,o),t.child=wo(t,null,s,o)):Cs(e,t,s,o),t.memoizedState=r.state,i&&Mi(t,n,!0),t.child}function Os(e){var t=e.stateNode;t.pendingContext?Ui(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Ui(0,t.context,!1),zo(e,t.containerInfo)}function Bs(e,t,n,r,i){return po(),fo(i),t.flags|=256,Cs(e,t,n,r),t.child}var Ns,Ds,Ps,Us,Ls={dehydrated:null,treeContext:null,retryLane:0};function ks(e){return{baseLanes:e,cachePool:null,transitions:null}}function Ms(e,t,n){var r,i=t.pendingProps,a=ea.current,s=!1,A=0!==(128&t.flags);if((r=A)||(r=(null===e||null!==e.memoizedState)&&0!==(2&a)),r?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),Ii(ea,1&a),null===e)return co(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(A=i.children,e=i.fallback,s?(i=t.mode,s=t.child,A={mode:"hidden",children:A},0===(1&i)&&null!==s?(s.childLanes=0,s.pendingProps=A):s=kc(A,i,0,null),e=Lc(e,i,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=ks(n),t.memoizedState=Ls,e):Fs(t,A));if(null!==(a=e.memoizedState)&&null!==(r=a.dehydrated))return function(e,t,n,r,i,a,s){if(n)return 256&t.flags?(t.flags&=-257,xs(e,t,s,r=ls(Error(o(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=r.fallback,i=t.mode,r=kc({mode:"visible",children:r.children},i,0,null),(a=Lc(a,i,s,null)).flags|=2,r.return=t,a.return=t,r.sibling=a,t.child=r,0!==(1&t.mode)&&wo(t,e.child,null,s),t.child.memoizedState=ks(s),t.memoizedState=Ls,a);if(0===(1&t.mode))return xs(e,t,s,null);if("$!"===i.data){if(r=i.nextSibling&&i.nextSibling.dataset)var A=r.dgst;return r=A,xs(e,t,s,r=ls(a=Error(o(419)),r,void 0))}if(A=0!==(s&e.childLanes),_s||A){if(null!==(r=OA)){switch(s&-s){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=0!==(i&(r.suspendedLanes|s))?0:i)&&i!==a.retryLane&&(a.retryLane=i,Lo(e,i),nc(r,e,i,-1))}return fc(),xs(e,t,s,r=ls(Error(o(421))))}return"$?"===i.data?(t.flags|=128,t.child=e.child,t=Rc.bind(null,e),i._reactRetry=t,null):(e=a.treeContext,ro=ci(i.nextSibling),no=t,io=!0,oo=null,null!==e&&(Yi[Ji++]=zi,Yi[Ji++]=qi,Yi[Ji++]=Xi,zi=e.id,qi=e.overflow,Xi=t),t=Fs(t,r.children),t.flags|=4096,t)}(e,t,A,i,r,a,n);if(s){s=i.fallback,A=t.mode,r=(a=e.child).sibling;var c={mode:"hidden",children:i.children};return 0===(1&A)&&t.child!==a?((i=t.child).childLanes=0,i.pendingProps=c,t.deletions=null):(i=Pc(a,c)).subtreeFlags=14680064&a.subtreeFlags,null!==r?s=Pc(r,s):(s=Lc(s,A,n,null)).flags|=2,s.return=t,i.return=t,i.sibling=s,t.child=i,i=s,s=t.child,A=null===(A=e.child.memoizedState)?ks(n):{baseLanes:A.baseLanes|n,cachePool:null,transitions:A.transitions},s.memoizedState=A,s.childLanes=e.childLanes&~n,t.memoizedState=Ls,i}return e=(s=e.child).sibling,i=Pc(s,{mode:"visible",children:i.children}),0===(1&t.mode)&&(i.lanes=n),i.return=t,i.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function Fs(e,t){return(t=kc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function xs(e,t,n,r){return null!==r&&fo(r),wo(t,e.child,null,n),(e=Fs(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Qs(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Oo(e.return,t,n)}function Vs(e,t,n,r,i){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i)}function Hs(e,t,n){var r=t.pendingProps,i=r.revealOrder,o=r.tail;if(Cs(e,t,r.children,n),0!==(2&(r=ea.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Qs(e,n,t);else if(19===e.tag)Qs(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ii(ea,r),0===(1&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===ta(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Vs(t,!1,i,n,o);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===ta(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Vs(t,!0,n,null,o);break;case"together":Vs(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ks(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function js(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),kA|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=Pc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Pc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Gs(e,t){if(!io)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Ws(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Ys(e,t,n){var r=t.pendingProps;switch(to(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ws(t),null;case 1:case 17:return Di(t.type)&&Pi(),Ws(t),null;case 3:return r=t.stateNode,qo(),yi(Oi),yi(bi),ra(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(uo(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==oo&&(ac(oo),oo=null))),Ds(e,t),Ws(t),null;case 5:$o(t);var i=Xo(Jo.current);if(n=t.type,null!==e&&null!=t.stateNode)Ps(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(o(166));return Ws(t),null}if(e=Xo(Wo.current),uo(t)){r=t.stateNode,n=t.type;var a=t.memoizedProps;switch(r[ui]=t,r[hi]=a,e=0!==(1&t.mode),n){case"dialog":xr("cancel",r),xr("close",r);break;case"iframe":case"object":case"embed":xr("load",r);break;case"video":case"audio":for(i=0;i<Lr.length;i++)xr(Lr[i],r);break;case"source":xr("error",r);break;case"img":case"image":case"link":xr("error",r),xr("load",r);break;case"details":xr("toggle",r);break;case"input":z(r,a),xr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},xr("invalid",r);break;case"textarea":ie(r,a),xr("invalid",r)}for(var A in me(n,a),i=null,a)if(a.hasOwnProperty(A)){var c=a[A];"children"===A?"string"===typeof c?r.textContent!==c&&(!0!==a.suppressHydrationWarning&&Zr(r.textContent,c,e),i=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(!0!==a.suppressHydrationWarning&&Zr(r.textContent,c,e),i=["children",""+c]):s.hasOwnProperty(A)&&null!=c&&"onScroll"===A&&xr("scroll",r)}switch(n){case"input":W(r),$(r,a,!0);break;case"textarea":W(r),ae(r);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(r.onclick=$r)}r=i,t.updateQueue=r,null!==r&&(t.flags|=4)}else{A=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=A.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=A.createElement(n,{is:r.is}):(e=A.createElement(n),"select"===n&&(A=e,r.multiple?A.multiple=!0:r.size&&(A.size=r.size))):e=A.createElementNS(e,n),e[ui]=t,e[hi]=r,Ns(e,t,!1,!1),t.stateNode=e;e:{switch(A=_e(n,r),n){case"dialog":xr("cancel",e),xr("close",e),i=r;break;case"iframe":case"object":case"embed":xr("load",e),i=r;break;case"video":case"audio":for(i=0;i<Lr.length;i++)xr(Lr[i],e);i=r;break;case"source":xr("error",e),i=r;break;case"img":case"image":case"link":xr("error",e),xr("load",e),i=r;break;case"details":xr("toggle",e),i=r;break;case"input":z(e,r),i=X(e,r),xr("invalid",e);break;case"option":default:i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=M({},r,{value:void 0}),xr("invalid",e);break;case"textarea":ie(e,r),i=re(e,r),xr("invalid",e)}for(a in me(n,i),c=i)if(c.hasOwnProperty(a)){var l=c[a];"style"===a?Ee(e,l):"dangerouslySetInnerHTML"===a?null!=(l=l?l.__html:void 0)&&de(e,l):"children"===a?"string"===typeof l?("textarea"!==n||""!==l)&&ue(e,l):"number"===typeof l&&ue(e,""+l):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(s.hasOwnProperty(a)?null!=l&&"onScroll"===a&&xr("scroll",e):null!=l&&_(e,a,l,A))}switch(n){case"input":W(e),$(e,r,!1);break;case"textarea":W(e),ae(e);break;case"option":null!=r.value&&e.setAttribute("value",""+j(r.value));break;case"select":e.multiple=!!r.multiple,null!=(a=r.value)?ne(e,!!r.multiple,a,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof i.onClick&&(e.onclick=$r)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Ws(t),null;case 6:if(e&&null!=t.stateNode)Us(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(o(166));if(n=Xo(Jo.current),Xo(Wo.current),uo(t)){if(r=t.stateNode,n=t.memoizedProps,r[ui]=t,(a=r.nodeValue!==n)&&null!==(e=no))switch(e.tag){case 3:Zr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Zr(r.nodeValue,n,0!==(1&e.mode))}a&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[ui]=t,t.stateNode=r}return Ws(t),null;case 13:if(yi(ea),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(io&&null!==ro&&0!==(1&t.mode)&&0===(128&t.flags))ho(),po(),t.flags|=98560,a=!1;else if(a=uo(t),null!==r&&null!==r.dehydrated){if(null===e){if(!a)throw Error(o(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(o(317));a[ui]=t}else po(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Ws(t),a=!1}else null!==oo&&(ac(oo),oo=null),a=!0;if(!a)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&ea.current)?0===UA&&(UA=3):fc())),null!==t.updateQueue&&(t.flags|=4),Ws(t),null);case 4:return qo(),Ds(e,t),null===e&&Hr(t.stateNode.containerInfo),Ws(t),null;case 10:return bo(t.type._context),Ws(t),null;case 19:if(yi(ea),null===(a=t.memoizedState))return Ws(t),null;if(r=0!==(128&t.flags),null===(A=a.rendering))if(r)Gs(a,!1);else{if(0!==UA||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(A=ta(e))){for(t.flags|=128,Gs(a,!1),null!==(r=A.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(a=n).flags&=14680066,null===(A=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=A.childLanes,a.lanes=A.lanes,a.child=A.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=A.memoizedProps,a.memoizedState=A.memoizedState,a.updateQueue=A.updateQueue,a.type=A.type,e=A.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ii(ea,1&ea.current|2),t.child}e=e.sibling}null!==a.tail&&qe()>HA&&(t.flags|=128,r=!0,Gs(a,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=ta(A))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Gs(a,!0),null===a.tail&&"hidden"===a.tailMode&&!A.alternate&&!io)return Ws(t),null}else 2*qe()-a.renderingStartTime>HA&&1073741824!==n&&(t.flags|=128,r=!0,Gs(a,!1),t.lanes=4194304);a.isBackwards?(A.sibling=t.child,t.child=A):(null!==(n=a.last)?n.sibling=A:t.child=A,a.last=A)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=qe(),t.sibling=null,n=ea.current,Ii(ea,r?1&n|2:1&n),t):(Ws(t),null);case 22:case 23:return dc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&DA)&&(Ws(t),6&t.subtreeFlags&&(t.flags|=8192)):Ws(t),null;case 24:case 25:return null}throw Error(o(156,t.tag))}function Js(e,t){switch(to(t),t.tag){case 1:return Di(t.type)&&Pi(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return qo(),yi(Oi),yi(bi),ra(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return $o(t),null;case 13:if(yi(ea),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(o(340));po()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return yi(ea),null;case 4:return qo(),null;case 10:return bo(t.type._context),null;case 22:case 23:return dc(),null;default:return null}}Ns=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ds=function(){},Ps=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,Xo(Wo.current);var o,a=null;switch(n){case"input":i=X(e,i),r=X(e,r),a=[];break;case"select":i=M({},i,{value:void 0}),r=M({},r,{value:void 0}),a=[];break;case"textarea":i=re(e,i),r=re(e,r),a=[];break;default:"function"!==typeof i.onClick&&"function"===typeof r.onClick&&(e.onclick=$r)}for(l in me(n,r),n=null,i)if(!r.hasOwnProperty(l)&&i.hasOwnProperty(l)&&null!=i[l])if("style"===l){var A=i[l];for(o in A)A.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else"dangerouslySetInnerHTML"!==l&&"children"!==l&&"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&"autoFocus"!==l&&(s.hasOwnProperty(l)?a||(a=[]):(a=a||[]).push(l,null));for(l in r){var c=r[l];if(A=null!=i?i[l]:void 0,r.hasOwnProperty(l)&&c!==A&&(null!=c||null!=A))if("style"===l)if(A){for(o in A)!A.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&A[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(a||(a=[]),a.push(l,n)),n=c;else"dangerouslySetInnerHTML"===l?(c=c?c.__html:void 0,A=A?A.__html:void 0,null!=c&&A!==c&&(a=a||[]).push(l,c)):"children"===l?"string"!==typeof c&&"number"!==typeof c||(a=a||[]).push(l,""+c):"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&(s.hasOwnProperty(l)?(null!=c&&"onScroll"===l&&xr("scroll",e),a||A===c||(a=[])):(a=a||[]).push(l,c))}n&&(a=a||[]).push("style",n);var l=a;(t.updateQueue=l)&&(t.flags|=4)}},Us=function(e,t,n,r){n!==r&&(t.flags|=4)};var Xs=!1,zs=!1,qs="function"===typeof WeakSet?WeakSet:Set,Zs=null;function $s(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){vc(e,t,r)}else n.current=null}function eA(e,t,n){try{n()}catch(r){vc(e,t,r)}}var tA=!1;function nA(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var o=i.destroy;i.destroy=void 0,void 0!==o&&eA(t,n,o)}i=i.next}while(i!==r)}}function rA(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function iA(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function oA(e){var t=e.alternate;null!==t&&(e.alternate=null,oA(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[ui],delete t[hi],delete t[fi],delete t[Ei],delete t[gi])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function aA(e){return 5===e.tag||3===e.tag||4===e.tag}function sA(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||aA(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function AA(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$r));else if(4!==r&&null!==(e=e.child))for(AA(e,t,n),e=e.sibling;null!==e;)AA(e,t,n),e=e.sibling}function cA(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(cA(e,t,n),e=e.sibling;null!==e;)cA(e,t,n),e=e.sibling}var lA=null,dA=!1;function uA(e,t,n){for(n=n.child;null!==n;)hA(e,t,n),n=n.sibling}function hA(e,t,n){if(ot&&"function"===typeof ot.onCommitFiberUnmount)try{ot.onCommitFiberUnmount(it,n)}catch(s){}switch(n.tag){case 5:zs||$s(n,t);case 6:var r=lA,i=dA;lA=null,uA(e,t,n),dA=i,null!==(lA=r)&&(dA?(e=lA,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):lA.removeChild(n.stateNode));break;case 18:null!==lA&&(dA?(e=lA,n=n.stateNode,8===e.nodeType?Ai(e.parentNode,n):1===e.nodeType&&Ai(e,n),Ht(e)):Ai(lA,n.stateNode));break;case 4:r=lA,i=dA,lA=n.stateNode.containerInfo,dA=!0,uA(e,t,n),lA=r,dA=i;break;case 0:case 11:case 14:case 15:if(!zs&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){i=r=r.next;do{var o=i,a=o.destroy;o=o.tag,void 0!==a&&(0!==(2&o)||0!==(4&o))&&eA(n,t,a),i=i.next}while(i!==r)}uA(e,t,n);break;case 1:if(!zs&&($s(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){vc(n,t,s)}uA(e,t,n);break;case 21:uA(e,t,n);break;case 22:1&n.mode?(zs=(r=zs)||null!==n.memoizedState,uA(e,t,n),zs=r):uA(e,t,n);break;default:uA(e,t,n)}}function pA(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new qs),t.forEach((function(t){var r=bc.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function fA(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var a=e,s=t,A=s;e:for(;null!==A;){switch(A.tag){case 5:lA=A.stateNode,dA=!1;break e;case 3:case 4:lA=A.stateNode.containerInfo,dA=!0;break e}A=A.return}if(null===lA)throw Error(o(160));hA(a,s,i),lA=null,dA=!1;var c=i.alternate;null!==c&&(c.return=null),i.return=null}catch(l){vc(i,t,l)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)EA(t,e),t=t.sibling}function EA(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(fA(t,e),gA(e),4&r){try{nA(3,e,e.return),rA(3,e)}catch(E){vc(e,e.return,E)}try{nA(5,e,e.return)}catch(E){vc(e,e.return,E)}}break;case 1:fA(t,e),gA(e),512&r&&null!==n&&$s(n,n.return);break;case 5:if(fA(t,e),gA(e),512&r&&null!==n&&$s(n,n.return),32&e.flags){var i=e.stateNode;try{ue(i,"")}catch(E){vc(e,e.return,E)}}if(4&r&&null!=(i=e.stateNode)){var a=e.memoizedProps,s=null!==n?n.memoizedProps:a,A=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===A&&"radio"===a.type&&null!=a.name&&q(i,a),_e(A,s);var l=_e(A,a);for(s=0;s<c.length;s+=2){var d=c[s],u=c[s+1];"style"===d?Ee(i,u):"dangerouslySetInnerHTML"===d?de(i,u):"children"===d?ue(i,u):_(i,d,u,l)}switch(A){case"input":Z(i,a);break;case"textarea":oe(i,a);break;case"select":var h=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!a.multiple;var p=a.value;null!=p?ne(i,!!a.multiple,p,!1):h!==!!a.multiple&&(null!=a.defaultValue?ne(i,!!a.multiple,a.defaultValue,!0):ne(i,!!a.multiple,a.multiple?[]:"",!1))}i[hi]=a}catch(E){vc(e,e.return,E)}}break;case 6:if(fA(t,e),gA(e),4&r){if(null===e.stateNode)throw Error(o(162));i=e.stateNode,a=e.memoizedProps;try{i.nodeValue=a}catch(E){vc(e,e.return,E)}}break;case 3:if(fA(t,e),gA(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Ht(t.containerInfo)}catch(E){vc(e,e.return,E)}break;case 4:default:fA(t,e),gA(e);break;case 13:fA(t,e),gA(e),8192&(i=e.child).flags&&(a=null!==i.memoizedState,i.stateNode.isHidden=a,!a||null!==i.alternate&&null!==i.alternate.memoizedState||(VA=qe())),4&r&&pA(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?(zs=(l=zs)||d,fA(t,e),zs=l):fA(t,e),gA(e),8192&r){if(l=null!==e.memoizedState,(e.stateNode.isHidden=l)&&!d&&0!==(1&e.mode))for(Zs=e,d=e.child;null!==d;){for(u=Zs=d;null!==Zs;){switch(p=(h=Zs).child,h.tag){case 0:case 11:case 14:case 15:nA(4,h,h.return);break;case 1:$s(h,h.return);var f=h.stateNode;if("function"===typeof f.componentWillUnmount){r=h,n=h.return;try{t=r,f.props=t.memoizedProps,f.state=t.memoizedState,f.componentWillUnmount()}catch(E){vc(r,n,E)}}break;case 5:$s(h,h.return);break;case 22:if(null!==h.memoizedState){wA(u);continue}}null!==p?(p.return=h,Zs=p):wA(u)}d=d.sibling}e:for(d=null,u=e;;){if(5===u.tag){if(null===d){d=u;try{i=u.stateNode,l?"function"===typeof(a=i.style).setProperty?a.setProperty("display","none","important"):a.display="none":(A=u.stateNode,s=void 0!==(c=u.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,A.style.display=fe("display",s))}catch(E){vc(e,e.return,E)}}}else if(6===u.tag){if(null===d)try{u.stateNode.nodeValue=l?"":u.memoizedProps}catch(E){vc(e,e.return,E)}}else if((22!==u.tag&&23!==u.tag||null===u.memoizedState||u===e)&&null!==u.child){u.child.return=u,u=u.child;continue}if(u===e)break e;for(;null===u.sibling;){if(null===u.return||u.return===e)break e;d===u&&(d=null),u=u.return}d===u&&(d=null),u.sibling.return=u.return,u=u.sibling}}break;case 19:fA(t,e),gA(e),4&r&&pA(e);case 21:}}function gA(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(aA(n)){var r=n;break e}n=n.return}throw Error(o(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(ue(i,""),r.flags&=-33),cA(e,sA(e),i);break;case 3:case 4:var a=r.stateNode.containerInfo;AA(e,sA(e),a);break;default:throw Error(o(161))}}catch(s){vc(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function mA(e,t,n){Zs=e,_A(e,t,n)}function _A(e,t,n){for(var r=0!==(1&e.mode);null!==Zs;){var i=Zs,o=i.child;if(22===i.tag&&r){var a=null!==i.memoizedState||Xs;if(!a){var s=i.alternate,A=null!==s&&null!==s.memoizedState||zs;s=Xs;var c=zs;if(Xs=a,(zs=A)&&!c)for(Zs=i;null!==Zs;)A=(a=Zs).child,22===a.tag&&null!==a.memoizedState?SA(i):null!==A?(A.return=a,Zs=A):SA(i);for(;null!==o;)Zs=o,_A(o,t,n),o=o.sibling;Zs=i,Xs=s,zs=c}CA(e)}else 0!==(8772&i.subtreeFlags)&&null!==o?(o.return=i,Zs=o):CA(e)}}function CA(e){for(;null!==Zs;){var t=Zs;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:zs||rA(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!zs)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:ns(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&jo(t,a,r);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}jo(t,s,n)}break;case 5:var A=t.stateNode;if(null===n&&4&t.flags){n=A;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var l=t.alternate;if(null!==l){var d=l.memoizedState;if(null!==d){var u=d.dehydrated;null!==u&&Ht(u)}}}break;default:throw Error(o(163))}zs||512&t.flags&&iA(t)}catch(h){vc(t,t.return,h)}}if(t===e){Zs=null;break}if(null!==(n=t.sibling)){n.return=t.return,Zs=n;break}Zs=t.return}}function wA(e){for(;null!==Zs;){var t=Zs;if(t===e){Zs=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Zs=n;break}Zs=t.return}}function SA(e){for(;null!==Zs;){var t=Zs;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{rA(4,t)}catch(A){vc(t,n,A)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(A){vc(t,i,A)}}var o=t.return;try{iA(t)}catch(A){vc(t,o,A)}break;case 5:var a=t.return;try{iA(t)}catch(A){vc(t,a,A)}}}catch(A){vc(t,t.return,A)}if(t===e){Zs=null;break}var s=t.sibling;if(null!==s){s.return=t.return,Zs=s;break}Zs=t.return}}var TA,vA=Math.ceil,yA=C.ReactCurrentDispatcher,IA=C.ReactCurrentOwner,RA=C.ReactCurrentBatchConfig,bA=0,OA=null,BA=null,NA=0,DA=0,PA=vi(0),UA=0,LA=null,kA=0,MA=0,FA=0,xA=null,QA=null,VA=0,HA=1/0,KA=null,jA=!1,GA=null,WA=null,YA=!1,JA=null,XA=0,zA=0,qA=null,ZA=-1,$A=0;function ec(){return 0!==(6&bA)?qe():-1!==ZA?ZA:ZA=qe()}function tc(e){return 0===(1&e.mode)?1:0!==(2&bA)&&0!==NA?NA&-NA:null!==Eo.transition?(0===$A&&($A=ft()),$A):0!==(e=_t)?e:e=void 0===(e=window.event)?16:zt(e.type)}function nc(e,t,n,r){if(50<zA)throw zA=0,qA=null,Error(o(185));gt(e,n,r),0!==(2&bA)&&e===OA||(e===OA&&(0===(2&bA)&&(MA|=n),4===UA&&sc(e,NA)),rc(e,r),1===n&&0===bA&&0===(1&t.mode)&&(HA=qe()+500,xi&&Hi()))}function rc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,o=e.pendingLanes;0<o;){var a=31-at(o),s=1<<a,A=i[a];-1===A?0!==(s&n)&&0===(s&r)||(i[a]=ht(s,t)):A<=t&&(e.expiredLanes|=s),o&=~s}}(e,t);var r=ut(e,e===OA?NA:0);if(0===r)null!==n&&Je(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Je(n),1===t)0===e.tag?function(e){xi=!0,Vi(e)}(Ac.bind(null,e)):Vi(Ac.bind(null,e)),ai((function(){0===(6&bA)&&Hi()})),n=null;else{switch(Ct(r)){case 1:n=$e;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Oc(n,ic.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function ic(e,t){if(ZA=-1,$A=0,0!==(6&bA))throw Error(o(327));var n=e.callbackNode;if(Sc()&&e.callbackNode!==n)return null;var r=ut(e,e===OA?NA:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=Ec(e,r);else{t=r;var i=bA;bA|=2;var a=pc();for(OA===e&&NA===t||(KA=null,HA=qe()+500,uc(e,t));;)try{mc();break}catch(A){hc(e,A)}Ro(),yA.current=a,bA=i,null!==BA?t=0:(OA=null,NA=0,t=UA)}if(0!==t){if(2===t&&(0!==(i=pt(e))&&(r=i,t=oc(e,i))),1===t)throw n=LA,uc(e,0),sc(e,r),rc(e,qe()),n;if(6===t)sc(e,r);else{if(i=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],o=i.getSnapshot;i=i.value;try{if(!sr(o(),i))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)&&(2===(t=Ec(e,r))&&(0!==(a=pt(e))&&(r=a,t=oc(e,a))),1===t))throw n=LA,uc(e,0),sc(e,r),rc(e,qe()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(o(345));case 2:case 5:wc(e,QA,KA);break;case 3:if(sc(e,r),(130023424&r)===r&&10<(t=VA+500-qe())){if(0!==ut(e,0))break;if(((i=e.suspendedLanes)&r)!==r){ec(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=ri(wc.bind(null,e,QA,KA),t);break}wc(e,QA,KA);break;case 4:if(sc(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var s=31-at(r);a=1<<s,(s=t[s])>i&&(i=s),r&=~a}if(r=i,10<(r=(120>(r=qe()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*vA(r/1960))-r)){e.timeoutHandle=ri(wc.bind(null,e,QA,KA),r);break}wc(e,QA,KA);break;default:throw Error(o(329))}}}return rc(e,qe()),e.callbackNode===n?ic.bind(null,e):null}function oc(e,t){var n=xA;return e.current.memoizedState.isDehydrated&&(uc(e,t).flags|=256),2!==(e=Ec(e,t))&&(t=QA,QA=n,null!==t&&ac(t)),e}function ac(e){null===QA?QA=e:QA.push.apply(QA,e)}function sc(e,t){for(t&=~FA,t&=~MA,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-at(t),r=1<<n;e[n]=-1,t&=~r}}function Ac(e){if(0!==(6&bA))throw Error(o(327));Sc();var t=ut(e,0);if(0===(1&t))return rc(e,qe()),null;var n=Ec(e,t);if(0!==e.tag&&2===n){var r=pt(e);0!==r&&(t=r,n=oc(e,r))}if(1===n)throw n=LA,uc(e,0),sc(e,t),rc(e,qe()),n;if(6===n)throw Error(o(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,wc(e,QA,KA),rc(e,qe()),null}function cc(e,t){var n=bA;bA|=1;try{return e(t)}finally{0===(bA=n)&&(HA=qe()+500,xi&&Hi())}}function lc(e){null!==JA&&0===JA.tag&&0===(6&bA)&&Sc();var t=bA;bA|=1;var n=RA.transition,r=_t;try{if(RA.transition=null,_t=1,e)return e()}finally{_t=r,RA.transition=n,0===(6&(bA=t))&&Hi()}}function dc(){DA=PA.current,yi(PA)}function uc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ii(n)),null!==BA)for(n=BA.return;null!==n;){var r=n;switch(to(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Pi();break;case 3:qo(),yi(Oi),yi(bi),ra();break;case 5:$o(r);break;case 4:qo();break;case 13:case 19:yi(ea);break;case 10:bo(r.type._context);break;case 22:case 23:dc()}n=n.return}if(OA=e,BA=e=Pc(e.current,null),NA=DA=t,UA=0,LA=null,FA=MA=kA=0,QA=xA=null,null!==Do){for(t=0;t<Do.length;t++)if(null!==(r=(n=Do[t]).interleaved)){n.interleaved=null;var i=r.next,o=n.pending;if(null!==o){var a=o.next;o.next=i,r.next=a}n.pending=r}Do=null}return e}function hc(e,t){for(;;){var n=BA;try{if(Ro(),ia.current=Za,la){for(var r=sa.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}la=!1}if(aa=0,ca=Aa=sa=null,da=!1,ua=0,IA.current=null,null===n||null===n.return){UA=1,LA=t,BA=null;break}e:{var a=e,s=n.return,A=n,c=t;if(t=NA,A.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var l=c,d=A,u=d.tag;if(0===(1&d.mode)&&(0===u||11===u||15===u)){var h=d.alternate;h?(d.updateQueue=h.updateQueue,d.memoizedState=h.memoizedState,d.lanes=h.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=Es(s);if(null!==p){p.flags&=-257,gs(p,s,A,0,t),1&p.mode&&fs(a,l,t),c=l;var f=(t=p).updateQueue;if(null===f){var E=new Set;E.add(c),t.updateQueue=E}else f.add(c);break e}if(0===(1&t)){fs(a,l,t),fc();break e}c=Error(o(426))}else if(io&&1&A.mode){var g=Es(s);if(null!==g){0===(65536&g.flags)&&(g.flags|=256),gs(g,s,A,0,t),fo(cs(c,A));break e}}a=c=cs(c,A),4!==UA&&(UA=2),null===xA?xA=[a]:xA.push(a),a=s;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,Ho(a,hs(0,c,t));break e;case 1:A=c;var m=a.type,_=a.stateNode;if(0===(128&a.flags)&&("function"===typeof m.getDerivedStateFromError||null!==_&&"function"===typeof _.componentDidCatch&&(null===WA||!WA.has(_)))){a.flags|=65536,t&=-t,a.lanes|=t,Ho(a,ps(a,A,t));break e}}a=a.return}while(null!==a)}Cc(n)}catch(C){t=C,BA===n&&null!==n&&(BA=n=n.return);continue}break}}function pc(){var e=yA.current;return yA.current=Za,null===e?Za:e}function fc(){0!==UA&&3!==UA&&2!==UA||(UA=4),null===OA||0===(268435455&kA)&&0===(268435455&MA)||sc(OA,NA)}function Ec(e,t){var n=bA;bA|=2;var r=pc();for(OA===e&&NA===t||(KA=null,uc(e,t));;)try{gc();break}catch(i){hc(e,i)}if(Ro(),bA=n,yA.current=r,null!==BA)throw Error(o(261));return OA=null,NA=0,UA}function gc(){for(;null!==BA;)_c(BA)}function mc(){for(;null!==BA&&!Xe();)_c(BA)}function _c(e){var t=TA(e.alternate,e,DA);e.memoizedProps=e.pendingProps,null===t?Cc(e):BA=t,IA.current=null}function Cc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Ys(n,t,DA)))return void(BA=n)}else{if(null!==(n=Js(n,t)))return n.flags&=32767,void(BA=n);if(null===e)return UA=6,void(BA=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(BA=t);BA=t=e}while(null!==t);0===UA&&(UA=5)}function wc(e,t,n){var r=_t,i=RA.transition;try{RA.transition=null,_t=1,function(e,t,n,r){do{Sc()}while(null!==JA);if(0!==(6&bA))throw Error(o(327));n=e.finishedWork;var i=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(o(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-at(n),o=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~o}}(e,a),e===OA&&(BA=OA=null,NA=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||YA||(YA=!0,Oc(tt,(function(){return Sc(),null}))),a=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||a){a=RA.transition,RA.transition=null;var s=_t;_t=1;var A=bA;bA|=4,IA.current=null,function(e,t){if(ei=jt,hr(e=ur())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch(w){n=null;break e}var s=0,A=-1,c=-1,l=0,d=0,u=e,h=null;t:for(;;){for(var p;u!==n||0!==i&&3!==u.nodeType||(A=s+i),u!==a||0!==r&&3!==u.nodeType||(c=s+r),3===u.nodeType&&(s+=u.nodeValue.length),null!==(p=u.firstChild);)h=u,u=p;for(;;){if(u===e)break t;if(h===n&&++l===i&&(A=s),h===a&&++d===r&&(c=s),null!==(p=u.nextSibling))break;h=(u=h).parentNode}u=p}n=-1===A||-1===c?null:{start:A,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ti={focusedElem:e,selectionRange:n},jt=!1,Zs=t;null!==Zs;)if(e=(t=Zs).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Zs=e;else for(;null!==Zs;){t=Zs;try{var f=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==f){var E=f.memoizedProps,g=f.memoizedState,m=t.stateNode,_=m.getSnapshotBeforeUpdate(t.elementType===t.type?E:ns(t.type,E),g);m.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var C=t.stateNode.containerInfo;1===C.nodeType?C.textContent="":9===C.nodeType&&C.documentElement&&C.removeChild(C.documentElement);break;default:throw Error(o(163))}}catch(w){vc(t,t.return,w)}if(null!==(e=t.sibling)){e.return=t.return,Zs=e;break}Zs=t.return}f=tA,tA=!1}(e,n),EA(n,e),pr(ti),jt=!!ei,ti=ei=null,e.current=n,mA(n,e,i),ze(),bA=A,_t=s,RA.transition=a}else e.current=n;if(YA&&(YA=!1,JA=e,XA=i),a=e.pendingLanes,0===a&&(WA=null),function(e){if(ot&&"function"===typeof ot.onCommitFiberRoot)try{ot.onCommitFiberRoot(it,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),rc(e,qe()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)i=t[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(jA)throw jA=!1,e=GA,GA=null,e;0!==(1&XA)&&0!==e.tag&&Sc(),a=e.pendingLanes,0!==(1&a)?e===qA?zA++:(zA=0,qA=e):zA=0,Hi()}(e,t,n,r)}finally{RA.transition=i,_t=r}return null}function Sc(){if(null!==JA){var e=Ct(XA),t=RA.transition,n=_t;try{if(RA.transition=null,_t=16>e?16:e,null===JA)var r=!1;else{if(e=JA,JA=null,XA=0,0!==(6&bA))throw Error(o(331));var i=bA;for(bA|=4,Zs=e.current;null!==Zs;){var a=Zs,s=a.child;if(0!==(16&Zs.flags)){var A=a.deletions;if(null!==A){for(var c=0;c<A.length;c++){var l=A[c];for(Zs=l;null!==Zs;){var d=Zs;switch(d.tag){case 0:case 11:case 15:nA(8,d,a)}var u=d.child;if(null!==u)u.return=d,Zs=u;else for(;null!==Zs;){var h=(d=Zs).sibling,p=d.return;if(oA(d),d===l){Zs=null;break}if(null!==h){h.return=p,Zs=h;break}Zs=p}}}var f=a.alternate;if(null!==f){var E=f.child;if(null!==E){f.child=null;do{var g=E.sibling;E.sibling=null,E=g}while(null!==E)}}Zs=a}}if(0!==(2064&a.subtreeFlags)&&null!==s)s.return=a,Zs=s;else e:for(;null!==Zs;){if(0!==(2048&(a=Zs).flags))switch(a.tag){case 0:case 11:case 15:nA(9,a,a.return)}var m=a.sibling;if(null!==m){m.return=a.return,Zs=m;break e}Zs=a.return}}var _=e.current;for(Zs=_;null!==Zs;){var C=(s=Zs).child;if(0!==(2064&s.subtreeFlags)&&null!==C)C.return=s,Zs=C;else e:for(s=_;null!==Zs;){if(0!==(2048&(A=Zs).flags))try{switch(A.tag){case 0:case 11:case 15:rA(9,A)}}catch(S){vc(A,A.return,S)}if(A===s){Zs=null;break e}var w=A.sibling;if(null!==w){w.return=A.return,Zs=w;break e}Zs=A.return}}if(bA=i,Hi(),ot&&"function"===typeof ot.onPostCommitFiberRoot)try{ot.onPostCommitFiberRoot(it,e)}catch(S){}r=!0}return r}finally{_t=n,RA.transition=t}}return!1}function Tc(e,t,n){e=Qo(e,t=hs(0,t=cs(n,t),1),1),t=ec(),null!==e&&(gt(e,1,t),rc(e,t))}function vc(e,t,n){if(3===e.tag)Tc(e,e,n);else for(;null!==t;){if(3===t.tag){Tc(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===WA||!WA.has(r))){t=Qo(t,e=ps(t,e=cs(n,e),1),1),e=ec(),null!==t&&(gt(t,1,e),rc(t,e));break}}t=t.return}}function yc(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&n,OA===e&&(NA&n)===n&&(4===UA||3===UA&&(130023424&NA)===NA&&500>qe()-VA?uc(e,0):FA|=n),rc(e,t)}function Ic(e,t){0===t&&(0===(1&e.mode)?t=1:(t=lt,0===(130023424&(lt<<=1))&&(lt=4194304)));var n=ec();null!==(e=Lo(e,t))&&(gt(e,t,n),rc(e,n))}function Rc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Ic(e,n)}function bc(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(o(314))}null!==r&&r.delete(t),Ic(e,n)}function Oc(e,t){return Ye(e,t)}function Bc(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Nc(e,t,n,r){return new Bc(e,t,n,r)}function Dc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Pc(e,t){var n=e.alternate;return null===n?((n=Nc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Uc(e,t,n,r,i,a){var s=2;if(r=e,"function"===typeof e)Dc(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case T:return Lc(n.children,i,a,t);case v:s=8,i|=8;break;case y:return(e=Nc(12,n,t,2|i)).elementType=y,e.lanes=a,e;case O:return(e=Nc(13,n,t,i)).elementType=O,e.lanes=a,e;case B:return(e=Nc(19,n,t,i)).elementType=B,e.lanes=a,e;case P:return kc(n,i,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case I:s=10;break e;case R:s=9;break e;case b:s=11;break e;case N:s=14;break e;case D:s=16,r=null;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=Nc(s,n,t,i)).elementType=e,t.type=r,t.lanes=a,t}function Lc(e,t,n,r){return(e=Nc(7,e,r,t)).lanes=n,e}function kc(e,t,n,r){return(e=Nc(22,e,r,t)).elementType=P,e.lanes=n,e.stateNode={isHidden:!1},e}function Mc(e,t,n){return(e=Nc(6,e,null,t)).lanes=n,e}function Fc(e,t,n){return(t=Nc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function xc(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Et(0),this.expirationTimes=Et(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Et(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Qc(e,t,n,r,i,o,a,s,A){return e=new xc(e,t,n,s,A),1===t?(t=1,!0===o&&(t|=8)):t=0,o=Nc(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Mo(o),e}function Vc(e){if(!e)return Ri;e:{if(He(e=e._reactInternals)!==e||1!==e.tag)throw Error(o(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Di(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(o(171))}if(1===e.tag){var n=e.type;if(Di(n))return Li(e,n,t)}return t}function Hc(e,t,n,r,i,o,a,s,A){return(e=Qc(n,r,!0,e,0,o,0,s,A)).context=Vc(null),n=e.current,(o=xo(r=ec(),i=tc(n))).callback=void 0!==t&&null!==t?t:null,Qo(n,o,i),e.current.lanes=i,gt(e,i,r),rc(e,r),e}function Kc(e,t,n,r){var i=t.current,o=ec(),a=tc(i);return n=Vc(n),null===t.context?t.context=n:t.pendingContext=n,(t=xo(o,a)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Qo(i,t,a))&&(nc(e,i,a,o),Vo(e,i,a)),a}function jc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Gc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Wc(e,t){Gc(e,t),(e=e.alternate)&&Gc(e,t)}TA=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Oi.current)_s=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return _s=!1,function(e,t,n){switch(t.tag){case 3:Os(t),po();break;case 5:Zo(t);break;case 1:Di(t.type)&&ki(t);break;case 4:zo(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;Ii(To,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ii(ea,1&ea.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Ms(e,t,n):(Ii(ea,1&ea.current),null!==(e=js(e,t,n))?e.sibling:null);Ii(ea,1&ea.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Hs(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ii(ea,ea.current),r)break;return null;case 22:case 23:return t.lanes=0,vs(e,t,n)}return js(e,t,n)}(e,t,n);_s=0!==(131072&e.flags)}else _s=!1,io&&0!==(1048576&t.flags)&&$i(t,Wi,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Ks(e,t),e=t.pendingProps;var i=Ni(t,bi.current);Bo(t,n),i=Ea(null,t,r,e,i,n);var a=ga();return t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Di(r)?(a=!0,ki(t)):a=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,Mo(t),i.updater=is,t.stateNode=i,i._reactInternals=t,As(t,r,e,n),t=bs(null,t,r,!0,a,n)):(t.tag=0,io&&a&&eo(t),Cs(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Ks(e,t),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,i=t.tag=function(e){if("function"===typeof e)return Dc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===b)return 11;if(e===N)return 14}return 2}(r),e=ns(r,e),i){case 0:t=Is(null,t,r,e,n);break e;case 1:t=Rs(null,t,r,e,n);break e;case 11:t=ws(null,t,r,e,n);break e;case 14:t=Ss(null,t,r,ns(r.type,e),n);break e}throw Error(o(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,Is(e,t,r,i=t.elementType===r?i:ns(r,i),n);case 1:return r=t.type,i=t.pendingProps,Rs(e,t,r,i=t.elementType===r?i:ns(r,i),n);case 3:e:{if(Os(t),null===e)throw Error(o(387));r=t.pendingProps,i=(a=t.memoizedState).element,Fo(e,t),Ko(t,r,null,n);var s=t.memoizedState;if(r=s.element,a.isDehydrated){if(a={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Bs(e,t,r,n,i=cs(Error(o(423)),t));break e}if(r!==i){t=Bs(e,t,r,n,i=cs(Error(o(424)),t));break e}for(ro=ci(t.stateNode.containerInfo.firstChild),no=t,io=!0,oo=null,n=So(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(po(),r===i){t=js(e,t,n);break e}Cs(e,t,r,n)}t=t.child}return t;case 5:return Zo(t),null===e&&co(t),r=t.type,i=t.pendingProps,a=null!==e?e.memoizedProps:null,s=i.children,ni(r,i)?s=null:null!==a&&ni(r,a)&&(t.flags|=32),ys(e,t),Cs(e,t,s,n),t.child;case 6:return null===e&&co(t),null;case 13:return Ms(e,t,n);case 4:return zo(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=wo(t,null,r,n):Cs(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,ws(e,t,r,i=t.elementType===r?i:ns(r,i),n);case 7:return Cs(e,t,t.pendingProps,n),t.child;case 8:case 12:return Cs(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,a=t.memoizedProps,s=i.value,Ii(To,r._currentValue),r._currentValue=s,null!==a)if(sr(a.value,s)){if(a.children===i.children&&!Oi.current){t=js(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var A=a.dependencies;if(null!==A){s=a.child;for(var c=A.firstContext;null!==c;){if(c.context===r){if(1===a.tag){(c=xo(-1,n&-n)).tag=2;var l=a.updateQueue;if(null!==l){var d=(l=l.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),l.pending=c}}a.lanes|=n,null!==(c=a.alternate)&&(c.lanes|=n),Oo(a.return,n,t),A.lanes|=n;break}c=c.next}}else if(10===a.tag)s=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(s=a.return))throw Error(o(341));s.lanes|=n,null!==(A=s.alternate)&&(A.lanes|=n),Oo(s,n,t),s=a.sibling}else s=a.child;if(null!==s)s.return=a;else for(s=a;null!==s;){if(s===t){s=null;break}if(null!==(a=s.sibling)){a.return=s.return,s=a;break}s=s.return}a=s}Cs(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,Bo(t,n),r=r(i=No(i)),t.flags|=1,Cs(e,t,r,n),t.child;case 14:return i=ns(r=t.type,t.pendingProps),Ss(e,t,r,i=ns(r.type,i),n);case 15:return Ts(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:ns(r,i),Ks(e,t),t.tag=1,Di(r)?(e=!0,ki(t)):e=!1,Bo(t,n),as(t,r,i),As(t,r,i,n),bs(null,t,r,!0,e,n);case 19:return Hs(e,t,n);case 22:return vs(e,t,n)}throw Error(o(156,t.tag))};var Yc="function"===typeof reportError?reportError:function(e){console.error(e)};function Jc(e){this._internalRoot=e}function Xc(e){this._internalRoot=e}function zc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function qc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Zc(){}function $c(e,t,n,r,i){var o=n._reactRootContainer;if(o){var a=o;if("function"===typeof i){var s=i;i=function(){var e=jc(a);s.call(e)}}Kc(t,a,e,i)}else a=function(e,t,n,r,i){if(i){if("function"===typeof r){var o=r;r=function(){var e=jc(a);o.call(e)}}var a=Hc(t,r,e,0,null,!1,0,"",Zc);return e._reactRootContainer=a,e[pi]=a.current,Hr(8===e.nodeType?e.parentNode:e),lc(),a}for(;i=e.lastChild;)e.removeChild(i);if("function"===typeof r){var s=r;r=function(){var e=jc(A);s.call(e)}}var A=Qc(e,0,!1,null,0,!1,0,"",Zc);return e._reactRootContainer=A,e[pi]=A.current,Hr(8===e.nodeType?e.parentNode:e),lc((function(){Kc(t,A,n,r)})),A}(n,t,e,i,r);return jc(a)}Xc.prototype.render=Jc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(o(409));Kc(e,t,null,null)},Xc.prototype.unmount=Jc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;lc((function(){Kc(null,e,null,null)})),t[pi]=null}},Xc.prototype.unstable_scheduleHydration=function(e){if(e){var t=vt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Pt.length&&0!==t&&t<Pt[n].priority;n++);Pt.splice(n,0,e),0===n&&Mt(e)}},wt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(mt(t,1|n),rc(t,qe()),0===(6&bA)&&(HA=qe()+500,Hi()))}break;case 13:lc((function(){var t=Lo(e,1);if(null!==t){var n=ec();nc(t,e,1,n)}})),Wc(e,1)}},St=function(e){if(13===e.tag){var t=Lo(e,134217728);if(null!==t)nc(t,e,134217728,ec());Wc(e,134217728)}},Tt=function(e){if(13===e.tag){var t=tc(e),n=Lo(e,t);if(null!==n)nc(n,e,t,ec());Wc(e,t)}},vt=function(){return _t},yt=function(e,t){var n=_t;try{return _t=e,t()}finally{_t=n}},Se=function(e,t,n){switch(t){case"input":if(Z(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=wi(r);if(!i)throw Error(o(90));Y(r),Z(r,i)}}}break;case"textarea":oe(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},be=cc,Oe=lc;var el={usingClientEntryPoint:!1,Events:[_i,Ci,wi,Ie,Re,cc]},tl={findFiberByHostInstance:mi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nl={bundleType:tl.bundleType,version:tl.version,rendererPackageName:tl.rendererPackageName,rendererConfig:tl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:C.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ge(e))?null:e.stateNode},findFiberByHostInstance:tl.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var rl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rl.isDisabled&&rl.supportsFiber)try{it=rl.inject(nl),ot=rl}catch(le){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=el,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!zc(t))throw Error(o(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:S,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!zc(e))throw Error(o(299));var n=!1,r="",i=Yc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError)),t=Qc(e,1,!1,null,0,n,0,r,i),e[pi]=t.current,Hr(8===e.nodeType?e.parentNode:e),new Jc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw e=Object.keys(e).join(","),Error(o(268,e))}return e=null===(e=Ge(t))?null:e.stateNode},t.flushSync=function(e){return lc(e)},t.hydrate=function(e,t,n){if(!qc(t))throw Error(o(200));return $c(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!zc(e))throw Error(o(405));var r=null!=n&&n.hydratedSources||null,i=!1,a="",s=Yc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Hc(t,null,e,1,null!=n?n:null,i,0,a,s),e[pi]=t.current,Hr(e),r)for(e=0;e<r.length;e++)i=(i=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new Xc(t)},t.render=function(e,t,n){if(!qc(t))throw Error(o(200));return $c(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!qc(e))throw Error(o(40));return!!e._reactRootContainer&&(lc((function(){$c(null,null,e,!1,(function(){e._reactRootContainer=null,e[pi]=null}))})),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!qc(n))throw Error(o(200));if(null==e||void 0===e._reactInternals)throw Error(o(38));return $c(e,t,n,!1,r)},t.version="18.3.1-next-f1338f8080-20240426"},391:(e,t,n)=>{"use strict";var r=n(950);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(730)},475:(e,t,n)=>{"use strict";var r,i;n.d(t,{Kd:()=>l});var o=n(43),a=n(950),s=n(216),A=n(387);new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);try{window.__reactRouterVersion="6"}catch(h){}new Map;const c=(r||(r=n.t(o,2))).startTransition;(i||(i=n.t(a,2))).flushSync,(r||(r=n.t(o,2))).useId;function l(e){let{basename:t,children:n,future:r,window:i}=e,a=o.useRef();null==a.current&&(a.current=(0,A.zR)({window:i,v5Compat:!0}));let l=a.current,[d,u]=o.useState({action:l.action,location:l.location}),{v7_startTransition:h}=r||{},p=o.useCallback((e=>{h&&c?c((()=>u(e))):u(e)}),[u,h]);return o.useLayoutEffect((()=>l.listen(p)),[l,p]),o.createElement(s.Ix,{basename:t,children:n,location:d.location,navigationType:d.action,navigator:l,future:r})}"undefined"!==typeof window&&"undefined"!==typeof window.document&&window.document.createElement;var d,u;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(d||(d={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(u||(u={}))},216:(e,t,n)=>{"use strict";var r;n.d(t,{BV:()=>D,Ix:()=>N,Zp:()=>E,g:()=>g,qh:()=>B});var i=n(43),o=n(387);function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a.apply(this,arguments)}const s=i.createContext(null);const A=i.createContext(null);const c=i.createContext(null);const l=i.createContext(null);const d=i.createContext({outlet:null,matches:[],isDataRoute:!1});const u=i.createContext(null);function h(){return null!=i.useContext(l)}function p(){return h()||(0,o.Oi)(!1),i.useContext(l).location}function f(e){i.useContext(c).static||i.useLayoutEffect(e)}function E(){let{isDataRoute:e}=i.useContext(d);return e?function(){let{router:e}=I(v.UseNavigateStable),t=b(y.UseNavigateStable),n=i.useRef(!1);return f((()=>{n.current=!0})),i.useCallback((function(r,i){void 0===i&&(i={}),n.current&&("number"===typeof r?e.navigate(r):e.navigate(r,a({fromRouteId:t},i)))}),[e,t])}():function(){h()||(0,o.Oi)(!1);let e=i.useContext(s),{basename:t,future:n,navigator:r}=i.useContext(c),{matches:a}=i.useContext(d),{pathname:A}=p(),l=JSON.stringify((0,o.yD)(a,n.v7_relativeSplatPath)),u=i.useRef(!1);return f((()=>{u.current=!0})),i.useCallback((function(n,i){if(void 0===i&&(i={}),!u.current)return;if("number"===typeof n)return void r.go(n);let a=(0,o.Gh)(n,JSON.parse(l),A,"path"===i.relative);null==e&&"/"!==t&&(a.pathname="/"===a.pathname?t:(0,o.HS)([t,a.pathname])),(i.replace?r.replace:r.push)(a,i.state,i)}),[t,r,l,A,e])}()}function g(){let{matches:e}=i.useContext(d),t=e[e.length-1];return t?t.params:{}}function m(e,t,n,r){h()||(0,o.Oi)(!1);let{navigator:s}=i.useContext(c),{matches:A}=i.useContext(d),u=A[A.length-1],f=u?u.params:{},E=(u&&u.pathname,u?u.pathnameBase:"/");u&&u.route;let g,m=p();if(t){var _;let e="string"===typeof t?(0,o.Rr)(t):t;"/"===E||(null==(_=e.pathname)?void 0:_.startsWith(E))||(0,o.Oi)(!1),g=e}else g=m;let C=g.pathname||"/",w=C;if("/"!==E){let e=E.replace(/^\//,"").split("/");w="/"+C.replace(/^\//,"").split("/").slice(e.length).join("/")}let S=(0,o.ue)(e,{pathname:w});let v=T(S&&S.map((e=>Object.assign({},e,{params:Object.assign({},f,e.params),pathname:(0,o.HS)([E,s.encodeLocation?s.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?E:(0,o.HS)([E,s.encodeLocation?s.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])}))),A,n,r);return t&&v?i.createElement(l.Provider,{value:{location:a({pathname:"/",search:"",hash:"",state:null,key:"default"},g),navigationType:o.rc.Pop}},v):v}function _(){let e=function(){var e;let t=i.useContext(u),n=R(y.UseRouteError),r=b(y.UseRouteError);if(void 0!==t)return t;return null==(e=n.errors)?void 0:e[r]}(),t=(0,o.pX)(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,r="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:r};return i.createElement(i.Fragment,null,i.createElement("h2",null,"Unexpected Application Error!"),i.createElement("h3",{style:{fontStyle:"italic"}},t),n?i.createElement("pre",{style:a},n):null,null)}const C=i.createElement(_,null);class w extends i.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?i.createElement(d.Provider,{value:this.props.routeContext},i.createElement(u.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function S(e){let{routeContext:t,match:n,children:r}=e,o=i.useContext(s);return o&&o.static&&o.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=n.route.id),i.createElement(d.Provider,{value:t},r)}function T(e,t,n,r){var a;if(void 0===t&&(t=[]),void 0===n&&(n=null),void 0===r&&(r=null),null==e){var s;if(null==(s=n)||!s.errors)return null;e=n.matches}let A=e,c=null==(a=n)?void 0:a.errors;if(null!=c){let e=A.findIndex((e=>e.route.id&&void 0!==(null==c?void 0:c[e.route.id])));e>=0||(0,o.Oi)(!1),A=A.slice(0,Math.min(A.length,e+1))}let l=!1,d=-1;if(n&&r&&r.v7_partialHydration)for(let i=0;i<A.length;i++){let e=A[i];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(d=i),e.route.id){let{loaderData:t,errors:r}=n,i=e.route.loader&&void 0===t[e.route.id]&&(!r||void 0===r[e.route.id]);if(e.route.lazy||i){l=!0,A=d>=0?A.slice(0,d+1):[A[0]];break}}}return A.reduceRight(((e,r,o)=>{let a,s=!1,u=null,h=null;var p;n&&(a=c&&r.route.id?c[r.route.id]:void 0,u=r.route.errorElement||C,l&&(d<0&&0===o?(p="route-fallback",!1||O[p]||(O[p]=!0),s=!0,h=null):d===o&&(s=!0,h=r.route.hydrateFallbackElement||null)));let f=t.concat(A.slice(0,o+1)),E=()=>{let t;return t=a?u:s?h:r.route.Component?i.createElement(r.route.Component,null):r.route.element?r.route.element:e,i.createElement(S,{match:r,routeContext:{outlet:e,matches:f,isDataRoute:null!=n},children:t})};return n&&(r.route.ErrorBoundary||r.route.errorElement||0===o)?i.createElement(w,{location:n.location,revalidation:n.revalidation,component:u,error:a,children:E(),routeContext:{outlet:null,matches:f,isDataRoute:!0}}):E()}),null)}var v=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(v||{}),y=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(y||{});function I(e){let t=i.useContext(s);return t||(0,o.Oi)(!1),t}function R(e){let t=i.useContext(A);return t||(0,o.Oi)(!1),t}function b(e){let t=function(e){let t=i.useContext(d);return t||(0,o.Oi)(!1),t}(),n=t.matches[t.matches.length-1];return n.route.id||(0,o.Oi)(!1),n.route.id}const O={};(r||(r=n.t(i,2))).startTransition;function B(e){(0,o.Oi)(!1)}function N(e){let{basename:t="/",children:n=null,location:r,navigationType:s=o.rc.Pop,navigator:A,static:d=!1,future:u}=e;h()&&(0,o.Oi)(!1);let p=t.replace(/^\/*/,"/"),f=i.useMemo((()=>({basename:p,navigator:A,static:d,future:a({v7_relativeSplatPath:!1},u)})),[p,u,A,d]);"string"===typeof r&&(r=(0,o.Rr)(r));let{pathname:E="/",search:g="",hash:m="",state:_=null,key:C="default"}=r,w=i.useMemo((()=>{let e=(0,o.pb)(E,p);return null==e?null:{location:{pathname:e,search:g,hash:m,state:_,key:C},navigationType:s}}),[p,E,g,m,_,C,s]);return null==w?null:i.createElement(c.Provider,{value:f},i.createElement(l.Provider,{children:n,value:w}))}function D(e){let{children:t,location:n}=e;return m(P(t),n)}new Promise((()=>{}));i.Component;function P(e,t){void 0===t&&(t=[]);let n=[];return i.Children.forEach(e,((e,r)=>{if(!i.isValidElement(e))return;let a=[...t,r];if(e.type===i.Fragment)return void n.push.apply(n,P(e.props.children,a));e.type!==B&&(0,o.Oi)(!1),e.props.index&&e.props.children&&(0,o.Oi)(!1);let s={id:e.props.id||a.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(s.children=P(e.props.children,a)),n.push(s)})),n}},706:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.isNative=void 0;var n="undefined"!==typeof window&&(window.SpeechRecognition||window.webkitSpeechRecognition||window.mozSpeechRecognition||window.msSpeechRecognition||window.oSpeechRecognition);t.isNative=function(e){return e===n};var r=n;t.default=r},338:(e,t,n)=>{"use strict";var r=n(756);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,o=(i=n(453))&&i.__esModule?i:{default:i},a=n(847),s=n(706);function A(e,t,n,r,i,o,a){try{var s=e[o](a),A=s.value}catch(c){return void n(c)}s.done?t(A):Promise.resolve(A).then(r,i)}function c(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){A(o,r,i,a,s,"next",e)}function s(e){A(o,r,i,a,s,"throw",e)}a(void 0)}))}}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.recognition=null,this.pauseAfterDisconnect=!1,this.interimTranscript="",this.finalTranscript="",this.listening=!1,this.isMicrophoneAvailable=!0,this.subscribers={},this.onStopListening=function(){},this.previousResultWasFinalOnly=!1,this.resetTranscript=this.resetTranscript.bind(this),this.startListening=this.startListening.bind(this),this.stopListening=this.stopListening.bind(this),this.abortListening=this.abortListening.bind(this),this.setSpeechRecognition=this.setSpeechRecognition.bind(this),this.disableRecognition=this.disableRecognition.bind(this),this.setSpeechRecognition(t),(0,o.default)()&&(this.updateFinalTranscript=(0,a.debounce)(this.updateFinalTranscript,250,!0))}var t,n,i;return t=e,n=[{key:"setSpeechRecognition",value:function(e){var t=!!e&&((0,s.isNative)(e)||(0,a.browserSupportsPolyfills)());t&&(this.disableRecognition(),this.recognition=new e,this.recognition.continuous=!1,this.recognition.interimResults=!0,this.recognition.onresult=this.updateTranscript.bind(this),this.recognition.onend=this.onRecognitionDisconnect.bind(this),this.recognition.onerror=this.onError.bind(this)),this.emitBrowserSupportsSpeechRecognitionChange(t)}},{key:"subscribe",value:function(e,t){this.subscribers[e]=t}},{key:"unsubscribe",value:function(e){delete this.subscribers[e]}},{key:"emitListeningChange",value:function(e){var t=this;this.listening=e,Object.keys(this.subscribers).forEach((function(n){(0,t.subscribers[n].onListeningChange)(e)}))}},{key:"emitMicrophoneAvailabilityChange",value:function(e){var t=this;this.isMicrophoneAvailable=e,Object.keys(this.subscribers).forEach((function(n){(0,t.subscribers[n].onMicrophoneAvailabilityChange)(e)}))}},{key:"emitTranscriptChange",value:function(e,t){var n=this;Object.keys(this.subscribers).forEach((function(r){(0,n.subscribers[r].onTranscriptChange)(e,t)}))}},{key:"emitClearTranscript",value:function(){var e=this;Object.keys(this.subscribers).forEach((function(t){(0,e.subscribers[t].onClearTranscript)()}))}},{key:"emitBrowserSupportsSpeechRecognitionChange",value:function(e){var t=this;Object.keys(this.subscribers).forEach((function(n){var r=t.subscribers[n],i=r.onBrowserSupportsSpeechRecognitionChange,o=r.onBrowserSupportsContinuousListeningChange;i(e),o(e)}))}},{key:"disconnect",value:function(e){if(this.recognition&&this.listening)switch(e){case"ABORT":this.pauseAfterDisconnect=!0,this.abort();break;case"RESET":this.pauseAfterDisconnect=!1,this.abort();break;default:this.pauseAfterDisconnect=!0,this.stop()}}},{key:"disableRecognition",value:function(){this.recognition&&(this.recognition.onresult=function(){},this.recognition.onend=function(){},this.recognition.onerror=function(){},this.listening&&this.stopListening())}},{key:"onError",value:function(e){e&&e.error&&"not-allowed"===e.error&&(this.emitMicrophoneAvailabilityChange(!1),this.disableRecognition())}},{key:"onRecognitionDisconnect",value:function(){this.onStopListening(),this.listening=!1,this.pauseAfterDisconnect?this.emitListeningChange(!1):this.recognition&&(this.recognition.continuous?this.startListening({continuous:this.recognition.continuous}):this.emitListeningChange(!1)),this.pauseAfterDisconnect=!1}},{key:"updateTranscript",value:function(e){var t=e.results,n=e.resultIndex,r=void 0===n?t.length-1:n;this.interimTranscript="",this.finalTranscript="";for(var i=r;i<t.length;++i)t[i].isFinal&&(!(0,o.default)()||t[i][0].confidence>0)?this.updateFinalTranscript(t[i][0].transcript):this.interimTranscript=(0,a.concatTranscripts)(this.interimTranscript,t[i][0].transcript);var s=!1;""===this.interimTranscript&&""!==this.finalTranscript?(this.previousResultWasFinalOnly&&(s=!0),this.previousResultWasFinalOnly=!0):this.previousResultWasFinalOnly=!1,s||this.emitTranscriptChange(this.interimTranscript,this.finalTranscript)}},{key:"updateFinalTranscript",value:function(e){this.finalTranscript=(0,a.concatTranscripts)(this.finalTranscript,e)}},{key:"resetTranscript",value:function(){this.disconnect("RESET")}},{key:"startListening",value:function(){var e=c(r.mark((function e(){var t,n,i,o,a,s,A=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(t=A.length>0&&void 0!==A[0]?A[0]:{}).continuous,i=void 0!==n&&n,o=t.language,this.recognition){e.next=3;break}return e.abrupt("return");case 3:if(a=i!==this.recognition.continuous,s=o&&o!==this.recognition.lang,!a&&!s){e.next=11;break}if(!this.listening){e.next=9;break}return e.next=9,this.stopListening();case 9:this.recognition.continuous=a?i:this.recognition.continuous,this.recognition.lang=s?o:this.recognition.lang;case 11:if(this.listening){e.next=22;break}return this.recognition.continuous||(this.resetTranscript(),this.emitClearTranscript()),e.prev=13,e.next=16,this.start();case 16:this.emitListeningChange(!0),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(13),e.t0 instanceof DOMException||this.emitMicrophoneAvailabilityChange(!1);case 22:case"end":return e.stop()}}),e,this,[[13,19]])})));return function(){return e.apply(this,arguments)}}()},{key:"abortListening",value:function(){var e=c(r.mark((function e(){var t=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.disconnect("ABORT"),this.emitListeningChange(!1),e.next=4,new Promise((function(e){t.onStopListening=e}));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stopListening",value:function(){var e=c(r.mark((function e(){var t=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.disconnect("STOP"),this.emitListeningChange(!1),e.next=4,new Promise((function(e){t.onStopListening=e}));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getRecognition",value:function(){return this.recognition}},{key:"start",value:function(){var e=c(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.recognition||this.listening){e.next=4;break}return e.next=3,this.recognition.start();case 3:this.listening=!0;case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){this.recognition&&this.listening&&(this.recognition.stop(),this.listening=!1)}},{key:"abort",value:function(){this.recognition&&this.listening&&(this.recognition.abort(),this.listening=!1)}}],n&&l(t.prototype,n),i&&l(t,i),e}();t.default=d},491:(e,t,n)=>{"use strict";var r=n(756);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.useSpeechRecognition=void 0;var i=n(43),o=n(847),a=n(309),s=n(425),A=d(n(338)),c=d(n(453)),l=d(n(706));function d(e){return e&&e.__esModule?e:{default:e}}function u(e,t,n,r,i,o,a){try{var s=e[o](a),A=s.value}catch(c){return void n(c)}s.done?t(A):Promise.resolve(A).then(r,i)}function h(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){u(o,r,i,a,s,"next",e)}function s(e){u(o,r,i,a,s,"throw",e)}a(void 0)}))}}function p(e){return function(e){if(Array.isArray(e))return m(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||g(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e){return f="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function E(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"===typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(A){i=!0,o=A}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(e,t)||g(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,t){if(e){if("string"===typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var _,C=!!l.default,w=C&&!(0,c.default)();t.useSpeechRecognition=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.transcribing,n=void 0===t||t,r=e.clearTranscriptOnListen,A=void 0===r||r,c=e.commands,l=void 0===c?[]:c,d=E((0,i.useState)(S.getRecognitionManager()),1)[0],u=E((0,i.useState)(C),2),h=u[0],g=u[1],m=E((0,i.useState)(w),2),_=m[0],T=m[1],v=E((0,i.useReducer)(s.transcriptReducer,{interimTranscript:d.interimTranscript,finalTranscript:""}),2),y=v[0],I=y.interimTranscript,R=y.finalTranscript,b=v[1],O=E((0,i.useState)(d.listening),2),B=O[0],N=O[1],D=E((0,i.useState)(d.isMicrophoneAvailable),2),P=D[0],U=D[1],L=(0,i.useRef)(l);L.current=l;var k=function(){b((0,a.clearTranscript)())},M=(0,i.useCallback)((function(){d.resetTranscript(),k()}),[d]),F=(0,i.useCallback)((function(e,t){L.current.forEach((function(n){var r=n.command,i=n.callback,a=n.matchInterim,s=void 0!==a&&a,A=n.isFuzzyMatch,c=void 0!==A&&A,l=n.fuzzyMatchingThreshold,d=void 0===l?.8:l,u=n.bestMatchOnly,h=void 0!==u&&u,E=!t&&s?e.trim():t.trim(),g=(Array.isArray(r)?r:[r]).map((function(e){return c?function(e,t,n){var r=("object"===f(e)?e.toString():e).replace(/[&/\\#,+()!$~%.'":*?<>{}]/g,"").replace(/  +/g," ").trim(),i=(0,o.compareTwoStringsUsingDiceCoefficient)(r,t);return i>=n?{command:e,commandWithoutSpecials:r,howSimilar:i,isFuzzyMatch:!0}:null}(e,E,d):function(e,t){var n=(0,o.commandToRegExp)(e).exec(t);return n?{command:e,parameters:n.slice(1)}:null}(e,E)})).filter((function(e){return e}));if(c&&h&&g.length>=2){g.sort((function(e,t){return t.howSimilar-e.howSimilar}));var m=g[0],_=m.command,C=m.commandWithoutSpecials,w=m.howSimilar;i(C,E,w,{command:_,resetTranscript:M})}else g.forEach((function(e){if(e.isFuzzyMatch){var t=e.command,n=e.commandWithoutSpecials,r=e.howSimilar;i(n,E,r,{command:t,resetTranscript:M})}else{var o=e.command,a=e.parameters;i.apply(void 0,p(a).concat([{command:o,resetTranscript:M}]))}}))}))}),[M]),x=(0,i.useCallback)((function(e,t){n&&b((0,a.appendTranscript)(e,t)),F(e,t)}),[F,n]),Q=(0,i.useCallback)((function(){A&&k()}),[A]);return(0,i.useEffect)((function(){var e=S.counter;S.counter+=1;var t={onListeningChange:N,onMicrophoneAvailabilityChange:U,onTranscriptChange:x,onClearTranscript:Q,onBrowserSupportsSpeechRecognitionChange:g,onBrowserSupportsContinuousListeningChange:T};return d.subscribe(e,t),function(){d.unsubscribe(e)}}),[n,A,d,x,Q]),{transcript:(0,o.concatTranscripts)(R,I),interimTranscript:I,finalTranscript:R,listening:B,isMicrophoneAvailable:P,resetTranscript:M,browserSupportsSpeechRecognition:h,browserSupportsContinuousListening:_}};var S={counter:0,applyPolyfill:function(e){_?_.setSpeechRecognition(e):_=new A.default(e);var t=!!e&&(0,o.browserSupportsPolyfills)();C=t,w=t},removePolyfill:function(){_?_.setSpeechRecognition(l.default):_=new A.default(l.default),C=!!l.default,w=C&&!(0,c.default)()},getRecognitionManager:function(){return _||(_=new A.default(l.default)),_},getRecognition:function(){return S.getRecognitionManager().getRecognition()},startListening:function(){var e=h(r.mark((function e(){var t,n,i,o,a=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(t=a.length>0&&void 0!==a[0]?a[0]:{}).continuous,i=t.language,o=S.getRecognitionManager(),e.next=4,o.startListening({continuous:n,language:i});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),stopListening:function(){var e=h(r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=S.getRecognitionManager(),e.next=3,t.stopListening();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),abortListening:function(){var e=h(r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=S.getRecognitionManager(),e.next=3,t.abortListening();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),browserSupportsSpeechRecognition:function(){return C},browserSupportsContinuousListening:function(){return w}},T=S;t.default=T},309:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.appendTranscript=t.clearTranscript=void 0;var r=n(231);t.clearTranscript=function(){return{type:r.CLEAR_TRANSCRIPT}};t.appendTranscript=function(e,t){return{type:r.APPEND_TRANSCRIPT,payload:{interimTranscript:e,finalTranscript:t}}}},231:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.APPEND_TRANSCRIPT=t.CLEAR_TRANSCRIPT=void 0;t.CLEAR_TRANSCRIPT="CLEAR_TRANSCRIPT";t.APPEND_TRANSCRIPT="APPEND_TRANSCRIPT"},569:(e,t,n)=>{"use strict";function r(e){return r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"Vw",{enumerable:!0,get:function(){return i.useSpeechRecognition}}),t.Ay=void 0;var i=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!==typeof e)return{default:e};var t=o();if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}n.default=e,t&&t.set(e,n);return n}(n(491));function o(){if("function"!==typeof WeakMap)return null;var e=new WeakMap;return o=function(){return e},e}var a=i.default;t.Ay=a},453:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=function(){return/(android)/i.test("undefined"!==typeof navigator?navigator.userAgent:"")}},425:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.transcriptReducer=void 0;var r=n(231),i=n(847);t.transcriptReducer=function(e,t){switch(t.type){case r.CLEAR_TRANSCRIPT:return{interimTranscript:"",finalTranscript:""};case r.APPEND_TRANSCRIPT:return{interimTranscript:t.payload.interimTranscript,finalTranscript:(0,i.concatTranscripts)(e.finalTranscript,t.payload.finalTranscript)};default:throw new Error}}},847:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.browserSupportsPolyfills=t.compareTwoStringsUsingDiceCoefficient=t.commandToRegExp=t.concatTranscripts=t.debounce=void 0;t.debounce=function(e,t,n){var r;return function(){var i=this,o=arguments,a=n&&!r;clearTimeout(r),r=setTimeout((function(){r=null,n||e.apply(i,o)}),t),a&&e.apply(i,o)}};t.concatTranscripts=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.map((function(e){return e.trim()})).join(" ").trim()};var n=/\s*\((.*?)\)\s*/g,r=/(\(\?:[^)]+\))\?/g,i=/(\(\?)?:\w+/g,o=/\*/g,a=/[-{}[\]+?.,\\^$|#]/g;t.commandToRegExp=function(e){return e instanceof RegExp?new RegExp(e.source,"i"):(e=e.replace(a,"\\$&").replace(n,"(?:$1)?").replace(i,(function(e,t){return t?e:"([^\\s]+)"})).replace(o,"(.*?)").replace(r,"\\s*$1?\\s*"),new RegExp("^"+e+"$","i"))};t.compareTwoStringsUsingDiceCoefficient=function(e,t){if(e=e.replace(/\s+/g,"").toLowerCase(),t=t.replace(/\s+/g,"").toLowerCase(),!e.length&&!t.length)return 1;if(!e.length||!t.length)return 0;if(e===t)return 1;if(1===e.length&&1===t.length)return 0;if(e.length<2||t.length<2)return 0;for(var n=new Map,r=0;r<e.length-1;r++){var i=e.substring(r,r+2),o=n.has(i)?n.get(i)+1:1;n.set(i,o)}for(var a=0,s=0;s<t.length-1;s++){var A=t.substring(s,s+2),c=n.has(A)?n.get(A):0;c>0&&(n.set(A,c-1),a++)}return 2*a/(e.length+t.length-2)};t.browserSupportsPolyfills=function(){return"undefined"!==typeof window&&void 0!==window.navigator&&void 0!==window.navigator.mediaDevices&&void 0!==window.navigator.mediaDevices.getUserMedia&&(void 0!==window.AudioContext||void 0!==window.webkitAudioContext)}},153:(e,t,n)=>{"use strict";var r=n(43),i=Symbol.for("react.element"),o=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,A={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,o={},c=null,l=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(l=t.ref),t)a.call(t,r)&&!A.hasOwnProperty(r)&&(o[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===o[r]&&(o[r]=t[r]);return{$$typeof:i,type:e,key:c,ref:l,props:o,_owner:s.current}}t.Fragment=o,t.jsx=c,t.jsxs=c},202:(e,t)=>{"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),A=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),h=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},f=Object.assign,E={};function g(e,t,n){this.props=e,this.context=t,this.refs=E,this.updater=n||p}function m(){}function _(e,t,n){this.props=e,this.context=t,this.refs=E,this.updater=n||p}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},m.prototype=g.prototype;var C=_.prototype=new m;C.constructor=_,f(C,g.prototype),C.isPureReactComponent=!0;var w=Array.isArray,S=Object.prototype.hasOwnProperty,T={current:null},v={key:!0,ref:!0,__self:!0,__source:!0};function y(e,t,r){var i,o={},a=null,s=null;if(null!=t)for(i in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(a=""+t.key),t)S.call(t,i)&&!v.hasOwnProperty(i)&&(o[i]=t[i]);var A=arguments.length-2;if(1===A)o.children=r;else if(1<A){for(var c=Array(A),l=0;l<A;l++)c[l]=arguments[l+2];o.children=c}if(e&&e.defaultProps)for(i in A=e.defaultProps)void 0===o[i]&&(o[i]=A[i]);return{$$typeof:n,type:e,key:a,ref:s,props:o,_owner:T.current}}function I(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var R=/\/+/g;function b(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function O(e,t,i,o,a){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var A=!1;if(null===e)A=!0;else switch(s){case"string":case"number":A=!0;break;case"object":switch(e.$$typeof){case n:case r:A=!0}}if(A)return a=a(A=e),e=""===o?"."+b(A,0):o,w(a)?(i="",null!=e&&(i=e.replace(R,"$&/")+"/"),O(a,t,i,"",(function(e){return e}))):null!=a&&(I(a)&&(a=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,i+(!a.key||A&&A.key===a.key?"":(""+a.key).replace(R,"$&/")+"/")+e)),t.push(a)),1;if(A=0,o=""===o?".":o+":",w(e))for(var c=0;c<e.length;c++){var l=o+b(s=e[c],c);A+=O(s,t,i,l,a)}else if(l=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=h&&e[h]||e["@@iterator"])?e:null}(e),"function"===typeof l)for(e=l.call(e),c=0;!(s=e.next()).done;)A+=O(s=s.value,t,i,l=o+b(s,c++),a);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return A}function B(e,t,n){if(null==e)return e;var r=[],i=0;return O(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function N(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var D={current:null},P={transition:null},U={ReactCurrentDispatcher:D,ReactCurrentBatchConfig:P,ReactCurrentOwner:T};function L(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:B,forEach:function(e,t,n){B(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return B(e,(function(){t++})),t},toArray:function(e){return B(e,(function(e){return e}))||[]},only:function(e){if(!I(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=g,t.Fragment=i,t.Profiler=a,t.PureComponent=_,t.StrictMode=o,t.Suspense=l,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=U,t.act=L,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=f({},e.props),o=e.key,a=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,s=T.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var A=e.type.defaultProps;for(c in t)S.call(t,c)&&!v.hasOwnProperty(c)&&(i[c]=void 0===t[c]&&void 0!==A?A[c]:t[c])}var c=arguments.length-2;if(1===c)i.children=r;else if(1<c){A=Array(c);for(var l=0;l<c;l++)A[l]=arguments[l+2];i.children=A}return{$$typeof:n,type:e.type,key:o,ref:a,props:i,_owner:s}},t.createContext=function(e){return(e={$$typeof:A,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=y,t.createFactory=function(e){var t=y.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=I,t.lazy=function(e){return{$$typeof:u,_payload:{_status:-1,_result:e},_init:N}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=P.transition;P.transition={};try{e()}finally{P.transition=t}},t.unstable_act=L,t.useCallback=function(e,t){return D.current.useCallback(e,t)},t.useContext=function(e){return D.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return D.current.useDeferredValue(e)},t.useEffect=function(e,t){return D.current.useEffect(e,t)},t.useId=function(){return D.current.useId()},t.useImperativeHandle=function(e,t,n){return D.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return D.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return D.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return D.current.useMemo(e,t)},t.useReducer=function(e,t,n){return D.current.useReducer(e,t,n)},t.useRef=function(e){return D.current.useRef(e)},t.useState=function(e){return D.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return D.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return D.current.useTransition()},t.version="18.3.1"},43:(e,t,n)=>{"use strict";e.exports=n(202)},579:(e,t,n)=>{"use strict";e.exports=n(153)},234:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<o(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,a=i>>>1;r<a;){var s=2*(r+1)-1,A=e[s],c=s+1,l=e[c];if(0>o(A,n))c<i&&0>o(l,A)?(e[r]=l,e[c]=n,r=c):(e[r]=A,e[s]=n,r=s);else{if(!(c<i&&0>o(l,n)))break e;e[r]=l,e[c]=n,r=c}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var s=Date,A=s.now();t.unstable_now=function(){return s.now()-A}}var c=[],l=[],d=1,u=null,h=3,p=!1,f=!1,E=!1,g="function"===typeof setTimeout?setTimeout:null,m="function"===typeof clearTimeout?clearTimeout:null,_="undefined"!==typeof setImmediate?setImmediate:null;function C(e){for(var t=r(l);null!==t;){if(null===t.callback)i(l);else{if(!(t.startTime<=e))break;i(l),t.sortIndex=t.expirationTime,n(c,t)}t=r(l)}}function w(e){if(E=!1,C(e),!f)if(null!==r(c))f=!0,P(S);else{var t=r(l);null!==t&&U(w,t.startTime-e)}}function S(e,n){f=!1,E&&(E=!1,m(I),I=-1),p=!0;var o=h;try{for(C(n),u=r(c);null!==u&&(!(u.expirationTime>n)||e&&!O());){var a=u.callback;if("function"===typeof a){u.callback=null,h=u.priorityLevel;var s=a(u.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?u.callback=s:u===r(c)&&i(c),C(n)}else i(c);u=r(c)}if(null!==u)var A=!0;else{var d=r(l);null!==d&&U(w,d.startTime-n),A=!1}return A}finally{u=null,h=o,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var T,v=!1,y=null,I=-1,R=5,b=-1;function O(){return!(t.unstable_now()-b<R)}function B(){if(null!==y){var e=t.unstable_now();b=e;var n=!0;try{n=y(!0,e)}finally{n?T():(v=!1,y=null)}}else v=!1}if("function"===typeof _)T=function(){_(B)};else if("undefined"!==typeof MessageChannel){var N=new MessageChannel,D=N.port2;N.port1.onmessage=B,T=function(){D.postMessage(null)}}else T=function(){g(B,0)};function P(e){y=e,v||(v=!0,T())}function U(e,n){I=g((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){f||p||(f=!0,P(S))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(h){case 1:case 2:case 3:var t=3;break;default:t=h}var n=h;h=t;try{return e()}finally{h=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=h;h=e;try{return t()}finally{h=n}},t.unstable_scheduleCallback=function(e,i,o){var a=t.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?a+o:a:o=a,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:d++,callback:i,priorityLevel:e,startTime:o,expirationTime:s=o+s,sortIndex:-1},o>a?(e.sortIndex=o,n(l,e),null===r(c)&&e===r(l)&&(E?(m(I),I=-1):E=!0,U(w,o-a))):(e.sortIndex=s,n(c,e),f||p||(f=!0,P(S))),e},t.unstable_shouldYield=O,t.unstable_wrapCallback=function(e){var t=h;return function(){var n=h;h=t;try{return e.apply(this,arguments)}finally{h=n}}}},853:(e,t,n)=>{"use strict";e.exports=n(234)},50:()=>{},913:()=>{},555:()=>{},576:e=>{"use strict";e.exports=import("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest")},633:(e,t,n)=>{var r=n(738).default;function i(){"use strict";e.exports=i=function(){return n},e.exports.__esModule=!0,e.exports.default=e.exports;var t,n={},o=Object.prototype,a=o.hasOwnProperty,s=Object.defineProperty||function(e,t,n){e[t]=n.value},A="function"==typeof Symbol?Symbol:{},c=A.iterator||"@@iterator",l=A.asyncIterator||"@@asyncIterator",d=A.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(t){u=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var i=t&&t.prototype instanceof C?t:C,o=Object.create(i.prototype),a=new P(r||[]);return s(o,"_invoke",{value:O(e,n,a)}),o}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}n.wrap=h;var f="suspendedStart",E="suspendedYield",g="executing",m="completed",_={};function C(){}function w(){}function S(){}var T={};u(T,c,(function(){return this}));var v=Object.getPrototypeOf,y=v&&v(v(U([])));y&&y!==o&&a.call(y,c)&&(T=y);var I=S.prototype=C.prototype=Object.create(T);function R(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function n(i,o,s,A){var c=p(e[i],e,o);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==r(d)&&a.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,s,A)}),(function(e){n("throw",e,s,A)})):t.resolve(d).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,A)}))}A(c.arg)}var i;s(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(o,o):o()}})}function O(e,n,r){var i=f;return function(o,a){if(i===g)throw Error("Generator is already running");if(i===m){if("throw"===o)throw a;return{value:t,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var A=B(s,r);if(A){if(A===_)continue;return A}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===f)throw i=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=g;var c=p(e,n,r);if("normal"===c.type){if(i=r.done?m:E,c.arg===_)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i=m,r.method="throw",r.arg=c.arg)}}}function B(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,B(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),_;var o=p(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,_;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,_):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,_)}function N(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function D(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(N,this),this.reset(!0)}function U(e){if(e||""===e){var n=e[c];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(a.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(r(e)+" is not iterable")}return w.prototype=S,s(I,"constructor",{value:S,configurable:!0}),s(S,"constructor",{value:w,configurable:!0}),w.displayName=u(S,d,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,S):(e.__proto__=S,u(e,d,"GeneratorFunction")),e.prototype=Object.create(I),e},n.awrap=function(e){return{__await:e}},R(b.prototype),u(b.prototype,l,(function(){return this})),n.AsyncIterator=b,n.async=function(e,t,r,i,o){void 0===o&&(o=Promise);var a=new b(h(e,t,r,i),o);return n.isGeneratorFunction(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},R(I),u(I,d,"Generator"),u(I,c,(function(){return this})),u(I,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},n.values=U,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(D),!e)for(var n in this)"t"===n.charAt(0)&&a.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var A=a.call(o,"catchLoc"),c=a.call(o,"finallyLoc");if(A&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(A){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,_):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),_},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),D(n),_}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;D(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:U(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),_}},n}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},738:e=>{function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},756:(e,t,n)=>{var r=n(633)();e.exports=r;try{regeneratorRuntime=r}catch(i){"object"===typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},158:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function i(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}function o(e,t,n){return(t=i(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,{jI:()=>P,Fd:()=>me,aG:()=>we,Ay:()=>ve,o9:()=>H,hD:()=>q,QG:()=>X,ZR:()=>W,iw:()=>U,iT:()=>te});var a,s,A=n(43),c=n(579),l=Object.create,d=Object.defineProperty,u=Object.getOwnPropertyDescriptor,h=Object.getOwnPropertyNames,p=Object.getPrototypeOf,f=Object.prototype.hasOwnProperty,E=(e,t,n,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let i of h(t))!f.call(e,i)&&i!==n&&d(e,i,{get:()=>t[i],enumerable:!(r=u(t,i))||r.enumerable});return e},g=(e,t,n)=>(n=null!=e?l(p(e)):{},E(e&&e.__esModule?n:d(n,"default",{value:e,enumerable:!0}),e)),m=(a=(e,t)=>{var n,r;n=e,r=function(){var e=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var n=function(e){try{return!!e()}catch{return!0}},r=!n((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),i=r,o=Function.prototype,a=o.call,s=i&&o.bind.bind(a,a),A=i?s:function(e){return function(){return a.apply(e,arguments)}},c=A({}.isPrototypeOf),l=function(e){return e&&e.Math==Math&&e},d=l("object"==typeof globalThis&&globalThis)||l("object"==typeof window&&window)||l("object"==typeof self&&self)||l("object"==typeof e&&e)||function(){return this}()||e||Function("return this")(),u=r,h=Function.prototype,p=h.apply,f=h.call,E="object"==typeof Reflect&&Reflect.apply||(u?f.bind(p):function(){return f.apply(p,arguments)}),g=A,m=g({}.toString),_=g("".slice),C=function(e){return _(m(e),8,-1)},w=C,S=A,T=function(e){if("Function"===w(e))return S(e)},v="object"==typeof document&&document.all,y={all:v,IS_HTMLDDA:void 0===v&&void 0!==v},I=y.all,R=y.IS_HTMLDDA?function(e){return"function"==typeof e||e===I}:function(e){return"function"==typeof e},b={},O=!n((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),B=r,N=Function.prototype.call,D=B?N.bind(N):function(){return N.apply(N,arguments)},P={},U={}.propertyIsEnumerable,L=Object.getOwnPropertyDescriptor,k=L&&!U.call({1:2},1);P.f=k?function(e){var t=L(this,e);return!!t&&t.enumerable}:U;var M,F,x=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Q=n,V=C,H=Object,K=A("".split),j=Q((function(){return!H("z").propertyIsEnumerable(0)}))?function(e){return"String"==V(e)?K(e,""):H(e)}:H,G=function(e){return null==e},W=G,Y=TypeError,J=function(e){if(W(e))throw Y("Can't call method on "+e);return e},X=j,z=J,q=function(e){return X(z(e))},Z=R,$=y.all,ee=y.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:Z(e)||e===$}:function(e){return"object"==typeof e?null!==e:Z(e)},te={},ne=te,re=d,ie=R,oe=function(e){return ie(e)?e:void 0},ae=function(e,t){return arguments.length<2?oe(ne[e])||oe(re[e]):ne[e]&&ne[e][t]||re[e]&&re[e][t]},se=typeof navigator<"u"&&String(navigator.userAgent)||"",Ae=d,ce=se,le=Ae.process,de=Ae.Deno,ue=le&&le.versions||de&&de.version,he=ue&&ue.v8;he&&(F=(M=he.split("."))[0]>0&&M[0]<4?1:+(M[0]+M[1])),!F&&ce&&(!(M=ce.match(/Edge\/(\d+)/))||M[1]>=74)&&(M=ce.match(/Chrome\/(\d+)/))&&(F=+M[1]);var pe=F,fe=pe,Ee=n,ge=d.String,me=!!Object.getOwnPropertySymbols&&!Ee((function(){var e=Symbol();return!ge(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&fe&&fe<41})),_e=me&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Ce=ae,we=R,Se=c,Te=Object,ve=_e?function(e){return"symbol"==typeof e}:function(e){var t=Ce("Symbol");return we(t)&&Se(t.prototype,Te(e))},ye=String,Ie=function(e){try{return ye(e)}catch{return"Object"}},Re=R,be=Ie,Oe=TypeError,Be=function(e){if(Re(e))return e;throw Oe(be(e)+" is not a function")},Ne=Be,De=G,Pe=function(e,t){var n=e[t];return De(n)?void 0:Ne(n)},Ue=D,Le=R,ke=ee,Me=TypeError,Fe={exports:{}},xe=d,Qe=Object.defineProperty,Ve="__core-js_shared__",He=d[Ve]||function(e,t){try{Qe(xe,e,{value:t,configurable:!0,writable:!0})}catch{xe[e]=t}return t}(Ve,{}),Ke=He;(Fe.exports=function(e,t){return Ke[e]||(Ke[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"\xa9 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var je=Fe.exports,Ge=J,We=Object,Ye=function(e){return We(Ge(e))},Je=Ye,Xe=A({}.hasOwnProperty),ze=Object.hasOwn||function(e,t){return Xe(Je(e),t)},qe=A,Ze=0,$e=Math.random(),et=qe(1..toString),tt=function(e){return"Symbol("+(void 0===e?"":e)+")_"+et(++Ze+$e,36)},nt=je,rt=ze,it=tt,ot=me,at=_e,st=d.Symbol,At=nt("wks"),ct=at?st.for||st:st&&st.withoutSetter||it,lt=function(e){return rt(At,e)||(At[e]=ot&&rt(st,e)?st[e]:ct("Symbol."+e)),At[e]},dt=D,ut=ee,ht=ve,pt=Pe,ft=TypeError,Et=lt("toPrimitive"),gt=function(e,t){if(!ut(e)||ht(e))return e;var n,r=pt(e,Et);if(r){if(n=dt(r,e,t),!ut(n)||ht(n))return n;throw ft("Can't convert object to primitive value")}return function(e,t){var n,r;if(Le(n=e.toString)&&!ke(r=Ue(n,e))||Le(n=e.valueOf)&&!ke(r=Ue(n,e))||"string"!==t)return r;throw Me("Can't convert object to primitive value")}(e,t)},mt=ve,_t=function(e){var t=gt(e,"string");return mt(t)?t:t+""},Ct=ee,wt=d.document,St=Ct(wt)&&Ct(wt.createElement),Tt=function(e){return St?wt.createElement(e):{}},vt=Tt,yt=!O&&!n((function(){return 7!=Object.defineProperty(vt("div"),"a",{get:function(){return 7}}).a})),It=O,Rt=D,bt=P,Ot=x,Bt=q,Nt=_t,Dt=ze,Pt=yt,Ut=Object.getOwnPropertyDescriptor;b.f=It?Ut:function(e,t){if(e=Bt(e),t=Nt(t),Pt)try{return Ut(e,t)}catch{}if(Dt(e,t))return Ot(!Rt(bt.f,e,t),e[t])};var Lt=n,kt=R,Mt=/#|\.prototype\./,Ft=function(e,t){var n=Qt[xt(e)];return n==Ht||n!=Vt&&(kt(t)?Lt(t):!!t)},xt=Ft.normalize=function(e){return String(e).replace(Mt,".").toLowerCase()},Qt=Ft.data={},Vt=Ft.NATIVE="N",Ht=Ft.POLYFILL="P",Kt=Ft,jt=Be,Gt=r,Wt=T(T.bind),Yt=function(e,t){return jt(e),void 0===t?e:Gt?Wt(e,t):function(){return e.apply(t,arguments)}},Jt={},Xt=O&&n((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),zt=ee,qt=String,Zt=TypeError,$t=function(e){if(zt(e))return e;throw Zt(qt(e)+" is not an object")},en=O,tn=yt,nn=Xt,rn=$t,on=_t,an=TypeError,sn=Object.defineProperty,An=Object.getOwnPropertyDescriptor,cn="enumerable",ln="configurable",dn="writable";Jt.f=en?nn?function(e,t,n){if(rn(e),t=on(t),rn(n),"function"==typeof e&&"prototype"===t&&"value"in n&&dn in n&&!n[dn]){var r=An(e,t);r&&r[dn]&&(e[t]=n.value,n={configurable:ln in n?n[ln]:r[ln],enumerable:cn in n?n[cn]:r[cn],writable:!1})}return sn(e,t,n)}:sn:function(e,t,n){if(rn(e),t=on(t),rn(n),tn)try{return sn(e,t,n)}catch{}if("get"in n||"set"in n)throw an("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var un=Jt,hn=x,pn=O?function(e,t,n){return un.f(e,t,hn(1,n))}:function(e,t,n){return e[t]=n,e},fn=d,En=E,gn=T,mn=R,_n=b.f,Cn=Kt,wn=te,Sn=Yt,Tn=pn,vn=ze,yn=function(e){var t=function(n,r,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,r)}return new e(n,r,i)}return En(e,this,arguments)};return t.prototype=e.prototype,t},In=function(e,t){var n,r,i,o,a,s,A,c,l,d=e.target,u=e.global,h=e.stat,p=e.proto,f=u?fn:h?fn[d]:(fn[d]||{}).prototype,E=u?wn:wn[d]||Tn(wn,d,{})[d],g=E.prototype;for(o in t)r=!(n=Cn(u?o:d+(h?".":"#")+o,e.forced))&&f&&vn(f,o),s=E[o],r&&(A=e.dontCallGetSet?(l=_n(f,o))&&l.value:f[o]),a=r&&A?A:t[o],r&&typeof s==typeof a||(c=e.bind&&r?Sn(a,fn):e.wrap&&r?yn(a):p&&mn(a)?gn(a):a,(e.sham||a&&a.sham||s&&s.sham)&&Tn(c,"sham",!0),Tn(E,o,c),p&&(vn(wn,i=d+"Prototype")||Tn(wn,i,{}),Tn(wn[i],o,a),e.real&&g&&(n||!g[o])&&Tn(g,o,a)))},Rn=Math.ceil,bn=Math.floor,On=Math.trunc||function(e){var t=+e;return(t>0?bn:Rn)(t)},Bn=On,Nn=function(e){var t=+e;return t!=t||0===t?0:Bn(t)},Dn=Nn,Pn=Math.max,Un=Math.min,Ln=function(e,t){var n=Dn(e);return n<0?Pn(n+t,0):Un(n,t)},kn=Nn,Mn=Math.min,Fn=function(e){return e>0?Mn(kn(e),9007199254740991):0},xn=Fn,Qn=function(e){return xn(e.length)},Vn=q,Hn=Ln,Kn=Qn,jn=function(e){return function(t,n,r){var i,o=Vn(t),a=Kn(o),s=Hn(r,a);if(e&&n!=n){for(;a>s;)if((i=o[s++])!=i)return!0}else for(;a>s;s++)if((e||s in o)&&o[s]===n)return e||s||0;return!e&&-1}},Gn={includes:jn(!0),indexOf:jn(!1)},Wn=Gn.includes;In({target:"Array",proto:!0,forced:n((function(){return!Array(1).includes()}))},{includes:function(e){return Wn(this,e,arguments.length>1?arguments[1]:void 0)}});var Yn=te,Jn=function(e){return Yn[e+"Prototype"]},Xn=Jn("Array").includes,zn=ee,qn=C,Zn=lt("match"),$n=function(e){var t;return zn(e)&&(void 0!==(t=e[Zn])?!!t:"RegExp"==qn(e))},er=$n,tr=TypeError,nr={};nr[lt("toStringTag")]="z";var rr="[object z]"===String(nr),ir=rr,or=R,ar=C,sr=lt("toStringTag"),Ar=Object,cr="Arguments"==ar(function(){return arguments}()),lr=ir?ar:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch{}}(t=Ar(e),sr))?n:cr?ar(t):"Object"==(r=ar(t))&&or(t.callee)?"Arguments":r},dr=lr,ur=String,hr=function(e){if("Symbol"===dr(e))throw TypeError("Cannot convert a Symbol value to a string");return ur(e)},pr=lt("match"),fr=In,Er=J,gr=hr,mr=A("".indexOf);fr({target:"String",proto:!0,forced:!function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[pr]=!1,"/./"[e](t)}catch{}}return!1}("includes")},{includes:function(e){return!!~mr(gr(Er(this)),gr(function(e){if(er(e))throw tr("The method doesn't accept regular expressions");return e}(e)),arguments.length>1?arguments[1]:void 0)}});var _r=Jn("String").includes,Cr=c,wr=Xn,Sr=_r,Tr=Array.prototype,vr=String.prototype,yr=t((function(e){var t=e.includes;return e===Tr||Cr(Tr,e)&&t===Tr.includes?wr:"string"==typeof e||e===vr||Cr(vr,e)&&t===vr.includes?Sr:t})),Ir=Be,Rr=Ye,br=j,Or=Qn,Br=TypeError,Nr=function(e){return function(t,n,r,i){Ir(n);var o=Rr(t),a=br(o),s=Or(o),A=e?s-1:0,c=e?-1:1;if(r<2)for(;;){if(A in a){i=a[A],A+=c;break}if(A+=c,e?A<0:s<=A)throw Br("Reduce of empty array with no initial value")}for(;e?A>=0:s>A;A+=c)A in a&&(i=n(i,a[A],A,o));return i}},Dr={left:Nr(!1),right:Nr(!0)},Pr=n,Ur=function(e,t){var n=[][e];return!!n&&Pr((function(){n.call(null,t||function(){return 1},1)}))},Lr=typeof process<"u"&&"process"==C(process),kr=Dr.left;In({target:"Array",proto:!0,forced:!Lr&&pe>79&&pe<83||!Ur("reduce")},{reduce:function(e){var t=arguments.length;return kr(this,e,t,t>1?arguments[1]:void 0)}});var Mr=Jn("Array").reduce,Fr=c,xr=Mr,Qr=Array.prototype,Vr=function(e){var t=e.reduce;return e===Qr||Fr(Qr,e)&&t===Qr.reduce?xr:t},Hr=t(Vr);let Kr=!0,jr=!0;function Gr(e,t,n){let r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function Wr(e,t,n){if(!e.RTCPeerConnection)return;let r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);let o=e=>{let t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,o),i.apply(this,[e,o])};let o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(n))return o.apply(this,arguments);let r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function Yr(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Kr=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Jr(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(jr=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Xr(){if("object"==typeof window){if(Kr)return;typeof console<"u"&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function zr(e,t){jr&&console.warn(e+" is deprecated, please use "+t+" instead.")}function qr(e){return"[object Object]"===Object.prototype.toString.call(e)}function Zr(e){var t;return qr(e)?Hr(t=Object.keys(e)).call(t,(function(t,n){let r=qr(e[n]),i=r?Zr(e[n]):e[n],o=r&&!Object.keys(i).length;return void 0===i||o?t:Object.assign(t,{[n]:i})}),{}):e}function $r(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((r=>{r.endsWith("Id")?$r(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach((t=>{$r(e,e.get(t),n)}))})))}function ei(e,t,n){let r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;let o=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)})),o.forEach((t=>{e.forEach((n=>{n.type===r&&n.trackId===t.id&&$r(e,n,i)}))})),i}var ti=tt,ni=je("keys"),ri=function(e){return ni[e]||(ni[e]=ti(e))},ii=!n((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),oi=ze,ai=R,si=Ye,Ai=ii,ci=ri("IE_PROTO"),li=Object,di=li.prototype,ui=Ai?li.getPrototypeOf:function(e){var t=si(e);if(oi(t,ci))return t[ci];var n=t.constructor;return ai(n)&&t instanceof n?n.prototype:t instanceof li?di:null},hi=A,pi=Be,fi=R,Ei=String,gi=TypeError,mi=$t,_i=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=function(e,t,n){try{return hi(pi(Object.getOwnPropertyDescriptor(e,t)[n]))}catch{}}(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(n,r){return mi(n),function(e){if("object"==typeof e||fi(e))return e;throw gi("Can't set "+Ei(e)+" as a prototype")}(r),t?e(n,r):n.__proto__=r,n}}():void 0),Ci={},wi={},Si=ze,Ti=q,vi=Gn.indexOf,yi=wi,Ii=A([].push),Ri=function(e,t){var n,r=Ti(e),i=0,o=[];for(n in r)!Si(yi,n)&&Si(r,n)&&Ii(o,n);for(;t.length>i;)Si(r,n=t[i++])&&(~vi(o,n)||Ii(o,n));return o},bi=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Oi=Ri,Bi=bi.concat("length","prototype");Ci.f=Object.getOwnPropertyNames||function(e){return Oi(e,Bi)};var Ni={};Ni.f=Object.getOwnPropertySymbols;var Di=ae,Pi=Ci,Ui=Ni,Li=$t,ki=A([].concat),Mi=Di("Reflect","ownKeys")||function(e){var t=Pi.f(Li(e)),n=Ui.f;return n?ki(t,n(e)):t},Fi=ze,xi=Mi,Qi=b,Vi=Jt,Hi={},Ki=Ri,ji=bi,Gi=Object.keys||function(e){return Ki(e,ji)},Wi=O,Yi=Xt,Ji=Jt,Xi=$t,zi=q,qi=Gi;Hi.f=Wi&&!Yi?Object.defineProperties:function(e,t){Xi(e);for(var n,r=zi(t),i=qi(t),o=i.length,a=0;o>a;)Ji.f(e,n=i[a++],r[n]);return e};var Zi,$i=ae("document","documentElement"),eo=$t,to=Hi,no=bi,ro=wi,io=$i,oo=Tt,ao="prototype",so="script",Ao=ri("IE_PROTO"),co=function(){},lo=function(e){return"<"+so+">"+e+"</"+so+">"},uo=function(e){e.write(lo("")),e.close();var t=e.parentWindow.Object;return e=null,t},ho=function(){try{Zi=new ActiveXObject("htmlfile")}catch{}var e,t,n;ho=typeof document<"u"?document.domain&&Zi?uo(Zi):(t=oo("iframe"),n="java"+so+":",t.style.display="none",io.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(lo("document.F=Object")),e.close(),e.F):uo(Zi);for(var r=no.length;r--;)delete ho[ao][no[r]];return ho()};ro[Ao]=!0;var po=Object.create||function(e,t){var n;return null!==e?(co[ao]=eo(e),n=new co,co[ao]=null,n[Ao]=e):n=ho(),void 0===t?n:to.f(n,t)},fo=ee,Eo=pn,go=Error,mo=A("".replace),_o=String(go("zxcasd").stack),Co=/\n\s*at [^:]*:[^\n]*/,wo=Co.test(_o),So=x,To=!n((function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",So(1,7)),7!==e.stack)})),vo=pn,yo=To,Io=Error.captureStackTrace,Ro={},bo=Ro,Oo=lt("iterator"),Bo=Array.prototype,No=function(e){return void 0!==e&&(bo.Array===e||Bo[Oo]===e)},Do=lr,Po=Pe,Uo=G,Lo=Ro,ko=lt("iterator"),Mo=function(e){if(!Uo(e))return Po(e,ko)||Po(e,"@@iterator")||Lo[Do(e)]},Fo=D,xo=Be,Qo=$t,Vo=Ie,Ho=Mo,Ko=TypeError,jo=function(e,t){var n=arguments.length<2?Ho(e):t;if(xo(n))return Qo(Fo(n,e));throw Ko(Vo(e)+" is not iterable")},Go=D,Wo=$t,Yo=Pe,Jo=function(e,t,n){var r,i;Wo(e);try{if(!(r=Yo(e,"return"))){if("throw"===t)throw n;return n}r=Go(r,e)}catch(o){i=!0,r=o}if("throw"===t)throw n;if(i)throw r;return Wo(r),n},Xo=Yt,zo=D,qo=$t,Zo=Ie,$o=No,ea=Qn,ta=c,na=jo,ra=Mo,ia=Jo,oa=TypeError,aa=function(e,t){this.stopped=e,this.result=t},sa=aa.prototype,Aa=function(e,t,n){var r,i,o,a,s,A,c,l=n&&n.that,d=!(!n||!n.AS_ENTRIES),u=!(!n||!n.IS_RECORD),h=!(!n||!n.IS_ITERATOR),p=!(!n||!n.INTERRUPTED),f=Xo(t,l),E=function(e){return r&&ia(r,"normal",e),new aa(!0,e)},g=function(e){return d?(qo(e),p?f(e[0],e[1],E):f(e[0],e[1])):p?f(e,E):f(e)};if(u)r=e.iterator;else if(h)r=e;else{if(!(i=ra(e)))throw oa(Zo(e)+" is not iterable");if($o(i)){for(o=0,a=ea(e);a>o;o++)if((s=g(e[o]))&&ta(sa,s))return s;return new aa(!1)}r=na(e,i)}for(A=u?e.next:r.next;!(c=zo(A,r)).done;){try{s=g(c.value)}catch(m){ia(r,"throw",m)}if("object"==typeof s&&s&&ta(sa,s))return s}return new aa(!1)},ca=hr,la=In,da=c,ua=ui,ha=_i,pa=po,fa=pn,Ea=x,ga=function(e,t,n,r){yo&&(Io?Io(e,t):vo(e,"stack",function(e,t){if(wo&&"string"==typeof e&&!go.prepareStackTrace)for(;t--;)e=mo(e,Co,"");return e}(n,r)))},ma=Aa,_a=lt("toStringTag"),Ca=Error,wa=[].push,Sa=function(e,t){var n,r=da(Ta,this);ha?n=ha(Ca(),r?ua(this):Ta):(n=r?this:pa(Ta),fa(n,_a,"Error")),void 0!==t&&fa(n,"message",function(e,t){return void 0===e?arguments.length<2?"":t:ca(e)}(t)),ga(n,Sa,n.stack,1),arguments.length>2&&function(e,t){fo(t)&&"cause"in t&&Eo(e,"cause",t.cause)}(n,arguments[2]);var i=[];return ma(e,wa,{that:i}),fa(n,"errors",i),n};ha?ha(Sa,Ca):function(e,t,n){for(var r=xi(t),i=Vi.f,o=Qi.f,a=0;a<r.length;a++){var s=r[a];Fi(e,s)||n&&Fi(n,s)||i(e,s,o(t,s))}}(Sa,Ca,{name:!0});var Ta=Sa.prototype=pa(Ca.prototype,{constructor:Ea(1,Sa),message:Ea(1,""),name:Ea(1,"AggregateError")});la({global:!0,constructor:!0,arity:2},{AggregateError:Sa});var va,ya,Ia,Ra=R,ba=d.WeakMap,Oa=Ra(ba)&&/native code/.test(String(ba)),Ba=d,Na=ee,Da=pn,Pa=ze,Ua=He,La=ri,ka=wi,Ma="Object already initialized",Fa=Ba.TypeError,xa=Ba.WeakMap;if(Oa||Ua.state){var Qa=Ua.state||(Ua.state=new xa);Qa.get=Qa.get,Qa.has=Qa.has,Qa.set=Qa.set,va=function(e,t){if(Qa.has(e))throw Fa(Ma);return t.facade=e,Qa.set(e,t),t},ya=function(e){return Qa.get(e)||{}},Ia=function(e){return Qa.has(e)}}else{var Va=La("state");ka[Va]=!0,va=function(e,t){if(Pa(e,Va))throw Fa(Ma);return t.facade=e,Da(e,Va,t),t},ya=function(e){return Pa(e,Va)?e[Va]:{}},Ia=function(e){return Pa(e,Va)}}var Ha,Ka,ja,Ga={set:va,get:ya,has:Ia,enforce:function(e){return Ia(e)?ya(e):va(e,{})},getterFor:function(e){return function(t){var n;if(!Na(t)||(n=ya(t)).type!==e)throw Fa("Incompatible receiver, "+e+" required");return n}}},Wa=O,Ya=ze,Ja=Function.prototype,Xa=Wa&&Object.getOwnPropertyDescriptor,za=Ya(Ja,"name"),qa={EXISTS:za,PROPER:za&&"something"===function(){}.name,CONFIGURABLE:za&&(!Wa||Wa&&Xa(Ja,"name").configurable)},Za=pn,$a=function(e,t,n,r){return r&&r.enumerable?e[t]=n:Za(e,t,n),e},es=n,ts=R,ns=ee,rs=po,is=ui,os=$a,as=lt("iterator"),ss=!1;[].keys&&("next"in(ja=[].keys())?(Ka=is(is(ja)))!==Object.prototype&&(Ha=Ka):ss=!0);var As=!ns(Ha)||es((function(){var e={};return Ha[as].call(e)!==e}));ts((Ha=As?{}:rs(Ha))[as])||os(Ha,as,(function(){return this}));var cs={IteratorPrototype:Ha,BUGGY_SAFARI_ITERATORS:ss},ls=lr,ds=rr?{}.toString:function(){return"[object "+ls(this)+"]"},us=rr,hs=Jt.f,ps=pn,fs=ze,Es=ds,gs=lt("toStringTag"),ms=function(e,t,n,r){if(e){var i=n?e:e.prototype;fs(i,gs)||hs(i,gs,{configurable:!0,value:t}),r&&!us&&ps(i,"toString",Es)}},_s=cs.IteratorPrototype,Cs=po,ws=x,Ss=ms,Ts=Ro,vs=function(){return this},ys=function(e,t,n,r){var i=t+" Iterator";return e.prototype=Cs(_s,{next:ws(+!r,n)}),Ss(e,i,!1,!0),Ts[i]=vs,e},Is=In,Rs=D,bs=ys,Os=ui,Bs=ms,Ns=$a,Ds=Ro,Ps=qa.PROPER,Us=cs.BUGGY_SAFARI_ITERATORS,Ls=lt("iterator"),ks="keys",Ms="values",Fs="entries",xs=function(){return this},Qs=function(e,t,n,r,i,o,a){bs(n,t,r);var s,A,c,l=function(e){if(e===i&&f)return f;if(!Us&&e in h)return h[e];switch(e){case ks:case Ms:case Fs:return function(){return new n(this,e)}}return function(){return new n(this)}},d=t+" Iterator",u=!1,h=e.prototype,p=h[Ls]||h["@@iterator"]||i&&h[i],f=!Us&&p||l(i),E="Array"==t&&h.entries||p;if(E&&(s=Os(E.call(new e)))!==Object.prototype&&s.next&&(Bs(s,d,!0,!0),Ds[d]=xs),Ps&&i==Ms&&p&&p.name!==Ms&&(u=!0,f=function(){return Rs(p,this)}),i)if(A={values:l(Ms),keys:o?f:l(ks),entries:l(Fs)},a)for(c in A)(Us||u||!(c in h))&&Ns(h,c,A[c]);else Is({target:t,proto:!0,forced:Us||u},A);return a&&h[Ls]!==f&&Ns(h,Ls,f,{name:i}),Ds[t]=f,A},Vs=function(e,t){return{value:e,done:t}},Hs=q,Ks=Ro,js=Ga;Jt.f;var Gs=Qs,Ws=Vs,Ys="Array Iterator",Js=js.set,Xs=js.getterFor(Ys);Gs(Array,"Array",(function(e,t){Js(this,{type:Ys,target:Hs(e),index:0,kind:t})}),(function(){var e=Xs(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,Ws(void 0,!0)):Ws("keys"==n?r:"values"==n?t[r]:[r,t[r]],!1)}),"values"),Ks.Arguments=Ks.Array;var zs=Jt,qs=function(e,t,n){return zs.f(e,t,n)},Zs=ae,$s=qs,eA=O,tA=lt("species"),nA=c,rA=TypeError,iA=function(e,t){if(nA(t,e))return e;throw rA("Incorrect invocation")},oA=R,aA=He,sA=A(Function.toString);oA(aA.inspectSource)||(aA.inspectSource=function(e){return sA(e)});var AA=aA.inspectSource,cA=A,lA=n,dA=R,uA=lr,hA=AA,pA=function(){},fA=[],EA=ae("Reflect","construct"),gA=/^\s*(?:class|function)\b/,mA=cA(gA.exec),_A=!gA.exec(pA),CA=function(e){if(!dA(e))return!1;try{return EA(pA,fA,e),!0}catch{return!1}},wA=function(e){if(!dA(e))return!1;switch(uA(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return _A||!!mA(gA,hA(e))}catch{return!0}};wA.sham=!0;var SA,TA,vA,yA,IA=!EA||lA((function(){var e;return CA(CA.call)||!CA(Object)||!CA((function(){e=!0}))||e}))?wA:CA,RA=IA,bA=Ie,OA=TypeError,BA=$t,NA=G,DA=lt("species"),PA=function(e,t){var n,r=BA(e).constructor;return void 0===r||NA(n=BA(r)[DA])?t:function(e){if(RA(e))return e;throw OA(bA(e)+" is not a constructor")}(n)},UA=A([].slice),LA=TypeError,kA=function(e,t){if(e<t)throw LA("Not enough arguments");return e},MA=/(?:ipad|iphone|ipod).*applewebkit/i.test(se),FA=d,xA=E,QA=Yt,VA=R,HA=ze,KA=n,jA=$i,GA=UA,WA=Tt,YA=kA,JA=MA,XA=Lr,zA=FA.setImmediate,qA=FA.clearImmediate,ZA=FA.process,$A=FA.Dispatch,ec=FA.Function,tc=FA.MessageChannel,nc=FA.String,rc=0,ic={},oc="onreadystatechange";KA((function(){SA=FA.location}));var ac=function(e){if(HA(ic,e)){var t=ic[e];delete ic[e],t()}},sc=function(e){return function(){ac(e)}},Ac=function(e){ac(e.data)},cc=function(e){FA.postMessage(nc(e),SA.protocol+"//"+SA.host)};zA&&qA||(zA=function(e){YA(arguments.length,1);var t=VA(e)?e:ec(e),n=GA(arguments,1);return ic[++rc]=function(){xA(t,void 0,n)},TA(rc),rc},qA=function(e){delete ic[e]},XA?TA=function(e){ZA.nextTick(sc(e))}:$A&&$A.now?TA=function(e){$A.now(sc(e))}:tc&&!JA?(yA=(vA=new tc).port2,vA.port1.onmessage=Ac,TA=QA(yA.postMessage,yA)):FA.addEventListener&&VA(FA.postMessage)&&!FA.importScripts&&SA&&"file:"!==SA.protocol&&!KA(cc)?(TA=cc,FA.addEventListener("message",Ac,!1)):TA=oc in WA("script")?function(e){jA.appendChild(WA("script"))[oc]=function(){jA.removeChild(this),ac(e)}}:function(e){setTimeout(sc(e),0)});var lc={set:zA,clear:qA},dc=function(){this.head=null,this.tail=null};dc.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}};var uc,hc,pc,fc,Ec,gc=dc,mc=/ipad|iphone|ipod/i.test(se)&&typeof Pebble<"u",_c=/web0s(?!.*chrome)/i.test(se),Cc=d,wc=Yt,Sc=b.f,Tc=lc.set,vc=gc,yc=MA,Ic=mc,Rc=_c,bc=Lr,Oc=Cc.MutationObserver||Cc.WebKitMutationObserver,Bc=Cc.document,Nc=Cc.process,Dc=Cc.Promise,Pc=Sc(Cc,"queueMicrotask"),Uc=Pc&&Pc.value;if(!Uc){var Lc=new vc,kc=function(){var e,t;for(bc&&(e=Nc.domain)&&e.exit();t=Lc.get();)try{t()}catch(n){throw Lc.head&&uc(),n}e&&e.enter()};yc||bc||Rc||!Oc||!Bc?!Ic&&Dc&&Dc.resolve?((fc=Dc.resolve(void 0)).constructor=Dc,Ec=wc(fc.then,fc),uc=function(){Ec(kc)}):bc?uc=function(){Nc.nextTick(kc)}:(Tc=wc(Tc,Cc),uc=function(){Tc(kc)}):(hc=!0,pc=Bc.createTextNode(""),new Oc(kc).observe(pc,{characterData:!0}),uc=function(){pc.data=hc=!hc}),Uc=function(e){Lc.head||uc(),Lc.add(e)}}var Mc=Uc,Fc=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},xc=d.Promise,Qc="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Vc=!Qc&&!Lr&&"object"==typeof window&&"object"==typeof document,Hc=d,Kc=xc,jc=R,Gc=Kt,Wc=AA,Yc=lt,Jc=Vc,Xc=Qc,zc=pe,qc=Kc&&Kc.prototype,Zc=Yc("species"),$c=!1,el=jc(Hc.PromiseRejectionEvent),tl=Gc("Promise",(function(){var e=Wc(Kc),t=e!==String(Kc);if(!t&&66===zc||!qc.catch||!qc.finally)return!0;if(!zc||zc<51||!/native code/.test(e)){var n=new Kc((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};if((n.constructor={})[Zc]=r,!($c=n.then((function(){}))instanceof r))return!0}return!t&&(Jc||Xc)&&!el})),nl={CONSTRUCTOR:tl,REJECTION_EVENT:el,SUBCLASSING:$c},rl={},il=Be,ol=TypeError,al=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw ol("Bad Promise constructor");t=e,n=r})),this.resolve=il(t),this.reject=il(n)};rl.f=function(e){return new al(e)};var sl,Al,cl=In,ll=Lr,dl=d,ul=D,hl=$a,pl=ms,fl=Be,El=R,gl=ee,ml=iA,_l=PA,Cl=lc.set,wl=Mc,Sl=Fc,Tl=gc,vl=Ga,yl=xc,Il=rl,Rl="Promise",bl=nl.CONSTRUCTOR,Ol=nl.REJECTION_EVENT,Bl=vl.getterFor(Rl),Nl=vl.set,Dl=yl&&yl.prototype,Pl=yl,Ul=Dl,Ll=dl.TypeError,kl=dl.document,Ml=dl.process,Fl=Il.f,xl=Fl,Ql=!!(kl&&kl.createEvent&&dl.dispatchEvent),Vl="unhandledrejection",Hl=function(e){var t;return!(!gl(e)||!El(t=e.then))&&t},Kl=function(e,t){var n,r,i,o=t.value,a=1==t.state,s=a?e.ok:e.fail,A=e.resolve,c=e.reject,l=e.domain;try{s?(a||(2===t.rejection&&Jl(t),t.rejection=1),!0===s?n=o:(l&&l.enter(),n=s(o),l&&(l.exit(),i=!0)),n===e.promise?c(Ll("Promise-chain cycle")):(r=Hl(n))?ul(r,n,A,c):A(n)):c(o)}catch(d){l&&!i&&l.exit(),c(d)}},jl=function(e,t){e.notified||(e.notified=!0,wl((function(){for(var n,r=e.reactions;n=r.get();)Kl(n,e);e.notified=!1,t&&!e.rejection&&Wl(e)})))},Gl=function(e,t,n){var r,i;Ql?((r=kl.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),dl.dispatchEvent(r)):r={promise:t,reason:n},!Ol&&(i=dl["on"+e])?i(r):e===Vl&&function(e,t){try{1==arguments.length?console.error(e):console.error(e,t)}catch{}}("Unhandled promise rejection",n)},Wl=function(e){ul(Cl,dl,(function(){var t,n=e.facade,r=e.value;if(Yl(e)&&(t=Sl((function(){ll?Ml.emit("unhandledRejection",r,n):Gl(Vl,n,r)})),e.rejection=ll||Yl(e)?2:1,t.error))throw t.value}))},Yl=function(e){return 1!==e.rejection&&!e.parent},Jl=function(e){ul(Cl,dl,(function(){var t=e.facade;ll?Ml.emit("rejectionHandled",t):Gl("rejectionhandled",t,e.value)}))},Xl=function(e,t,n){return function(r){e(t,r,n)}},zl=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,jl(e,!0))},ql=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw Ll("Promise can't be resolved itself");var r=Hl(t);r?wl((function(){var n={done:!1};try{ul(r,t,Xl(ql,n,e),Xl(zl,n,e))}catch(i){zl(n,i,e)}})):(e.value=t,e.state=1,jl(e,!1))}catch(i){zl({done:!1},i,e)}}};bl&&(Ul=(Pl=function(e){ml(this,Ul),fl(e),ul(sl,this);var t=Bl(this);try{e(Xl(ql,t),Xl(zl,t))}catch(n){zl(t,n)}}).prototype,(sl=function(e){Nl(this,{type:Rl,done:!1,notified:!1,parent:!1,reactions:new Tl,rejection:!1,state:0,value:void 0})}).prototype=hl(Ul,"then",(function(e,t){var n=Bl(this),r=Fl(_l(this,Pl));return n.parent=!0,r.ok=!El(e)||e,r.fail=El(t)&&t,r.domain=ll?Ml.domain:void 0,0==n.state?n.reactions.add(r):wl((function(){Kl(r,n)})),r.promise})),Al=function(){var e=new sl,t=Bl(e);this.promise=e,this.resolve=Xl(ql,t),this.reject=Xl(zl,t)},Il.f=Fl=function(e){return e===Pl||void 0===e?new Al(e):xl(e)}),cl({global:!0,constructor:!0,wrap:!0,forced:bl},{Promise:Pl}),pl(Pl,Rl,!1,!0),function(e){var t=Zs(e);eA&&t&&!t[tA]&&$s(t,tA,{configurable:!0,get:function(){return this}})}(Rl);var Zl=lt("iterator"),$l=!1;try{var ed=0,td={next:function(){return{done:!!ed++}},return:function(){$l=!0}};td[Zl]=function(){return this},Array.from(td,(function(){throw 2}))}catch{}var nd=xc,rd=nl.CONSTRUCTOR||!function(e,t){if(!$l)return!1;var n=!1;try{var r={};r[Zl]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch{}return n}((function(e){nd.all(e).then(void 0,(function(){}))})),id=D,od=Be,ad=rl,sd=Fc,Ad=Aa;In({target:"Promise",stat:!0,forced:rd},{all:function(e){var t=this,n=ad.f(t),r=n.resolve,i=n.reject,o=sd((function(){var n=od(t.resolve),o=[],a=0,s=1;Ad(e,(function(e){var A=a++,c=!1;s++,id(n,t,e).then((function(e){c||(c=!0,o[A]=e,--s||r(o))}),i)})),--s||r(o)}));return o.error&&i(o.value),n.promise}});var cd=In,ld=nl.CONSTRUCTOR;xc&&xc.prototype,cd({target:"Promise",proto:!0,forced:ld,real:!0},{catch:function(e){return this.then(void 0,e)}});var dd=D,ud=Be,hd=rl,pd=Fc,fd=Aa;In({target:"Promise",stat:!0,forced:rd},{race:function(e){var t=this,n=hd.f(t),r=n.reject,i=pd((function(){var i=ud(t.resolve);fd(e,(function(e){dd(i,t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var Ed=D,gd=rl;In({target:"Promise",stat:!0,forced:nl.CONSTRUCTOR},{reject:function(e){var t=gd.f(this);return Ed(t.reject,void 0,e),t.promise}});var md=$t,_d=ee,Cd=rl,wd=function(e,t){if(md(e),_d(t)&&t.constructor===e)return t;var n=Cd.f(e);return(0,n.resolve)(t),n.promise},Sd=In,Td=xc,vd=nl.CONSTRUCTOR,yd=wd,Id=ae("Promise"),Rd=!vd;Sd({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return yd(Rd&&this===Id?Td:this,e)}});var bd=D,Od=Be,Bd=rl,Nd=Fc,Dd=Aa;In({target:"Promise",stat:!0,forced:rd},{allSettled:function(e){var t=this,n=Bd.f(t),r=n.resolve,i=n.reject,o=Nd((function(){var n=Od(t.resolve),i=[],o=0,a=1;Dd(e,(function(e){var s=o++,A=!1;a++,bd(n,t,e).then((function(e){A||(A=!0,i[s]={status:"fulfilled",value:e},--a||r(i))}),(function(e){A||(A=!0,i[s]={status:"rejected",reason:e},--a||r(i))}))})),--a||r(i)}));return o.error&&i(o.value),n.promise}});var Pd=D,Ud=Be,Ld=ae,kd=rl,Md=Fc,Fd=Aa,xd="No one promise resolved";In({target:"Promise",stat:!0,forced:rd},{any:function(e){var t=this,n=Ld("AggregateError"),r=kd.f(t),i=r.resolve,o=r.reject,a=Md((function(){var r=Ud(t.resolve),a=[],s=0,A=1,c=!1;Fd(e,(function(e){var l=s++,d=!1;A++,Pd(r,t,e).then((function(e){d||c||(c=!0,i(e))}),(function(e){d||c||(d=!0,a[l]=e,--A||o(new n(a,xd)))}))})),--A||o(new n(a,xd))}));return a.error&&o(a.value),r.promise}});var Qd=In,Vd=xc,Hd=n,Kd=ae,jd=R,Gd=PA,Wd=wd,Yd=Vd&&Vd.prototype;Qd({target:"Promise",proto:!0,real:!0,forced:!!Vd&&Hd((function(){Yd.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=Gd(this,Kd("Promise")),n=jd(e);return this.then(n?function(n){return Wd(t,e()).then((function(){return n}))}:e,n?function(n){return Wd(t,e()).then((function(){throw n}))}:e)}});var Jd=A,Xd=Nn,zd=hr,qd=J,Zd=Jd("".charAt),$d=Jd("".charCodeAt),eu=Jd("".slice),tu=function(e){return function(t,n){var r,i,o=zd(qd(t)),a=Xd(n),s=o.length;return a<0||a>=s?e?"":void 0:(r=$d(o,a))<55296||r>56319||a+1===s||(i=$d(o,a+1))<56320||i>57343?e?Zd(o,a):r:e?eu(o,a,a+2):i-56320+(r-55296<<10)+65536}},nu={codeAt:tu(!1),charAt:tu(!0)},ru=nu.charAt,iu=hr,ou=Ga,au=Qs,su=Vs,Au="String Iterator",cu=ou.set,lu=ou.getterFor(Au);au(String,"String",(function(e){cu(this,{type:Au,string:iu(e),index:0})}),(function(){var e,t=lu(this),n=t.string,r=t.index;return r>=n.length?su(void 0,!0):(e=ru(n,r),t.index+=e.length,su(e,!1))}));var du=te.Promise,uu=d,hu=lr,pu=pn,fu=Ro,Eu=lt("toStringTag");for(var gu in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var mu=uu[gu],_u=mu&&mu.prototype;_u&&hu(_u)!==Eu&&pu(_u,Eu,gu),fu[gu]=fu.Array}var Cu=du,wu=t(Cu);let Su=Xr;function Tu(e,t){let n=e&&e.navigator;if(!n.mediaDevices)return;let r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;let t={};return Object.keys(e).forEach((n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;let r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);let i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];let e={};"number"==typeof r.ideal?(e[i("min",n)]=r.ideal,t.optional.push(e),e={},e[i("max",n)]=r.ideal,t.optional.push(e)):(e[i("",n)]=r.ideal,t.optional.push(e))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach((e=>{void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){let t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){let o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});let a=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||a)){let t;if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?t=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then((n=>{let a=(n=n.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>{var n;return yr(n=e.label.toLowerCase()).call(n,t)}))));return!a&&n.length&&yr(t).call(t,"back")&&(a=n[n.length-1]),a&&(e.video.deviceId=o.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=r(e.video),Su("chrome: "+JSON.stringify(e)),i(e)}))}e.video=r(e.video)}return Su("chrome: "+JSON.stringify(e)),i(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,r){i(e,(e=>{n.webkitGetUserMedia(e,t,(e=>{r&&r(o(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){let e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return i(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>wu.reject(o(e))))))}}}function vu(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function yu(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.track.id)):{track:n.track};let i=new Event("track");i.track=n.track,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)})),t.stream.getTracks().forEach((n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.id)):{track:n};let i=new Event("track");i.track=n,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Wr(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function Iu(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};let r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);let t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}let n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};let r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach((e=>{let t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Ru(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[e,n,r]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);let i=function(e){let t={};return e.result().forEach((e=>{let n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t[n.id]=n})),t},o=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){let r=function(e){n(o(i(e)))};return t.apply(this,[r,e])}return new wu(((e,n)=>{t.apply(this,[function(t){e(o(i(t)))},n])})).then(n,r)}}function bu(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});let n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){let e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){let e=this;return this._pc.getStats().then((t=>ei(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),Wr(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){let e=this;return this._pc.getStats().then((t=>ei(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let e,t,n,r=arguments[0];return this.getSenders().forEach((t=>{t.track===r&&(e?n=!0:e=t)})),this.getReceivers().forEach((e=>(e.track===r&&(t?n=!0:t=e),e.track===r))),n||e&&t?wu.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):e?e.getStats():t?t.getStats():wu.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Ou(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};let n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));let t=this.getSenders();n.apply(this,arguments);let r=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(r)};let r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};let i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{let n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),i.apply(this,arguments)}}function Bu(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Ou(e);let n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){let n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}r.apply(this,[t])};let i=e.RTCPeerConnection.prototype.removeStream;function o(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{let r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((e=>e.track===t)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let i=this._streams[n.id];if(i)i.addTrack(t),wu.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{let r=new e.MediaStream([t]);this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){let n=e.RTCPeerConnection.prototype[t],r={[t](){let e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{let n=o(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then((e=>o(this,e)))}};e.RTCPeerConnection.prototype[t]=r[t]}));let a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{let r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};let s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){let e=s.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((t=>e.track===t))&&(t=this._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Nu(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){let n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}))}function Du(e,t){Wr(e,"negotiationneeded",(e=>{let n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}var Pu=Object.freeze({__proto__:null,fixNegotiationNeeded:Du,shimAddTrackRemoveTrack:Bu,shimAddTrackRemoveTrackWithNative:Ou,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((t=>{let r=n.video&&n.video.width,i=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:Iu,shimGetStats:Ru,shimGetUserMedia:Tu,shimMediaStream:vu,shimOnTrack:yu,shimPeerConnection:Nu,shimSenderReceiverGetStats:bu});function Uu(e,t){let n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){zr("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){let e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},r&&r.prototype.getSettings){let t=r.prototype.getSettings;r.prototype.getSettings=function(){let n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(r&&r.prototype.applyConstraints){let t=r.prototype.applyConstraints;r.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function Lu(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ku(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){let n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}));let n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[e,i,o]=arguments;return r.apply(this,[e||null]).then((e=>{if(t.version<53&&!i)try{e.forEach((e=>{e.type=n[e.type]||e.type}))}catch(r){if("TypeError"!==r.name)throw r;e.forEach(((t,r)=>{e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(i,o)}}function Mu(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});let n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){let e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):wu.resolve(new Map)}}function Fu(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),Wr(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function xu(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){zr("removeStream","removeTrack"),this.getSenders().forEach((t=>{var n;t.track&&yr(n=e.getTracks()).call(n,t.track)&&this.removeTrack(t)}))})}function Qu(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Vu(e){if("object"!=typeof e||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];let n=e.length>0;n&&e.forEach((e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));let r=t.apply(this,arguments);if(n){let{sender:t}=r,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return r})}function Hu(e){if("object"!=typeof e||!e.RTCRtpSender)return;let t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){let e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function Ku(e){if("object"!=typeof e||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?wu.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function ju(e){if("object"!=typeof e||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?wu.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var Gu=Object.freeze({__proto__:null,shimAddTransceiver:Vu,shimCreateAnswer:ju,shimCreateOffer:Ku,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){let e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,wu.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:Hu,shimGetUserMedia:Uu,shimOnTrack:Lu,shimPeerConnection:ku,shimRTCDataChannel:Qu,shimReceiverGetStats:Fu,shimRemoveStream:xu,shimSenderGetStats:Mu});function Wu(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var n;this._localStreams||(this._localStreams=[]),yr(n=this._localStreams).call(n,e)||this._localStreams.push(e),e.getAudioTracks().forEach((n=>t.call(this,n,e))),e.getVideoTracks().forEach((n=>t.call(this,n,e)))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r&&r.forEach((e=>{var t;this._localStreams?yr(t=this._localStreams).call(t,e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);let t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);let n=e.getTracks();this.getSenders().forEach((e=>{yr(n).call(n,e.track)&&this.removeTrack(e)}))})}}function Yu(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{var t;if(this._remoteStreams||(this._remoteStreams=[]),yr(t=this._remoteStreams).call(t,e))return;this._remoteStreams.push(e);let n=new Event("addstream");n.stream=e,this.dispatchEvent(n)}))})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);let n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}))}),t.apply(e,arguments)}}}function Ju(e){if("object"!=typeof e||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){let r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),wu.resolve()):i},t.createAnswer=function(e,t){let n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),wu.resolve()):i};let s=function(e,t,n){let r=i.apply(this,[e]);return n?(r.then(t,n),wu.resolve()):r};t.setLocalDescription=s,s=function(e,t,n){let r=o.apply(this,[e]);return n?(r.then(t,n),wu.resolve()):r},t.setRemoteDescription=s,s=function(e,t,n){let r=a.apply(this,[e]);return n?(r.then(t,n),wu.resolve()):r},t.addIceCandidate=s}function Xu(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){let e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(zu(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function zu(e){return e&&void 0!==e.video?Object.assign({},e,{video:Zr(e.video)}):e}function qu(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){let t=[];for(let n=0;n<e.iceServers.length;n++){let r=e.iceServers[n];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(zr("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(JSON.stringify(r)),r.urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function Zu(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function $u(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);let t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);let n=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function eh(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var th,nh=Object.freeze({__proto__:null,shimAudioContext:eh,shimCallbacksAPI:Ju,shimConstraints:zu,shimCreateOfferLegacy:$u,shimGetUserMedia:Xu,shimLocalStreamsAPI:Wu,shimRTCIceServerUrls:qu,shimRemoteStreamsAPI:Yu,shimTrackEventTransceiver:Zu}),rh="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",ih=J,oh=hr,ah=rh,sh=A("".replace),Ah=RegExp("^["+ah+"]+"),ch=RegExp("(^|[^"+ah+"])["+ah+"]+$"),lh=function(e){return function(t){var n=oh(ih(t));return 1&e&&(n=sh(n,Ah,"")),2&e&&(n=sh(n,ch,"$1")),n}},dh={start:lh(1),end:lh(2),trim:lh(3)},uh=qa.PROPER,hh=rh,ph=dh.trim;In({target:"String",proto:!0,forced:(th="trim",n((function(){return!!hh[th]()||"\u200b\x85\u180e"!=="\u200b\x85\u180e"[th]()||uh&&hh[th].name!==th})))},{trim:function(){return ph(this)}});var fh=Jn("String").trim,Eh=c,gh=fh,mh=String.prototype,_h=t((function(e){var t=e.trim;return"string"==typeof e||e===mh||Eh(mh,e)&&t===mh.trim?gh:t})),Ch={exports:{}};!function(e){let t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){let n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){let n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((e=>0===e.indexOf(n)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");let n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:void 0===n[t[r]]&&(n[t[r]]=t[r+1])}return n},t.writeCandidate=function(e){let t=[];t.push(e.foundation);let n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);let r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);let n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){let t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){let t,n={},r=e.substring(e.indexOf(" ")+1).split(";");for(let i=0;i<r.length;i++)t=r[i].trim().split("="),n[t[0].trim()]=t[1];return n},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){let r=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){let t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){let t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substring(t+1,r),n.value=e.substring(r+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){let t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){let n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){let t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){let t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;let t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){let r=t.matchPrefix(e+n,"a=ice-ufrag:")[0],i=t.matchPrefix(e+n,"a=ice-pwd:")[0];return r&&i?{usernameFragment:r.substring(12),password:i.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){let n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(e)[0].split(" ");n.profile=r[2];for(let o=3;o<r.length;o++){let i=r[o],a=t.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(a){let r=t.parseRtpMap(a),o=t.matchPrefix(e,"a=fmtp:"+i+" ");switch(r.parameters=o.length?t.parseFmtp(o[0]):{},r.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(t.parseRtcpFb),n.codecs.push(r),r.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(r.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach((e=>{n.headerExtensions.push(t.parseExtmap(e))}));let i=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach((e=>{i.forEach((t=>{e.rtcpFeedback.find((e=>e.type===t.type&&e.parameter===t.parameter))||e.rtcpFeedback.push(t)}))})),n},t.writeRtpDescription=function(e,n){let r="";r+="m="+e+" ",r+=n.codecs.length>0?"9":"0",r+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=n.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((e=>{r+=t.writeRtpMap(e),r+=t.writeFmtp(e),r+=t.writeRtcpFb(e)}));let i=0;return n.codecs.forEach((e=>{e.maxptime>i&&(i=e.maxptime)})),i>0&&(r+="a=maxptime:"+i+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((e=>{r+=t.writeExtmap(e)})),r},t.parseRtpEncodingParameters=function(e){let n,r=[],i=t.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),A=s.length>0&&s[0].ssrc,c=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substring(17).split(" ").map((e=>parseInt(e,10)))));c.length>0&&c[0].length>1&&c[0][0]===A&&(n=c[0][1]),i.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:A,codecPayloadType:parseInt(e.parameters.apt,10)};A&&n&&(t.rtx={ssrc:n}),r.push(t),o&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:A,mechanism:a?"red+ulpfec":"red"},r.push(t))}})),0===r.length&&A&&r.push({ssrc:A});let l=t.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substring(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substring(5),10)*.95-16e3:void 0,r.forEach((e=>{e.maxBitrate=l}))),r},t.parseRtcpParameters=function(e){let n={},r=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);let i=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=i.length>0,n.compound=0===i.length;let o=t.matchPrefix(e,"a=rtcp-mux");return n.mux=o.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n,r=t.matchPrefix(e,"a=msid:");if(1===r.length)return n=r[0].substring(7).split(" "),{stream:n[0],track:n[1]};let i=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return i.length>0?(n=i[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){let n,r=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");i.length>0&&(n=parseInt(i[0].substring(19),10)),isNaN(n)&&(n=65536);let o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:n};let a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){let e=a[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:n}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,r){let i,o=void 0!==n?n:2;return i=e||t.generateSessionId(),"v=0\r\no="+(r||"thisisadapterortc")+" "+i+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){let r=t.splitLines(e);for(let t=0;t<r.length;t++)switch(r[t]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[t].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){let n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){let n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;let n=t.splitLines(e);for(let t=0;t<n.length;t++)if(n[t].length<2||"="!==n[t].charAt(1))return!1;return!0},e.exports=t}(Ch);var wh=Ch.exports,Sh=t(wh),Th=function(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}({__proto__:null,default:Sh},[wh]);function vh(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;let t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){let n=new t(e),r=Sh.parseCandidate(e.candidate),i=Object.assign(n,r);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,Wr(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function yh(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Wr(e,"icecandidate",(e=>{if(e.candidate){let t=Sh.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function Ih(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});let n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){let{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;let t=Sh.splitSections(e.sdp);return t.shift(),t.some((e=>{let t=Sh.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))}(arguments[0])){let e,n=function(e){let t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;let n=parseInt(t[1],10);return n!=n?-1:n}(arguments[0]),r=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n}(n),i=function(e,n){let r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);let i=Sh.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r}(arguments[0],n);e=0===r&&0===i?Number.POSITIVE_INFINITY:0===r||0===i?Math.max(r,i):Math.min(r,i);let o={};Object.defineProperty(o,"maxMessageSize",{get:()=>e}),this._sctp=o}return n.apply(this,arguments)}}function Rh(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){let n=e.send;e.send=function(){let r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}let n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let e=n.apply(this,arguments);return t(e,this),e},Wr(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function bh(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;let t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{let n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{let t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;let n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function Oh(e,t){if(!e.RTCPeerConnection||"chrome"===t.browser&&t.version>=71||"safari"===t.browser&&t.version>=605)return;let n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){let n=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==_h(e).call(e))).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function Bh(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?wu.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),wu.resolve())})}function Nh(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}return e.sdp||"offer"!==e.type&&"answer"!==e.type?n.apply(this,[e]):("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then((e=>n.apply(this,[e])))})}var Dh=Object.freeze({__proto__:null,removeExtmapAllowMixed:Oh,shimAddIceCandidateNullOrEmpty:Bh,shimConnectionState:bh,shimMaxMessageSize:Ih,shimParameterlessSetLocalDescription:Nh,shimRTCIceCandidate:vh,shimRTCIceCandidateRelayProtocol:yh,shimSendThrowTypeError:Rh});!function(){let{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},n=Xr,r=function(e){let t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;let{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=Gr(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=Gr(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=Gr(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),i={browserDetails:r,commonShim:Dh,extractVersion:Gr,disableLog:Yr,disableWarnings:Jr,sdp:Th};switch(r.browser){case"chrome":if(!Pu||!Nu||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(null===r.version)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=Pu,Bh(e,r),Nh(e),Tu(e,r),vu(e),Nu(e,r),yu(e),Bu(e,r),Iu(e),Ru(e),bu(e),Du(e,r),vh(e),yh(e),bh(e),Ih(e,r),Rh(e),Oh(e,r);break;case"firefox":if(!Gu||!ku||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=Gu,Bh(e,r),Nh(e),Uu(e,r),ku(e,r),Lu(e),xu(e),Mu(e),Fu(e),Qu(e),Vu(e),Hu(e),Ku(e),ju(e),vh(e),bh(e),Ih(e,r),Rh(e);break;case"safari":if(!nh||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=nh,Bh(e,r),Nh(e),qu(e),$u(e),Ju(e),Wu(e),Yu(e),Zu(e),Xu(e),eh(e),vh(e),yh(e),Ih(e,r),Rh(e),Oh(e,r);break;default:n("Unsupported browser!")}}({window:typeof window>"u"?void 0:window});var Ph=Jn("Array").keys,Uh=lr,Lh=ze,kh=c,Mh=Ph,Fh=Array.prototype,xh={DOMTokenList:!0,NodeList:!0},Qh=t((function(e){var t=e.keys;return e===Fh||kh(Fh,e)&&t===Fh.keys||Lh(xh,Uh(e))?Mh:t})),Vh=Ie,Hh=TypeError,Kh=_t,jh=Jt,Gh=x,Wh=function(e,t,n){var r=Kh(t);r in e?jh.f(e,r,Gh(0,n)):e[r]=n},Yh=Ln,Jh=Qn,Xh=Wh,zh=Array,qh=Math.max,Zh=function(e,t,n){for(var r=Jh(e),i=Yh(t,r),o=Yh(void 0===n?r:n,r),a=zh(qh(o-i,0)),s=0;i<o;i++,s++)Xh(a,s,e[i]);return a.length=s,a},$h=Zh,ep=Math.floor,tp=function(e,t){var n=e.length,r=ep(n/2);return n<8?np(e,t):rp(e,tp($h(e,0,r),t),tp($h(e,r),t),t)},np=function(e,t){for(var n,r,i=e.length,o=1;o<i;){for(r=o,n=e[o];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==o++&&(e[r]=n)}return e},rp=function(e,t,n,r){for(var i=t.length,o=n.length,a=0,s=0;a<i||s<o;)e[a+s]=a<i&&s<o?r(t[a],n[s])<=0?t[a++]:n[s++]:a<i?t[a++]:n[s++];return e},ip=tp,op=se.match(/firefox\/(\d+)/i),ap=!!op&&+op[1],sp=/MSIE|Trident/.test(se),Ap=se.match(/AppleWebKit\/(\d+)\./),cp=!!Ap&&+Ap[1],lp=In,dp=A,up=Be,hp=Ye,pp=Qn,fp=function(e,t){if(!delete e[t])throw Hh("Cannot delete property "+Vh(t)+" of "+Vh(e))},Ep=hr,gp=n,mp=ip,_p=Ur,Cp=ap,wp=sp,Sp=pe,Tp=cp,vp=[],yp=dp(vp.sort),Ip=dp(vp.push),Rp=gp((function(){vp.sort(void 0)})),bp=gp((function(){vp.sort(null)})),Op=_p("sort"),Bp=!gp((function(){if(Sp)return Sp<70;if(!(Cp&&Cp>3)){if(wp)return!0;if(Tp)return Tp<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)vp.push({k:t+r,v:n})}for(vp.sort((function(e,t){return t.v-e.v})),r=0;r<vp.length;r++)t=vp[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));lp({target:"Array",proto:!0,forced:Rp||!bp||!Op||!Bp},{sort:function(e){void 0!==e&&up(e);var t=hp(this);if(Bp)return void 0===e?yp(t):yp(t,e);var n,r,i=[],o=pp(t);for(r=0;r<o;r++)r in t&&Ip(i,t[r]);for(mp(i,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:Ep(t)>Ep(n)?1:-1}}(e)),n=pp(i),r=0;r<n;)t[r]=i[r++];for(;r<o;)fp(t,r++);return t}});var Np=Jn("Array").sort,Dp=c,Pp=Np,Up=Array.prototype,Lp=t((function(e){var t=e.sort;return e===Up||Dp(Up,e)&&t===Up.sort?Pp:t})),kp={exports:{}};!function(t,n){!function(e,r){var i="function",o="undefined",a="object",s="string",A="major",c="model",l="name",d="type",u="vendor",h="version",p="architecture",f="console",E="mobile",g="tablet",m="smarttv",_="wearable",C="embedded",w="Amazon",S="Apple",T="ASUS",v="BlackBerry",y="Browser",I="Chrome",R="Firefox",b="Google",O="Huawei",B="LG",N="Microsoft",D="Motorola",P="Opera",U="Samsung",L="Sharp",k="Sony",M="Xiaomi",F="Zebra",x="Facebook",Q="Chromium OS",V="Mac OS",H=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].toUpperCase()]=e[n];return t},K=function(e,t){return typeof e===s&&-1!==j(t).indexOf(j(e))},j=function(e){return e.toLowerCase()},G=function(e,t){if(typeof e===s)return e=e.replace(/^\s\s*/,""),typeof t===o?e:e.substring(0,350)},W=function(e,t){for(var n,o,s,A,c,l,d=0;d<t.length&&!c;){var u=t[d],h=t[d+1];for(n=o=0;n<u.length&&!c&&u[n];)if(c=u[n++].exec(e))for(s=0;s<h.length;s++)l=c[++o],typeof(A=h[s])===a&&A.length>0?2===A.length?typeof A[1]==i?this[A[0]]=A[1].call(this,l):this[A[0]]=A[1]:3===A.length?typeof A[1]!==i||A[1].exec&&A[1].test?this[A[0]]=l?l.replace(A[1],A[2]):r:this[A[0]]=l?A[1].call(this,l,A[2]):r:4===A.length&&(this[A[0]]=l?A[3].call(this,l.replace(A[1],A[2])):r):this[A]=l||r;d+=2}},Y=function(e,t){for(var n in t)if(typeof t[n]===a&&t[n].length>0){for(var i=0;i<t[n].length;i++)if(K(t[n][i],e))return"?"===n?r:n}else if(K(t[n],e))return"?"===n?r:n;return e},J={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},X={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[h,[l,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[h,[l,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[l,h],[/opios[\/ ]+([\w\.]+)/i],[h,[l,P+" Mini"]],[/\bopr\/([\w\.]+)/i],[h,[l,P]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[l,h],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[h,[l,"UC"+y]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[h,[l,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[h,[l,"WeChat"]],[/konqueror\/([\w\.]+)/i],[h,[l,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[h,[l,"IE"]],[/yabrowser\/([\w\.]+)/i],[h,[l,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[l,/(.+)/,"$1 Secure "+y],h],[/\bfocus\/([\w\.]+)/i],[h,[l,R+" Focus"]],[/\bopt\/([\w\.]+)/i],[h,[l,P+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[h,[l,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[h,[l,"Dolphin"]],[/coast\/([\w\.]+)/i],[h,[l,P+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[h,[l,"MIUI "+y]],[/fxios\/([-\w\.]+)/i],[h,[l,R]],[/\bqihu|(qi?ho?o?|360)browser/i],[[l,"360 "+y]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[l,/(.+)/,"$1 "+y],h],[/(comodo_dragon)\/([\w\.]+)/i],[[l,/_/g," "],h],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[l,h],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[l],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[l,x],h],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[l,h],[/\bgsa\/([\w\.]+) .*safari\//i],[h,[l,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[h,[l,I+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[l,I+" WebView"],h],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[h,[l,"Android "+y]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[l,h],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[h,[l,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[h,l],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[l,[h,Y,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[l,h],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[l,"Netscape"],h],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[h,[l,R+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[l,h],[/(cobalt)\/([\w\.]+)/i],[l,[h,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[p,"amd64"]],[/(ia32(?=;))/i],[[p,j]],[/((?:i[346]|x)86)[;\)]/i],[[p,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[p,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[p,"armhf"]],[/windows (ce|mobile); ppc;/i],[[p,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[p,/ower/,"",j]],[/(sun4\w)[;\)]/i],[[p,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[p,j]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[c,[u,U],[d,g]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[c,[u,U],[d,E]],[/\((ip(?:hone|od)[\w ]*);/i],[c,[u,S],[d,E]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[c,[u,S],[d,g]],[/(macintosh);/i],[c,[u,S]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[c,[u,L],[d,E]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[c,[u,O],[d,g]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[c,[u,O],[d,E]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[c,/_/g," "],[u,M],[d,E]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[c,/_/g," "],[u,M],[d,g]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[c,[u,"OPPO"],[d,E]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[c,[u,"Vivo"],[d,E]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[c,[u,"Realme"],[d,E]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[c,[u,D],[d,E]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[c,[u,D],[d,g]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[c,[u,B],[d,g]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[c,[u,B],[d,E]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[c,[u,"Lenovo"],[d,g]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[c,/_/g," "],[u,"Nokia"],[d,E]],[/(pixel c)\b/i],[c,[u,b],[d,g]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[c,[u,b],[d,E]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[c,[u,k],[d,E]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[c,"Xperia Tablet"],[u,k],[d,g]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[c,[u,"OnePlus"],[d,E]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[c,[u,w],[d,g]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[c,/(.+)/g,"Fire Phone $1"],[u,w],[d,E]],[/(playbook);[-\w\),; ]+(rim)/i],[c,u,[d,g]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[c,[u,v],[d,E]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[c,[u,T],[d,g]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[c,[u,T],[d,E]],[/(nexus 9)/i],[c,[u,"HTC"],[d,g]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[u,[c,/_/g," "],[d,E]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[c,[u,"Acer"],[d,g]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[c,[u,"Meizu"],[d,E]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[u,c,[d,E]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[u,c,[d,g]],[/(surface duo)/i],[c,[u,N],[d,g]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[c,[u,"Fairphone"],[d,E]],[/(u304aa)/i],[c,[u,"AT&T"],[d,E]],[/\bsie-(\w*)/i],[c,[u,"Siemens"],[d,E]],[/\b(rct\w+) b/i],[c,[u,"RCA"],[d,g]],[/\b(venue[\d ]{2,7}) b/i],[c,[u,"Dell"],[d,g]],[/\b(q(?:mv|ta)\w+) b/i],[c,[u,"Verizon"],[d,g]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[c,[u,"Barnes & Noble"],[d,g]],[/\b(tm\d{3}\w+) b/i],[c,[u,"NuVision"],[d,g]],[/\b(k88) b/i],[c,[u,"ZTE"],[d,g]],[/\b(nx\d{3}j) b/i],[c,[u,"ZTE"],[d,E]],[/\b(gen\d{3}) b.+49h/i],[c,[u,"Swiss"],[d,E]],[/\b(zur\d{3}) b/i],[c,[u,"Swiss"],[d,g]],[/\b((zeki)?tb.*\b) b/i],[c,[u,"Zeki"],[d,g]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[u,"Dragon Touch"],c,[d,g]],[/\b(ns-?\w{0,9}) b/i],[c,[u,"Insignia"],[d,g]],[/\b((nxa|next)-?\w{0,9}) b/i],[c,[u,"NextBook"],[d,g]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[u,"Voice"],c,[d,E]],[/\b(lvtel\-)?(v1[12]) b/i],[[u,"LvTel"],c,[d,E]],[/\b(ph-1) /i],[c,[u,"Essential"],[d,E]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[c,[u,"Envizen"],[d,g]],[/\b(trio[-\w\. ]+) b/i],[c,[u,"MachSpeed"],[d,g]],[/\btu_(1491) b/i],[c,[u,"Rotor"],[d,g]],[/(shield[\w ]+) b/i],[c,[u,"Nvidia"],[d,g]],[/(sprint) (\w+)/i],[u,c,[d,E]],[/(kin\.[onetw]{3})/i],[[c,/\./g," "],[u,N],[d,E]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[c,[u,F],[d,g]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[c,[u,F],[d,E]],[/smart-tv.+(samsung)/i],[u,[d,m]],[/hbbtv.+maple;(\d+)/i],[[c,/^/,"SmartTV"],[u,U],[d,m]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[u,B],[d,m]],[/(apple) ?tv/i],[u,[c,S+" TV"],[d,m]],[/crkey/i],[[c,I+"cast"],[u,b],[d,m]],[/droid.+aft(\w)( bui|\))/i],[c,[u,w],[d,m]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[c,[u,L],[d,m]],[/(bravia[\w ]+)( bui|\))/i],[c,[u,k],[d,m]],[/(mitv-\w{5}) bui/i],[c,[u,M],[d,m]],[/Hbbtv.*(technisat) (.*);/i],[u,c,[d,m]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[u,G],[c,G],[d,m]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[d,m]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[u,c,[d,f]],[/droid.+; (shield) bui/i],[c,[u,"Nvidia"],[d,f]],[/(playstation [345portablevi]+)/i],[c,[u,k],[d,f]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[c,[u,N],[d,f]],[/((pebble))app/i],[u,c,[d,_]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[c,[u,S],[d,_]],[/droid.+; (glass) \d/i],[c,[u,b],[d,_]],[/droid.+; (wt63?0{2,3})\)/i],[c,[u,F],[d,_]],[/(quest( 2| pro)?)/i],[c,[u,x],[d,_]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[u,[d,C]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[c,[d,E]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[c,[d,g]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[d,g]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[d,E]],[/(android[-\w\. ]{0,9});.+buil/i],[c,[u,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[h,[l,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[h,[l,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[l,h],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[h,l]],os:[[/microsoft (windows) (vista|xp)/i],[l,h],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[l,[h,Y,J]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[l,"Windows"],[h,Y,J]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[h,/_/g,"."],[l,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[l,V],[h,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[h,l],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[l,h],[/\(bb(10);/i],[h,[l,v]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[h,[l,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[h,[l,R+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[h,[l,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[h,[l,"watchOS"]],[/crkey\/([\d\.]+)/i],[h,[l,I+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[l,Q],h],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[l,h],[/(sunos) ?([\w\.\d]*)/i],[[l,"Solaris"],h],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[l,h]]},z=function(t,n){if(typeof t===a&&(n=t,t=r),!(this instanceof z))return new z(t,n).getResult();var f=typeof e!==o&&e.navigator?e.navigator:r,m=t||(f&&f.userAgent?f.userAgent:""),_=f&&f.userAgentData?f.userAgentData:r,C=n?function(e,t){var n={};for(var r in e)t[r]&&t[r].length%2==0?n[r]=t[r].concat(e[r]):n[r]=e[r];return n}(X,n):X;return this.getBrowser=function(){var e,t={};return t[l]=r,t[h]=r,W.call(t,m,C.browser),t[A]=typeof(e=t[h])===s?e.replace(/[^\d\.]/g,"").split(".")[0]:r,f&&f.brave&&typeof f.brave.isBrave==i&&(t[l]="Brave"),t},this.getCPU=function(){var e={};return e[p]=r,W.call(e,m,C.cpu),e},this.getDevice=function(){var e={};return e[u]=r,e[c]=r,e[d]=r,W.call(e,m,C.device),!e[d]&&_&&_.mobile&&(e[d]=E),"Macintosh"==e[c]&&f&&typeof f.standalone!==o&&f.maxTouchPoints&&f.maxTouchPoints>2&&(e[c]="iPad",e[d]=g),e},this.getEngine=function(){var e={};return e[l]=r,e[h]=r,W.call(e,m,C.engine),e},this.getOS=function(){var e={};return e[l]=r,e[h]=r,W.call(e,m,C.os),!e[l]&&_&&"Unknown"!=_.platform&&(e[l]=_.platform.replace(/chrome os/i,Q).replace(/macos/i,V)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return m},this.setUA=function(e){return m=typeof e===s&&e.length>350?G(e,350):e,this},this.setUA(m),this};z.VERSION="0.7.34",z.BROWSER=H([l,h,A]),z.CPU=H([p]),z.DEVICE=H([c,u,d,f,E,m,g,_,C]),z.ENGINE=z.OS=H([l,h]),t.exports&&(n=t.exports=z),n.UAParser=z;var q=typeof e!==o&&(e.jQuery||e.Zepto);if(q&&!q.ua){var Z=new z;q.ua=Z.getResult(),q.ua.get=function(){return Z.getUA()},q.ua.set=function(e){Z.setUA(e);var t=Z.getResult();for(var n in t)q.ua[n]=t[n]}}}("object"==typeof window?window:e)}(kp,kp.exports);var Mp=t(kp.exports),Fp=lr,xp=ze,Qp=G,Vp=Ro,Hp=lt("iterator"),Kp=Object,jp=t((function(e){if(Qp(e))return!1;var t=Kp(e);return void 0!==t[Hp]||"@@iterator"in t||xp(Vp,Fp(t))})),Gp=d;In({global:!0,forced:Gp.globalThis!==Gp},{globalThis:Gp});var Wp=t(d);function Yp(e,t){return function(){return e.apply(t,arguments)}}let{toString:Jp}=Object.prototype,{getPrototypeOf:Xp}=Object,zp=(qp=Object.create(null),e=>{let t=Jp.call(e);return qp[t]||(qp[t]=t.slice(8,-1).toLowerCase())});var qp;let Zp=e=>(e=e.toLowerCase(),t=>zp(t)===e),$p=e=>t=>typeof t===e,{isArray:ef}=Array,tf=$p("undefined"),nf=Zp("ArrayBuffer"),rf=$p("string"),of=$p("function"),af=$p("number"),sf=e=>null!==e&&"object"==typeof e,Af=e=>{if("object"!==zp(e))return!1;let t=Xp(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||jp(e))},cf=Zp("Date"),lf=Zp("File"),df=Zp("Blob"),uf=Zp("FileList"),hf=Zp("URLSearchParams");function pf(e,t){let n,r,{allOwnKeys:i=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=e)if("object"!=typeof e&&(e=[e]),ef(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{let r,o=i?Object.getOwnPropertyNames(e):Object.keys(e),a=o.length;for(n=0;n<a;n++)r=o[n],t.call(null,e[r],r,e)}}function ff(e,t){t=t.toLowerCase();let n,r=Object.keys(e),i=r.length;for(;i-- >0;)if(n=r[i],t===n.toLowerCase())return n;return null}let Ef=void 0!==Wp?Wp:typeof self<"u"?self:typeof window<"u"?window:global,gf=e=>!tf(e)&&e!==Ef,mf=(_f=typeof Uint8Array<"u"&&Xp(Uint8Array),e=>_f&&e instanceof _f);var _f;let Cf=Zp("HTMLFormElement"),wf=(e=>{let{hasOwnProperty:t}=e;return(e,n)=>t.call(e,n)})(Object.prototype),Sf=Zp("RegExp"),Tf=(e,t)=>{let n=Object.getOwnPropertyDescriptors(e),r={};pf(n,((n,i)=>{let o;!1!==(o=t(n,i,e))&&(r[i]=o||n)})),Object.defineProperties(e,r)},vf="abcdefghijklmnopqrstuvwxyz",yf="0123456789",If={DIGIT:yf,ALPHA:vf,ALPHA_DIGIT:vf+vf.toUpperCase()+yf},Rf=Zp("AsyncFunction");var bf={isArray:ef,isArrayBuffer:nf,isBuffer:function(e){return null!==e&&!tf(e)&&null!==e.constructor&&!tf(e.constructor)&&of(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||of(e.append)&&("formdata"===(t=zp(e))||"object"===t&&of(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&nf(e.buffer),t},isString:rf,isNumber:af,isBoolean:e=>!0===e||!1===e,isObject:sf,isPlainObject:Af,isUndefined:tf,isDate:cf,isFile:lf,isBlob:df,isRegExp:Sf,isFunction:of,isStream:e=>sf(e)&&of(e.pipe),isURLSearchParams:hf,isTypedArray:mf,isFileList:uf,forEach:pf,merge:function e(){let{caseless:t}=gf(this)&&this||{},n={},r=(r,i)=>{let o=t&&ff(n,i)||i;Af(n[o])&&Af(r)?n[o]=e(n[o],r):Af(r)?n[o]=e({},r):ef(r)?n[o]=r.slice():n[o]=r};for(let i=0,o=arguments.length;i<o;i++)arguments[i]&&pf(arguments[i],r);return n},extend:function(e,t,n){let{allOwnKeys:r}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return pf(t,((t,r)=>{n&&of(t)?e[r]=Yp(t,n):e[r]=t}),{allOwnKeys:r}),e},trim:e=>_h(e)?_h(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let i,o,a,s={};if(t=t||{},null==e)return t;do{for(i=Object.getOwnPropertyNames(e),o=i.length;o-- >0;)a=i[o],r&&!r(a,e,t)||s[a]||(t[a]=e[a],s[a]=!0);e=!1!==n&&Xp(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:zp,kindOfTest:Zp,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;let r=e.indexOf(t,n);return-1!==r&&r===n},toArray:e=>{if(!e)return null;if(ef(e))return e;let t=e.length;if(!af(t))return null;let n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{let n,r=(e&&e[Symbol.iterator]).call(e);for(;(n=r.next())&&!n.done;){let r=n.value;t.call(e,r[0],r[1])}},matchAll:(e,t)=>{let n,r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:Cf,hasOwnProperty:wf,hasOwnProp:wf,reduceDescriptors:Tf,freezeMethods:e=>{Tf(e,((t,n)=>{if(of(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;let r=e[n];of(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:(e,t)=>{let n={},r=e=>{e.forEach((e=>{n[e]=!0}))};return ef(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n})),noop:()=>{},toFiniteNumber:(e,t)=>(e=+e,Number.isFinite(e)?e:t),findKey:ff,global:Ef,isContextDefined:gf,ALPHABET:If,generateString:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:If.ALPHA_DIGIT,n="",{length:r}=t;for(;e--;)n+=t[Math.random()*r|0];return n},isSpecCompliantForm:function(e){return!!(e&&of(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{let t=new Array(10),n=(e,r)=>{if(sf(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[r]=e;let i=ef(e)?[]:{};return pf(e,((e,t)=>{let o=n(e,r+1);!tf(o)&&(i[t]=o)})),t[r]=void 0,i}}return e};return n(e,0)},isAsyncFn:Rf,isThenable:e=>e&&(sf(e)||of(e))&&of(e.then)&&of(e.catch)};function Of(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i)}bf.inherits(Of,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:bf.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});let Bf=Of.prototype,Nf={};function Df(e){return bf.isPlainObject(e)||bf.isArray(e)}function Pf(e){return bf.endsWith(e,"[]")?e.slice(0,-2):e}function Uf(e,t,n){return e?e.concat(t).map((function(e,t){return e=Pf(e),!n&&t?"["+e+"]":e})).join(n?".":""):t}["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{Nf[e]={value:e}})),Object.defineProperties(Of,Nf),Object.defineProperty(Bf,"isAxiosError",{value:!0}),Of.from=(e,t,n,r,i,o)=>{let a=Object.create(Bf);return bf.toFlatObject(e,a,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),Of.call(a,e.message,t,n,r,i),a.cause=e,a.name=e.name,o&&Object.assign(a,o),a};let Lf=bf.toFlatObject(bf,{},null,(function(e){return/^is[A-Z]/.test(e)}));function kf(e,t,n){if(!bf.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;let r=(n=bf.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!bf.isUndefined(t[e])}))).metaTokens,i=n.visitor||c,o=n.dots,a=n.indexes,s=(n.Blob||typeof Blob<"u"&&Blob)&&bf.isSpecCompliantForm(t);if(!bf.isFunction(i))throw new TypeError("visitor must be a function");function A(e){if(null===e)return"";if(bf.isDate(e))return e.toISOString();if(!s&&bf.isBlob(e))throw new Of("Blob is not supported. Use a Buffer instead.");return bf.isArrayBuffer(e)||bf.isTypedArray(e)?s&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,n,i){let s=e;if(e&&!i&&"object"==typeof e)if(bf.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(bf.isArray(e)&&(c=e,bf.isArray(c)&&!c.some(Df))||(bf.isFileList(e)||bf.endsWith(n,"[]"))&&(s=bf.toArray(e)))return n=Pf(n),s.forEach((function(e,r){!bf.isUndefined(e)&&null!==e&&t.append(!0===a?Uf([n],r,o):null===a?n:n+"[]",A(e))})),!1;var c;return!!Df(e)||(t.append(Uf(i,n,o),A(e)),!1)}let l=[],d=Object.assign(Lf,{defaultVisitor:c,convertValue:A,isVisitable:Df});if(!bf.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!bf.isUndefined(n)){if(-1!==l.indexOf(n))throw Error("Circular reference detected in "+r.join("."));l.push(n),bf.forEach(n,(function(n,o){!0===(!(bf.isUndefined(n)||null===n)&&i.call(t,n,bf.isString(o)?_h(o).call(o):o,r,d))&&e(n,r?r.concat(o):[o])})),l.pop()}}(e),t}function Mf(e){let t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function Ff(e,t){this._pairs=[],e&&kf(e,this,t)}let xf=Ff.prototype;function Qf(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Vf(e,t,n){if(!t)return e;let r,i=n&&n.encode||Qf,o=n&&n.serialize;if(r=o?o(t,n):bf.isURLSearchParams(t)?t.toString():new Ff(t,n).toString(i),r){let t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+r}return e}xf.append=function(e,t){this._pairs.push([e,t])},xf.toString=function(e){let t=e?function(t){return e.call(this,t,Mf)}:Mf;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};var Hf=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){bf.forEach(this.handlers,(function(t){null!==t&&e(t)}))}},Kf={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},jf={exports:{}},Gf=In,Wf=O,Yf=Jt.f;Gf({target:"Object",stat:!0,forced:Object.defineProperty!==Yf,sham:!Wf},{defineProperty:Yf});var Jf=te.Object,Xf=jf.exports=function(e,t,n){return Jf.defineProperty(e,t,n)};Jf.defineProperty.sham&&(Xf.sham=!0);var zf=t(jf.exports),qf=C,Zf=Array.isArray||function(e){return"Array"==qf(e)},$f=TypeError,eE=Zf,tE=IA,nE=ee,rE=lt("species"),iE=Array,oE=function(e,t){return new(function(e){var t;return eE(e)&&(t=e.constructor,(tE(t)&&(t===iE||eE(t.prototype))||nE(t)&&null===(t=t[rE]))&&(t=void 0)),void 0===t?iE:t}(e))(0===t?0:t)},aE=n,sE=pe,AE=lt("species"),cE=function(e){return sE>=51||!aE((function(){var t=[];return(t.constructor={})[AE]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},lE=In,dE=n,uE=Zf,hE=ee,pE=Ye,fE=Qn,EE=function(e){if(e>9007199254740991)throw $f("Maximum allowed index exceeded");return e},gE=Wh,mE=oE,_E=cE,CE=pe,wE=lt("isConcatSpreadable"),SE=CE>=51||!dE((function(){var e=[];return e[wE]=!1,e.concat()[0]!==e})),TE=function(e){if(!hE(e))return!1;var t=e[wE];return void 0!==t?!!t:uE(e)};lE({target:"Array",proto:!0,arity:1,forced:!SE||!_E("concat")},{concat:function(e){var t,n,r,i,o,a=pE(this),s=mE(a,0),A=0;for(t=-1,r=arguments.length;t<r;t++)if(TE(o=-1===t?a:arguments[t]))for(i=fE(o),EE(A+i),n=0;n<i;n++,A++)n in o&&gE(s,A,o[n]);else EE(A+1),gE(s,A++,o);return s.length=A,s}});var vE={},yE=C,IE=q,RE=Ci.f,bE=Zh,OE="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];vE.f=function(e){return OE&&"Window"==yE(e)?function(e){try{return RE(e)}catch{return bE(OE)}}(e):RE(IE(e))};var BE={},NE=lt;BE.f=NE;var DE=te,PE=ze,UE=BE,LE=Jt.f,kE=function(e){var t=DE.Symbol||(DE.Symbol={});PE(t,e)||LE(t,e,{value:UE.f(e)})},ME=D,FE=ae,xE=lt,QE=$a,VE=function(){var e=FE("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,r=xE("toPrimitive");t&&!t[r]&&QE(t,r,(function(e){return ME(n,this)}),{arity:1})},HE=Yt,KE=j,jE=Ye,GE=Qn,WE=oE,YE=A([].push),JE=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,o=6==e,a=7==e,s=5==e||o;return function(A,c,l,d){for(var u,h,p=jE(A),f=KE(p),E=HE(c,l),g=GE(f),m=0,_=d||WE,C=t?_(A,g):n||a?_(A,0):void 0;g>m;m++)if((s||m in f)&&(h=E(u=f[m],m,p),e))if(t)C[m]=h;else if(h)switch(e){case 3:return!0;case 5:return u;case 6:return m;case 2:YE(C,u)}else switch(e){case 4:return!1;case 7:YE(C,u)}return o?-1:r||i?i:C}},XE={forEach:JE(0),map:JE(1),filter:JE(2),some:JE(3),every:JE(4),find:JE(5),findIndex:JE(6),filterReject:JE(7)},zE=In,qE=d,ZE=D,$E=A,eg=O,tg=me,ng=n,rg=ze,ig=c,og=$t,ag=q,sg=_t,Ag=hr,cg=x,lg=po,dg=Gi,ug=Ci,hg=vE,pg=Ni,fg=b,Eg=Jt,gg=Hi,mg=P,_g=$a,Cg=qs,wg=je,Sg=wi,Tg=tt,vg=lt,yg=BE,Ig=kE,Rg=VE,bg=ms,Og=Ga,Bg=XE.forEach,Ng=ri("hidden"),Dg="Symbol",Pg="prototype",Ug=Og.set,Lg=Og.getterFor(Dg),kg=Object[Pg],Mg=qE.Symbol,Fg=Mg&&Mg[Pg],xg=qE.TypeError,Qg=qE.QObject,Vg=fg.f,Hg=Eg.f,Kg=hg.f,jg=mg.f,Gg=$E([].push),Wg=wg("symbols"),Yg=wg("op-symbols"),Jg=wg("wks"),Xg=!Qg||!Qg[Pg]||!Qg[Pg].findChild,zg=eg&&ng((function(){return 7!=lg(Hg({},"a",{get:function(){return Hg(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=Vg(kg,t);r&&delete kg[t],Hg(e,t,n),r&&e!==kg&&Hg(kg,t,r)}:Hg,qg=function(e,t){var n=Wg[e]=lg(Fg);return Ug(n,{type:Dg,tag:e,description:t}),eg||(n.description=t),n},Zg=function(e,t,n){e===kg&&Zg(Yg,t,n),og(e);var r=sg(t);return og(n),rg(Wg,r)?(n.enumerable?(rg(e,Ng)&&e[Ng][r]&&(e[Ng][r]=!1),n=lg(n,{enumerable:cg(0,!1)})):(rg(e,Ng)||Hg(e,Ng,cg(1,{})),e[Ng][r]=!0),zg(e,r,n)):Hg(e,r,n)},$g=function(e,t){og(e);var n=ag(t),r=dg(n).concat(rm(n));return Bg(r,(function(t){eg&&!ZE(em,n,t)||Zg(e,t,n[t])})),e},em=function(e){var t=sg(e),n=ZE(jg,this,t);return!(this===kg&&rg(Wg,t)&&!rg(Yg,t))&&(!(n||!rg(this,t)||!rg(Wg,t)||rg(this,Ng)&&this[Ng][t])||n)},tm=function(e,t){var n=ag(e),r=sg(t);if(n!==kg||!rg(Wg,r)||rg(Yg,r)){var i=Vg(n,r);return!i||!rg(Wg,r)||rg(n,Ng)&&n[Ng][r]||(i.enumerable=!0),i}},nm=function(e){var t=Kg(ag(e)),n=[];return Bg(t,(function(e){rg(Wg,e)||rg(Sg,e)||Gg(n,e)})),n},rm=function(e){var t=e===kg,n=Kg(t?Yg:ag(e)),r=[];return Bg(n,(function(e){!rg(Wg,e)||t&&!rg(kg,e)||Gg(r,Wg[e])})),r};tg||(Mg=function(){if(ig(Fg,this))throw xg("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?Ag(arguments[0]):void 0,t=Tg(e),n=function(e){this===kg&&ZE(n,Yg,e),rg(this,Ng)&&rg(this[Ng],t)&&(this[Ng][t]=!1),zg(this,t,cg(1,e))};return eg&&Xg&&zg(kg,t,{configurable:!0,set:n}),qg(t,e)},_g(Fg=Mg[Pg],"toString",(function(){return Lg(this).tag})),_g(Mg,"withoutSetter",(function(e){return qg(Tg(e),e)})),mg.f=em,Eg.f=Zg,gg.f=$g,fg.f=tm,ug.f=hg.f=nm,pg.f=rm,yg.f=function(e){return qg(vg(e),e)},eg&&Cg(Fg,"description",{configurable:!0,get:function(){return Lg(this).description}})),zE({global:!0,constructor:!0,wrap:!0,forced:!tg,sham:!tg},{Symbol:Mg}),Bg(dg(Jg),(function(e){Ig(e)})),zE({target:Dg,stat:!0,forced:!tg},{useSetter:function(){Xg=!0},useSimple:function(){Xg=!1}}),zE({target:"Object",stat:!0,forced:!tg,sham:!eg},{create:function(e,t){return void 0===t?lg(e):$g(lg(e),t)},defineProperty:Zg,defineProperties:$g,getOwnPropertyDescriptor:tm}),zE({target:"Object",stat:!0,forced:!tg},{getOwnPropertyNames:nm}),Rg(),bg(Mg,Dg),Sg[Ng]=!0;var im=me&&!!Symbol.for&&!!Symbol.keyFor,om=In,am=ae,sm=ze,Am=hr,cm=je,lm=im,dm=cm("string-to-symbol-registry"),um=cm("symbol-to-string-registry");om({target:"Symbol",stat:!0,forced:!lm},{for:function(e){var t=Am(e);if(sm(dm,t))return dm[t];var n=am("Symbol")(t);return dm[t]=n,um[n]=t,n}});var hm=In,pm=ze,fm=ve,Em=Ie,gm=im,mm=je("symbol-to-string-registry");hm({target:"Symbol",stat:!0,forced:!gm},{keyFor:function(e){if(!fm(e))throw TypeError(Em(e)+" is not a symbol");if(pm(mm,e))return mm[e]}});var _m=Zf,Cm=R,wm=C,Sm=hr,Tm=A([].push),vm=In,ym=ae,Im=E,Rm=D,bm=A,Om=n,Bm=R,Nm=ve,Dm=UA,Pm=me,Um=String,Lm=ym("JSON","stringify"),km=bm(/./.exec),Mm=bm("".charAt),Fm=bm("".charCodeAt),xm=bm("".replace),Qm=bm(1..toString),Vm=/[\uD800-\uDFFF]/g,Hm=/^[\uD800-\uDBFF]$/,Km=/^[\uDC00-\uDFFF]$/,jm=!Pm||Om((function(){var e=ym("Symbol")();return"[null]"!=Lm([e])||"{}"!=Lm({a:e})||"{}"!=Lm(Object(e))})),Gm=Om((function(){return'"\\udf06\\ud834"'!==Lm("\udf06\ud834")||'"\\udead"'!==Lm("\udead")})),Wm=function(e,t){var n=Dm(arguments),r=function(e){if(Cm(e))return e;if(_m(e)){for(var t=e.length,n=[],r=0;r<t;r++){var i=e[r];"string"==typeof i?Tm(n,i):"number"!=typeof i&&"Number"!=wm(i)&&"String"!=wm(i)||Tm(n,Sm(i))}var o=n.length,a=!0;return function(e,t){if(a)return a=!1,t;if(_m(this))return t;for(var r=0;r<o;r++)if(n[r]===e)return t}}}(t);if(Bm(r)||void 0!==e&&!Nm(e))return n[1]=function(e,t){if(Bm(r)&&(t=Rm(r,this,Um(e),t)),!Nm(t))return t},Im(Lm,null,n)},Ym=function(e,t,n){var r=Mm(n,t-1),i=Mm(n,t+1);return km(Hm,e)&&!km(Km,i)||km(Km,e)&&!km(Hm,r)?"\\u"+Qm(Fm(e,0),16):e};Lm&&vm({target:"JSON",stat:!0,arity:3,forced:jm||Gm},{stringify:function(e,t,n){var r=Dm(arguments),i=Im(jm?Wm:Lm,null,r);return Gm&&"string"==typeof i?xm(i,Vm,Ym):i}});var Jm=Ni,Xm=Ye;In({target:"Object",stat:!0,forced:!me||n((function(){Jm.f(1)}))},{getOwnPropertySymbols:function(e){var t=Jm.f;return t?t(Xm(e)):[]}}),kE("asyncIterator"),kE("hasInstance"),kE("isConcatSpreadable"),kE("iterator"),kE("match"),kE("matchAll"),kE("replace"),kE("search"),kE("species"),kE("split");var zm=VE;kE("toPrimitive"),zm();var qm=ae,Zm=ms;kE("toStringTag"),Zm(qm("Symbol"),"Symbol"),kE("unscopables"),ms(d.JSON,"JSON",!0);var $m=te.Symbol,e_=lt,t_=Jt.f,n_=e_("metadata"),r_=Function.prototype;void 0===r_[n_]&&t_(r_,n_,{value:null}),kE("dispose"),kE("metadata");var i_=$m;kE("asyncDispose");var o_=A,a_=ae("Symbol"),s_=a_.keyFor,A_=o_(a_.prototype.valueOf),c_=a_.isRegisteredSymbol||function(e){try{return void 0!==s_(A_(e))}catch{return!1}};In({target:"Symbol",stat:!0},{isRegisteredSymbol:c_});for(var l_=je,d_=ae,u_=A,h_=ve,p_=lt,f_=d_("Symbol"),E_=f_.isWellKnownSymbol,g_=d_("Object","getOwnPropertyNames"),m_=u_(f_.prototype.valueOf),__=l_("wks"),C_=0,w_=g_(f_),S_=w_.length;C_<S_;C_++)try{var T_=w_[C_];h_(f_[T_])&&p_(T_)}catch{}var v_=function(e){if(E_&&E_(e))return!0;try{for(var t=m_(e),n=0,r=g_(__),i=r.length;n<i;n++)if(__[r[n]]==t)return!0}catch{}return!1};In({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:v_}),kE("matcher"),kE("observable"),In({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:c_}),In({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:v_}),kE("metadataKey"),kE("patternMatch"),kE("replaceAll");var y_=t(i_),I_=t(BE.f("iterator"));function R_(e){return(R_="function"==typeof y_&&"symbol"==typeof I_?function(e){return typeof e}:function(e){return e&&"function"==typeof y_&&e.constructor===y_&&e!==y_.prototype?"symbol":typeof e})(e)}var b_=t(BE.f("toPrimitive"));function O_(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==R_(e)||null===e)return e;var n=e[b_];if(void 0!==n){var r=n.call(e,"string");if("object"!==R_(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===R_(t)?t:String(t)}(t))in e?zf(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var B_=n,N_=lt("iterator"),D_=!B_((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2"),r="";return e.pathname="c%20d",t.forEach((function(e,n){t.delete("b"),r+=n+e})),n.delete("a",2),!e.toJSON||!n.has("a",1)||n.has("a",2)||!t.size&&!0||!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[N_]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://\u0442\u0435\u0441\u0442").host||"#%D0%B1"!==new URL("http://a#\u0431").hash||"a1c3"!==r||"x"!==new URL("http://x",void 0).host})),P_=$a,U_=In,L_=d,k_=D,M_=A,F_=O,x_=D_,Q_=$a,V_=qs,H_=ms,K_=ys,j_=Ga,G_=iA,W_=R,Y_=ze,J_=Yt,X_=lr,z_=$t,q_=ee,Z_=hr,$_=po,eC=x,tC=jo,nC=Mo,rC=kA,iC=ip,oC=lt("iterator"),aC="URLSearchParams",sC=aC+"Iterator",AC=j_.set,cC=j_.getterFor(aC),lC=j_.getterFor(sC),dC=Object.getOwnPropertyDescriptor,uC=function(e){if(!F_)return L_[e];var t=dC(L_,e);return t&&t.value},hC=uC("fetch"),pC=uC("Request"),fC=uC("Headers"),EC=pC&&pC.prototype,gC=fC&&fC.prototype,mC=L_.RegExp,_C=L_.TypeError,CC=L_.decodeURIComponent,wC=L_.encodeURIComponent,SC=M_("".charAt),TC=M_([].join),vC=M_([].push),yC=M_("".replace),IC=M_([].shift),RC=M_([].splice),bC=M_("".split),OC=M_("".slice),BC=/\+/g,NC=Array(4),DC=function(e){return NC[e-1]||(NC[e-1]=mC("((?:%[\\da-f]{2}){"+e+"})","gi"))},PC=function(e){try{return CC(e)}catch{return e}},UC=function(e){var t=yC(e,BC," "),n=4;try{return CC(t)}catch{for(;n;)t=yC(t,DC(n--),PC);return t}},LC=/[!'()~]|%20/g,kC={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},MC=function(e){return kC[e]},FC=function(e){return yC(wC(e),LC,MC)},xC=K_((function(e,t){AC(this,{type:sC,iterator:tC(cC(e).entries),kind:t})}),"Iterator",(function(){var e=lC(this),t=e.kind,n=e.iterator.next(),r=n.value;return n.done||(n.value="keys"===t?r.key:"values"===t?r.value:[r.key,r.value]),n}),!0),QC=function(e){this.entries=[],this.url=null,void 0!==e&&(q_(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===SC(e,0)?OC(e,1):e:Z_(e)))};QC.prototype={type:aC,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,r,i,o,a,s,A=nC(e);if(A)for(n=(t=tC(e,A)).next;!(r=k_(n,t)).done;){if(o=(i=tC(z_(r.value))).next,(a=k_(o,i)).done||(s=k_(o,i)).done||!k_(o,i).done)throw _C("Expected sequence with length 2");vC(this.entries,{key:Z_(a.value),value:Z_(s.value)})}else for(var c in e)Y_(e,c)&&vC(this.entries,{key:c,value:Z_(e[c])})},parseQuery:function(e){if(e)for(var t,n,r=bC(e,"&"),i=0;i<r.length;)(t=r[i++]).length&&(n=bC(t,"="),vC(this.entries,{key:UC(IC(n)),value:UC(TC(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],r=0;r<t.length;)e=t[r++],vC(n,FC(e.key)+"="+FC(e.value));return TC(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var VC=function(){G_(this,HC);var e=AC(this,new QC(arguments.length>0?arguments[0]:void 0));F_||(this.size=e.entries.length)},HC=VC.prototype;if(function(e,t,n){for(var r in t)n&&n.unsafe&&e[r]?e[r]=t[r]:P_(e,r,t[r],n)}(HC,{append:function(e,t){var n=cC(this);rC(arguments.length,2),vC(n.entries,{key:Z_(e),value:Z_(t)}),F_||this.length++,n.updateURL()},delete:function(e){for(var t=cC(this),n=rC(arguments.length,1),r=t.entries,i=Z_(e),o=n<2?void 0:arguments[1],a=void 0===o?o:Z_(o),s=0;s<r.length;){var A=r[s];if(A.key!==i||void 0!==a&&A.value!==a)s++;else if(RC(r,s,1),void 0!==a)break}F_||(this.size=r.length),t.updateURL()},get:function(e){var t=cC(this).entries;rC(arguments.length,1);for(var n=Z_(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){var t=cC(this).entries;rC(arguments.length,1);for(var n=Z_(e),r=[],i=0;i<t.length;i++)t[i].key===n&&vC(r,t[i].value);return r},has:function(e){for(var t=cC(this).entries,n=rC(arguments.length,1),r=Z_(e),i=n<2?void 0:arguments[1],o=void 0===i?i:Z_(i),a=0;a<t.length;){var s=t[a++];if(s.key===r&&(void 0===o||s.value===o))return!0}return!1},set:function(e,t){var n=cC(this);rC(arguments.length,1);for(var r,i=n.entries,o=!1,a=Z_(e),s=Z_(t),A=0;A<i.length;A++)(r=i[A]).key===a&&(o?RC(i,A--,1):(o=!0,r.value=s));o||vC(i,{key:a,value:s}),F_||(this.size=i.length),n.updateURL()},sort:function(){var e=cC(this);iC(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,n=cC(this).entries,r=J_(e,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new xC(this,"keys")},values:function(){return new xC(this,"values")},entries:function(){return new xC(this,"entries")}},{enumerable:!0}),Q_(HC,oC,HC.entries,{name:"entries"}),Q_(HC,"toString",(function(){return cC(this).serialize()}),{enumerable:!0}),F_&&V_(HC,"size",{get:function(){return cC(this).entries.length},configurable:!0,enumerable:!0}),H_(VC,aC),U_({global:!0,constructor:!0,forced:!x_},{URLSearchParams:VC}),!x_&&W_(fC)){var KC=M_(gC.has),jC=M_(gC.set),GC=function(e){if(q_(e)){var t,n=e.body;if(X_(n)===aC)return t=e.headers?new fC(e.headers):new fC,KC(t,"content-type")||jC(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),$_(e,{body:eC(0,Z_(n)),headers:eC(0,t)})}return e};if(W_(hC)&&U_({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return hC(e,arguments.length>1?GC(arguments[1]):{})}}),W_(pC)){var WC=function(e){return G_(this,EC),new pC(e,arguments.length>1?GC(arguments[1]):{})};EC.constructor=WC,WC.prototype=EC,U_({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:WC})}}var YC={URLSearchParams:VC,getState:cC},JC=t(te.URLSearchParams),XC={isBrowser:!0,classes:{URLSearchParams:void 0!==JC?JC:Ff,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};let zC=typeof window<"u"&&typeof document<"u",qC=(ZC=typeof navigator<"u"&&navigator.product,zC&&["ReactNative","NativeScript","NS"].indexOf(ZC)<0);var ZC;let $C=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts;function ew(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function tw(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ew(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ew(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var nw=tw(tw({},Object.freeze({__proto__:null,hasBrowserEnv:zC,hasStandardBrowserEnv:qC,hasStandardBrowserWebWorkerEnv:$C})),XC),rw=$t,iw=D,ow=ze,aw=c,sw=function(){var e=rw(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},Aw=RegExp.prototype,cw=function(e){var t=e.flags;return void 0!==t||"flags"in Aw||ow(e,"flags")||!aw(Aw,e)?t:iw(sw,e)},lw=nu.charAt,dw=D,uw=$t,hw=R,pw=C,fw=/./.exec,Ew=TypeError,gw=In,mw=D,_w=T,Cw=ys,ww=Vs,Sw=J,Tw=Fn,vw=hr,yw=$t,Iw=G,Rw=C,bw=$n,Ow=cw,Bw=Pe,Nw=n,Dw=PA,Pw=Ga,Uw=lt("matchAll"),Lw="RegExp String",kw=Lw+" Iterator",Mw=Pw.set,Fw=Pw.getterFor(kw),xw=TypeError,Qw=_w("".indexOf),Vw=_w("".matchAll),Hw=!!Vw&&!Nw((function(){Vw("a",/./)})),Kw=Cw((function(e,t,n,r){Mw(this,{type:kw,regexp:e,string:t,global:n,unicode:r,done:!1})}),Lw,(function(){var e=Fw(this);if(e.done)return ww(void 0,!0);var t=e.regexp,n=e.string,r=function(e,t){var n=e.exec;if(hw(n)){var r=dw(n,e,t);return null!==r&&uw(r),r}if("RegExp"===pw(e))return dw(fw,e,t);throw Ew("RegExp#exec called on incompatible receiver")}(t,n);return null===r?(e.done=!0,ww(void 0,!0)):e.global?(""===vw(r[0])&&(t.lastIndex=function(e,t,n){return t+(n?lw(e,t).length:1)}(n,Tw(t.lastIndex),e.unicode)),ww(r,!1)):(e.done=!0,ww(r,!1))})),jw=function(e){var t,n,r,i=yw(this),o=vw(e),a=Dw(i,RegExp),s=vw(Ow(i));return t=new a(a===RegExp?i.source:i,s),n=!!~Qw(s,"g"),r=!!~Qw(s,"u"),t.lastIndex=Tw(i.lastIndex),new Kw(t,o,n,r)};gw({target:"String",proto:!0,forced:Hw},{matchAll:function(e){var t,n,r,i,o=Sw(this);if(Iw(e)){if(Hw)return Vw(o,e)}else{if(bw(e)&&(t=vw(Sw(Ow(e))),!~Qw(t,"g")))throw xw("`.matchAll` does not allow non-global regexes");if(Hw)return Vw(o,e);if(void 0===(r=Bw(e,Uw))&&"RegExp"==Rw(e)&&(r=jw),r)return mw(r,e,o)}return n=vw(o),i=new RegExp(e,"g"),mw(jw,i,n)}});var Gw=Jn("String").matchAll,Ww=c,Yw=Gw,Jw=String.prototype,Xw=t((function(e){var t=e.matchAll;return"string"==typeof e||e===Jw||Ww(Jw,e)&&t===Jw.matchAll?Yw:t}));function zw(e){function t(e,n,r,i){let o=e[i++];if("__proto__"===o)return!0;let a=Number.isFinite(+o),s=i>=e.length;return o=!o&&bf.isArray(r)?r.length:o,s?(bf.hasOwnProp(r,o)?r[o]=[r[o],n]:r[o]=n,!a):(r[o]&&bf.isObject(r[o])||(r[o]=[]),t(e,n,r[o],i)&&bf.isArray(r[o])&&(r[o]=function(e){let t,n,r={},i=Object.keys(e),o=i.length;for(t=0;t<o;t++)n=i[t],r[n]=e[n];return r}(r[o])),!a)}if(bf.isFormData(e)&&bf.isFunction(e.entries)){let n={};return bf.forEachEntry(e,((e,r)=>{var i;t((i=e,Xw(bf).call(bf,/\w+|\[(\w*)]/g,i).map((e=>"[]"===e[0]?"":e[1]||e[0]))),r,n,0)})),n}return null}let qw={transitional:Kf,adapter:["xhr","http"],transformRequest:[function(e,t){let n,r=t.getContentType()||"",i=r.indexOf("application/json")>-1,o=bf.isObject(e);if(o&&bf.isHTMLForm(e)&&(e=new FormData(e)),bf.isFormData(e))return i?JSON.stringify(zw(e)):e;if(bf.isArrayBuffer(e)||bf.isBuffer(e)||bf.isStream(e)||bf.isFile(e)||bf.isBlob(e))return e;if(bf.isArrayBufferView(e))return e.buffer;if(bf.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();if(o){if(r.indexOf("application/x-www-form-urlencoded")>-1)return(a=e,s=this.formSerializer,kf(a,new nw.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,r){return nw.isNode&&bf.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},s))).toString();if((n=bf.isFileList(e))||r.indexOf("multipart/form-data")>-1){let t=this.env&&this.env.FormData;return kf(n?{"files[]":e}:e,t&&new t,this.formSerializer)}}var a,s;return o||i?(t.setContentType("application/json",!1),function(e,t,n){if(bf.isString(e))try{return(0,JSON.parse)(e),_h(bf).call(bf,e)}catch(r){if("SyntaxError"!==r.name)throw r}return(0,JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){let t=this.transitional||qw.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(e&&bf.isString(e)&&(n&&!this.responseType||r)){let n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(i){if(n)throw"SyntaxError"===i.name?Of.from(i,Of.ERR_BAD_RESPONSE,this,null,this.response):i}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:nw.classes.FormData,Blob:nw.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};bf.forEach(["delete","get","head","post","put","patch"],(e=>{qw.headers[e]={}}));var Zw=qw;let $w=bf.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),eS=Symbol("internals");function tS(e){var t;return e&&_h(t=String(e)).call(t).toLowerCase()}function nS(e){return!1===e||null==e?e:bf.isArray(e)?e.map(nS):String(e)}function rS(e,t,n,r,i){return bf.isFunction(r)?r.call(this,t,n):(i&&(t=n),bf.isString(t)?bf.isString(r)?-1!==t.indexOf(r):bf.isRegExp(r)?r.test(t):void 0:void 0)}class iS{constructor(e){e&&this.set(e)}set(e,t,n){let r=this;function i(e,t,n){let i=tS(t);if(!i)throw new Error("header name must be a non-empty string");let o=bf.findKey(r,i);(!o||void 0===r[o]||!0===n||void 0===n&&!1!==r[o])&&(r[o||t]=nS(e))}let o=(e,t)=>bf.forEach(e,((e,n)=>i(e,n,t)));var a;return bf.isPlainObject(e)||e instanceof this.constructor?o(e,t):bf.isString(e)&&(e=_h(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(_h(a=e).call(a))?o((e=>{let t,n,r,i={};return e&&e.split("\n").forEach((function(e){var o,a;r=e.indexOf(":"),t=_h(o=e.substring(0,r)).call(o).toLowerCase(),n=_h(a=e.substring(r+1)).call(a),!t||i[t]&&$w[t]||("set-cookie"===t?i[t]?i[t].push(n):i[t]=[n]:i[t]=i[t]?i[t]+", "+n:n)})),i})(e),t):null!=e&&i(t,e,n),this}get(e,t){if(e=tS(e)){let n=bf.findKey(this,e);if(n){let e=this[n];if(!t)return e;if(!0===t)return function(e){let t,n=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;for(;t=r.exec(e);)n[t[1]]=t[2];return n}(e);if(bf.isFunction(t))return t.call(this,e,n);if(bf.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=tS(e)){let n=bf.findKey(this,e);return!(!n||void 0===this[n]||t&&!rS(0,this[n],n,t))}return!1}delete(e,t){let n=this,r=!1;function i(e){if(e=tS(e)){let i=bf.findKey(n,e);!i||t&&!rS(0,n[i],i,t)||(delete n[i],r=!0)}}return bf.isArray(e)?e.forEach(i):i(e),r}clear(e){let t=Object.keys(this),n=t.length,r=!1;for(;n--;){let i=t[n];e&&!rS(0,this[i],i,e,!0)||(delete this[i],r=!0)}return r}normalize(e){let t=this,n={};return bf.forEach(this,((r,i)=>{var o;let a=bf.findKey(n,i);if(a)return t[a]=nS(r),void delete t[i];let s=e?_h(A=i).call(A).toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,n)=>t.toUpperCase()+n)):_h(o=String(i)).call(o);var A;s!==i&&delete t[i],t[s]=nS(r),n[s]=!0})),this}concat(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.constructor.concat(this,...t)}toJSON(e){let t=Object.create(null);return bf.forEach(this,((n,r)=>{null!=n&&!1!==n&&(t[r]=e&&bf.isArray(n)?n.join(", "):n)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((e=>{let[t,n]=e;return t+": "+n})).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){let t=new this(e);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r.forEach((e=>t.set(e))),t}static accessor(e){let t=(this[eS]=this[eS]={accessors:{}}).accessors,n=this.prototype;function r(e){let r=tS(e);t[r]||(function(e,t){let n=bf.toCamelCase(" "+t);["get","set","has"].forEach((r=>{Object.defineProperty(e,r+n,{value:function(e,n,i){return this[r].call(this,t,e,n,i)},configurable:!0})}))}(n,e),t[r]=!0)}return bf.isArray(e)?e.forEach(r):r(e),this}}iS.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),bf.reduceDescriptors(iS.prototype,((e,t)=>{let{value:n}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(e){this[r]=e}}})),bf.freezeMethods(iS);var oS=iS;function aS(e,t){let n=this||Zw,r=t||n,i=oS.from(r.headers),o=r.data;return bf.forEach(e,(function(e){o=e.call(n,o,i.normalize(),t?t.status:void 0)})),i.normalize(),o}function sS(e){return!(!e||!e.__CANCEL__)}function AS(e,t,n){Of.call(this,null!==e&&void 0!==e?e:"canceled",Of.ERR_CANCELED,t,n),this.name="CanceledError"}bf.inherits(AS,Of,{__CANCEL__:!0});var cS=nw.hasStandardBrowserEnv?{write(e,t,n,r,i,o){let a=[e+"="+encodeURIComponent(t)];bf.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),bf.isString(r)&&a.push("path="+r),bf.isString(i)&&a.push("domain="+i),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read(e){let t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function lS(e,t){return e&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}var dS=nw.hasStandardBrowserEnv?function(){let e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function r(e){let r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=r(window.location.href),function(t){let n=bf.isString(t)?r(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0};function uS(e,t){let n=0,r=function(e,t){e=e||10;let n,r=new Array(e),i=new Array(e),o=0,a=0;return t=void 0!==t?t:1e3,function(s){let A=Date.now(),c=i[a];n||(n=A),r[o]=s,i[o]=A;let l=a,d=0;for(;l!==o;)d+=r[l++],l%=e;if(o=(o+1)%e,o===a&&(a=(a+1)%e),A-n<t)return;let u=c&&A-c;return u?Math.round(1e3*d/u):void 0}}(50,250);return i=>{let o=i.loaded,a=i.lengthComputable?i.total:void 0,s=o-n,A=r(s);n=o;let c={loaded:o,total:a,progress:a?o/a:void 0,bytes:s,rate:A||void 0,estimated:A&&a&&o<=a?(a-o)/A:void 0,event:i};c[t?"download":"upload"]=!0,e(c)}}var hS=typeof XMLHttpRequest<"u"&&function(e){return new wu((function(t,n){let r,i,o=e.data,a=oS.from(e.headers).normalize(),{responseType:s,withXSRFToken:A}=e;function c(){e.cancelToken&&e.cancelToken.unsubscribe(r),e.signal&&e.signal.removeEventListener("abort",r)}if(bf.isFormData(o))if(nw.hasStandardBrowserEnv||nw.hasStandardBrowserWebWorkerEnv)a.setContentType(!1);else if(!1!==(i=a.getContentType())){let[e,...t]=i?i.split(";").map((e=>_h(e).call(e))).filter(Boolean):[];a.setContentType([e||"multipart/form-data",...t].join("; "))}let l=new XMLHttpRequest;if(e.auth){let t=e.auth.username||"",n=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";a.set("Authorization","Basic "+btoa(t+":"+n))}let d=lS(e.baseURL,e.url);function u(){if(!l)return;let r=oS.from("getAllResponseHeaders"in l&&l.getAllResponseHeaders());(function(e,r,i){let o=i.config.validateStatus;i.status&&o&&!o(i.status)?function(e){n(e),c()}(new Of("Request failed with status code "+i.status,[Of.ERR_BAD_REQUEST,Of.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):function(e){t(e),c()}(i)})(0,0,{data:s&&"text"!==s&&"json"!==s?l.response:l.responseText,status:l.status,statusText:l.statusText,headers:r,config:e,request:l}),l=null}if(l.open(e.method.toUpperCase(),Vf(d,e.params,e.paramsSerializer),!0),l.timeout=e.timeout,"onloadend"in l?l.onloadend=u:l.onreadystatechange=function(){l&&4===l.readyState&&(0!==l.status||l.responseURL&&0===l.responseURL.indexOf("file:"))&&setTimeout(u)},l.onabort=function(){l&&(n(new Of("Request aborted",Of.ECONNABORTED,e,l)),l=null)},l.onerror=function(){n(new Of("Network Error",Of.ERR_NETWORK,e,l)),l=null},l.ontimeout=function(){let t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",r=e.transitional||Kf;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(new Of(t,r.clarifyTimeoutError?Of.ETIMEDOUT:Of.ECONNABORTED,e,l)),l=null},nw.hasStandardBrowserEnv&&(A&&bf.isFunction(A)&&(A=A(e)),A||!1!==A&&dS(d))){let t=e.xsrfHeaderName&&e.xsrfCookieName&&cS.read(e.xsrfCookieName);t&&a.set(e.xsrfHeaderName,t)}void 0===o&&a.setContentType(null),"setRequestHeader"in l&&bf.forEach(a.toJSON(),(function(e,t){l.setRequestHeader(t,e)})),bf.isUndefined(e.withCredentials)||(l.withCredentials=!!e.withCredentials),s&&"json"!==s&&(l.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&l.addEventListener("progress",uS(e.onDownloadProgress,!0)),"function"==typeof e.onUploadProgress&&l.upload&&l.upload.addEventListener("progress",uS(e.onUploadProgress)),(e.cancelToken||e.signal)&&(r=t=>{l&&(n(!t||t.type?new AS(null,e,l):t),l.abort(),l=null)},e.cancelToken&&e.cancelToken.subscribe(r),e.signal&&(e.signal.aborted?r():e.signal.addEventListener("abort",r)));let h=function(e){let t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(d);h&&-1===nw.protocols.indexOf(h)?n(new Of("Unsupported protocol "+h+":",Of.ERR_BAD_REQUEST,e)):l.send(o||null)}))};let pS={http:null,xhr:hS};bf.forEach(pS,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}}));let fS=e=>"- ".concat(e),ES=e=>bf.isFunction(e)||null===e||!1===e;var gS=e=>{e=bf.isArray(e)?e:[e];let t,n,{length:r}=e,i={};for(let o=0;o<r;o++){let r;if(t=e[o],n=t,!ES(t)&&(n=pS[(r=String(t)).toLowerCase()],void 0===n))throw new Of("Unknown adapter '".concat(r,"'"));if(n)break;i[r||"#"+o]=n}if(!n){let e=Object.entries(i).map((e=>{let[t,n]=e;return"adapter ".concat(t," ")+(!1===n?"is not supported by the environment":"is not available in the build")}));throw new Of("There is no suitable adapter to dispatch the request "+(r?e.length>1?"since :\n"+e.map(fS).join("\n"):" "+fS(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return n};function mS(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new AS(null,e)}function _S(e){return mS(e),e.headers=oS.from(e.headers),e.data=aS.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),gS(e.adapter||Zw.adapter)(e).then((function(t){return mS(e),t.data=aS.call(e,e.transformResponse,t),t.headers=oS.from(t.headers),t}),(function(t){return sS(t)||(mS(e),t&&t.response&&(t.response.data=aS.call(e,e.transformResponse,t.response),t.response.headers=oS.from(t.response.headers))),wu.reject(t)}))}function CS(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}let wS=e=>e instanceof oS?function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?CS(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):CS(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e):e;function SS(e,t){t=t||{};let n={};function r(e,t,n){return bf.isPlainObject(e)&&bf.isPlainObject(t)?bf.merge.call({caseless:n},e,t):bf.isPlainObject(t)?bf.merge({},t):bf.isArray(t)?t.slice():t}function i(e,t,n){return bf.isUndefined(t)?bf.isUndefined(e)?void 0:r(void 0,e,n):r(e,t,n)}function o(e,t){if(!bf.isUndefined(t))return r(void 0,t)}function a(e,t){return bf.isUndefined(t)?bf.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function s(n,i,o){return o in t?r(n,i):o in e?r(void 0,n):void 0}let A={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:s,headers:(e,t)=>i(wS(e),wS(t),!0)};return bf.forEach(Object.keys(Object.assign({},e,t)),(function(r){let o=A[r]||i,a=o(e[r],t[r],r);bf.isUndefined(a)&&o!==s||(n[r]=a)})),n}let TS="1.6.8",vS={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{vS[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));let yS={};vS.transitional=function(e,t,n){function r(e,t){return"[Axios v1.6.8] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,i,o)=>{if(!1===e)throw new Of(r(i," has been removed"+(t?" in "+t:"")),Of.ERR_DEPRECATED);return t&&!yS[i]&&(yS[i]=!0,console.warn(r(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,o)}};var IS={assertOptions:function(e,t,n){if("object"!=typeof e)throw new Of("options must be an object",Of.ERR_BAD_OPTION_VALUE);let r=Object.keys(e),i=r.length;for(;i-- >0;){let o=r[i],a=t[o];if(a){let t=e[o],n=void 0===t||a(t,o,e);if(!0!==n)throw new Of("option "+o+" must be "+n,Of.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new Of("Unknown option "+o,Of.ERR_BAD_OPTION)}},validators:vS};let RS=IS.validators,bS=class{constructor(e){this.defaults=e,this.interceptors={request:new Hf,response:new Hf}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let e;Error.captureStackTrace?Error.captureStackTrace(e={}):e=new Error;let t=e.stack?e.stack.replace(/^.+\n/,""):"";n.stack?t&&!String(n.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(n.stack+="\n"+t):n.stack=t}throw n}}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=SS(this.defaults,t);let{transitional:n,paramsSerializer:r,headers:i}=t;void 0!==n&&IS.assertOptions(n,{silentJSONParsing:RS.transitional(RS.boolean),forcedJSONParsing:RS.transitional(RS.boolean),clarifyTimeoutError:RS.transitional(RS.boolean)},!1),null!=r&&(bf.isFunction(r)?t.paramsSerializer={serialize:r}:IS.assertOptions(r,{encode:RS.function,serialize:RS.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=i&&bf.merge(i.common,i[t.method]);i&&bf.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete i[e]})),t.headers=oS.concat(o,i);let a=[],s=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(s=s&&e.synchronous,a.unshift(e.fulfilled,e.rejected))}));let A,c=[];this.interceptors.response.forEach((function(e){c.push(e.fulfilled,e.rejected)}));let l,d=0;if(!s){let e=[_S.bind(this),void 0];for(e.unshift.apply(e,a),e.push.apply(e,c),l=e.length,A=wu.resolve(t);d<l;)A=A.then(e[d++],e[d++]);return A}l=a.length;let u=t;for(d=0;d<l;){let e=a[d++],t=a[d++];try{u=e(u)}catch(h){t.call(this,h);break}}try{A=_S.call(this,u)}catch(p){return wu.reject(p)}for(d=0,l=c.length;d<l;)A=A.then(c[d++],c[d++]);return A}getUri(e){return Vf(lS((e=SS(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};bf.forEach(["delete","get","head","options"],(function(e){bS.prototype[e]=function(t,n){return this.request(SS(n||{},{method:e,url:t,data:(n||{}).data}))}})),bf.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,i){return this.request(SS(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}bS.prototype[e]=t(),bS.prototype[e+"Form"]=t(!0)}));var OS=bS;class BS{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new wu((function(e){t=e}));let n=this;this.promise.then((e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null})),this.promise.then=e=>{let t,r=new wu((e=>{n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e,r,i){n.reason||(n.reason=new AS(e,r,i),t(n.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;let t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}static source(){let e;return{token:new BS((function(t){e=t})),cancel:e}}}var NS=BS;let DS={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(DS).forEach((e=>{let[t,n]=e;DS[n]=t}));var PS=DS;let US=function e(t){let n=new OS(t),r=Yp(OS.prototype.request,n);return bf.extend(r,OS.prototype,n,{allOwnKeys:!0}),bf.extend(r,n,null,{allOwnKeys:!0}),r.create=function(n){return e(SS(t,n))},r}(Zw);US.Axios=OS,US.CanceledError=AS,US.CancelToken=NS,US.isCancel=sS,US.VERSION=TS,US.toFormData=kf,US.AxiosError=Of,US.Cancel=US.CanceledError,US.all=function(e){return wu.all(e)},US.spread=function(e){return function(t){return e.apply(null,t)}},US.isAxiosError=function(e){return bf.isObject(e)&&!0===e.isAxiosError},US.mergeConfig=SS,US.AxiosHeaders=oS,US.formToJSON=e=>zw(bf.isHTMLForm(e)?new FormData(e):e),US.getAdapter=gS,US.HttpStatusCode=PS,US.default=US;var LS=US;let kS=()=>{};function MS(){let e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:kS};return e.promise=new wu(((t,n)=>{e.resolve=n=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(n),e.value=n)},e.reject=t=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(t))}})),e}let FS=new Map,xS=new Map,QS=new Map,VS=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),HS=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({}),KS=new Mp,jS=KS.getResult(),GS=null;function WS(e){if(!GS){jS=KS.getResult();let e=function(e){if("Blink"===e.engine.name&&"WeChat"!==e.browser.name)return HS.CHROME;switch(e.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return HS.CHROME;case"Safari":case"Mobile Safari":return HS.SAFARI;case"Edge":return HS.EDGE;case"Firefox":return HS.FIREFOX;case"QQ":case"QQBrowser":return HS.QQ;case"Opera":return HS.OPERA;case"WeChat":return HS.WECHAT;default:return e.browser.name||""}}(jS),n=YS(jS),r="Windows"===(t=jS).os.name?t.os.version?t.os.name+" "+t.os.version:t.os.name:t.os.name||"",i=jS.os.version,o=YS(jS,!1),a=jS.device.type;if(!(e&&n&&r&&i))return{name:e,version:n,os:r,osVersion:i,browserVersion:o,deviceType:a};GS={name:e,version:n,os:r,osVersion:i,browserVersion:o,deviceType:a}}var t;return GS}function YS(e){let t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t="Blink"===e.engine.name?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function JS(){return WS().os}function XS(){let e=WS();return"".concat(e.os," ").concat(e.osVersion)}function zS(){let e=WS();return!!("WebKit"===jS.engine.name&&e.os===VS.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==HS.SAFARI||tT()&&e.name!==HS.SAFARI)}function qS(){return WS().name===HS.CHROME}function ZS(){return WS().name===HS.SAFARI}function $S(){return WS().name===HS.EDGE}function eT(){return WS().name===HS.FIREFOX}function tT(){return WS().os===VS.IOS}function nT(e){let t=WS();return!(t.name!==HS.CHROME||!t.osVersion)&&Number(t.version)>=e}function rT(e){let t=WS();return!(t.name!==HS.EDGE||!t.osVersion)&&Number(t.version)>=e}function iT(e){let t=WS();return!(t.name!==HS.SAFARI||!t.osVersion)&&Number(t.version)>=e}function oT(e,t,n){let r=WS();if(r.os!==VS.IOS||!r.osVersion)return!1;let i=r.osVersion.split(".");return t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e}function aT(e,t,n){let r=WS();if(r.name!==HS.SAFARI||!r.osVersion||!r.browserVersion)return!1;let i=r.browserVersion.split(".");return t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e}function sT(e){let t=WS();return!(t.name!==HS.OPERA||!t.osVersion)&&Number(t.version)>=e}function AT(){let e=WS();return!(e.name!==HS.CHROME||!e.osVersion)&&Number(e.version)<=90}function cT(){let e=WS();if(e.os!==VS.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])<14||14===Number(t[0])&&Number(t[1])<=6}function lT(){let e=WS();if(e.os!==VS.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return 15===Number(t[0])}function dT(){let e=WS();if(e.os!==VS.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return 16===Number(t[0])}function uT(){let e=WS();if(e.os!==VS.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=1}function hT(){return ZS()&&navigator.maxTouchPoints>0}function pT(){return WS().name===HS.WECHAT}function fT(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function ET(){let e=JS();return function(){let{deviceType:e}=WS();return"mobile"===e||"tablet"===e}()||e===VS.ANDROID||e===VS.IOS||e===VS.HARMONY_OS}function gT(){let e=WS();return e.name!==HS.EDGE&&e.name!==HS.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function mT(){return JS()===VS.ANDROID}function _T(){let e=WS();return mT()&&(e.name===HS.CHROME||e.name===HS.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function CT(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function wT(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?CT(Object(n),!0).forEach((function(t){ST(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):CT(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ST(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let TT=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({});class vT extends Error{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),ST(this,"code",void 0),ST(this,"message",void 0),ST(this,"data",void 0),ST(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),"\n").concat(this.stack):"".concat(this.stack)}print(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return"error"===e&&(t||console).error(this.toString()),"warning"===e&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}}function yT(e,t){if("boolean"!=typeof e)throw new vT(TT.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function IT(e,t,n){if(!yr(n).call(n,e))throw new vT(TT.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function RT(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(e<n||e>r||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&("number"!=typeof(i=e)||i%1!=0))throw new vT(TT.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(r,"]. integer only"));var i}function bT(e,t){if("number"!=typeof e){if(!(e.min||e.max||e.ideal||e.exact))throw new vT(TT.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));void 0!==e.min&&RT(e.min,"".concat(t,".min"),0,1/0),void 0!==e.max&&RT(e.max,"".concat(t,".max"),1,1/0),void 0!==e.exact&&RT(e.exact,"".concat(t,".exact"),1,1/0),void 0!==e.ideal&&RT(e.ideal,"".concat(t,".ideal"),1,1/0)}else RT(e,t,1,1/0)}function OT(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==e)throw new vT(TT.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!DT(e,n,r,i))throw new vT(TT.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(i?" ASCII characters only.":""))}function BT(e,t){if(!Array.isArray(e))throw new vT(TT.INVALID_PARAMS,"".concat(t," should be an array"))}function NT(e){return null==e}function DT(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:255,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return"string"==typeof e&&e.length<=n&&e.length>=t&&(!r||function(e){if("string"!=typeof e)return!1;for(let t=0;t<e.length;t+=1){let n=e.charCodeAt(t);if(n<0||n>255)return!1}return!0}(e))}function PT(e,t,n){if("getBigUint64"in DataView.prototype)return e.getBigUint64(t,n);let r=e.getUint32(t,n),i=e.getUint32(t+4,n),o=+!!n,a=+!n;return BigInt(r*a+i*o)<<BigInt(32)|BigInt(r*o+i*a)}function UT(e,t,n,r){if("setBigUint64"in DataView.prototype)return e.setBigUint64(t,n,r);let i=Number(n>>BigInt(32)),o=Number(n&BigInt(4294967295));e.setUint32(t,i,r),e.setUint32(t+4,o,r)}var LT=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(LT||{}),kT=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(kT||{});let MT=new class{constructor(){ST(this,"_clientSize",null),ST(this,"getClientWidth",(()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth)),ST(this,"getClientHeight",(()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight)),ST(this,"getStyle",(e=>window.getComputedStyle(e,null))),ST(this,"checkCssVisibleProperty",(e=>{var t;let n=!0,r=this.getStyle(e),{display:i,visibility:o,opacity:a,filter:s}=r;return("none"===i||yr(t=["hidden","collapse"]).call(t,o)||Number(a)<.1)&&(n=!1),!!n&&(s&&s.split(" ").filter((e=>{var t;let n=e.split("(")[0];return yr(t=["brightness","blur","opacity"]).call(t,n)})).map((e=>{let[t,n]=e.split(/\(|\)/);return[t,Number(n.match(/^[0-9\.]+/))]})).forEach((e=>{let[t,r]=e;switch(t){case"brightness":(r<.1||r>3)&&(n=!1);break;case"blur":r>3&&(n=!1);break;case"opacity":r<.1&&(n=!1)}})),n)})),ST(this,"checkPropertyUpToAllParentNodes",((e,t)=>{let n=!0,r=!0,i=e;for(;i&&r;)t(i)||(n=!1,r=!1),i=i.parentElement,i||(r=!1);return n})),ST(this,"checkActualCssVisibleIncludeInherit",(e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty))),ST(this,"getSizeAboutClient",(e=>{let{width:t,height:n,left:r,right:i,top:o,bottom:a}=e.getBoundingClientRect(),s=this.getClientWidth(),A=this.getClientHeight();return{width:t,height:n,left:r,right:i,top:o,bottom:a,clientWidth:s,clientHeight:A,clientMin:Math.min(s,A)}})),ST(this,"checkActualSize",(()=>{let{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)})),ST(this,"elementFromPoint",((e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null)),ST(this,"checkCoverForAPoint",((e,t,n)=>{let r=this.elementFromPoint(e,t);return null!==r&&r!==n})),ST(this,"getPointPositionList",(()=>{let{width:e,height:t,left:n,top:r}=this._clientSize,i=e/6,o=t/6,a=[],s=10**6;for(let A=0;A<5;A++)for(let e=0;e<5;e++){let t=(n*s+(0===A?.1:4===A?(i*A*s-1e5)/s:i*A)*s)/s,c=(r*s+(0===e?.1:4===e?(o*e*s-1e5)/s:o*e)*s)/s;a.push({x:t,y:c})}return[...a]})),ST(this,"checkElementCover",(e=>this.getPointPositionList().map((t=>this.checkCoverForAPoint(t.x,t.y,e))).filter((e=>!!e)).length>6)),ST(this,"checkSizeIsVisible",((e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10))),ST(this,"checkSizeOfPartInClient",(()=>{let e,t,n,r,{left:i,right:o,top:a,bottom:s,clientHeight:A,clientWidth:c,clientMin:l}=this._clientSize;if(i<0)e=0;else{if(!(i<c))return!1;e=i}if(o<0)return!1;if(t=o<c?o:c,a<0)n=0;else{if(!(a<A))return!1;n=a}if(s<0)return!1;r=s<A?s:A;let d=t-e,u=r-n;return this.checkSizeIsVisible(d,u,l)})),ST(this,"returnHiddenResult",(e=>(this._clientSize=null,{visible:!1,reason:e}))),ST(this,"checkOneElementVisible",(e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(LT.COVERED);{let e=this.checkActualSize(),t=this.checkSizeOfPartInClient();return e&&!t?this.returnHiddenResult(LT.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(LT.SIZE)}}return this.returnHiddenResult(LT.STYLE)}return this.returnHiddenResult(kT.UNMOUNTED)}return this.returnHiddenResult(kT.INVALID_HTML_ELEMENT)})),ST(this,"checkElementIsMountedOnDom",(e=>this.checkPropertyUpToAllParentNodes(e,(e=>"HTML"!==e.nodeName.toUpperCase()?null!==e.parentElement:!!document.documentElement))))}};function FT(e){return(new TextEncoder).encode(e)}let xT=function(e,t){let n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},QT=async e=>function(e,t){let n="";return new Uint8Array(e).forEach((e=>{n+=e.toString(16).padStart(2,"0")})),n}(await crypto.subtle.digest("SHA-256",FT(e))),VT=class{constructor(){ST(this,"_events",{}),ST(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map((e=>e.listener)):[]}on(e,t){this._events[e]||(this._events[e]=[]);let n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);let n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;let n=this._events[e],r=this._indexOfListener(n,t);-1!==r&&n.splice(r,1),0===this._events[e].length&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);let t=this._events[e].map((e=>e));for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(let o=0;o<t.length;o+=1){let n=t[o];n.once&&this.off(e,n.listener),n.listener.apply(this,r||[])}}safeEmit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];[...this._events[e]||[]].forEach((t=>{t.once&&this.off(e,t.listener);try{t.listener.apply(this,n)}catch(r){console.error("safeEmit event:".concat(e," error ").concat(null===r||void 0===r?void 0:r.toString()))}}))}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}},HT=null;function KT(){if(HT)return HT;if(window.electron)return HT=window.electron;if(!window.require)return null;try{return HT=window.require("electron"),HT}catch{return null}}let jT=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.DATACHANNEL_FAILBACK="Client._datachannelFailback",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e}({}),GT=function(e){return e.TRACER="tracer",e}({});function WT(e){return RT(e.timeout,"config.timeout",0,1e5),RT(e.timeoutFactor,"config.timeoutFactor",0,100,!1),RT(e.maxRetryCount,"config.maxRetryConfig",0,1/0),RT(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let YT=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),JT=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.FALLBACK="FALLBACK",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function XT(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach((e=>{if(!e.urls)throw Error()}))}catch{return!1}return!0}function zT(e){return OT(e.turnServerURL,"turnServerURL"),OT(e.username,"username"),OT(e.password,"password"),e.udpport&&RT(e.udpport,"udpport",1,99999,!0),e.forceturn&&yT(e.forceturn,"forceturn"),e.security&&yT(e.security,"security"),e.tcpport&&RT(e.tcpport,"tcpport",1,99999,!0),!0}function qT(e){return void 0!==e.level&&IT(e.level,"level",[1,2,3]),void 0!==e.delay&&RT(e.delay,"delay",0,3e3,!0),!0}let ZT=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.INJECT_STREAM_STATUS="stream-inject-status",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),$T=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),ev=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),tv=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function nv(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return 0===e.getListeners(t).length?wu.reject(new vT(TT.UNEXPECTED_ERROR,"can not emit promise")):new wu(((n,i)=>{e.emit(t,...r,n,i)}))}function rv(e,t){if(0===e.getListeners(t).length)return wu.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return nv(e,t,...r)}function iv(e,t){if(0===e.getListeners(t).length)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return ov(e,t,...r)}function ov(e,t){let n=null,r=null;for(var i=arguments.length,o=new Array(i>2?i-2:0),a=2;a<i;a++)o[a-2]=arguments[a];if(e.emit(t,...o,(e=>{n=e}),(e=>{r=e})),null!==r)throw r;if(null===n)throw new vT(TT.UNEXPECTED_ERROR,"handler is not sync");return n}let av=new class extends VT{set networkState(e){this.emit(tv.NETWORK_STATE_CHANGE,e,this._networkState),e===ev.ONLINE?this.emit(tv.ONLINE):e===ev.OFFLINE&&(this.onlineWaiter=new wu((e=>{this.once(tv.ONLINE,(()=>{this.onlineWaiter=void 0,e(ev.ONLINE)}))})),this.emit(tv.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===ev.ONLINE}constructor(){super(),ST(this,"_moduleName","network-indicator"),ST(this,"_networkState",ev.ONLINE),ST(this,"onlineWaiter",void 0),window.addEventListener("online",(()=>{this.networkState=ev.ONLINE})),window.addEventListener("offline",(()=>{this.networkState=ev.OFFLINE}))}};function sv(e,t){let n=e.indexOf(t);-1!==n&&e.splice(n,1)}function Av(e){let t=[];return e.forEach((e=>{-1===t.indexOf(e)&&t.push(e)})),t}function cv(e){void 0!==wu?wu.resolve().then(e):setTimeout(e,0)}function lv(e){return JSON.parse(JSON.stringify(e))}function dv(e){try{return lv(e)}catch{return e}}let uv={};function hv(e,t){uv[t]||(uv[t]=!0,e())}function pv(e){let t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}function fv(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function Ev(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=(new TextEncoder).encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){let e=new Uint8Array(t);e.set(n),n=e}return n}function gv(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=Hr(t).call(t,((e,t)=>e+t.length),0),i=new Uint8Array(new ArrayBuffer(r)),o=0;return t.forEach((e=>{i.set(e,o),o+=e.length})),i}function mv(e){return window.TextEncoder?(new TextEncoder).encode(e).length:e.length}function _v(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach((e=>{t+="string"==typeof e?mv(e):e.size})),t+138}function Cv(e){let t=new vT(TT.TIMEOUT,"timeout");return new wu(((n,r)=>{window.setTimeout((()=>r(t)),e)}))}function wv(e){return new wu((t=>{window.setTimeout(t,e)}))}function Sv(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0,n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+Sv(e-n.length,"")}function Tv(){return Sv(32,"").toUpperCase()}let vv=()=>{},yv=new class{constructor(){ST(this,"fnMap",new Map)}throttleByKey(e,t,n,r){for(var i=arguments.length,o=new Array(i>4?i-4:0),a=4;a<i;a++)o[a-4]=arguments[a];if(this.fnMap.has(t)){let i=this.fnMap.get(t);if(i.threshold!==n){i.fn(...i.args),clearTimeout(i.timer);let a=window.setTimeout((()=>{let e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)}),n);this.fnMap.set(t,{fn:e,threshold:n,timer:a,args:o,skipFn:r})}else i.skipFn&&i.skipFn(...i.args),this.fnMap.set(t,wT(wT({},i),{},{fn:e,args:o,skipFn:r}))}else{let i=window.setTimeout((()=>{let e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)}),n);this.fnMap.set(t,{fn:e,threshold:n,timer:i,args:o,skipFn:r})}}},Iv=yv.throttleByKey.bind(yv);function Rv(e){return"object"==typeof e&&null!==e&&!(e instanceof RegExp)}function bv(e,t){if(!Rv(e)||!Rv(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){let n=[...e];for(let r=0;r<t.length;r++)n[r]=bv(e[r],t[r]);return n}{let n=wT({},e);for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)?n[r]=bv(e[r],t[r]):n[r]=t[r]);return n}}function Ov(e,t){let n=[0];if(n=new Array(t).fill(0),0===e)return n;let r=0;for(;e>0&&(n[r]=255&e,e>>=8,r++,r!==t););return n}function Bv(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function Nv(e){let t="0123456789abcdef";function n(e){let n,r="";for(n=0;n<=3;n++)r+=t.charAt(e>>8*n+4&15)+t.charAt(e>>8*n&15);return r}function r(e,t){let n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function i(e,t,n,i,o,a){return r((s=r(r(t,e),r(i,a)))<<(A=o)|s>>>32-A,n);var s,A}function o(e,t,n,r,o,a,s){return i(t&n|~t&r,e,t,o,a,s)}function a(e,t,n,r,o,a,s){return i(t&r|n&~r,e,t,o,a,s)}function s(e,t,n,r,o,a,s){return i(t^n^r,e,t,o,a,s)}function A(e,t,n,r,o,a,s){return i(n^(t|~r),e,t,o,a,s)}let c,l,d,u,h,p=function(e){let t,n=1+(e.length+8>>6),r=new Array(16*n);for(t=0;t<16*n;t++)r[t]=0;for(t=0;t<e.length;t++)r[t>>2]|=e.charCodeAt(t)<<t%4*8;return r[t>>2]|=128<<t%4*8,r[16*n-2]=8*e.length,r}(e),f=1732584193,E=-271733879,g=-1732584194,m=271733878;for(c=0;c<p.length;c+=16)l=f,d=E,u=g,h=m,f=o(f,E,g,m,p[c+0],7,-680876936),m=o(m,f,E,g,p[c+1],12,-389564586),g=o(g,m,f,E,p[c+2],17,606105819),E=o(E,g,m,f,p[c+3],22,-1044525330),f=o(f,E,g,m,p[c+4],7,-176418897),m=o(m,f,E,g,p[c+5],12,1200080426),g=o(g,m,f,E,p[c+6],17,-1473231341),E=o(E,g,m,f,p[c+7],22,-45705983),f=o(f,E,g,m,p[c+8],7,1770035416),m=o(m,f,E,g,p[c+9],12,-1958414417),g=o(g,m,f,E,p[c+10],17,-42063),E=o(E,g,m,f,p[c+11],22,-1990404162),f=o(f,E,g,m,p[c+12],7,1804603682),m=o(m,f,E,g,p[c+13],12,-40341101),g=o(g,m,f,E,p[c+14],17,-1502002290),E=o(E,g,m,f,p[c+15],22,1236535329),f=a(f,E,g,m,p[c+1],5,-165796510),m=a(m,f,E,g,p[c+6],9,-1069501632),g=a(g,m,f,E,p[c+11],14,643717713),E=a(E,g,m,f,p[c+0],20,-373897302),f=a(f,E,g,m,p[c+5],5,-701558691),m=a(m,f,E,g,p[c+10],9,38016083),g=a(g,m,f,E,p[c+15],14,-660478335),E=a(E,g,m,f,p[c+4],20,-405537848),f=a(f,E,g,m,p[c+9],5,568446438),m=a(m,f,E,g,p[c+14],9,-1019803690),g=a(g,m,f,E,p[c+3],14,-187363961),E=a(E,g,m,f,p[c+8],20,1163531501),f=a(f,E,g,m,p[c+13],5,-1444681467),m=a(m,f,E,g,p[c+2],9,-51403784),g=a(g,m,f,E,p[c+7],14,1735328473),E=a(E,g,m,f,p[c+12],20,-1926607734),f=s(f,E,g,m,p[c+5],4,-378558),m=s(m,f,E,g,p[c+8],11,-2022574463),g=s(g,m,f,E,p[c+11],16,1839030562),E=s(E,g,m,f,p[c+14],23,-35309556),f=s(f,E,g,m,p[c+1],4,-1530992060),m=s(m,f,E,g,p[c+4],11,1272893353),g=s(g,m,f,E,p[c+7],16,-155497632),E=s(E,g,m,f,p[c+10],23,-1094730640),f=s(f,E,g,m,p[c+13],4,681279174),m=s(m,f,E,g,p[c+0],11,-358537222),g=s(g,m,f,E,p[c+3],16,-722521979),E=s(E,g,m,f,p[c+6],23,76029189),f=s(f,E,g,m,p[c+9],4,-640364487),m=s(m,f,E,g,p[c+12],11,-421815835),g=s(g,m,f,E,p[c+15],16,530742520),E=s(E,g,m,f,p[c+2],23,-995338651),f=A(f,E,g,m,p[c+0],6,-198630844),m=A(m,f,E,g,p[c+7],10,1126891415),g=A(g,m,f,E,p[c+14],15,-1416354905),E=A(E,g,m,f,p[c+5],21,-57434055),f=A(f,E,g,m,p[c+12],6,1700485571),m=A(m,f,E,g,p[c+3],10,-1894986606),g=A(g,m,f,E,p[c+10],15,-1051523),E=A(E,g,m,f,p[c+1],21,-2054922799),f=A(f,E,g,m,p[c+8],6,1873313359),m=A(m,f,E,g,p[c+15],10,-30611744),g=A(g,m,f,E,p[c+6],15,-1560198380),E=A(E,g,m,f,p[c+13],21,1309151649),f=A(f,E,g,m,p[c+4],6,-145523070),m=A(m,f,E,g,p[c+11],10,-1120210379),g=A(g,m,f,E,p[c+2],15,718787259),E=A(E,g,m,f,p[c+9],21,-343485551),f=r(f,l),E=r(E,d),g=r(g,u),m=r(m,h);return n(f)+n(E)+n(g)+n(m)}let Dv=1,Pv=console,Uv=class{static setLogger(e){Pv=e}constructor(e){ST(this,"lockingPromise",wu.resolve()),ST(this,"locks",0),ST(this,"name",""),ST(this,"lockId",void 0),this.lockId=Dv++,e&&(this.name=e),Pv.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,Pv.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat("string"==typeof e?e:""));let n=new wu((n=>{t=()=>{this.locks-=1,Pv.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat("string"==typeof e?e:"")),n()}})),r=this.lockingPromise.then((()=>t));return this.lockingPromise=this.lockingPromise.then((()=>n)),r}};function Lv(e,t){return function(n,r,i){let o=i.value;if("function"!=typeof o)throw new Error("Cannot use mutex on object property.");return i.value=async function(){let n=this[t];if(!n)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));let i=await n.lock("From ".concat(e,".").concat(r));try{for(var a=arguments.length,s=new Array(a),A=0;A<a;A++)s[A]=arguments[A];return await o.apply(this,s)}finally{i()}},i}}let kv={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Mv(e,t){let n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function Fv(e,t,n,r){let i=Object.assign({},kv,r),o=i.timeout,a=async()=>{var e;await(e=o,new wu((t=>{window.setTimeout(t,e)}))),o*=i.timeoutFactor,o=Math.min(i.maxRetryTimeout,o)},s=!1,A=new wu((async(r,o)=>{t=t||(()=>!1),n=n||(()=>!0);for(let c=0;c<i.maxRetryCount;c+=1){if(s)return o(new vT(TT.OPERATION_ABORTED));try{let n=await e();if(!t(n,c)||c+1===i.maxRetryCount)return r(n);await a()}catch(A){if(!n(A,c)||c+1===i.maxRetryCount)return o(A);await a()}}}));return A.cancel=()=>s=!0,A}class xv{constructor(e){ST(this,"input",[]),ST(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return 0===this.input.length?0:Hr(e=this.input).call(e,((e,t)=>e+t))/this.input.length}}let Qv,Vv=0,Hv=0;function Kv(e,t,n,r){return new wu(((r,i)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),Vv+=mv(t.data)):n&&(t.data.size?Vv+=t.data.size:t.data instanceof FormData?Vv+=_v(t.data):Vv+=mv(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,LS.request(t).then((e=>{"string"==typeof e.data?Hv+=mv(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?Hv+=e.data.byteLength:Hv+=mv(JSON.stringify(e.data)),r(e.data)})).catch((e=>{LS.isCancel(e)?i(new vT(TT.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?i(new vT(TT.NETWORK_TIMEOUT,e.message)):e.response?i(new vT(TT.NETWORK_RESPONSE_ERROR,e.response.status)):i(new vT(TT.NETWORK_ERROR,e.message))}))}))}async function jv(e,t){let n=new Blob([t.data],{type:"buffer"});return await Kv(e,wT(wT({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}let Gv=()=>void 0!==window.isSecureContext,Wv=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;let t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(t&&t[1]&&t[2]){let e=t[1],n=t[2];return"".concat(e,".").concat(n)}let n=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(n&&n[1]&&n[2]){let e=n[1],t=n[2];return"".concat(e,".").concat(100*(Number(t)+1))}return"4.0.0.999"}("4.21.0"),Yv=function(){try{return!0===JSON.parse("true")}catch{return!0}}(),Jv=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({}),Xv={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},zv="v4.21.0-0-g16fdae2c-dirty(6/3/2024, 2:55:18 PM)",qv={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!0,USE_SUB_RTX:!0,USE_XR:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:void 0,ENABLE_CC_FALLBACK:void 0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,DISABLE_FEC:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,ENABLE_DATASTREAM_2:!1,DATASTREAM_MAX_RETRANSMITS:10,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_INSTANT_VIDEO:!1,ENABLE_NTP_REPORT:!1,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:Xv,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,ENABLE_PRELOAD:!0};function Zv(e,t,n){var r,i,o;yr(r=Object.keys(qv)).call(r,e)&&(!n&&yr(i=Object.keys(ey)).call(i,e)||(qv[e]=t,"ENABLE_VIDEO_SEI"===e&&!0===t&&(qv.ENABLE_ENCODED_TRANSFORM=!0),"USE_NEW_NETWORK_CONFIG"===e&&t&&(o=!!t,qv.USE_NEW_NETWORK_CONFIG=o,o&&(qv.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],qv.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],qv.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],qv.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],qv.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",qv.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",qv.GATEWAY_DOMAINS=["edge.sd-rtn.com"]))))}function $v(e){return qv[e]}let ey={};var ty=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(ty||{});class ny{constructor(e,t,n,r){ST(this,"state",void 0),this.state={codec:e,audioCodec:t,mode:n,clientId:r,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1,useP2P:!1,p2pTransport:Jv.Default}}dispatch(e){this.state=function(e,t){switch(t.type){case ty.SET_SESSION_ID:return wT(wT({},e),{},{sessionId:t.sessionId});case ty.SET_P2P_ID:return wT(wT({},e),{},{p2pId:t.p2pId});case ty.SET_UID:return wT(wT({},e),{},{uid:t.uid});case ty.SET_INT_UID:return wT(wT({},e),{},{intUid:t.intUid});case ty.SET_PUB_ID:return wT(wT({},e),{},{pubId:t.pubId});case ty.KEY_METRIC_CLIENT_CREATED:return wT(wT({},e),{},{keyMetrics:wT(wT({},e.keyMetrics),{},{clientCreated:t.metric})});case ty.KEY_METRIC_JOIN_START:return wT(wT({},e),{},{keyMetrics:wT(wT({},e.keyMetrics),{},{joinStart:t.metric})});case ty.AVOID_JOIN_START:return wT(wT({},e),{},{avoidJoinStart:t.avoidJoinStart});case ty.KEY_METRIC_JOIN_END:return wT(wT({},e),{},{keyMetrics:wT(wT({},e.keyMetrics),{},{joinEnd:t.metric})});case ty.KEY_METRIC_REQUEST_AP_START:return wT(wT({},e),{},{keyMetrics:wT(wT({},e.keyMetrics),{},{requestAPStart:t.metric})});case ty.KEY_METRIC_REQUEST_AP_END:return wT(wT({},e),{},{keyMetrics:wT(wT({},e.keyMetrics),{},{requestAPEnd:t.metric})});case ty.KEY_METRIC_JOIN_GATEWAY_START:return wT(wT({},e),{},{keyMetrics:wT(wT({},e.keyMetrics),{},{joinGatewayStart:t.metric})});case ty.KEY_METRIC_JOIN_GATEWAY_END:return wT(wT({},e),{},{keyMetrics:wT(wT({},e.keyMetrics),{},{joinGatewayEnd:t.metric})});case ty.KEY_METRIC_PEER_CONNECTION_START:return wT(wT({},e),{},{keyMetrics:wT(wT({},e.keyMetrics),{},{peerConnectionStart:t.metric})});case ty.KEY_METRIC_PEER_CONNECTION_END:return wT(wT({},e),{},{keyMetrics:wT(wT({},e.keyMetrics),{},{peerConnectionEnd:t.metric})});case ty.KEY_METRIC_DESCRIPTION_START:return wT(wT({},e),{},{keyMetrics:wT(wT({},e.keyMetrics),{},{descriptionStart:t.metric})});case ty.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return wT(wT({},e),{},{keyMetrics:wT(wT({},e.keyMetrics),{},{signalChannelOpen:t.metric})});case ty.KEY_METRIC_ICE_CONNECTION_END:return wT(wT({},e),{},{keyMetrics:wT(wT({},e.keyMetrics),{},{iceConnectionEnd:t.metric})});case ty.KEY_METRIC_PUBLISH:{let n=e.keyMetrics.publish,r=n.findIndex((e=>e.trackId===t.metric.trackId));return-1!==r?(n[r]=wT(wT({},n[r]),t.metric),wT(wT({},e),{},{keyMetrics:wT(wT({},e.keyMetrics),{},{publish:[...n]})})):wT(wT({},e),{},{keyMetrics:wT(wT({},e.keyMetrics),{},{publish:[...e.keyMetrics.publish,t.metric]})})}case ty.KEY_METRIC_SUBSCRIBE:{let n=e.keyMetrics.subscribe,r=n.findIndex((e=>e.userId===t.metric.userId&&e.type===t.metric.type));return-1!==r?(n[r]=wT(wT({},n[r]),t.metric),wT(wT({},e),{},{keyMetrics:wT(wT({},e.keyMetrics),{},{subscribe:[...n]})})):wT(wT({},e),{},{keyMetrics:wT(wT({},e.keyMetrics),{},{subscribe:[...e.keyMetrics.subscribe,t.metric]})})}case ty.SET_CLOUD_PROXY_SERVER_MODE:return e.cloudProxyServerMode=t.mode,e;case ty.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof t.index?e.joinChannelServiceRecords=[...e.joinChannelServiceRecords,t.record]:(e.joinChannelServiceRecords[t.index]=wT(wT({},e.joinChannelServiceRecords[t.index]),t.record),e.joinChannelServiceRecords=[...e.joinChannelServiceRecords]),e;case ty.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return e.joinChannelServiceRecords=[],e;case ty.RESET_KEY_METRICS:return e.keyMetrics={publish:[],subscribe:[]},e;case ty.SET_USE_DATACHANNEL:return wT(wT({},e),{},{useDataChannel:t.val});case ty.SET_USE_P2P:return wT(wT({},e),{},{useP2P:t.val});case ty.SET_TRANSPORT_TYPE:return wT(wT({},e),{},{p2pTransport:t.val});default:return e}}(this.state,e)}set sessionId(e){this.dispatch({type:ty.SET_SESSION_ID,sessionId:e})}get sessionId(){return this.state.sessionId}set codec(e){this.state.codec=e}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(e){this.dispatch({type:ty.SET_P2P_ID,p2pId:e})}get p2pId(){return this.state.p2pId}set dcId(e){this.dispatch({type:ty.SET_DC_ID,dcId:e})}get dcId(){return this.state.dcId}set uid(e){this.dispatch({type:ty.SET_UID,uid:e})}get uid(){return this.state.uid}set intUid(e){this.dispatch({type:ty.SET_INT_UID,intUid:e})}get intUid(){return this.state.intUid}set pubId(e){this.dispatch({type:ty.SET_PUB_ID,pubId:e})}get pubId(){return this.state.pubId}set cloudProxyServerMode(e){this.dispatch({type:ty.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(e){this.dispatch({type:ty.SET_USE_DATACHANNEL,val:e})}get useDataChannel(){return this.state.useDataChannel}set useP2P(e){this.dispatch({type:ty.SET_USE_P2P,val:e})}get useP2P(){return this.state.useP2P}set p2pTransport(e){this.dispatch({type:ty.SET_TRANSPORT_TYPE,val:e})}get p2pTransport(){return this.state.p2pTransport}clientCreated(){this.dispatch({type:ty.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:ty.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:ty.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:ty.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:ty.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:ty.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:ty.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:ty.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:ty.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:ty.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:ty.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:ty.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(e,t,n,r){this.dispatch({type:ty.KEY_METRIC_PUBLISH,metric:wT(wT({trackId:e,type:t},n&&{publishStart:n}),r&&{publishEnd:r})})}subscribe(e,t,n,r,i,o,a){this.dispatch({type:ty.KEY_METRIC_SUBSCRIBE,metric:wT(wT(wT(wT(wT({userId:e,type:t},n&&{subscribeStart:n}),r&&{subscribeEnd:r}),i&&{firstFrame:i}),o&&{streamAdded:o}),a&&{firstDecoded:a})})}massSubscribe(e,t,n,r){e.forEach((e=>{this.dispatch({type:ty.KEY_METRIC_SUBSCRIBE,metric:wT(wT(wT({userId:e.userId,type:e.type},t&&{subscribeStart:t}),n&&{subscribeEnd:n}),r&&{firstFrame:r})})}))}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(e,t){"gateway"===e.service&&Array.isArray(e.urls)&&(e.urls=e.urls.map((e=>e.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2"))));try{return"number"!=typeof t?(this.dispatch({type:ty.RECORD_JOIN_CHANNEL_SERVICE,record:wT(wT({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(t<0||t>=this.state.joinChannelServiceRecords.length||this.dispatch({type:ty.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:t}),t)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:ty.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:ty.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(e){this.dispatch({type:ty.AVOID_JOIN_START,avoidJoinStart:e})}}let ry=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});!function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"}({});let iy=10,oy=0;function ay(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function sy(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ay(Object(n),!0).forEach((function(t){Ay(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ay(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ay(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let cy=new class extends VT{constructor(){super(...arguments),Ay(this,"currentUploadLogID",0)}reportLogUploadError(e){let{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class ly{constructor(e){Ay(this,"logger",void 0),Ay(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.debug(...this.prefixLists,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.info(...this.prefixLists,...t)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.warning(...this.prefixLists,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.error(...this.prefixLists,...t)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function dy(){let e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function uy(){let e=new Date,t=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return t?(null===t||void 0===t?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}let hy={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},py=Date.now(),fy=e=>{for(let t in hy)if(Object.prototype.hasOwnProperty.call(hy,t)&&hy[t]===e)return t;return"DEFAULT"},Ey=new class{constructor(){Ay(this,"proxyServerURL",void 0),Ay(this,"logLevel",hy.DEBUG),Ay(this,"uploadState","collecting"),Ay(this,"uploadLogWaitingList",[]),Ay(this,"uploadLogUploadingList",[]),Ay(this,"uploadErrorCount",0),Ay(this,"currentLogID",0),Ay(this,"url",void 0),Ay(this,"extLog",((e,t)=>{this.appendLogToWaitingList(e,...t)}))}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=[hy.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=[hy.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=[hy.WARNING].concat(t);this.log.apply(this,r)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=[hy.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=[hy.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){Zv("UPLOAD_LOG",!0)}disableLogUpload(){Zv("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new ly(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-py<100)return void setTimeout((()=>{this.log(...t)}),Date.now()-py);let r=Math.max(0,Math.min(4,t[0]));if(t[0]=dy()+" Agora-SDK [".concat(fy(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;let i=dy()+" %cAgora-SDK [".concat(fy(r),"]:"),o=[];if(!$v("USE_NEW_LOG"))switch(r){case hy.DEBUG:o=[i,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,o);break;case hy.INFO:o=[i,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,o);break;case hy.WARNING:o=[i,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,o);break;case hy.ERROR:o=[i,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,o)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-py<100)return void setTimeout((()=>{this.uploadLog(...t)}),Date.now()-py);let r=Math.max(0,Math.min(4,t[0]));t[0]=dy()+" Agora-SDK [".concat(fy(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!$v("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=uy()+" Agora-SDK [".concat(fy(e),"]:"):n[0]=uy()+" Agora-SDK [".concat(fy(e),"]:");let i="";n.forEach((e=>{"object"==typeof e&&(e=JSON.stringify(e)),i+="".concat(e," ")})),this.uploadLogWaitingList.push({payload_str:i,log_level:e,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}async uploadLogs(){let e=this.uploadLogUploadingList,t={sdk_version:Wv,process_id:$v("PROCESS_ID"),payload:JSON.stringify(e)};return Fv((async()=>{let e=await LS.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat($v("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat($v("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if("OK"!==e.data){let t=new Error("unexpected upload log response");throw t.response=e,t}}),(()=>(this.uploadLogUploadingList=[],!1)),(t=>{let n={status:-1,message:t.message,errorRange:e.map((e=>e.log_item_id))};return t.response?(n.status=t.response.status,n.data=t.response.data,n.headers=t.response.headers):t.request&&(n.status=t.request.status),cy.reportLogUploadError(n),!0}),{timeout:$v("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:$v("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,$v("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then((()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout((()=>this.uploadLogInterval()),$v("UPLOAD_LOG_INTERVAL"))})).catch((e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout((()=>this.uploadLogInterval()),$v("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout((()=>this.uploadLogInterval()),$v("UPLOAD_LOG_RETRY_INTERVAL_V1"))})))}};var gy;function my(e){return OT(e.reportId,"params.reportId",0,100,!1),OT(e.category,"params.category",0,100,!1),OT(e.event,"params.event",0,100,!1),OT(e.label,"params.label",0,100,!1),RT(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(gy={}).FREE="free",gy.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});let _y={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0},Cy=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e}({}),wy=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({}),function(e){e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}({});class Sy{constructor(){Ay(this,"baseInfoMap",new Map),Ay(this,"proxyServer",void 0),Ay(this,"eventUploadTimer",void 0),Ay(this,"setSessionIdTimer",void 0),Ay(this,"url",void 0),Ay(this,"backupUrl",void 0),Ay(this,"_appId",void 0),Ay(this,"keyEventUploadPendingItems",[]),Ay(this,"normalEventUploadPendingItems",[]),Ay(this,"apiInvokeUploadPendingItems",[]),Ay(this,"apiInvokeCount",0),Ay(this,"ltsList",[]),Ay(this,"lastSendNormalEventTime",Date.now()),Ay(this,"customReportCounterTimer",void 0),Ay(this,"customReportCount",0),Ay(this,"extApiInvoke",(async e=>{for(let t of e){let e=sy(sy({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:GT.TRACER});this.sendApiInvoke(e)}})),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),$v("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),$v("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}adjustSessionStartTime(e){if(!this.baseInfoMap.has(e)&&!this.baseInfoMap.get(e))return void Ey.error("adjust session ".concat(e," start time, sid is not exist or info is undefined"));let t=this.baseInfoMap.get(e),n=Date.now(),r=t.startTime;t.startTime=n,Ey.debug("rewrite session ".concat(e," startTime: ").concat(n," , ").concat(n-r,"ms")),this.baseInfoMap.set(e,t)}setAppId(e){this._appId=e}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=void 0===t.reportResult||t.reportResult;let r=Date.now();this.apiInvokeCount+=1;let i=this.apiInvokeCount,o=()=>({tag:t.tag,invokeId:i,sid:e,name:t.name,apiInvokeTime:r,options:t.options,states:t.states||null}),a=!!$v("SHOW_REPORT_INVOKER_LOG");a&&Ey.info("".concat(t.name," start"),t.options);let s=!1;wv(t.timeout).then((()=>{s||(this.sendApiInvoke(sy(sy({},o()),{},{error:TT.API_INVOKE_TIMEOUT,success:!1})),Ey.debug("".concat(t.name," timeout")))}));let A=new vT(TT.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:e=>{let r=()=>{if(s)throw A;return s=!0,this.sendApiInvoke(sy(sy({},o()),{},{success:!0},t.reportResult&&{result:e})),a&&Ey.info("".concat(t.name," onSuccess")),e};return n?Iv(r,t.name+"Success",n,(()=>s=!0)):r()},onError:e=>{let r=()=>{if(s)throw e;s=!0,this.sendApiInvoke(sy(sy({},o()),{},{success:!1,error:e})),a&&Ey.info("".concat(t.name," onFailure"),e.toString())};return n?Iv(r,t.name+"Error",n,(()=>s=!0)):r()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;let n=Date.now(),r=this.createBaseInfo(e,n);r.cname=t.cname;let i=Object.assign({},{willUploadConsoleLog:$v("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:Yv?"global":"oversea",areas:$v("AREAS")&&$v("AREAS").join(",")},t.extend),{stringUid:o,channelProfile:a,channelMode:s,isABTestSuccess:A,lsid:c,clientRole:l}=t,d=Date.now(),u=sy(sy({},r),{},{eventType:Cy.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:zv,lts:d,elapse:d-n,extend:JSON.stringify(i),mode:t.mode,process:$v("PROCESS_ID"),appType:$v("APP_TYPE"),success:!0,version:Wv,stringUid:o,channelProfile:a,channelMode:s,isABTestSuccess:A,lsid:c,clientType:20,clientRole:l,serviceId:$v("PROCESS_ID"),extensionID:$v("PLUGIN_INFO").join(",")||"",preload:t.preload?1:0});this.send({type:wy.SESSION,data:u},!0)}joinChooseServer(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),o=sy(sy({},r),{},{eventType:Cy.JOIN_CHOOSE_SERVER,lts:i,eventElapse:t.elapse||i-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:i-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3});this.send({type:wy.JOIN_CHOOSE_SERVER,data:o},!0)}reqUserAccount(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),o=sy(sy({},r),{},{eventType:Cy.REQ_USER_ACCOUNT,lts:i,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||i-n.startTime,eventElapse:i-t.lts,extend:JSON.stringify(t.extend)});this.send({type:wy.REQ_USER_ACCOUNT,data:o},!0)}joinGateway(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info;t.vid&&(r.vid=t.vid),r.uid=t.uid,r.cid=t.cid;let i=Date.now(),{firstSuccess:o,avoidJoinStartTime:a,isProxy:s,addr:A}=t,c=i-(o&&a?a:n.startTime),l=sy(sy({},r),{},{eventType:Cy.JOIN_GATEWAY,lts:i,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,elapse:c,eventElapse:i-t.lts,firstSuccess:o,signalChannel:t.signalChannel}),d=l.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=i),o)this.send({type:wy.JOIN_GATEWAY,data:l},!0);else{let e;if(A)if(s){let t=A.match(/h=(\d{1,3}-){3}\d{1,3}/g),n=A.match(/p=[0-9]{1,6}/g);e={isSuccess:d,gatewayIp:t&&t.length?t[0].split("=")[1].replace(/-/g,"."):"",port:n&&n.length?n[0].split("=")[1]:"",isProxy:s?1:0}}else{let t=A.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),n=A.match(/(:|p=)[0-9]{1,6}/g);e={isSuccess:d,gatewayIp:t&&t.length?t[0].split("//")[1].replace(/-/g,"."):"",port:n&&n.length?n[0].split(/:|p=/g)[1]:"",isProxy:s?1:0}}else e={isSuccess:d,gatewayIp:"",port:"",isProxy:s?1:0};delete l.success,delete l.eventType,delete l.firstSuccess,l.vid=Number(l.vid);let t=Object.assign({},l,e,{eventType:Cy.REJOIN_GATEWAY});this.send({type:wy.RE_JOIN_GATEWAY,data:t},!0)}}joinChannelTimeout(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=Date.now(),i=sy(sy({},n.info),{},{lts:r,timeout:t,elapse:r-n.startTime});this.send({type:wy.JOIN_CHANNEL_TIMEOUT,data:i},!0)}publish(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),o=sy(sy({},r),{},{eventType:Cy.PUBLISH,lts:i,eventElapse:t.eventElapse,elapse:i-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:wy.PUBLISH,data:o},!0)}subscribe(e,t,n){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,o=Date.now(),a=sy(sy({},i),{},{eventType:Cy.SUBSCRIBE,lts:o,eventElapse:t.eventElapse,elapse:o-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid},n&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof t.peerid?a.peerSuid=t.peerid:a.peer=t.peerid,this.send({type:wy.SUBSCRIBE,data:a},!0)}wsCompressorInit(e){var t;let n=[...Qh(t=this.baseInfoMap).call(t)],r=n.length?n[0]:"UnableToGetSid",i=this.baseInfoMap.get(r);if(!i)return;let o=i.info,a=Date.now(),s=sy(sy({},o),{},{eventType:Cy.WS_COMPRESSOR_INIT,lts:a,eventElapse:e.eventElapse,elapse:a-i.startTime,status:e.status?1:2});this.send({type:wy.WS_COMPRESSOR_INIT,data:s},!0)}firstRemoteVideoDecode(e,t,n,r){let i=this.baseInfoMap.get(e);if(!i)return;let o=i.info,a=Date.now(),s=sy(sy(sy({},o),r),{},{elapse:a-i.startTime,eventType:t,lts:a,firstDecodeFrame:Math.max(a-i.startTime,0),apEnd:Math.max(r.apEnd-i.startTime,0),apStart:Math.max(r.apStart-i.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-i.startTime,0),joinGwStart:Math.max(r.joinGwStart-i.startTime,0),pcEnd:Math.max(r.pcEnd-i.startTime,0),pcStart:Math.max(r.pcStart-i.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-i.startTime,0),subscriberStart:Math.max(r.subscriberStart-i.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-i.startTime,0)});this.send({type:n,data:s},!0)}firstRemoteFrame(e,t,n,r){let i=this.baseInfoMap.get(e);if(!i)return;let o=i.info,a=Date.now(),s=sy(sy(sy({},o),r),{},{elapse:a-i.startTime,eventType:t,lts:a});this.send({type:n,data:s},!0)}pcStats(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),o=sy(sy(sy({},r),t),{},{vid:void 0===r.vid?0:Number(r.vid),elapse:i-n.startTime,eventType:Cy.PC_STATS,lts:i});this.send({type:wy.PC_STATS,data:o},!0)}updateRemoteRTPCapabilities(e,t){if(e){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),o=sy(sy(sy({},r),t),{},{vid:void 0===r.vid?0:Number(r.vid),eventType:Cy.UPDATE_REMOTE_RTPCAPABILITIES,lts:i});this.send({type:wy.UPDATE_REMOTE_RTPCAPABILITIES,data:o},!0)}}onGatewayStream(e,t,n,r){let i=this.baseInfoMap.get(e);if(!i)return;let o=i.info,a=Date.now(),s=sy(sy(sy({},o),r),{},{eventType:t,lts:a});this.send({type:n,data:s},!0)}streamSwitch(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),o=sy(sy({},r),{},{eventType:Cy.STREAM_SWITCH,lts:i,isDual:t.isdual,elapse:i-n.startTime,success:t.succ});this.send({type:wy.STREAM_SWITCH,data:o},!0)}requestProxyAppCenter(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),o=sy(sy({},r),{},{eventType:Cy.REQUEST_PROXY_APPCENTER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:wy.REQUEST_PROXY_APPCENTER,data:o},!0)}requestProxyWorkerManager(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),o=sy(sy({},r),{},{eventType:Cy.REQUEST_PROXY_WORKER_MANAGER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:wy.REQUEST_PROXY_WORKER_MANAGER,data:o},!0)}setProxyServer(e){this.proxyServer=e,e?Ey.debug("reportProxyServerurl: ".concat(e)):Ey.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),o=sy(sy({},r),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:i,elapse:i-n.startTime,joinChannelSuccessElapse:i-(n.lastJoinSuccessTime||i),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:wy.PEER_PUBLISH_STATUS,data:o},!0)}workerEvent(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now();(function(e,t,n){let r=e[t];if(!r||"string"!=typeof r)return[e];e[t]="";let i=mv(JSON.stringify(e)),o=0,a=[],s=0;for(let A=0;A<r.length;A++)s+=r.charCodeAt(A)<=127?1:3,s<=1300-i||(a[a.length]=wT(wT({},e),{},{[t]:r.substring(o,A)}),o=A,s=r.charCodeAt(A)<=127?1:3);return o!==r.length-1&&(a[a.length]=wT(wT({},e),{},{[t]:r.substring(o)})),a})(sy(sy(sy({},r),t),{},{elapse:i-n.startTime,lts:i,productType:"WebRTC"}),"payload").forEach((e=>this.send({type:wy.WORKER_EVENT,data:e},!0)))}apworkerEvent(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),o=sy(sy(sy({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:wy.AP_WORKER_EVENT,data:o},!0)}joinWebProxyAP(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),o=sy(sy(sy({},r),t),{},{elapse:i-n.startTime,lts:i,extend:t.extend||void 0});this.send({type:wy.JOIN_WEB_PROXY_AP,data:o},!0)}WebSocketQuit(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),o=sy(sy(sy({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:wy.WEBSOCKET_QUIT,data:o},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>$v("CUSTOM_REPORT_LIMIT"))throw new vT(TT.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval((()=>{this.customReportCount=0}),5e3));let n=Date.now(),r=t.map((t=>({type:wy.USER_ANALYTICS,data:sy(sy({sid:e},t),{},{lts:n})})));try{$v("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(r):await this.postDataToStatsCollector(r)}catch(i){throw Ey.error("send custom report message failed",i.toString()),new vT(TT.CUSTOM_REPORT_SEND_FAILED,i.message)}}sendApiInvoke(e){let t=$v("NOT_REPORT_EVENT");if(e.tag&&yr(t)&&yr(t).call(t,e.tag))return!1;if(null===e.sid)return this.apiInvokeUploadPendingItems.push(e),!1;let n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;let r,{cname:i,uid:o,cid:a}=n.info;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof vT){let{code:t,message:n}=e.error;r=t||n||e.error.toString()}else r=e.error.toString();let s={invokeId:e.invokeId,sid:e.sid,cname:i,cid:a,uid:o,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?r:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:wy.API_INVOKE,data:s},!1),!0}appendSessionId(){Sy.__CLIENT_LIST__.forEach((e=>{if(e._sessionId){let t=this.apiInvokeUploadPendingItems.length;for(let n=0;n<t;n++){let t=this.apiInvokeUploadPendingItems.shift();t&&(t.sid=e._sessionId,this.sendApiInvoke(Object.assign({},t)))}}}))}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>$v("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){let n=[],r=[];for(;e.length;){let t=e.shift();n.length<20?n.push(t):r.push(t)}e.push(...r);for(let o of[...n]){var i;-1!==this.ltsList.indexOf(o.data.lts)?(o.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(o.data.lts)):(this.ltsList.push(o.data.lts),Lp(i=this.ltsList).call(i,((e,t)=>e-t)))}return t||(this.lastSendNormalEventTime=Date.now()),$v("ENABLE_EVENT_REPORT")&&n.length&&($v("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((e=>n=>{$v("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(e):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(e),this.normalEventUploadPendingItems.length>$v("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-$v("NORMAL_EVENT_QUEUE_CAPACITY")),Ey.warning("report: drop normal events"))))})(n)),e}async postDataToStatsCollector2(e){av.networkState===ev.OFFLINE&&await wu.race([av.onlineWaiter,wv(2*kv.maxRetryTimeout)]);let t=e=>{let t=new Uint8Array;return e.forEach((e=>{let n=FT(JSON.stringify(e.data)),r=new ArrayBuffer(5),i=(e=>{let t=0;return Object.entries(wy).forEach((n=>{let[r,i]=n;i===e.type&&(t=EventNameToID[r])})),t})(e),o=new DataView(r);o.setUint16(0,n.byteLength,!0),o.setUint8(2,255&i),o.setUint8(3,i>>>8&255),o.setUint8(4,i>>>16&255),t=xT(t,new Uint8Array(r)),t=xT(t,n)})),t},n="event",r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($v("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat($v("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let o=0;o<2;o+=1){1===o&&(r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($v("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat($v("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await Kv(r,{timeout:1e4,data:t(e),headers:sy(sy({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(i){if(1===o)throw i;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map((e=>JSON.stringify(e))),vid:(e=>{let t=e&&e.data.sid&&this.baseInfoMap.get(e.data.sid);return t&&t.info.vid&&+t.info.vid||0})(e[0])};av.networkState===ev.OFFLINE&&await wu.race([av.onlineWaiter,wv(2*kv.maxRetryTimeout)]);let r=t?"/events/proto-raws":"/events/messages",i=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($v("EVENT_REPORT_DOMAIN"),"&p=").concat($v("STATS_COLLECTOR_PORT"),"&d=").concat(r):"https://".concat($v("EVENT_REPORT_DOMAIN"),":").concat($v("STATS_COLLECTOR_PORT")).concat(r));for(let a=0;a<2;a+=1){1===a&&(i=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($v("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat($v("STATS_COLLECTOR_PORT"),"&d=").concat(r):"https://".concat($v("EVENT_REPORT_BACKUP_DOMAIN"),":").concat($v("STATS_COLLECTOR_PORT")).concat(r)));try{t?await jv(i,{timeout:1e4,data:n}):await Kv(i,{timeout:1e4,data:n})}catch(o){if(1===a)throw o;continue}return}}createBaseInfo(e,t){let n=Object.assign({},_y);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){let n=performance.getEntriesByName(e),r=n[n.length-1];r&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:r,tag:GT.TRACER}).onSuccess()}}function Ty(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,n,r){let i=r.value;if("function"==typeof i){let o=e.className||t.__className__||("AgoraRTCClient"===t.constructor.name?"Client":t.constructor.name);r.value=function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];let s=r;if(e.argsMap)try{s=e.argsMap(this,...r)}catch(c){Ey.warning(c),s=[]}try{JSON.stringify(s)}catch{Ey.warning("arguments for method ".concat(o,".").concat(String(n)," not serializable for apiInvoke.")),s=[]}let A=(e.report||vy).reportApiInvoke(this._sessionId||null,{name:"".concat(o,".").concat(String(n)),options:s,tag:GT.TRACER,reportResult:e.reportResult},e.throttleTime);try{let t=i.apply(this,r);return t instanceof wu?t.then((t=>(A.onSuccess(e.reportResult&&t),t))).catch((e=>{throw A.onError(e),e})):(A.onSuccess(e.reportResult&&t),t)}catch(c){throw A.onError(c),c}}}return r}}Ay(Sy,"__CLIENT_LIST__",[]);let vy=new Sy;cy.on("REPORT_LOG_UPLOAD",(e=>{e.networkState=av.networkState,vy.reportApiInvoke(null,{name:"logUploadError",options:e,tag:GT.TRACER}).onSuccess("logUploadError")}));let yy=["CHINA","GLOBAL"],Iy=function(){let e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");let r=n.join(""),i=[];for(let s=0;s<6;s++)i.push("1");let o=i.join(""),a={};return a[e]=r,a[t]=o,Object.assign(a,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Iy,Yv||(qv.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],qv.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],qv.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],qv.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],qv.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],qv.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],qv.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",qv.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",qv.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",qv.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",qv.AREAS=["NORTH_AMERICA","OVERSEA"]);let Ry=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],by=[];function Oy(e,t){return!!t&&by.some((n=>n.uid===e&&n.channelName===t))}Sy.__CLIENT_LIST__=by;var By=XE.forEach,Ny=Ur("forEach")?[].forEach:function(e){return By(this,e,arguments.length>1?arguments[1]:void 0)};In({target:"Array",proto:!0,forced:[].forEach!=Ny},{forEach:Ny});var Dy=Jn("Array").forEach,Py=lr,Uy=ze,Ly=c,ky=Dy,My=Array.prototype,Fy={DOMTokenList:!0,NodeList:!0},xy=t((function(e){var t=e.forEach;return e===My||Ly(My,e)&&t===My.forEach||Uy(Fy,Py(e))?ky:t})),Qy=Ye,Vy=Gi;In({target:"Object",stat:!0,forced:n((function(){Vy(1)}))},{keys:function(e){return Vy(Qy(e))}});var Hy=t(te.Object.keys),Ky=t(Vr),jy=In,Gy=Zf,Wy=A([].reverse),Yy=[1,2];jy({target:"Array",proto:!0,forced:String(Yy)===String(Yy.reverse())},{reverse:function(){return Gy(this)&&(this.length=this.length),Wy(this)}});var Jy=Jn("Array").reverse,Xy=c,zy=Jy,qy=Array.prototype,Zy=function(e){var t=e.reverse;return e===qy||Xy(qy,e)&&t===qy.reverse?zy:t},$y=t(Zy),eI=In,tI=Zf,nI=IA,rI=ee,iI=Ln,oI=Qn,aI=q,sI=Wh,AI=lt,cI=UA,lI=cE("slice"),dI=AI("species"),uI=Array,hI=Math.max;eI({target:"Array",proto:!0,forced:!lI},{slice:function(e,t){var n,r,i,o=aI(this),a=oI(o),s=iI(e,a),A=iI(void 0===t?a:t,a);if(tI(o)&&(n=o.constructor,(nI(n)&&(n===uI||tI(n.prototype))||rI(n)&&null===(n=n[dI]))&&(n=void 0),n===uI||void 0===n))return cI(o,s,A);for(r=new(void 0===n?uI:n)(hI(A-s,0)),i=0;s<A;s++,i++)s in o&&sI(r,i,o[s]);return r.length=i,r}});var pI=Jn("Array").slice,fI=c,EI=pI,gI=Array.prototype,mI=t((function(e){var t=e.slice;return e===gI||fI(gI,e)&&t===gI.slice?EI:t}));function _I(e,t,n,r,i){var o,a,s,A={};return xy(o=Hy(r)).call(o,(function(e){A[e]=r[e]})),A.enumerable=!!A.enumerable,A.configurable=!!A.configurable,("value"in A||A.initializer)&&(A.writable=!0),A=Ky(a=$y(s=mI(n).call(n)).call(s)).call(a,(function(n,r){return r(e,t,n)||n}),A),i&&void 0!==A.initializer&&(A.value=A.initializer?A.initializer.call(i):void 0,A.initializer=void 0),void 0===A.initializer&&(zf(e,t,A),A=null),A}var CI=Jn("Array").values,wI=lr,SI=ze,TI=c,vI=CI,yI=Array.prototype,II={DOMTokenList:!0,NodeList:!0},RI=t((function(e){var t=e.values;return e===yI||TI(yI,e)&&t===yI.values||SI(II,wI(e))?vI:t}));let bI=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),OI=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({}),BI=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),NI=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),DI=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),PI=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),UI=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),LI=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),kI=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_CONNECTING="datachannel_connecting",e.DATACHANNEL_FAILBACK="datachannel_failback",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e}({}),MI=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),FI=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),xI=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),QI=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),VI=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});class HI extends vT{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",arguments.length>2?arguments[2]:void 0),O_(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error";return super.print(e,Ey)}throw(){super.throw(Ey)}}function KI(e){if("string"!=typeof e||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw Ey.error("Invalid Channel Name ".concat(e)),new HI(TT.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function jI(e){if(!("number"==typeof(t=e)&&Math.floor(t)===t&&0<=t&&t<=4294967295)&&!DT(e,1,255))throw new HI(TT.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;"string"==typeof e&&Ey.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let GI=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e.INJECT="inject_streaming",e}({}),WI=function(e){return e[e.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",e[e.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",e[e.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",e[e.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",e[e.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",e[e.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",e[e.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",e[e.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",e[e.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN",e}({}),YI={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},JI={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function XI(e,t){OT(e.url,"".concat(t,".url"),1,1e3,!1),NT(e.x)||RT(e.x,"".concat(t,".x"),0,1e4),NT(e.y)||RT(e.y,"".concat(t,".y"),0,1e4),NT(e.width)||RT(e.width,"".concat(t,".width"),0,1e4),NT(e.height)||RT(e.height,"".concat(t,".height"),0,1e4),NT(e.zOrder)||RT(e.zOrder,"".concat(t,".zOrder"),0,255),NT(e.alpha)||RT(e.alpha,"".concat(t,".alpha"),0,1,!1)}let zI={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},qI={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30},ZI=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.INJECT_STREAM_STATUS="@live_uap-inject-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),$I=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),eR=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function tR(e){if(!e.channelName)throw new HI(TT.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof e.uid)throw new HI(TT.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&OT(e.token,"info.token",1,2047),jI(e.uid),KI(e.channelName),!0}let nR=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),rR=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),iR=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),oR=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),aR=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),sR=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_FAILBACK="datachannel_failback",e.RESET_SIGNAL="reset-signal",e}({}),AR=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),cR=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),lR=function(e){return e[e.websocket=0]="websocket",e[e.datachannel=1]="datachannel",e}({}),dR=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({}),uR=[dR.AFRICA,dR.ASIA,dR.CHINA,dR.EUROPE,dR.GLOBAL,dR.INDIA,dR.JAPAN,dR.NORTH_AMERICA,dR.OCEANIA,dR.OVERSEA,dR.SOUTH_AMERICA],hR=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({}),pR={CHINA:{},ASIA:{CODE:hR.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:hR.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:hR.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:hR.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:hR.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:hR.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:hR.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:hR.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:hR.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:hR.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:hR.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:hR.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:hR.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};Yv&&(pR.CHINA={CODE:hR.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let fR=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e}({});class ER extends VT{constructor(e,t){super(),O_(this,"onICEConnectionStateChange",void 0),O_(this,"onConnectionStateChange",void 0),O_(this,"onDTLSTransportStateChange",void 0),O_(this,"onDTLSTransportError",void 0),O_(this,"onICETransportStateChange",void 0),O_(this,"onFirstAudioReceived",void 0),O_(this,"onFirstVideoReceived",void 0),O_(this,"onFirstAudioDecoded",void 0),O_(this,"onFirstVideoDecoded",void 0),O_(this,"onFirstVideoDecodedTimeout",void 0),O_(this,"onSelectedLocalCandidateChanged",void 0),O_(this,"onSelectedRemoteCandidateChanged",void 0),O_(this,"getLocalVideoStats",void 0)}}class gR extends ER{constructor(e,t){super(e,t),O_(this,"establishPromise",void 0)}}let mR=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),_R=function(e){return e[e.UDP=0]="UDP",e[e.TCP=1]="TCP",e[e.RELAY=2]="RELAY",e}({}),CR=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.TCP_RESTART=1]="TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({}),wR=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),SR=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),TR=function(e){return e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),vR=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),yR=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),IR=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),RR=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),bR=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e}({}),OR=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),BR=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),NR=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),DR=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),PR=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),UR=function(e){return e.ABORT="abort",e}({}),LR=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),kR=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({}),MR={[BI.ACCESS_POINT]:{[PI.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[PI.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[PI.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[PI.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[PI.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[PI.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[PI.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[PI.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[PI.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[PI.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[PI.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[PI.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[PI.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[PI.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[PI.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[PI.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[PI.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[PI.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[BI.UNILBS]:{[DI.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[DI.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[DI.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[DI.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[DI.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[DI.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[DI.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[DI.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[DI.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[DI.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[DI.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[DI.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[BI.STRING_UID_ALLOCATOR]:{[NI.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[NI.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[NI.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function FR(e){let t=MR[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};let n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===BI.ACCESS_POINT){let t=e%1e4;if("1"===t.toString()[0])return{desc:e.toString(),retry:!1};if("2"===t.toString()[0])return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}let xR={[UI.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[UI.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[UI.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[UI.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[UI.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[UI.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[UI.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[UI.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[UI.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[UI.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[UI.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[UI.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[UI.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[UI.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[UI.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[UI.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[UI.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[UI.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[UI.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[UI.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[UI.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[UI.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[UI.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[UI.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[UI.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[UI.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[UI.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[UI.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[UI.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[UI.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[UI.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[UI.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[UI.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[UI.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[UI.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[UI.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[UI.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[UI.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[UI.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[UI.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[UI.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[UI.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[UI.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[UI.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[UI.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[UI.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[UI.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[UI.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[UI.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[UI.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[UI.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[UI.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[UI.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[UI.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[UI.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[UI.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[UI.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[UI.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[UI.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[UI.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[UI.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[UI.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[UI.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function QR(e){return xR[e]||{desc:"UNKNOW_ERROR_".concat(e),action:"failed"}}function VR(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function HR(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?VR(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VR(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function KR(e){return e.every((e=>e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING))}function jR(e,t){if("string"==typeof e)return e;let{proxy:n,host:r,port:i}=e;if(t){let e=$v("JOIN_GATEWAY_FALLBACK_PORT")||443;return 443===e?"wss://".concat(r,"/ws/?p=").concat(Number(i)+150):"wss://".concat(r,":").concat(e,"/ws/?p=").concat(Number(i)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(r,"&p=").concat(i):"wss://".concat(r,":").concat(i)}let GR=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,WR=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,YR=/wss:\/\/(.+):([0-9]+)\/?/,JR=/wss:\/\/(.[^\/]+)\/?/,XR=0;class zR{constructor(e,t){O_(this,"id",0),O_(this,"store",void 0),O_(this,"recordIndex",void 0),O_(this,"websockets",[]),O_(this,"try443PortDuration",2e3),O_(this,"forceCloseWSDuration",5e3),O_(this,"try443PortTimeout",null),O_(this,"forceCloseTimeout",null),O_(this,"isTry443PortFailed",!1),O_(this,"isNormalPortFailed",!1),O_(this,"useDoubleDomain",!1),O_(this,"useProxy",!1),O_(this,"startTime",Date.now()),this.id=++XR,this.try443PortDuration=$v("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=t}closeAllWebsockets(){this.websockets.forEach((e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()})),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var e;let t=Date.now()-this.startTime;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];Ey.debug("[choose-best-ws ".concat(null===(e=this.store)||void 0===e?void 0:e.clientId," ").concat(this.id,"] ").concat(t,"ms:"),...r)}createWebSocket(e,t,n){this.logger("createWebSocket:",e,{isTry443Port:t,hasTimeoutDetection:n});let r=$v("GATEWAY_DOMAINS"),i=Date.now(),o=[],a=r.find((t=>{var n;return yr(n=e.host).call(n,t)}));a||(this.useDoubleDomain=!1);let s=[];if(this.useDoubleDomain)r.forEach((n=>{s.push(jR(HR(HR({},e),{},{host:e.host.replace(a,n)}),t))}));else{let n=HR({},e);if(t&&a){let e=r.find((e=>e!==a));e&&(n.host=n.host.replace(a,e))}s.push(jR(n,t))}try{s.forEach((e=>{let t=new WebSocket(e);t.binaryType="arraybuffer",o.push(t),this.logger("ws is connecting:",t.url)}))}catch(c){if(this.logger("ws create failed"),o.forEach((e=>e.close())),o.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,t,n);if(!t&&443!==Number(e.port))return this.createWebSocket(e,!0,n);throw new HI(TT.WS_ERR,"init websocket failed! Error: ".concat(c.toString()))}let A=MS();return this.store&&this.store.recordJoinChannelService({urls:o.map((e=>e.url)),service:"gateway"},this.recordIndex),o.forEach((e=>{e.onopen=()=>{this.logger("onopen: ws ".concat(e.url," open cost ").concat(Date.now()-i,"ms")),this.websockets.forEach((t=>{t!==e&&(t.onopen=null,t.onclose=null,t.onmessage=null,t.close(),this.logger("close backup websocket: ".concat(t.url)))})),this.websockets.length=0,A.resolve(e)},e.onclose=n=>{this.logger("onclose: ws ".concat(e.url," closed cost ").concat(Date.now()-i,"ms state: ").concat(e.readyState)),t?this.isTry443PortFailed=KR(o):this.isNormalPortFailed=KR(o),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(t&&this.isTry443PortFailed||!t&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(n.reason)),A.reject({code:n.code,reason:AR.A_ROUND_WS_FAILED}))},e.onmessage=t=>this.logger("".concat(e.url," onmessage: ").concat(t.data))})),this.websockets.push(...o),n||(()=>{let n=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",A.isResolved),this.websockets.forEach((e=>e.readyState!==WebSocket.OPEN&&e.close()))};if(t||this.useProxy)return this.logger("add 5s timeout at ".concat(t?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(n,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout((()=>{if(this.logger("2s timeout, isWebsocket created: ",A.isResolved),A.isResolved)return n();WS().os===VS.MAC_OS&&eT()&&n(),this.createWebSocket(e,!0,!0).then((e=>A.resolve(e))).catch((e=>{this.isNormalPortFailed&&A.reject(e),this.logger("try 443 port to create ws failed")})),this.forceCloseTimeout=window.setTimeout(n,this.forceCloseWSDuration)}),this.try443PortDuration)})(),A.promise}chooseBestWebsocket(e,t,n,r){return this.useDoubleDomain=!!t,"string"==typeof e&&(e=function(e){let t,n,r;return[,t,n,r]=e.match(GR)||[],t||([,n,r]=e.match(WR)||[]),n&&r||([,n,r]=e.match(YR)||[]),n&&r||([,n]=e.match(JR)||[]),n||Ey.warning("un-destructible url: ",e),{proxy:t,host:n,port:r||"443"}}(e)),this.recordIndex=r,this.useProxy=!!e.proxy,n&&this.useProxy&&(Ey.warn("cannot use 443 only when use proxy"),n=!1),this.createWebSocket(e,!!n,!1).finally((()=>this.clearTimeout()))}}function qR(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}class ZR extends VT{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var t;yr(t=["tryNext","recover"]).call(t,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,"reconnecting"===this._state?this.emit(VI.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(VI.CONNECTED):"closed"===this._state?this.emit(VI.CLOSED):"failed"===this._state&&this.emit(VI.FAILED))}resetReconnectCount(e){Ey.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0;super(),O_(this,"connectionID",0),O_(this,"currentURLIndex",0),O_(this,"urls",[]),O_(this,"_reconnectMode","tryNext"),O_(this,"reconnectReason",void 0),O_(this,"_initMutex",new Uv("websocket")),O_(this,"name",void 0),O_(this,"_state","closed"),O_(this,"reconnectInterrupter",void 0),O_(this,"websocket",void 0),O_(this,"retryConfig",void 0),O_(this,"reconnectCount",0),O_(this,"forceCloseTimeout",5e3),O_(this,"onlineReconnectListener",void 0),O_(this,"useCompress",void 0),O_(this,"tryDoubleDomain",!1),O_(this,"use443PortOnly",!1),O_(this,"wsInflateLength",0),O_(this,"wsDeflateLength",0),O_(this,"closeEstablishingWs",(()=>{})),O_(this,"store",void 0),O_(this,"joinGatewayRecordIndex",void 0),this.store=o,this.name=e,this.retryConfig=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qR(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qR(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t),this.useCompress=n,this.tryDoubleDomain=r,this.use443PortOnly=i;let{timeout:a,timeoutFactor:s}=t,A=Math.max(300,Math.floor(3*a/5)),c=Math.max(1.2,Math.floor(8*s)/10);ev.ONLINE&&(this.retryConfig.timeout=A,this.retryConfig.timeoutFactor=c),av.on(tv.NETWORK_STATE_CHANGE,((e,t)=>{e!==t&&(this.resetReconnectCount("network state change: ".concat(t," -> ").concat(e)),e===ev.ONLINE?(this.retryConfig.timeout=A,this.retryConfig.timeoutFactor=c):(this.retryConfig.timeout=a,this.retryConfig.timeoutFactor=s))}))}getConnection(){return this.websocket||void 0}async init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,n=await this._initMutex.lock();this.forceCloseTimeout=t,this.urls=e,this.state="connecting";try{let e=MS(),t=this.urls[this.currentURLIndex];this.createWebSocketConnection(t).then(e.resolve).catch(e.reject),this.once(VI.CLOSED,(()=>{e.reject(new vT(TT.WS_DISCONNECT))})),this.once(VI.CONNECTED,e.resolve),await e.promise}catch{}finally{n()}}close(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;let e=this.websocket;t?setTimeout((()=>e.close()),500):e.close(),this.websocket=void 0}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,t){if(!this.websocket)return void Ey.warning("[".concat(this.name,"] can not reconnect, no websocket"));void 0!==e&&(this.reconnectMode=e),Ey.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinGatewayRecordIndex&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(t)]},this.joinGatewayRecordIndex);let n=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),n&&n.bind(this.websocket)({code:9999,reason:t})}sendMessage(e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new vT(TT.WS_ABORT,"websocket is not ready");try{t||(e=JSON.stringify(e)),this.websocket.send(e)}catch(n){throw new vT(TT.WS_ERR,"send websocket message error"+n.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){let e=this.wsInflateLength,t=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:t}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var t;let n=MS();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;let r=e=>{var t;null===(t=this.store)||void 0===t||t.signalChannelOpen(),Ey.debug("[".concat(this.name,"] websocket opened:"),e),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),n.resolve()},i=async e=>{var t;if(Ey.debug("[".concat(this.name,"] websocket close ").concat(null===(t=this.websocket)||void 0===t?void 0:t.url,", code: ").concat(e.code,", reason: ").concat(e.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)n.reject(new vT(TT.WS_DISCONNECT,"websocket close: ".concat(e.code))),this.close();else{"connected"===this.state&&(this.reconnectReason=e.reason,this.state="reconnecting");let t=iv(this,VI.WILL_RECONNECT,this.reconnectMode,e.reason)||this.reconnectMode,r=await this.reconnectWithAction(t);if("closed"===this.state)return void Ey.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!r)return n.reject(new vT(TT.WS_DISCONNECT,"websocket reconnect failed: ".concat(e.code))),this.close(!0);n.resolve()}},o=e=>{this.emit(VI.ON_MESSAGE,e)},a=e=>{Ey.warn("[".concat(this.connectionID,"] ws open error ").concat(e))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),$v("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=$v("GATEWAY_WSS_ADDRESS")),Ey.debug("[".concat(this.name,"] start connect, url:"),e);let s=null===(t=this.store)||void 0===t?void 0:t.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var A;let t=await this.chooseBestWebsocketConnection(e);this.websocket=t,r&&r(this.websocket.url),this.websocket.onclose=i,this.websocket.onmessage=o,this.websocket.onerror=a,null===(A=this.store)||void 0===A||A.recordJoinChannelService({endTs:Date.now(),status:"success"},s),this.joinGatewayRecordIndex=s}catch(c){let e="closed"===this.state,t=c instanceof vT,r=t&&c.code===TT.WS_ABORT,o=t&&c.code===TT.WS_ERR,a=t?c.message:c&&(c.reason||c.toString());Ey.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(a)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:r?"aborted":"error",errors:[c]},s),e||o?(n.reject(e?new vT(TT.WS_DISCONNECT,"websocket is closed: ".concat(a)):new vT(TT.WS_ERR,"init websocket failed: ".concat(a))),o&&Ey.error("[".concat(this.name,"] init websocket failed: ").concat(a))):i&&i(c)}return n.promise}async reconnectWithAction(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||0===this.urls.length||"closed"===this.state)return!1;Ey.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||av.isOnline||!av.onlineWaiter||(this.onlineReconnectListener=av.onlineWaiter.then((()=>{this.onlineReconnectListener=void 0})));let n=!0;if(this.reconnectInterrupter=()=>n=!1,t){let t=Mv(this.reconnectCount,this.retryConfig);Ey.debug("[".concat(this.name,"] wait ").concat(t,"ms to reconnect websocket, mode: ").concat(e)),await wu.race([wv(t),this.onlineReconnectListener||new wu((()=>{}))])}if("closed"===this._state||!n)return!1;this.reconnectCount+=1;let r=async(e,t)=>{this.emit(VI.RECONNECT_CREATE_CONNECTION,t),await this.createWebSocketConnection(e)};try{if("retry"===e)this.emit(VI.RECONNECT_WAITTING_FINISH,e),await r(this.urls[this.currentURLIndex],e);else if("tryNext"===e){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);Ey.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(VI.RECONNECT_WAITTING_FINISH,e),await r(this.urls[this.currentURLIndex],e)}else"recover"===e&&(Ey.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(VI.RECONNECT_WAITTING_FINISH,e),this.urls=await nv(this,VI.REQUEST_NEW_URLS),this.currentURLIndex=0,await r(this.urls[this.currentURLIndex],e))}catch(o){var i;Ey.error("[".concat(this.name,"] reconnect failed ").concat(o&&o.toString()));let n=null==o||null===(i=o.data)||void 0===i?void 0:i.desc;return Array.isArray(n)&&yr(n).call(n,"dynamic key expired")?(this.emit(VI.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,t)}return!0}}class $R extends ZR{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){let n=MS(),r=(i=this.forceCloseTimeout,o=this.store,new zR(i,o));var i,o;this.closeEstablishingWs=()=>{Ey.debug("[choose-best-ws] close establishing websockets"),r.closeAllWebsockets(),n.reject(new vT(TT.WS_ABORT,"choose best websocket aborted"))};let a=$v("GATEWAY_DOMAINS");return Ey.debug("[choose-best-ws] currentDomain: ",e,", domains: ",a,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),r.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,t).then(n.resolve).catch(n.reject),n.promise.finally((()=>{this.closeEstablishingWs=void 0}))}}class eb extends ZR{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){return new wu(((n,r)=>{let i=!1,o=[];this.closeEstablishingWs=()=>{Ey.debug("[choose-best-ws] close establishing websockets"),o.forEach((e=>{e.onclose=null,e.onopen=null,e.onmessage=null,e.close()})),r(new vT(TT.WS_ABORT,"choose best websocket aborted"))};let a,s=$v("GATEWAY_DOMAINS"),A=e.indexOf("?h="),c=s.find((t=>-1!==A?yr(e).call(e,t,A):yr(e).call(e,t)));Ey.debug("[choose-best-ws] currentDomain: ",c,", domains: ",s);let l=!this.tryDoubleDomain||!c;if(!l&&c){var d;let u=Date.now();try{s.forEach((t=>{let n=-1===A?e.replace(c,t):e.substr(0,A)+e.substr(A).replace(c,t),r=new WebSocket(n);r.binaryType="arraybuffer",o.push(r),Ey.debug("[choose-best-ws] ws is connecting:",r.url)}))}catch{for(Ey.debug("[choose-best-ws] ws create failed, fallback to single url"),o.forEach((e=>e.close()));o.length;)o.pop();l=!0}null===(d=this.store)||void 0===d||d.recordJoinChannelService({urls:o.map((e=>e.url)),service:"gateway"},t),o.forEach((e=>{e.onopen=()=>{if(i)return;let t=Date.now()-u;Ey.debug("[choose-best-ws] ws open cost ".concat(t,"ms")),o.filter((t=>t!==e)).forEach((e=>{Ey.debug("[choose-best-ws]close backup websocket: ".concat(e.url)),e.close()})),i=!0,n(e)},e.onclose=e=>{a=e,!i&&(o.find((e=>!(e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING)))||(Ey.debug("[choose-best-ws] all websocket is closed"),i=!0,r(a)))},e.onmessage=t=>{Ey.debug("[choose-best-ws]".concat(e.url," onmessage: ").concat(t.data))}})),wv(this.forceCloseTimeout).then((()=>{o.forEach((e=>{e.readyState!==WebSocket.OPEN&&e.close()}))}))}if(l){var u;let i;Ey.debug("[choose-best-ws] use single url: ",e),null===(u=this.store)||void 0===u||u.recordJoinChannelService({urls:[e],service:"gateway"},t);try{i=new WebSocket(e),o.push(i),i.binaryType="arraybuffer"}catch(h){let e=new vT(TT.WS_ERR,"init websocket failed! Error: ".concat(h.toString()));return Ey.error("[".concat(this.name,"]").concat(e)),void r(e)}i.onopen=()=>{n(i)},i.onclose=e=>{r(e)},i.onmessage=e=>{Ey.debug("[choose-best-ws]".concat(i.url," onmessage: ").concat(e.data))},wv(this.forceCloseTimeout).then((()=>{i&&i.readyState!==WebSocket.OPEN&&i.close()}))}})).then((e=>(this.closeEstablishingWs=void 0,e))).catch((e=>{throw this.closeEstablishingWs=void 0,e}))}}class tb extends VT{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===LI.CONNECTED?this.emit(kI.WS_CONNECTED):e===LI.RECONNECTING?this.emit(kI.WS_RECONNECTING,this._websocketReconnectReason):e===LI.CLOSED&&this.emit(kI.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),O_(this,"_disconnectedReason",void 0),O_(this,"_websocketReconnectReason",void 0),O_(this,"_connectionState",LI.CLOSED),O_(this,"reconnectToken",void 0),O_(this,"websocket",void 0),O_(this,"openConnectionTime",void 0),O_(this,"clientId",void 0),O_(this,"lastMsgTime",Date.now()),O_(this,"uploadCache",[]),O_(this,"uploadCacheInterval",void 0),O_(this,"rttRolling",new xv(5)),O_(this,"pingpongTimer",void 0),O_(this,"wsInflateDataTimer",void 0),O_(this,"pingpongTimeoutCount",0),O_(this,"joinResponse",void 0),O_(this,"multiIpOption",void 0),O_(this,"initError",void 0),O_(this,"spec",void 0),O_(this,"store",void 0),O_(this,"onWebsocketMessage",(e=>{if(e.data instanceof ArrayBuffer)return void this.emit(kI.ON_BINARY_DATA,e.data);let t=JSON.parse(e.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){let e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){if(this.emit(t._type,t._message),t._type===xI.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===xI.ON_USER_BANNED)switch(t._message.error_code){case 14:this.close(JT.UID_BANNED);break;case 15:this.close(JT.IP_BANNED);break;case 16:this.close(JT.CHANNEL_BANNED)}if(t._type===xI.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case UI.ERR_LICENSE_MISSING:this.close(JT.LICENSE_MISSING);break;case UI.ERR_LICENSE_EXPIRED:this.close(JT.LICENSE_EXPIRED);break;case UI.ERR_LICENSE_MINUTES_EXCEEDED:this.close(JT.LICENSE_MINUTES_EXCEEDED);break;case UI.ERR_LICENSE_PERIOD_INVALID:this.close(JT.LICENSE_PERIOD_INVALID);break;case UI.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(JT.LICENSE_MULTIPLE_SDK_SERVICE);break;case UI.ERR_LICENSE_ILLEGAL:this.close(JT.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new $R("gateway-".concat(this.clientId),this.spec.retryConfig,!0,$v("JOIN_GATEWAY_USE_DUAL_DOMAIN"),$v("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===LI.CONNECTED&&this.reconnect("retry",$T.OFFLINE)}))}async request(e,t,n,r){let i=Sv(6,""),o={_id:i,_type:e,_message:t},a=this.websocket.connectionID,s=()=>new wu(((t,n)=>{if(this.connectionState===LI.CONNECTED)return t();let r=()=>{this.off(kI.WS_CLOSED,i),t()},i=()=>{this.off(kI.WS_CONNECTED,r),n(new HI(TT.WS_ABORT))};this.once(kI.WS_CONNECTED,r),this.once(kI.WS_CLOSED,i),e!==MI.PUBLISH&&e!==MI.PUBLISH_DATASTREAM&&e!==MI.SUBSCRIBE&&e!==MI.SUBSCRIBE_DATASTREAM&&e!==MI.UNSUBSCRIBE&&e!==MI.UNSUBSCRIBE_DATASTREAM&&e!==MI.UNPUBLISH&&e!==MI.UNPUBLISH_DATASTREAM&&e!==MI.CONTROL&&e!==MI.RESTART_ICE||this.once(kI.DISCONNECT_P2P,(()=>{n(new HI(TT.DISCONNECT_P2P))})),e!==MI.PUBLISH&&e!==MI.RESTART_ICE||this.once(kI.ABORT_P2P_EXECUTION,(()=>{n(new HI(TT.DISCONNECT_P2P))}))}));if(this.connectionState!==LI.CONNECTING&&this.connectionState!==LI.RECONNECTING||e===MI.JOIN||e===MI.REJOIN||await s(),this.websocket.sendMessage(o,!0),r)return;let A=new wu(((n,r)=>{let o=!1,s=(r,i)=>{o=!0,n({isSuccess:"success"===r,message:i||{}}),this.off(kI.WS_CLOSED,A),this.off(kI.WS_RECONNECTING,A),this.emit(kI.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(i),s);let A=()=>{r(new HI(TT.WS_ABORT,"type: ".concat(e))),this.off(kI.WS_CLOSED,A),this.off(kI.WS_RECONNECTING,A),this.off("res-@".concat(i),s)};this.once(kI.WS_CLOSED,A),this.once(kI.WS_RECONNECTING,A),wv($v("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==a||o||(Ey.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(kI.REQUEST_TIMEOUT,e,t))}))})),c=null;try{c=await A}catch(h){if(this.connectionState===LI.CLOSED||e===MI.LEAVE)throw new HI(TT.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?h.throw():e===MI.JOIN||e===MI.REJOIN?null:(await s(),await this.request(e,t))}if(c.isSuccess)return c.message;let l=Number(c.message.error_code||c.message.code),d=QR(l),u=new HI(TT.UNEXPECTED_RESPONSE,"".concat(d.desc,": ").concat(c.message.error_str),{code:l,data:c.message});return"success"===d.action?c.message:(Ey.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(l,", message: ").concat(d.desc,", action: ").concat(d.action)),l===UI.ERR_TOO_MANY_BROADCASTERS?((e===MI.JOIN||e===MI.REJOIN)&&(this.initError=u,this.close()),u.throw()):"failed"===d.action?u.throw():"quit"===d.action?(this.initError=u,this.close(),u.throw()):(l===UI.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=c.message.option,Ey.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",$T.MULTI_IP)):this.reconnect(d.action,$T.SERVER_ERROR),e===MI.JOIN||e===MI.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new wu((n=>{let r=i=>{(!t||t(i))&&(this.off(e,r),n(i))};this.on(e,r)}))}uploadWRTCStats(e){if(!this.store.sessionId)return void Ey.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(FI.WRTC_STATS,t)}upload(e,t){let n={_type:e,_message:t};try{this.websocket.sendMessage(n)}catch{let e=$v("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>e&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==LI.CONNECTED)return;let e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)}),$v("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){let n={_type:e,_message:t};this.websocket.sendMessage(n)}init(e,t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new wu(((t,n)=>{this.once(kI.WS_CONNECTED,(()=>t(this.joinResponse))),this.once(kI.WS_CLOSED,(()=>n(this.initError||new HI(TT.WS_ABORT)))),this.connectionState=LI.CONNECTING,this.websocket.init(e).catch(n),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval((()=>{this.handleWsInflateData()}),2e4)}))}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||JT.LEAVE,this.connectionState=LI.CLOSED,Ey.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),e===JT.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new $R("gateway-".concat(this.clientId),this.spec.retryConfig,!0,$v("JOIN_GATEWAY_USE_DUAL_DOMAIN"),$v("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(kI.ABORT_P2P_EXECUTION);let e=await nv(this,kI.REQUEST_JOIN_INFO),t=await this.request(MI.JOIN,e);if(!t)return this.emit(kI.REPORT_JOIN_GATEWAY,AR.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(kI.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=LI.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new HI(TT.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let e=ov(this,kI.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;let t=await this.request(MI.REJOIN,e);return!!t&&(this.connectionState=LI.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),t.peers&&t.peers.forEach((e=>{this.emit(xI.ON_USER_ONLINE,{uid:e.uid}),e.audio&&this.emit(xI.ON_ADD_AUDIO_STREAM,{uid:e.uid,uint_id:e.uint_id,audio:!0,ssrcId:e.audio_ssrc}),e.video&&this.emit(xI.ON_ADD_VIDEO_STREAM,{uid:e.uid,uint_id:e.uint_id,video:!0,ssrcId:e.video_ssrc}),e.audio_mute?this.emit(xI.MUTE_AUDIO,{uid:e.uid}):this.emit(xI.UNMUTE_AUDIO,{uid:e.uid}),e.video_mute?this.emit(xI.MUTE_VIDEO,{uid:e.uid}):this.emit(xI.UNMUTE_VIDEO,{uid:e.uid}),e.audio_enable_local?this.emit(xI.ENABLE_LOCAL_AUDIO,{uid:e.uid}):this.emit(xI.DISABLE_LOCAL_AUDIO,{uid:e.uid}),e.video_enable_local?this.emit(xI.ENABLE_LOCAL_VIDEO,{uid:e.uid}):this.emit(xI.DISABLE_LOCAL_VIDEO,{uid:e.uid}),e.audio||e.video||this.emit(xI.ON_REMOVE_STREAM,{uid:e.uid,uint_id:e.uint_id})})),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleNotification(e){Ey.debug("[".concat(this.clientId,"] receive notification: "),e);let t=QR(e.code);if("success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(JT.UID_BANNED),void this.close()):void this.reconnect(t.action,$T.SERVER_ERROR);Ey.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let e=$v("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(Ey.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>$v("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",$T.TIMEOUT):this.request(MI.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;let e=Date.now()-t;this.rttRolling.add(e),$v("REPORT_STATS")&&this.send(MI.PING_BACK,{pingpongElapse:e})})).catch((e=>{}))}handleWsInflateData(){let{wsInflateLength:e,wsDeflateLength:t}=this.websocket.getWsInflateData();0!==e&&0!==t&&this.upload(FI.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(VI.RECONNECT_WAITTING_FINISH,(e=>{this.emit(kI.WS_RECONNECT_WAITTING_FINISH,e)})),this.websocket.on(VI.RECONNECT_CREATE_CONNECTION,(e=>{this.emit(kI.WS_RECONNECT_CREATE_CONNECTION,e)})),this.websocket.on(VI.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(VI.CLOSED,(()=>{this.connectionState=LI.CLOSED})),this.websocket.on(VI.FAILED,(()=>{this._disconnectedReason=JT.NETWORK_ERROR,this.connectionState=LI.CLOSED})),this.websocket.on(VI.RECONNECTING,(e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===LI.CONNECTED?this.connectionState=LI.RECONNECTING:this.connectionState=LI.CONNECTING})),this.websocket.on(VI.WILL_RECONNECT,((e,t,n)=>{let r=ov(this,kI.IS_P2P_DISCONNECTED),i=r||"retry"!==e;r&&"retry"===e&&(Ey.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",t=AR.P2P_DISCONNECTED),i&&(Ey.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(kI.REPORT_JOIN_GATEWAY,t||AR.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(kI.NEED_RENEW_SESSION,this.websocket.currentURLIndex>=this.websocket.urls.length-1?"recover":e),this.emit(kI.DISCONNECT_P2P)),n(e)})),this.websocket.on(VI.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch((e=>{Ey.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",$T.SERVER_ERROR)})):this.join().catch((e=>{if(this.emit(kI.REPORT_JOIN_GATEWAY,e.message||e.code||AR.UNKNOWN_REASON,this.url||""),e instanceof HI){if(e.code===TT.UNEXPECTED_RESPONSE&&e.data.code===UI.ERR_NO_AUTHORIZED)return this.initError=new HI(TT.CAN_NOT_GET_GATEWAY_SERVER,"AgoraRTCError CAN_NOT_GET_GATEWAY_SERVER: dynamic key expired"),Ey.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",$T.SERVER_ERROR);Ey.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",$T.SERVER_ERROR):(this.initError=e,this.close())}}))})),this.websocket.on(VI.REQUEST_NEW_URLS,((e,t)=>{nv(this,kI.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)})),this.websocket.on(VI.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(xI.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}))}}let nb=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function rb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ib(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rb(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rb(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ob(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat($v("TURN_DOMAIN")):(Ey.info("Unidentified as ip: ".concat(e,", use as host")),e)}function ab(e,t){e.addresses||(e.addresses=[]);let n=function(e,t){if($v("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return e.map((e=>{let{ip:t,port:n}=e;return{address:"".concat(t,":").concat(n)}}));let n=$v("GATEWAY_DOMAINS"),r=n[1]&&yr(t).call(t,n[1])?1:0;return e.map((e=>{let{domain_prefix:t,port:i,ip:o}=e;if(t)return{address:"".concat(t,".").concat(n[r++%n.length],":").concat(i)};let a=/^[\.\:\d]+$/.test(o),s=a?"".concat(o.replace(/[^\d]/g,"-"),".").concat(n[r++%n.length],":").concat(i):"".concat(o,":").concat(i);return a||Ey.info("Unidentified as ip: ".concat(o,", use as host")),{ip:o,port:i,address:s}}))}(e.addresses,t),r=Array.isArray(e.detail)&&e.detail[18];if(r&&"string"==typeof r){let e=r.split(";");for(let t=0;t<e.length;t++){var i;let r=_h(i=e[t]).call(i);n[t]&&r&&(n[t].ip6=r)}}return{gatewayAddrs:n,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function sb(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function Ab(e){let t=e._encoderConfig;if(!t)return{};let n={resolution:t.width&&t.height?"".concat(sb(t.width),"x").concat(sb(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return"number"==typeof t.frameRate?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function cb(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function lb(e,t){let n,r,i;switch(t){case nb.CHOOSE_SERVER:r=4096,i="choose server";break;case nb.CLOUD_PROXY:r=1048576,i="proxy";break;case nb.CLOUD_PROXY_5:r=4194304,i="proxy5";break;case nb.CLOUD_PROXY_FALLBACK:r=4194310,i="proxy fallback";break;default:throw new HI(TT.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach((t=>{t.buffer&&t.buffer.flag===r&&(n={code:t.buffer.code,addresses:(t.buffer.edges_services||[]).map((e=>ib(ib({},e),{},{ticket:t.buffer.cert}))),server_ts:e.enter_ts,uid:t.buffer.uid,cid:t.buffer.cid,cname:t.buffer.cname,detail:ib(ib({},t.buffer.detail),e.detail),flag:t.buffer.flag,opid:e.opid,cert:t.buffer.cert})})),!n)throw new HI(TT.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function db(e,t){return await wu.all(e.addresses.map((async e=>({address:ob(e.ip),tcpport:e.port,udpport:e.port,username:t&&$v("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():Iy.username,password:t&&$v("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await QT(t.toString()):Iy.password}))))}function ub(e,t){let n=t.getMediaStreamTrack(!0).getSettings(),r=t.videoHeight||n.height,i=t.videoWidth||n.width;return r&&i?Math.max(Math.min(r,i)/Math.min(sb(e.height),sb(e.width)),1):(Ey.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function hb(e){let{candidateType:t,relayProtocol:n,type:r,address:i,port:o,protocol:a}=e;return"local-candidate"===r?{candidateType:t,relayProtocol:n,protocol:a}:{candidateType:t,relayProtocol:n,address:i,port:o,protocol:a}}function pb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}class fb extends VT{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var t;yr(t=["tryNext","recover"]).call(t,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,"reconnecting"===this._state?this.emit(bR.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(bR.CONNECTED):"closed"===this._state?this.emit(bR.CLOSED):"failed"===this._state&&this.emit(bR.FAILED))}constructor(e,t,n,r){super(),O_(this,"connectionID",0),O_(this,"currentURLIndex",0),O_(this,"reconnectReason",void 0),O_(this,"_reconnectMode","tryNext"),O_(this,"_initMutex",void 0),O_(this,"_name",void 0),O_(this,"_state","closed"),O_(this,"_reconnectInterrupter",void 0),O_(this,"_url",void 0),O_(this,"_retryConfig",void 0),O_(this,"_reconnectCount",0),O_(this,"_forceCloseTimeout",5e3),O_(this,"_onlineReconnectListener",void 0),O_(this,"_closeEstablishingTransmitter",(()=>{})),O_(this,"_store",void 0),O_(this,"_joinChannelServiceRecordIndex",void 0),O_(this,"_transmitter",void 0),O_(this,"_useCompress",void 0),O_(this,"_inflateLength",0),O_(this,"_deflateLength",0),this._store=r,this._name=e,this._retryConfig=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pb(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pb(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t),this._useCompress=n}resetReconnectCount(e){Ey.debug("".concat(this._name," reset reconnect count, reason: ").concat(e)),this._reconnectCount=0}close(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;let e=this._transmitter;t?setTimeout((()=>e.close()),500):e.close(),this._transmitter=void 0}this.state=e?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(e,t){if(!this._transmitter)return void Ey.warning("[".concat(this._name,"] can not reconnect, no websocket"));var n;void 0!==e&&(this.reconnectMode=e),Ey.debug("[".concat(this._name,"] reconnect is triggered initiative")),"number"==typeof this._joinChannelServiceRecordIndex&&(null===(n=this._store)||void 0===n||n.recordJoinChannelService({status:"error",errors:[new Error(t)]},this._joinChannelServiceRecordIndex));let r=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),r&&r.bind(this._transmitter)({code:9999,reason:t})}getInflateData(){let e=this._inflateLength,t=this._deflateLength;return this.clearInflateData(),{inflateLength:e,deflateLength:t}}setInflateData(e){this._deflateLength=this._deflateLength+e.originLength,this._inflateLength=this._inflateLength+e.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}let Eb=function(e){return e[e.Default=0]="Default",e[e.Ack=1]="Ack",e}({});class gb{constructor(e,t,n){O_(this,"version",1),O_(this,"initialRTO",void 0),O_(this,"maxBatchAckCount",void 0),O_(this,"maxRTO",void 0),O_(this,"initialRTT",void 0),O_(this,"ID",void 0),O_(this,"rtt",void 0),O_(this,"packetNumber",1),O_(this,"rtoRatioMap",new Map),O_(this,"timeoutMap",new Map),O_(this,"unorderedPacketQueue",[]),O_(this,"batchAckPacketQueue",[]),O_(this,"lastOrderedPacketNumber",0),O_(this,"batchAckTimer",void 0),O_(this,"sendImpl",void 0),O_(this,"receiveImpl",void 0),this.sendImpl=e,this.receiveImpl=t,this.ID=Sv(7,"transmitter-"),this.initialRTO=void 0!==(null===n||void 0===n?void 0:n.initialRTO)?n.initialRTO:$v("TRANSMITTER_INITIAL_RTO"),this.initialRTT=void 0!==(null===n||void 0===n?void 0:n.initialRTT)?n.initialRTT:$v("TRANSMITTER_INITIAL_RTT"),this.rtt=void 0!==(null===n||void 0===n?void 0:n.initialRTT)?n.initialRTT:$v("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=void 0!==(null===n||void 0===n?void 0:n.maxBatchAckCount)?n.maxBatchAckCount:$v("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=void 0!==(null===n||void 0===n?void 0:n.maxRTO)?n.maxRTO:$v("TRANSMITTER_MAX_RTO")}packetize(e,t){return{type:Eb.Default,version:this.version,packetNumber:t,payload:e}}serialize(e){switch(e.type){case Eb.Default:{let t;t="string"==typeof e.payload?(new TextEncoder).encode(e.payload):e.payload;let n=new ArrayBuffer(t.length+15),r=new DataView(n);return r.setUint16(0,e.version),r.setUint8(2,e.type),r.setUint32(3,e.packetNumber),UT(r,7,BigInt(e.sendTs)),new Uint8Array(r.buffer).set(t,15),n}case Eb.Ack:{let t=new ArrayBuffer(16),n=new DataView(t);return n.setUint16(0,e.version),n.setUint8(2,e.type),n.setUint32(3,e.maxAckPacketNumber),n.setUint8(7,e.shift),UT(n,8,BigInt(e.ackSendTs)),t}}}deserialize(e){let t=new DataView(e),n=t.getUint16(0),r=t.getUint8(2);switch(r){case Eb.Default:{let i=t.getUint32(3),o=PT(t,7),a=e.slice(15),s=(new TextDecoder).decode(a);return{version:n,type:r,packetNumber:i,sendTs:Number(o),payload:s}}case Eb.Ack:{let e=t.getUint32(3),i=t.getUint8(7),o=PT(t,8);return{version:n,type:r,maxAckPacketNumber:e,shift:i,ackSendTs:Number(o)}}default:throw Ey.error("[".concat(this.ID,"] Unrecognized packet type ").concat(r)),new Error("Unrecognized packet type ".concat(r))}}sendMessage(e){let t=this.packetize(e,this.packetNumber);this.packetNumber=4294967295===this.packetNumber?1:this.packetNumber+1;let n=this.calculateRTO(t),r=window.setTimeout((()=>{this.resendMessage(t)}),n);this.timeoutMap.set(t.packetNumber,r),this.sendPacket(t)}onData(e){let t=this.deserialize(e);t.type===Eb.Default?this.ack(t):t.type===Eb.Ack&&(this.updateRTT(t,Math.round(performance.now())),this.clearRTO(t))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach((e=>{let[t,n]=e;window.clearTimeout(n)})),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,void 0!==this.batchAckTimer&&window.clearTimeout(this.batchAckTimer)}resendMessage(e){let t=this.calculateRTO(e),n=window.setTimeout((()=>{this.resendMessage(e)}),t);this.timeoutMap.set(e.packetNumber,n),this.sendPacket(e)}calculateRTO(e){let t=this.rtoRatioMap.get(e.packetNumber);if(void 0===t)return this.rtoRatioMap.set(e.packetNumber,1),this.initialRTO;{let n=9*this.rtt/8*t;return this.rtoRatioMap.set(e.packetNumber,t+1),n>this.maxRTO?this.maxRTO:n}}updateRTT(e,t){let n=e.ackSendTs;this.rtt=this.rtt*(7/8)+(t-n-this.rtt)/8}ack(e){if(e.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(e):(this.batchAckPacketQueue.push(e),this.batchAckTimer=window.setTimeout((()=>{this.batchAck()}),this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(e.payload);;){let e=this.unorderedPacketQueue[0];if(!e){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(e.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(e.packetNumber<=this.lastOrderedPacketNumber){let t={ackSendTs:e.sendTs,maxAckPacketNumber:e.packetNumber,shift:0,type:Eb.Ack,version:this.version};this.sendPacket(t)}else if(e.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[e.packetNumber-this.lastOrderedPacketNumber-2]=e;let t={ackSendTs:e.sendTs,maxAckPacketNumber:e.packetNumber,shift:0,type:Eb.Ack,version:this.version};this.sendPacket(t)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;let e={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:Eb.Ack,version:this.version};this.sendPacket(e),this.batchAckPacketQueue=[]}sendPacket(e){e.type===Eb.Default&&(e.sendTs=Math.round(performance.now()));let t=this.serialize(e);this.sendImpl(t)}clearRTO(e){for(let t=e.maxAckPacketNumber-e.shift;t<=e.maxAckPacketNumber;t++){let e=this.timeoutMap.get(t);void 0!==e&&window.clearTimeout(e),this.timeoutMap.delete(t),this.rtoRatioMap.delete(t)}}}class mb extends fb{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3?arguments[3]:void 0),O_(this,"_initMutex",void 0),O_(this,"_reconnectInterrupter",void 0),O_(this,"_url",void 0),O_(this,"_transmitter",void 0),O_(this,"_addresses",void 0),O_(this,"_reliableTransmission",void 0),this._initMutex=new Uv("datachannel");let{timeout:n,timeoutFactor:r}=t,i=Math.max(300,Math.floor(3*n/5)),o=Math.max(1.2,Math.floor(8*r)/10);ev.ONLINE&&(this._retryConfig.timeout=i,this._retryConfig.timeoutFactor=o),av.on(tv.NETWORK_STATE_CHANGE,((e,t)=>{e!==t&&(this.resetReconnectCount("network state change: ".concat(t," -> ").concat(e)),e===ev.ONLINE?(this._retryConfig.timeout=i,this._retryConfig.timeoutFactor=o):(this._retryConfig.timeout=n,this._retryConfig.timeoutFactor=r))}))}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;this._forceCloseTimeout=t;let n=(t,n)=>{this._addresses=e,this.currentURLIndex=this._addresses.findIndex((e=>e.fingerprint||$v("FINGERPRINT")));let r=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(r).then(t).catch(n),this.once(bR.CLOSED,(()=>n(new HI(TT.WS_DISCONNECT)))),this.once(bR.CONNECTED,(()=>t()))};return this._initMutex.lock().then((e=>new wu(((e,t)=>{n(e,t)})).then((()=>{e()})).catch((()=>{e()}))))}sendMessage(e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new HI(TT.WS_ABORT,"datachannel is not ready");try{t||(e=JSON.stringify(e)),this._reliableTransmission.sendMessage(e)}catch(n){throw new HI(TT.WS_ERR,"send datachannel signal message error"+n.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(e){let t=JSON.stringify(e);return{compressed:t,compressedLength:t.length,origin:e}}sendMessageWithUint8Array(e){return{compressed:e,compressedLength:e.byteLength,origin:e}}createTransmitterConnection(e){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(e.ip,":").concat(e.port),new wu(((t,n)=>{var r;let i=()=>{Ey.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),t()},o=async e=>{var r;if(null===(r=this._closeEstablishingTransmitter)||void 0===r||r.call(this),Ey.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(e.code,", reason: ").concat(e.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){"connected"===this.state&&(this.reconnectReason=e.reason,this.state="reconnecting");let r=iv(this,bR.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,i=await this.reconnectWithAction(r);if("closed"===this.state)return void Ey.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!i)return n(new HI(TT.WS_DISCONNECT,"datachannel reconnect failed: ".concat(e.code))),void this.close(!0);t()}else n(new HI(TT.WS_DISCONNECT,"datachannel close: ".concat(e.code))),this.close()},a=e=>{var t;null===(t=this._reliableTransmission)||void 0===t||t.onData(e.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),Ey.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(e)));let s=null===(r=this._store)||void 0===r?void 0:r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),A=Date.now();nv(this,bR.TO_CONNECT_DATACHANNEL,e).then((e=>{var t,n;if(!e)throw new Error("transmissonInfo not exist yet");let{transmitter:r,close:c}=e;this._transmitter=r,null===(t=this._store)||void 0===t||t.signalChannelOpen();let l=Date.now()-A;Ey.debug("[choose dc] dc open cost ".concat(l,"ms")),this._reliableTransmission=new gb((e=>{var t;this._transmitter&&"open"===this._transmitter.readyState&&(null===(t=this._transmitter)||void 0===t||t.send(e))}),(e=>{"string"==typeof e&&this.emit(bR.ON_MESSAGE,e)})),this._closeEstablishingTransmitter=()=>{var e;null===(e=this._reliableTransmission)||void 0===e||e.close(),this._reliableTransmission=void 0,c()},i&&i(),r.onclose=o,r.onmessage=a,null===(n=this._store)||void 0===n||n.recordJoinChannelService({endTs:Date.now(),status:"success"},s),this._joinChannelServiceRecordIndex=s})).catch((e=>{var t;if(null===(t=this._store)||void 0===t||t.recordJoinChannelService({endTs:Date.now(),status:e instanceof HI&&e.code===TT.WS_ABORT?"aborted":"error",errors:[e]},s),"closed"!==this.state){if(e instanceof HI&&e.code===TT.WS_ERR){let t=new HI(TT.WS_ERR,"init datachannel failed! Error: ".concat(e.toString()));return Ey.error("[".concat(this._name,"]").concat(t)),void n(t)}o&&o(e)}else n(new HI(TT.WS_DISCONNECT,"datachannel is closed: ".concat(e.toString())))}))}))}async reconnectWithAction(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||"closed"===this.state)return!1;this._onlineReconnectListener||av.networkState!==ev.OFFLINE||(this._onlineReconnectListener=av.onlineWaiter&&av.onlineWaiter.then((()=>{this._onlineReconnectListener=void 0})));let n=!0;if(this._reconnectInterrupter=()=>{n=!1},t){let t=Mv(this._reconnectCount,this._retryConfig);Ey.debug("[".concat(this._name,"] wait ").concat(t,"ms to reconnect datachannel, mode: ").concat(e)),await wu.race([wv(t),this._onlineReconnectListener||new wu((()=>{}))])}if("closed"===this.state||!n)return!1;this._reconnectCount+=1;let r=async(e,t)=>{this.emit(bR.RECONNECT_CREATE_CONNECTION,t),await this.createTransmitterConnection(e)};try{if("retry"===e){let t=this._addresses[this.currentURLIndex];this.emit(bR.RECONNECT_WAITTING_FINISH,e),await r(t,e)}else if("tryNext"===e){this.currentURLIndex+=1;for(let e=this.currentURLIndex;e<this._addresses.length;e++){if(this._addresses[e].fingerprint||$v("FINGERPRINT")){this.currentURLIndex=e;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return Ey.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);Ey.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));let t=this._addresses[this.currentURLIndex];this.emit(bR.RECONNECT_WAITTING_FINISH,e),await r(t,e)}else"recover"===e&&(Ey.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(bR.RECONNECT_WAITTING_FINISH,e),this.emit(bR.FAILBACK));return!0}catch(a){var i,o;return Ey.error("[".concat(this._name,"] reconnect failed"),a.toString()),null!=a&&null!==(i=a.data)&&void 0!==i&&i.desc&&Array.isArray(a.data.desc)&&a.data.desc.length&&yr(o=a.data.desc).call(o,"dynamic key expired")?(this.emit(bR.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(e,t)}}}class _b extends VT{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===LI.CONNECTED?this.emit(kI.WS_CONNECTED):e===LI.RECONNECTING?this.emit(kI.WS_RECONNECTING,this._websocketReconnectReason):e===LI.CLOSED&&this.emit(kI.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),O_(this,"_disconnectedReason",void 0),O_(this,"_websocketReconnectReason",void 0),O_(this,"_connectionState",LI.CLOSED),O_(this,"reconnectToken",void 0),O_(this,"websocket",void 0),O_(this,"openConnectionTime",void 0),O_(this,"clientId",void 0),O_(this,"lastMsgTime",Date.now()),O_(this,"uploadCache",[]),O_(this,"uploadCacheInterval",void 0),O_(this,"rttRolling",new xv(5)),O_(this,"pingpongTimer",void 0),O_(this,"inflateDataTimer",void 0),O_(this,"pingpongTimeoutCount",0),O_(this,"joinResponse",void 0),O_(this,"multiIpOption",void 0),O_(this,"initError",void 0),O_(this,"spec",void 0),O_(this,"store",void 0),O_(this,"onWebsocketMessage",(e=>{if(e instanceof ArrayBuffer)return void this.emit(kI.ON_BINARY_DATA,e);let t=JSON.parse(e);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){let e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")&&(this.emit(t._type,t._message),t._type===xI.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===xI.ON_USER_BANNED))switch(t._message.error_code){case 14:this.close(JT.UID_BANNED);break;case 15:this.close(JT.IP_BANNED);break;case 16:this.close(JT.CHANNEL_BANNED)}})),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new mb("gateway-".concat(this.clientId),this.spec.retryConfig,!0,t),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===LI.CONNECTED&&this.reconnect("retry",RR.OFFLINE)}))}async request(e,t,n,r){let i=Sv(6,""),o={_id:i,_type:e,_message:t},a=this.websocket.connectionID,s=()=>new wu(((t,n)=>{if(this.connectionState===LI.CONNECTED)return t();let r=()=>{this.off(kI.WS_CLOSED,i),t()},i=()=>{this.off(kI.WS_CONNECTED,r),n(new HI(TT.WS_ABORT))};this.once(kI.WS_CONNECTED,r),this.once(kI.WS_CLOSED,i),e!==MI.PUBLISH&&e!==MI.SUBSCRIBE&&e!==MI.UNSUBSCRIBE&&e!==MI.UNPUBLISH&&e!==MI.CONTROL&&e!==MI.RESTART_ICE||this.once(kI.DISCONNECT_P2P,(()=>{n(new HI(TT.DISCONNECT_P2P))})),e!==MI.PUBLISH&&e!==MI.RESTART_ICE||this.once(kI.ABORT_P2P_EXECUTION,(()=>{n(new HI(TT.DISCONNECT_P2P))}))}));if(this.connectionState!==LI.CONNECTING&&this.connectionState!==LI.RECONNECTING||e===MI.JOIN||e===MI.REJOIN||await s(),e===MI.LEAVE&&(this.websocket.unbindDcCloseEventListener(),r=!0),this.websocket.sendMessage(o,!0,!1),r)return;let A=new wu(((n,r)=>{let o=!1,s=(r,i)=>{o=!0,n({isSuccess:"success"===r,message:i||{}}),this.off(kI.WS_CLOSED,A),this.off(kI.WS_RECONNECTING,A),this.emit(kI.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(i),s);let A=()=>{r(new HI(TT.WS_ABORT,"type: ".concat(e))),this.off(kI.WS_CLOSED,A),this.off(kI.WS_RECONNECTING,A),this.off("res-@".concat(i),s)};this.once(kI.WS_CLOSED,A),this.once(kI.WS_RECONNECTING,A),wv($v("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==a||o||(Ey.warning("dc request timeout, type: ".concat(e)),this.emit(kI.REQUEST_TIMEOUT,e,t))}))})),c=null;try{c=await A}catch(h){if(this.connectionState===LI.CLOSED||e===MI.LEAVE)throw new HI(TT.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?h.throw():e===MI.JOIN||e===MI.REJOIN?null:(await s(),await this.request(e,t))}if(c.isSuccess)return c.message;let l=Number(c.message.error_code||c.message.code),d=QR(l),u=new HI(TT.UNEXPECTED_RESPONSE,"".concat(d.desc,": ").concat(c.message.error_str),{code:l,data:c.message});return"success"===d.action?c.message:(Ey.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(l,", message: ").concat(d.desc,", action: ").concat(d.action)),l===UI.ERR_TOO_MANY_BROADCASTERS?((e===MI.JOIN||e===MI.REJOIN)&&(this.initError=u,this.close()),u.throw()):"failed"===d.action?u.throw():"quit"===d.action?(this.initError=u,this.close(),u.throw()):(l===UI.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=c.message.option,Ey.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",RR.MULTI_IP)):this.reconnect(d.action,RR.SERVER_ERROR),e===MI.JOIN||e===MI.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new wu((n=>{let r=i=>{(!t||t(i))&&(this.off(e,r),n(i))};this.on(e,r)}))}uploadWRTCStats(e){if(!this.store.sessionId)return void Ey.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(FI.WRTC_STATS,t)}upload(e,t){let n={_type:e,_message:t};try{this.websocket.sendMessage(n)}catch{let e=$v("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>e&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==LI.CONNECTED)return;let e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)}),$v("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){let n={_type:e,_message:t};this.websocket.sendMessage(n)}init(e,t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new wu(((n,r)=>{this.once(kI.WS_CONNECTED,(()=>n(this.joinResponse))),this.once(kI.WS_CLOSED,(()=>r(this.initError||new HI(TT.WS_ABORT)))),this.connectionState=LI.CONNECTING,this.websocket.init(e).catch(r),this.websocket.once(bR.FAILBACK,(()=>{void 0===this.openConnectionTime&&r(new HI(TT.INIT_DATACHANNEL_TIMEOUT))})),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval((()=>{this.handleInflateData()}),2e4),setTimeout((()=>{t&&void 0===this.openConnectionTime&&(Ey.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),r(new HI(TT.INIT_DATACHANNEL_TIMEOUT)))}),$v("DC_JOIN_WITH_FAILBACK"))}))}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||JT.LEAVE,this.connectionState=LI.CLOSED,Ey.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),e===JT.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new mb("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(kI.ABORT_P2P_EXECUTION);let e=await nv(this,kI.DATACHANNEL_CONNECTING),t=await this.request(MI.JOIN,e);if(!t)return this.emit(kI.REPORT_JOIN_GATEWAY,TT.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(kI.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=LI.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new HI(TT.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let e=ov(this,kI.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;let t=await this.request(MI.REJOIN,e);return!!t&&(this.connectionState=LI.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),t.peers&&t.peers.forEach((e=>{this.emit(xI.ON_USER_ONLINE,{uid:e.uid}),e.audio&&this.emit(xI.ON_ADD_AUDIO_STREAM,{uid:e.uid,uint_id:e.uint_id,audio:!0,ssrcId:e.audio_ssrc}),e.video&&this.emit(xI.ON_ADD_VIDEO_STREAM,{uid:e.uid,uint_id:e.uint_id,video:!0,ssrcId:e.video_ssrc}),e.audio_mute?this.emit(xI.MUTE_AUDIO,{uid:e.uid}):this.emit(xI.UNMUTE_AUDIO,{uid:e.uid}),e.video_mute?this.emit(xI.MUTE_VIDEO,{uid:e.uid}):this.emit(xI.UNMUTE_VIDEO,{uid:e.uid}),e.audio_enable_local?this.emit(xI.ENABLE_LOCAL_AUDIO,{uid:e.uid}):this.emit(xI.DISABLE_LOCAL_AUDIO,{uid:e.uid}),e.video_enable_local?this.emit(xI.ENABLE_LOCAL_VIDEO,{uid:e.uid}):this.emit(xI.DISABLE_LOCAL_VIDEO,{uid:e.uid}),e.audio||e.video||this.emit(xI.ON_REMOVE_STREAM,{uid:e.uid,uint_id:e.uint_id})})),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleNotification(e){Ey.debug("[".concat(this.clientId,"] receive notification: "),e);let t=QR(e.code);if("success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(JT.UID_BANNED),void this.close()):void this.reconnect(t.action,RR.SERVER_ERROR);Ey.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let e=$v("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(Ey.warning("PINGPONG Timeout. Last Socket Message: ".concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>$v("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",RR.TIMEOUT):this.request(MI.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;let e=Date.now()-t;this.rttRolling.add(e),$v("REPORT_STATS")&&this.send(MI.PING_BACK,{pingpongElapse:e})})).catch((e=>{}))}handleInflateData(){let{inflateLength:e,deflateLength:t}=this.websocket.getInflateData();0!==e&&0!==t&&this.upload(FI.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(bR.RECONNECT_WAITTING_FINISH,(e=>{this.emit(kI.WS_RECONNECT_WAITTING_FINISH,e)})),this.websocket.on(bR.RECONNECT_CREATE_CONNECTION,(e=>{this.emit(kI.WS_RECONNECT_CREATE_CONNECTION,e)})),this.websocket.on(bR.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(bR.CLOSED,(()=>{this.connectionState=LI.CLOSED})),this.websocket.on(bR.FAILED,(()=>{this._disconnectedReason=JT.NETWORK_ERROR,this.connectionState=LI.CLOSED})),this.websocket.on(bR.RECONNECTING,(e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===LI.CONNECTED?this.connectionState=LI.RECONNECTING:this.connectionState=LI.CONNECTING})),this.websocket.on(bR.WILL_RECONNECT,((e,t)=>{if(ov(this,kI.IS_P2P_DISCONNECTED)&&"retry"===e)return Ey.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(kI.NEED_RENEW_SESSION),this.emit(kI.DISCONNECT_P2P),t("tryNext");"retry"!==e&&(Ey.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0,this.emit(kI.NEED_RENEW_SESSION),this.emit(kI.DISCONNECT_P2P)),t(e)})),this.websocket.on(bR.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch((e=>{Ey.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",RR.SERVER_ERROR)})):this.join().catch((e=>{if(this.emit(kI.REPORT_JOIN_GATEWAY,e.message||e.code,this.url||""),e instanceof HI&&e.code===TT.UNEXPECTED_RESPONSE&&e.data.code===UI.ERR_NO_AUTHORIZED)return Ey.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",RR.SERVER_ERROR);Ey.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",RR.SERVER_ERROR):(this.initError=e,this.close())}))})),this.websocket.on(bR.REQUEST_NEW_URLS,((e,t)=>{nv(this,kI.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)})),this.websocket.on(bR.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(xI.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})),this.websocket.on(bR.TO_CONNECT_DATACHANNEL,(async(e,t,n)=>nv(this,kI.DATACHANNEL_PRECONNECT,e).then(t).catch(n))),this.websocket.on(bR.FAILBACK,(()=>{void 0!==this.openConnectionTime&&this.emit(kI.DATACHANNEL_FAILBACK)}))}}class Cb extends VT{constructor(e,t){super(),O_(this,"signal",void 0),O_(this,"token",void 0),O_(this,"tokenTimeout",void 0),O_(this,"tokenInterval",void 0),O_(this,"_sequence",0),O_(this,"userMap",new Map),O_(this,"encoder",new TextEncoder),this.signal=e,this.token=t;let n=()=>{this.signal.connectionState===LI.CONNECTED&&this.check(),0===this.userMap.size?this.tokenInterval=window.setTimeout(n,1e3):this.tokenInterval=window.setTimeout(n,3*$v("P2P_TOKEN_INTERVAL"))};n()}async send(e,t,n,r,i){var o,a,s;if(0===this.userMap.size)return;let A=Array.from(RI(o=this.userMap).call(o))[0].token;"string"!=typeof t&&(t=JSON.stringify(t)),r=null!==(a=r)&&void 0!==a?a:Sv(6,""),i=null!==(s=i)&&void 0!==s?s:this._sequence++;let c={_id:r,_type:e,_seq:i,_message:t,token:"".concat(this.token,"_").concat(A)};$v("SHOW_P2P_LOG")&&Ey.debug("send message",c,"noNeedResponse : ".concat(n)),this.splitMessage(JSON.stringify(c)).forEach((e=>{this.signal.request(MI.DATA_STREAM,{payload:fv(this.encoder.encode(e))})}));let l=new wu(((t,i)=>{let o=window.setTimeout((()=>{this.off("res-@".concat(r,"_ack"),a),this.off("res-@".concat(r),A),this.off(UR.ABORT,s),Ey.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(r)),0===this.userMap.size?i(new vT(TT.INVALID_REMOTE_USER)):i(new vT(TT.TIMEOUT))}),$v("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),a=()=>{o&&window.clearTimeout(o),this.off(UR.ABORT,s),n&&t()},s=()=>{o&&window.clearTimeout(o),this.off("res-@".concat(r,"_ack"),a),this.off("res-@".concat(r),A),i(new vT(TT.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(r)))};this.once(UR.ABORT,s),this.once("res-@".concat(r,"_ack"),a);let A=(n,A)=>{l=!0,o&&window.clearTimeout(o),this.off("res-@".concat(r,"_ack"),a),this.off(UR.ABORT,s),"success"===n?t(A):i(new vT(TT.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(r)))},l=!1;n||(this.once("res-@".concat(r),A),wv($v("SIGNAL_REQUEST_TIMEOUT")).then((()=>{l||Ey.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(r,", ").concat(c))})))}));try{return await l}catch(d){if(d.code===TT.TIMEOUT)return await this.send(e,t,n,r,i);throw d}}onMessage(e){var t;let n,{_uid:r}=e,i=this.userMap.get(r);if(i)n=i.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==PR.CHECK)return;let{token:t}=e;n=new Map,i={uid:r,isStart:!0,token:t,splitMessageMap:n,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(r,i),this.signal.emit(xI.ON_USER_ONLINE,{uid:r}),this.handleUserOnline()}if("id"in e&&"total"in e){var o;let{id:t,total:i}=e,a=null!==(o=n.get(t))&&void 0!==o?o:[];if(a.push(e),n.has(t)||n.set(t,a),a.length!==i)return;{let i=Lp(a).call(a,((e,t)=>e.index-t.index)).map((e=>e.payload)).join("");n.delete(t),(e=JSON.parse(i))._uid=r}}let{_type:a,token:s}=e;if(yr(t=[PR.ACK,PR.CHECK]).call(t,a))return a===PR.CHECK&&this.handleCheckToken(i,s),void this.receiveMessage(e);s==="".concat(i.token,"_").concat(this.token)?this.handleReceivedMessage(e):Ey.debug('Receive unexpected message", '.concat(s,", cur_token: ").concat(i.token,"_").concat(this.token),e)}check(){let e={_id:Sv(6,""),token:this.token,_type:PR.CHECK};$v("SHOW_P2P_LOG")&&Ey.debug("send message",e),this.signal.request(MI.DATA_STREAM,{payload:fv(this.encoder.encode(JSON.stringify(e)))})}ack(e){let t={_id:e,_type:PR.ACK,token:this.token};$v("SHOW_P2P_LOG")&&Ey.debug("send message",t),this.signal.request(MI.DATA_STREAM,{payload:fv(this.encoder.encode(JSON.stringify(t)))})}response(e,t,n){this.send(PR.RESPONSE,JSON.stringify({success:!n,message:t}),!0,e)}handleReceivedMessage(e){let t=()=>{this.userMap.forEach((e=>{let{receivedMessagesMap:t,nextExpectedSequenceNumber:n}=e;for(;t.has(n);){let r=t.get(n);t.delete(n),this.receiveMessage(r),e.nextExpectedSequenceNumber++}}))};if(!e)return void t();let{_uid:n,_seq:r}=e,i=this.userMap.get(n),{receivedMessagesMap:o,isStart:a,nextExpectedSequenceNumber:s}=i;if(r<s)return this.ack(e._id),void Ey.debug("[external-signal] receive old message, seq: ".concat(r,", ").concat(e._message));o.set(r,e),a&&r===s&&(this.receiveMessage(e),o.delete(s),i.nextExpectedSequenceNumber++,t())}receiveMessage(e){let{_id:t,_type:n,_message:r,_uid:i}=e;if($v("SHOW_P2P_LOG")&&Ey.debug("receive message",e),t){let o;switch(e._type!==PR.ACK&&(r&&(o=JSON.parse(r)),this.ack(e._id)),e._type){case PR.CANDIDATE:case PR.CONTROL:this.signal.emit(n,o,i);break;case PR.PUBLISH:case PR.UNPUBLISH:case PR.RESTART_ICE:case PR.CALL:o.uid=i,nv(this.signal,n,o).then((t=>{this.response(e._id,t)})).catch((()=>{this.response(e._id,void 0,!0)}));break;case PR.ACK:this.getListeners("res-@".concat(t,"_ack")).length>0&&this.emit("res-@".concat(t,"_ack"));break;case PR.RESPONSE:{let{success:e,message:n}=o;this.emit("res-@".concat(t),e?"success":"failed",n);break}}}}splitMessage(e){if(e.length<Cb.MAX_MESSAGE_SIZE)return[e];let t=[],{remoteToken:n}=JSON.parse(e),r=Sv(6,""),i=0,o=800,a=Math.ceil(e.length/o);for(;e.length>0;){i++;let s={id:r,index:i,total:a,payload:e.slice(0,o),token:"".concat(this.token,"_").concat(n)};JSON.stringify(s).length>Cb.MAX_MESSAGE_SIZE?o-=50:(t.push(s),e=e.slice(o))}return t.map((e=>JSON.stringify(e)))}handleCheckToken(e,t){return e.token!==t?(Ey.debug("token changed, from ".concat(e.token," to ").concat(t)),this.reset(e.uid,t),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout((()=>{Ey.debug("token timeout, ".concat(t)),this.reset(e.uid)}),$v("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){let e=await nv(this.signal,PR.CALL,void 0),t=await this.send(PR.CALL,e);this.signal.emit(kI.P2P_CONNECTION,t,!0)}async reset(e,t){let n=this.userMap.get(e);n&&(this.emit(UR.ABORT),this.signal.emit(xI.ON_USER_OFFLINE,{uid:n.uid,reason:kR.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),t||(Ey.debug("change local token from ".concat(t," to ").concat(t)),this.token=Sv(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(UR.ABORT)}}O_(Cb,"MAX_SIZE",1),O_(Cb,"MAX_MESSAGE_SIZE",1024);class wb extends VT{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===LI.CONNECTED?this.emit(kI.WS_CONNECTED):e===LI.RECONNECTING?this.emit(kI.WS_RECONNECTING,this._websocketReconnectReason):e===LI.CLOSED&&this.emit(kI.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),O_(this,"_disconnectedReason",void 0),O_(this,"_websocketReconnectReason",void 0),O_(this,"_connectionState",LI.CLOSED),O_(this,"reconnectToken",void 0),O_(this,"p2pToken",void 0),O_(this,"websocket",void 0),O_(this,"openConnectionTime",void 0),O_(this,"clientId",void 0),O_(this,"lastMsgTime",Date.now()),O_(this,"uploadCache",[]),O_(this,"uploadCacheInterval",void 0),O_(this,"rttRolling",new xv(5)),O_(this,"pingpongTimer",void 0),O_(this,"pingpongTimeoutCount",0),O_(this,"joinResponse",void 0),O_(this,"multiIpOption",void 0),O_(this,"initError",void 0),O_(this,"spec",void 0),O_(this,"store",void 0),O_(this,"_external_signal",void 0),O_(this,"onWebsocketMessage",(e=>{if(e.data instanceof ArrayBuffer)return void this.emit(kI.ON_BINARY_DATA,e.data);let t=JSON.parse(e.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){let e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){switch(t._type){case xI.ON_DATA_STREAM:return void this.handleDataStream(t._message);case xI.MUTE_AUDIO:case xI.MUTE_VIDEO:case xI.ON_P2P_LOST:case xI.ON_USER_ONLINE:return;case xI.ON_USER_OFFLINE:let{uid:e}=t._message;return Ey.debug("[".concat(this.clientId,"] user-offline uid: ").concat(e)),void this._external_signal.reset(e)}if(this.emit(t._type,t._message),t._type===xI.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===xI.ON_USER_BANNED)switch(t._message.error_code){case 14:this.close(JT.UID_BANNED);break;case 15:this.close(JT.IP_BANNED);break;case 16:this.close(JT.CHANNEL_BANNED)}if(t._type===xI.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case UI.ERR_LICENSE_MISSING:this.close(JT.LICENSE_MISSING);break;case UI.ERR_LICENSE_EXPIRED:this.close(JT.LICENSE_EXPIRED);break;case UI.ERR_LICENSE_MINUTES_EXCEEDED:this.close(JT.LICENSE_MINUTES_EXCEEDED);break;case UI.ERR_LICENSE_PERIOD_INVALID:this.close(JT.LICENSE_PERIOD_INVALID);break;case UI.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(JT.LICENSE_MULTIPLE_SDK_SERVICE);break;case UI.ERR_LICENSE_ILLEGAL:this.close(JT.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new $R("gateway-".concat(this.clientId),this.spec.retryConfig,!0,$v("JOIN_GATEWAY_USE_DUAL_DOMAIN"),$v("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===LI.CONNECTED&&this.reconnect("retry",$T.OFFLINE)})),this.p2pToken=Sv(6,""),this._external_signal=new Cb(this,this.p2pToken)}async request(e,t,n,r){let i=Sv(6,""),o={_id:i,_type:e,_message:t},a=this.websocket.connectionID,s=()=>new wu(((e,t)=>{if(this.connectionState===LI.CONNECTED)return e();let n=()=>{this.off(kI.WS_CLOSED,r),e()},r=()=>{this.off(kI.WS_CONNECTED,n),t(new vT(TT.WS_ABORT))};this.once(kI.WS_CONNECTED,n),this.once(kI.WS_CLOSED,r)}));if(this.connectionState!==LI.CONNECTING&&this.connectionState!==LI.RECONNECTING||e===MI.JOIN||e===MI.REJOIN||await s(),this.websocket.sendMessage(o,!0),r)return;let A=new wu(((n,r)=>{let o=!1,s=(r,i)=>{o=!0,n({isSuccess:"success"===r,message:i||{}}),this.off(kI.WS_CLOSED,A),this.off(kI.WS_RECONNECTING,A),this.emit(kI.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(i),s);let A=()=>{r(new vT(TT.WS_ABORT,"type: ".concat(e))),this.off(kI.WS_CLOSED,A),this.off(kI.WS_RECONNECTING,A),this.off("res-@".concat(i),s)};this.once(kI.WS_CLOSED,A),this.once(kI.WS_RECONNECTING,A),wv($v("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==a||o||(Ey.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(kI.REQUEST_TIMEOUT,e,t))}))})),c=null;try{c=await A}catch(h){if(this.connectionState===LI.CLOSED||e===MI.LEAVE)throw new vT(TT.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?h.throw():e===MI.JOIN||e===MI.REJOIN?null:(await s(),await this.request(e,t))}if(c.isSuccess)return c.message;let l=Number(c.message.error_code||c.message.code),d=QR(l),u=new vT(TT.UNEXPECTED_RESPONSE,"".concat(d.desc,": ").concat(c.message.error_str),{code:l,data:c.message});return"success"===d.action?c.message:(Ey.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(l,", message: ").concat(d.desc,", action: ").concat(d.action)),l===UI.ERR_TOO_MANY_BROADCASTERS?((e===MI.JOIN||e===MI.REJOIN)&&(this.initError=u,this.close()),u.throw()):"failed"===d.action?u.throw():"quit"===d.action?(this.initError=u,this.close(),u.throw()):(l===UI.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=c.message.option,Ey.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",$T.MULTI_IP)):this.reconnect(d.action,$T.SERVER_ERROR),e===MI.JOIN||e===MI.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new wu((n=>{let r=i=>{(!t||t(i))&&(this.off(e,r),n(i))};this.on(e,r)}))}uploadWRTCStats(e){if(!this.store.sessionId)return void Ey.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(FI.WRTC_STATS,t)}upload(e,t){let n={_type:e,_message:t};try{this.websocket.sendMessage(n)}catch{let e=$v("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>e&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==LI.CONNECTED)return;let e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)}),$v("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){let n={_type:e,_message:t};this.websocket.sendMessage(n)}async sendExtensionMessage(e,t,n){return await this._external_signal.send(e,t,n)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new wu(((t,n)=>{this.once(kI.WS_CONNECTED,(()=>t(this.joinResponse))),this.once(kI.WS_CLOSED,(()=>n(this.initError||new vT(TT.WS_ABORT)))),this.connectionState=LI.CONNECTING,this.websocket.init(e).catch(n)}))}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||JT.LEAVE,this.connectionState=LI.CLOSED,Ey.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),e===JT.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new $R("gateway-".concat(this.clientId),this.spec.retryConfig,!0,$v("JOIN_GATEWAY_USE_DUAL_DOMAIN"),$v("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents()),this.p2pToken=Sv(6,""),this._external_signal.clear(),this._external_signal=new Cb(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(kI.ABORT_P2P_EXECUTION);let e=await nv(this,kI.REQUEST_JOIN_INFO),t=await this.request(MI.JOIN,e);if(!t)return this.emit(kI.REPORT_JOIN_GATEWAY,TT.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(kI.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=LI.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleDataStream(e){try{var t;let n=pv(e.payload),r=(new TextDecoder).decode(n),i=JSON.parse(r);"total"in i&&"id"in i||yr(t=Object.values(PR)).call(t,i._type)?(i._uid=e.uid,this._external_signal.onMessage(i)):this.emit(xI.ON_DATA_STREAM,e)}catch{this.emit(xI.ON_DATA_STREAM,e)}}handleNotification(e){Ey.debug("[".concat(this.clientId,"] receive notification: "),e);let t=QR(e.code);if("success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(JT.UID_BANNED),void this.close()):void this.reconnect(t.action,$T.SERVER_ERROR);Ey.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let e=$v("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(Ey.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>$v("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",$T.TIMEOUT):this.request(MI.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;let e=Date.now()-t;this.rttRolling.add(e),$v("REPORT_STATS")&&this.send(MI.PING_BACK,{pingpongElapse:e})})).catch((e=>{}))}handleWebsocketEvents(){this.websocket.on(VI.RECONNECT_WAITTING_FINISH,(e=>{this.emit(kI.WS_RECONNECT_WAITTING_FINISH,e)})),this.websocket.on(VI.RECONNECT_CREATE_CONNECTION,(e=>{this.emit(kI.WS_RECONNECT_CREATE_CONNECTION,e)})),this.websocket.on(VI.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(VI.CLOSED,(()=>{this.connectionState=LI.CLOSED})),this.websocket.on(VI.FAILED,(()=>{this._disconnectedReason=JT.NETWORK_ERROR,this.connectionState=LI.CLOSED})),this.websocket.on(VI.RECONNECTING,(e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===LI.CONNECTED?this.connectionState=LI.RECONNECTING:this.connectionState=LI.CONNECTING})),this.websocket.on(VI.WILL_RECONNECT,((e,t,n)=>{"retry"!==e?(Ey.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0,this.emit(kI.NEED_RENEW_SESSION)):Ey.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),n(e)})),this.websocket.on(VI.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.join().catch((e=>{if(this.emit(kI.REPORT_JOIN_GATEWAY,e.message||e.code,this.url||""),e instanceof vT&&e.code===TT.UNEXPECTED_RESPONSE&&e.data.code===UI.ERR_NO_AUTHORIZED)return Ey.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",$T.SERVER_ERROR);Ey.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",$T.SERVER_ERROR):(this.initError=e,this.close())}))})),this.websocket.on(VI.REQUEST_NEW_URLS,((e,t)=>{nv(this,kI.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)})),this.websocket.on(VI.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(xI.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}))}}function Sb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Tb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Sb(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Sb(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let vb=new Map;class yb extends VT{get state(){return this._state}set state(e){if(e===this._state)return;let t=this._state;this._state=e,"DISCONNECTED"===e&&this._disconnectedReason?this.emit(sR.CONNECTION_STATE_CHANGE,e,t,this._disconnectedReason):this.emit(sR.CONNECTION_STATE_CHANGE,e,t)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){Ey.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,t){super(),O_(this,"store",void 0),O_(this,"joinInfo",void 0),O_(this,"key",void 0),O_(this,"ntpOffset",0),O_(this,"signal",void 0),O_(this,"role",void 0),O_(this,"inChannelInfo",{joinAt:null,duration:0}),O_(this,"spec",void 0),O_(this,"_state","DISCONNECTED"),O_(this,"_statsCollector",void 0),O_(this,"_disconnectedReason",void 0),O_(this,"isSignalRecover",!1),O_(this,"hasChangeBGPAddress",!1),O_(this,"trafficStatsInterval",void 0),O_(this,"networkQualityInterval",void 0),O_(this,"_joinGatewayStartTime",0),O_(this,"_signalTimeout",!1),O_(this,"_clientRoleOptions",void 0),O_(this,"_isProactiveJoin",!1),this.store=e,this.spec=t,this.signal=this.store.useP2P?new wb(Tb(Tb({},t),{},{retryConfig:t.websocketRetryConfig}),e):this.store.useDataChannel?new _b(Tb(Tb({},t),{},{retryConfig:t.websocketRetryConfig}),e):new tb(Tb(Tb({},t),{},{retryConfig:t.websocketRetryConfig}),e),this._statsCollector=t.statsCollector,this.role=t.role||"audience",this._clientRoleOptions=t.clientRoleOptions,this.handleSignalEvents()}async join(e,t,n){if(this.signal instanceof _b){let t=!1;"disabled"!==e.cloudProxyServer?(Ey.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(e.cloudProxyServer,")")),t=!0):"".concat(e.apResponse.cid,"_").concat(e.apResponse.cert).length>255||"".concat(e.apResponse.cid,"_").concat(e.apResponse.cert).length<22?(Ey.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),t=!0):e.apResponse.addresses.some((e=>e.fingerprint))||$v("FINGERPRINT")||(Ey.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),t=!0),t&&this.resetSignal()}this.store.joinGatewayStart(),"disabled"!==e.cloudProxyServer&&(this.hasChangeBGPAddress=!0);let r=Date.now(),i=vb.get(e.cname);if(i||(i=new Map,vb.set(e.cname,i)),this._isProactiveJoin=!0,i.has(e.uid)){let t=new HI(TT.UID_CONFLICT);throw vy.joinGateway(e.sid,{lts:r,succ:!1,ec:t.message,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!e.proxyServer,signalChannel:this.signal instanceof _b?"1":"0"}),this._isProactiveJoin=!1,t}i.set(e.uid,!0),this.joinInfo=e,this.key=t;let o=0;this.joinGatewayStartTime=r;let a=e.proxyServer;try{let t;if(Ey.debug("[".concat(this.store.clientId,"] use ").concat(this.signal instanceof _b?"datachannel":"websocket"," join uid ").concat(o)),this.signal instanceof _b)t=await this.signal.init(e.apResponse.addresses,n);else{let r=e.gatewayAddrs.map((t=>{let{address:n}=t,[r,i]=n.split(":"),o={host:r,port:i};return e.proxyServer&&(o.proxy=e.proxyServer),o}));t=await this.signal.init(r,n)}o=t.uid,Ey.debug("[".concat(this.store.clientId,"] ").concat(this.signal instanceof _b?"datachannel":"websocket"," join uid ").concat(o," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(s){throw s&&s.code===TT.INIT_WEBSOCKET_TIMEOUT?(Ey.warning("[".concat(this.store.clientId,"] User join failed"),s.toString()),s):s&&s.code===TT.INIT_DATACHANNEL_TIMEOUT?(Ey.warning("[".concat(this.store.clientId,"] User join datachannel failed"),s.toString()),this.resetSignal(),s):(Ey.error("[".concat(this.store.clientId,"] User join failed"),s.toString()),vy.joinGateway(e.sid,{lts:r,succ:!1,ec:s.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!a,signalChannel:this.signal instanceof _b?"1":"0"}),this._isProactiveJoin=!1,i.delete(e.uid),this.signal.close(),s)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),Ey.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval((()=>{this.updateTrafficStats().catch((e=>{Ey.warning("[".concat(this.store.clientId,"] get traffic stats error"),e.toString())}))}),3e3),this.networkQualityInterval=window.setInterval((()=>{navigator&&void 0!==navigator.onLine&&!navigator.onLine?this.emit(sR.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(sR.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):"CONNECTED"===this.state&&this._statsCollector.trafficStats?this.emit(sR.NETWORK_QUALITY,{uplinkNetworkQuality:cb(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:cb(this._statsCollector.trafficStats.B_dnq)}):this.emit(sR.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})}),2e3),this.store.joinGatewayEnd(),o}async leave(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if("DISCONNECTED"!==this.state){t!==JT.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==LI.CONNECTED||await(n=this.signal.request(MI.LEAVE,void 0,!0),wu.race([n,Cv(3e3)]))}catch(n){Ey.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),n)}this.signal.close(t),t!==JT.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}var n}async publish(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new HI(TT.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let r={state:"offer",p2p_id:this.store.p2pId,ortc:t,mode:this.spec.mode,extend:$v("PUB_EXTEND"),twcc:!!$v("PUBLISH_TWCC"),rtx:!!$v("USE_PUB_RTX")};try{return(await this.signal.request(MI.PUBLISH,r,!0))._message}catch(i){if(n&&i.data&&i.data.code===UI.ERR_PUBLISH_REQUEST_INVALID)return Ey.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),i.toString()),await this.tryUnpubBeforeRepub(e,t),this.publish(e,t,!1);throw i}}async publishDataChannel(e,t,n){var r;if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new HI(TT.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let i={stream_id:t.streamId,ordered:t.ordered?1:0,max_retrans_times:null!==(r=t.maxRetransmits)&&void 0!==r?r:10,channel_id:t.channelId,metadata:t.metadata};try{await this.signal.request(MI.PUBLISH_DATASTREAM,i,!0)}catch(o){if(n&&o.data&&o.data.code===UI.ERR_PUBLISH_REQUEST_INVALID)return Ey.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),o.toString()),await this.tryUnpubDataChannelBeforeRepub(e,t),this.publishDataChannel(e,t,!1);throw o}}async unpublish(e,t){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new HI(TT.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(MI.UNPUBLISH,{stream_id:t,ortc:e},!0)}catch(n){Ey.warning("[".concat(this.store.clientId,"] unpublish warning: "),n)}}async unpublishDataChannel(e){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new HI(TT.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await wu.all(e.map((e=>this.signal.request(MI.UNPUBLISH_DATASTREAM,{channel_id:e},!0))))}catch(t){Ey.warning("unpublish datachannels warning: ",t)}}async presubscribe(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new HI(TT.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));let r={stream_id:e,stream_type:t,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!$v("SUBSCRIBE_TWCC"),rtx:!!$v("USE_SUB_RTX")||void 0,extend:$v("SUB_EXTEND"),svc:Array.isArray($v("SVC"))&&0!==$v("SVC").length?$v("SVC"):void 0};try{return await this.signal.request(MI.PRE_SUBSCRIBE,r,!0)}catch(i){if(n&&i.data&&i.data.code===UI.ERR_SUBSCRIBE_REQUEST_INVALID)return Ey.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),i.toString()),this.presubscribe(e,t,!1);throw i}}async subscribe(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new HI(TT.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));let r={stream_id:e,stream_type:t.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!$v("SUBSCRIBE_TWCC"),rtx:!!$v("USE_SUB_RTX"),extend:$v("SUB_EXTEND"),ssrcId:t.ssrcId,svc:Array.isArray($v("SVC"))&&0!==$v("SVC").length?$v("SVC"):void 0};try{return(await this.signal.request(MI.SUBSCRIBE,r,!0))._message}catch(i){if(n&&i.data&&i.data.code===UI.ERR_SUBSCRIBE_REQUEST_INVALID)return Ey.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),i.toString()),await this.tryUnsubBeforeResub(e,t),await this.subscribe(e,t,!1);throw i}}async subscribeDataChannel(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new HI(TT.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));let r={uid:e,stream_id:t.id,channel_id:t.datachannelId};try{return void await this.signal.request(MI.SUBSCRIBE_DATASTREAM,r,!0)}catch(i){if(n&&i.data&&i.data.code===UI.ERR_SUBSCRIBE_REQUEST_INVALID)return Ey.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),i.toString()),await this.tryUnsubDataChannelBeforeResub(e,t),await this.subscribeDataChannel(e,t,!1);throw i}}async subscribeAll(e,t){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new HI(TT.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));let n={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!$v("USE_SUB_RTX"),twcc:!!$v("SUBSCRIBE_TWCC"),svc:Array.isArray($v("SVC"))&&0!==$v("SVC").length?$v("SVC"):void 0};try{return await this.signal.request(MI.SUBSCRIBE_STREAMS,n,!0)}catch(r){if(t&&r.data&&r.data.code===UI.ERR_SUBSCRIBE_REQUEST_INVALID)return Ey.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),r.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw r}}async setVideoProfile(e){let t=function(e){if(!(e.bitrateMax&&e.bitrateMin&&e.frameRate&&e.height&&e.width))return;let t=e.frameRate,n=e.width,r=e.height,i=!0;return"number"!=typeof t&&(t=t.exact||t.ideal||t.max||t.min||0,t||(i=!1)),"number"!=typeof n&&(n=n.exact||n.ideal||n.max||n.min||0,n||(i=!1)),"number"!=typeof r&&(r=r.exact||r.ideal||r.max||r.min||0,t||(i=!1)),i?{stream_type:0,width:n,height:r,fps:t,start_bps:1e3*e.bitrateMax,min_bps:1e3*e.bitrateMin,target_bps:1e3*e.bitrateMax}:void 0}(e);if(t)return this.signal.request(MI.SET_VIDEO_PROFILE,t);Ey.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,t){try{await this.signal.request(MI.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:t},!0)}catch(n){Ey.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),n)}}async unsubscribeDataChannel(e,t){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new HI(TT.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await wu.all(e.map((e=>this.signal.request(MI.UNSUBSCRIBE_DATASTREAM,{stream_id:e,uid:t},!0))))}catch(n){Ey.warning("unsubscribeDataChannel warning: ",n)}}async massUnsubscribe(e){try{await this.signal.request(MI.UNSUBSCRIBE_STREAMS,e,!0)}catch(t){Ey.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),t)}}async reconnectPC(e){let{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=e;return{gatewayEstablishParams:await this.signal.request(MI.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(MI.GATEWAY_INFO)}async renewToken(e){await this.signal.request(MI.RENEW_TOKEN,e),this.key=e.token}async setClientRole(e,t){if(t&&(this._clientRoleOptions=Object.assign({},t)),"CONNECTED"!==this.state)return void(this.role=e);let n,r=0;"audience"===e?this._clientRoleOptions&&this._clientRoleOptions.delay?(n=this._clientRoleOptions.delay,r=1):r=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:r=0,await this.signal.request(MI.SET_CLIENT_ROLE,{role:e,level:r,delay:n,client_ts:Date.now()}),this.role=e}async setRemoteVideoStreamType(e,t){await this.signal.request(MI.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:t})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(MI.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,t){await this.signal.request(MI.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:t})}async pickSVCLayer(e,t){await this.signal.request(MI.PICK_SVC_LAYER,{stream_id:e,spatial_layer:t.spatialLayer,temporal_layer:t.temporalLayer})}async setRTM2Flag(e){await this.signal.request(MI.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,t,n){if(this.signal instanceof wb)return this.signal.sendExtensionMessage(e,t,n)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Tb({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(MI.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){let e=vb.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;let e=function(e){let t;return t=e.startsWith("dc")?e.match(/(dc\:\/\/)?([^:]+):(\d+)/):e.match(/(wss\:\/\/)?([^:]+):(\d+)/),t?{username:Iy.username,password:Iy.password,turnServerURL:t[2],tcpport:parseInt(t[3])+30,udpport:parseInt(t[3])+30,forceturn:!1}:null}(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(Tb(Tb({},Iy),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if("CONNECTED"!==this.state)return;let e=await this.signal.request(MI.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),null!=e.ntp_offset&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach((e=>{let t=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find((t=>t.peer_uid===e.peer_uid));t&&t.B_st!==e.B_st&&cv((()=>{this.emit(sR.STREAM_TYPE_CHANGE,e.peer_uid,e.B_st)}))})),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){if(!this.joinInfo||!this.key)throw new HI(TT.UNEXPECTED_ERROR,"can not generate join message, no join info");let t=Object.assign({},this.joinInfo.apResponse),n=$v("REPORT_APP_SCENARIO");if("string"!=typeof n)try{n=JSON.stringify(n)}catch{n=void 0}n&&n.length>128&&(n=void 0);let r=Tb({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Wv,browser:navigator.userAgent,process_id:$v("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:t,extend:$v("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:n,attributes:{userAttributes:{enablePublishedUserList:$v("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:$v("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:"number"==typeof $v("SUBSCRIBE_AUDIO_FILTER_TOPN")?$v("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:"boolean"==typeof $v("ENABLE_PUBLISH_AUDIO_FILTER")?$v("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:"boolean"==typeof $v("ENABLE_USER_LICENSE_CHECK")?$v("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:!0===$v("USE_PUB_RTX")||!0===$v("USE_SUB_RTX")||void 0,disableFEC:$v("DISABLE_FEC"),enableNTPReport:!!$v("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!$v("ENABLE_INSTANT_VIDEO")||void 0,enableDataStream2:"boolean"==typeof $v("ENABLE_DATASTREAM_2")?$v("ENABLE_DATASTREAM_2"):void 0,rtm2Flag:"number"==typeof this.joinInfo.rtmFlag?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!$v("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:"boolean"==typeof $v("USE_XR")?$v("USE_XR"):void 0,enableLossbasedBwe:"boolean"==typeof $v("ENABLE_LOSSBASED_BWE")?$v("ENABLE_LOSSBASED_BWE"):void 0,enableAutCC:"boolean"==typeof $v("ENABLE_AUT_CC")?$v("ENABLE_AUT_CC"):void 0,enableCCFallback:"boolean"==typeof $v("ENABLE_CC_FALLBACK")?$v("ENABLE_CC_FALLBACK"):void 0}},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(r.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(r.aes_mode=this.joinInfo.aesmode,$v("ENCRYPT_AES")?(r.aes_secret=this.joinInfo.aespassword,r.aes_encrypt=!0):r.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(r.aes_salt=this.joinInfo.aessalt)),t.addresses[this.signal.websocket.currentURLIndex]&&(r.ap_response.ticket=t.addresses[this.signal.websocket.currentURLIndex].ticket,delete t.addresses),void 0!==this.joinInfo.defaultVideoStream&&(r.default_video_stream=this.joinInfo.defaultVideoStream),r}getRejoinMessage(){if(!this.joinInfo)throw new HI(TT.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(kI.WS_RECONNECT_WAITTING_FINISH,(e=>{var t;yr(t=["tryNext","recover"]).call(t,e)&&this.joinInfo&&vy.adjustSessionStartTime(this.joinInfo.sid)})),this.signal.on(kI.WS_RECONNECT_CREATE_CONNECTION,(e=>{this.joinGatewayStartTime=Date.now()})),this.signal.on(kI.WS_RECONNECTING,(e=>{this.joinInfo&&vy.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||$T.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",vy.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:"live"===this.spec.mode?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:"audience"===this.role?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())})),this.signal.on(kI.WS_CLOSED,(e=>{let t;switch(e){case JT.LEAVE:t=$T.LEAVE;break;case JT.UID_BANNED:case JT.IP_BANNED:case JT.CHANNEL_BANNED:case JT.SERVER_ERROR:t=$T.SERVER_ERROR;break;case JT.FALLBACK:t=$T.FALLBACK;break;case JT.LICENSE_MISSING:case JT.LICENSE_EXPIRED:case JT.LICENSE_MINUTES_EXCEEDED:case JT.LICENSE_PERIOD_INVALID:case JT.LICENSE_MULTIPLE_SDK_SERVICE:case JT.LICENSE_ILLEGAL:case JT.TOKEN_EXPIRE:t=e;break;default:t=$T.NETWORK_ERROR}Ey.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(t||"undefined -> "+$T.NETWORK_ERROR)),this.joinInfo&&vy.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===JT.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t}),this._disconnectedReason=e,e!==JT.FALLBACK&&(this.state="DISCONNECTED"),this.reset()})),this.signal.on(kI.WS_CONNECTED,(()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&("audience"===this.role&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(Ey.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),vy.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof _b?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&1===this.joinInfo.setLocalAPVersion)){let e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void Ey.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));Zv("EVENT_REPORT_DOMAIN",e[1]),Zv("EVENT_REPORT_BACKUP_DOMAIN",e[1]),Zv("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}})),this.signal.on(xI.ON_UPLINK_STATS,(e=>{this._statsCollector.updateUplinkStats(e)})),this.signal.on(kI.REQUEST_RECOVER,((e,t,n)=>{if(!this.joinInfo)return n(new HI(TT.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,nv(this,sR.REQUEST_NEW_GATEWAY_LIST).then(t).catch(n)})),this.signal.on(kI.REQUEST_JOIN_INFO,(async e=>{var t;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));let{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}=await nv(this,sR.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:null===(t=this.joinInfo)||void 0===t?void 0:t.turnServer});e(this.getJoinMessage({ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:i,version:"2"}}))})),this.signal.on(kI.REQUEST_REJOIN_INFO,(e=>{e(this.getRejoinMessage())})),this.signal.on(kI.REPORT_JOIN_GATEWAY,((e,t)=>{this.joinInfo&&(vy.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:e,addr:t,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof _b?"1":"0"}),this._isProactiveJoin=!1)})),this.signal.on(kI.IS_P2P_DISCONNECTED,(e=>{e(ov(this,sR.IS_P2P_DISCONNECTED))})),this.signal.on(kI.DISCONNECT_P2P,(()=>{this.emit(sR.DISCONNECT_P2P)})),this.signal.on(kI.NEED_RENEW_SESSION,(e=>{this.emit(sR.NEED_RENEW_SESSION,e)})),this.signal.on(kI.REQUEST_SUCCESS,(()=>{this._signalTimeout=!1})),this.signal.on(kI.REQUEST_TIMEOUT,(()=>{this._signalTimeout=!0})),this.signal.on(kI.JOIN_RESPONSE,(e=>{let t=this.getCurrentGatewayAddress();this.emit(sR.JOIN_RESPONSE,e,t)})),this.signal.on(kI.DATACHANNEL_PRECONNECT,(async(e,t,n)=>{this.updateTurnConfigFromSignal();let r=this.getCurrentGatewayAddress();return nv(this,sR.DATACHANNEL_PRECONNECT,e,r).then(t).catch(n)})),this.signal.on(kI.DATACHANNEL_CONNECTING,(async e=>{let{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=await nv(this,sR.REQUEST_DC_CONNECTION_PARAMS);e(this.getJoinMessage({ortc:{iceParameters:t,dtlsParameters:n,rtpCapabilities:r,version:"2"}}))})),this.signal.on(kI.DATACHANNEL_FAILBACK,(()=>{Ey.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(sR.DATACHANNEL_FAILBACK)}))}async tryUnsubBeforeResub(e,t){try{await this.signal.request(MI.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[t]},!0)}catch(n){throw Ey.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),n),n}}async tryUnsubDataChannelBeforeResub(e,t){try{await this.signal.request(MI.UNSUBSCRIBE,{stream_id:t.id},!0)}catch(n){throw Ey.warning("unsubscribe datachannel warning",n),n}}async tryUnpubBeforeRepub(e,t){try{await this.signal.request(MI.UNPUBLISH,{stream_id:e,ortc:t},!0)}catch(n){throw Ey.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),n),n}}async tryUnpubDataChannelBeforeRepub(e,t){try{await this.signal.request(MI.UNPUBLISH_DATASTREAM,{channnel_id:t.channelId},!0)}catch(n){throw Ey.warning("unpublish datastream warning: ",n),n}}async tryMassUnsubBeforeResub(e){let t={users:e.map((e=>({stream_id:e.stream_id,stream_type:e.stream_type})))};try{await this.signal.request(MI.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){throw Ey.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),n),n}}async muteLocal(e,t){let n={action:e.find((e=>e.stream_type===aR.Audio))?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(MI.CONTROL,n,!0,!0)}catch(r){throw Ey.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),r),r}}async unmuteLocal(e,t){let n={action:e.find((e=>e.stream_type===aR.Audio))?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(MI.CONTROL,n,!0,!0)}catch(r){throw Ey.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),r),r}}async muteRemote(e,t){let n={action:e===mR.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(MI.CONTROL,n,!0,!0)}catch(r){throw Ey.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),r),r}}async unmuteRemote(e,t){let n={action:e===mR.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(MI.CONTROL,n,!0,!0)}catch(r){throw Ey.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),r),r}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,t){this.signal.upload(e,t)}getSignalRTT(){return this.signal.rtt}async restartICE(e){let t={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(MI.RESTART_ICE,t,!0)}catch(n){throw Ey.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),n),n}}reconnect(){"CONNECTED"===this.state&&this.signal.reconnect(void 0,$T.P2P_FAILED)}getCurrentGatewayAddress(){var e;if(!$v("GATEWAY_WSS_ADDRESS"))return null!==(e=this.joinInfo)&&void 0!==e&&e.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(MI.SET_PARAMETER,{enablePublishAudioFilter:e})}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(JT.FALLBACK)),this.store.useDataChannel=!1,this.signal=new tb(Tb(Tb({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(sR.RESET_SIGNAL,lR.websocket)}}let Ib=0,Rb=0;function bb(e,t,n,r){return new wu(((i,o)=>{t.timeout=t.timeout||$v("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),Ib+=mv(t.data)):n&&(t.data.size?Ib+=t.data.size:t.data instanceof FormData?Ib+=_v(t.data):Ib+=mv(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,LS.request(t).then((e=>{"string"==typeof e.data?Rb+=mv(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?Rb+=e.data.byteLength:Rb+=mv(JSON.stringify(e.data)),r&&i({data:e.data,headers:e.headers}),i(e.data)})).catch((e=>{LS.isCancel(e)?o(new HI(TT.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?o(new HI(TT.NETWORK_TIMEOUT,e.message)):e.response?o(new HI(TT.NETWORK_RESPONSE_ERROR,e.response.status)):o(new HI(TT.NETWORK_ERROR,e.message))}))}))}!function(){var t;function n(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var r,i="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},o=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof e&&e];for(var n=0;n<t.length;++n){var r=t[n];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);function a(e,t){if(t)e:{var n=o;e=e.split(".");for(var r=0;r<e.length-1;r++){var a=e[r];if(!(a in n))break e;n=n[a]}(t=t(r=n[e=e[e.length-1]]))!=r&&null!=t&&i(n,e,{configurable:!0,writable:!0,value:t})}}function s(e){return(e={next:e})[Symbol.iterator]=function(){return this},e}function A(e){var t=typeof Symbol<"u"&&Symbol.iterator&&e[Symbol.iterator];return t?t.call(e):{next:n(e)}}if(a("Symbol",(function(e){function t(e,t){this.A=e,i(this,"description",{configurable:!0,writable:!0,value:t})}if(e)return e;t.prototype.toString=function(){return this.A};var n="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",r=0;return function e(i){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new t(n+(i||"")+"_"+r++,i)}})),a("Symbol.iterator",(function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var t="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),r=0;r<t.length;r++){var a=o[t[r]];"function"==typeof a&&"function"!=typeof a.prototype[e]&&i(a.prototype,e,{configurable:!0,writable:!0,value:function(){return s(n(this))}})}return e})),"function"==typeof Object.setPrototypeOf)r=Object.setPrototypeOf;else{var c;e:{var l={};try{l.__proto__={a:!0},c=l.a;break e}catch{}c=!1}r=c?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var d=r;function u(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function h(e){if(e.m)throw new TypeError("Generator is already running");e.m=!0}function p(e,t){return e.h=3,{value:t}}function f(e){this.g=new u,this.G=e}function E(e,t,n,r){try{var i=t.call(e.g.j,n);if(!(i instanceof Object))throw new TypeError("Iterator result "+i+" is not an object");if(!i.done)return e.g.m=!1,i;var o=i.value}catch(a){return e.g.j=null,e.g.s(a),g(e)}return e.g.j=null,r.call(e.g,o),g(e)}function g(e){for(;e.g.h;)try{var t=e.G(e.g);if(t)return e.g.m=!1,{value:t.value,done:!1}}catch(n){e.g.v=void 0,e.g.s(n)}if(e.g.m=!1,e.g.l){if(t=e.g.l,e.g.l=null,t.F)throw t.D;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function m(e){this.next=function(t){return e.o(t)},this.throw=function(t){return e.s(t)},this.return=function(t){return function(e,t){h(e.g);var n=e.g.j;return n?E(e,"return"in n?n.return:function(e){return{value:e,done:!0}},t,e.g.return):(e.g.return(t),g(e))}(e,t)},this[Symbol.iterator]=function(){return this}}function _(e,t){return t=new m(new f(t)),d&&e.prototype&&d(t,e.prototype),t}if(u.prototype.o=function(e){this.v=e},u.prototype.s=function(e){this.l={D:e,F:!0},this.h=this.C||this.u},u.prototype.return=function(e){this.l={return:e},this.h=this.u},f.prototype.o=function(e){return h(this.g),this.g.j?E(this,this.g.j.next,e,this.g.o):(this.g.o(e),g(this))},f.prototype.s=function(e){return h(this.g),this.g.j?E(this,this.g.j.throw,e,this.g.o):(this.g.s(e),g(this))},a("Array.prototype.entries",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(e,t){return[e,t]}))}})),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var C=function(e,t){for(var n=0;n<e.length;n++)t(e[n])},w=function(e){return e.replace(/\r?\n|\r/g,"\r\n")},S=function(e,t,n){return t instanceof Blob?(n=void 0!==n?n+"":"string"==typeof t.name?t.name:"blob",t.name===n&&"[object Blob]"!==Object.prototype.toString.call(t)||(t=new File([t],n)),[String(e),t]):[String(e),String(t)]},T=function(e,t){if(e.length<t)throw new TypeError(t+" argument required, but only "+e.length+" present.")},v="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,y=v.FormData,I=v.XMLHttpRequest&&v.XMLHttpRequest.prototype.send,R=v.Request&&v.fetch,b=v.navigator&&v.navigator.sendBeacon,O=v.Element&&v.Element.prototype,B=v.Symbol&&Symbol.toStringTag;B&&(Blob.prototype[B]||(Blob.prototype[B]="Blob"),"File"in v&&!File.prototype[B]&&(File.prototype[B]="File"));try{new File([],"")}catch{v.File=function(e,t,n){return e=new Blob(e,n||{}),Object.defineProperties(e,{name:{value:t},lastModified:{value:+(n&&void 0!==n.lastModified?new Date(n.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),B&&Object.defineProperty(e,B,{value:"File"}),e}}var N=function(e){return e.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},D=function(e){this.i=[];var t=this;e&&C(e.elements,(function(e){if(e.name&&!e.disabled&&"submit"!==e.type&&"button"!==e.type&&!e.matches("form fieldset[disabled] *"))if("file"===e.type){var n=e.files&&e.files.length?e.files:[new File([],"",{type:"application/octet-stream"})];C(n,(function(n){t.append(e.name,n)}))}else"select-multiple"===e.type||"select-one"===e.type?C(e.options,(function(n){!n.disabled&&n.selected&&t.append(e.name,n.value)})):"checkbox"===e.type||"radio"===e.type?e.checked&&t.append(e.name,e.value):(n="textarea"===e.type?w(e.value):e.value,t.append(e.name,n))}))};if((t=D.prototype).append=function(e,t,n){T(arguments,2),this.i.push(S(e,t,n))},t.delete=function(e){T(arguments,1);var t=[];e=String(e),C(this.i,(function(n){n[0]!==e&&t.push(n)})),this.i=t},t.entries=function e(){var t,n=this;return _(e,(function(e){if(1==e.h&&(t=0),3!=e.h)return t<n.i.length?e=p(e,n.i[t]):(e.h=0,e=void 0),e;t++,e.h=2}))},t.forEach=function(e,t){T(arguments,1);for(var n=A(this),r=n.next();!r.done;r=n.next()){var i=A(r.value);r=i.next().value,i=i.next().value,e.call(t,i,r,this)}},t.get=function(e){T(arguments,1);var t=this.i;e=String(e);for(var n=0;n<t.length;n++)if(t[n][0]===e)return t[n][1];return null},t.getAll=function(e){T(arguments,1);var t=[];return e=String(e),C(this.i,(function(n){n[0]===e&&t.push(n[1])})),t},t.has=function(e){T(arguments,1),e=String(e);for(var t=0;t<this.i.length;t++)if(this.i[t][0]===e)return!0;return!1},t.keys=function e(){var t,n,r,i=this;return _(e,(function(e){if(1==e.h&&(t=A(i),n=t.next()),3!=e.h)return n.done?void(e.h=0):(r=n.value,p(e,A(r).next().value));n=t.next(),e.h=2}))},t.set=function(e,t,n){T(arguments,2),e=String(e);var r=[],i=S(e,t,n),o=!0;C(this.i,(function(t){t[0]===e?o&&(o=!r.push(i)):r.push(t)})),o&&r.push(i),this.i=r},t.values=function e(){var t,n,r,i,o=this;return _(e,(function(e){if(1==e.h&&(t=A(o),n=t.next()),3!=e.h)return n.done?void(e.h=0):(r=n.value,(i=A(r)).next(),p(e,i.next().value));n=t.next(),e.h=2}))},D.prototype._asNative=function(){for(var e=new y,t=A(this),n=t.next();!n.done;n=t.next()){var r=A(n.value);n=r.next().value,r=r.next().value,e.append(n,r)}return e},D.prototype._blob=function(){var e="----formdata-polyfill-"+Math.random(),t=[],n="--"+e+'\r\nContent-Disposition: form-data; name="';return this.forEach((function(e,r){return"string"==typeof e?t.push(n+N(w(r))+'"\r\n\r\n'+w(e)+"\r\n"):t.push(n+N(w(r))+'"; filename="'+N(e.name)+'"\r\nContent-Type: '+(e.type||"application/octet-stream")+"\r\n\r\n",e,"\r\n")})),t.push("--"+e+"--"),new Blob(t,{type:"multipart/form-data; boundary="+e})},D.prototype[Symbol.iterator]=function(){return this.entries()},D.prototype.toString=function(){return"[object FormData]"},O&&!O.matches&&(O.matches=O.matchesSelector||O.mozMatchesSelector||O.msMatchesSelector||O.oMatchesSelector||O.webkitMatchesSelector||function(e){for(var t=(e=(this.document||this.ownerDocument).querySelectorAll(e)).length;0<=--t&&e.item(t)!==this;);return-1<t}),B&&(D.prototype[B]="FormData"),I){var P=v.XMLHttpRequest.prototype.setRequestHeader;v.XMLHttpRequest.prototype.setRequestHeader=function(e,t){P.call(this,e,t),"content-type"===e.toLowerCase()&&(this.B=!0)},v.XMLHttpRequest.prototype.send=function(e){e instanceof D?(e=e._blob(),this.B||this.setRequestHeader("Content-Type",e.type),I.call(this,e)):I.call(this,e)}}R&&(v.fetch=function(e,t){return t&&t.body&&t.body instanceof D&&(t.body=t.body._blob()),R.call(this,e,t)}),b&&(v.navigator.sendBeacon=function(e,t){return t instanceof D&&(t=t._asNative()),b.call(this,e,t)}),v.FormData=D}}();let Ob=()=>{let e=$v("AREAS");return 0===e.length&&e.push(dR.GLOBAL),Hr(e).call(e,((e,t,n)=>{let r=Bb(t);return r?0===n?r:"".concat(e,",").concat(r):e}),"")},Bb=e=>e===dR.OVERSEA?"".concat(hR.ASIA,",").concat(hR.EUROPE,",").concat(hR.AFRICA,",").concat(hR.NORTH_AMERICA,",").concat(hR.SOUTH_AMERICA,",").concat(hR.OCEANIA):hR[e],Nb=e=>{let t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map((e=>{let n=pR[e],r=Object.keys(n);r&&r.map((e=>{"CODE"!==e&&(t[e]=t[e].concat(n[e]))}))})),t},Db={GLOBAL:{ASIA:[dR.CHINA,dR.JAPAN,dR.INDIA,dR.KOREA,dR.HKMC],EUROPE:[],NORTH_AMERICA:[dR.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Pb=Object.keys(Db[dR.GLOBAL]),Ub=[dR.CHINA,dR.NORTH_AMERICA,dR.EUROPE,dR.ASIA,dR.JAPAN,dR.INDIA,dR.OCEANIA,dR.SOUTH_AMERICA,dR.AFRICA,dR.KOREA,dR.HKMC,dR.US],Lb=function(e,t){let n=[];if(yr(e).call(e,dR.GLOBAL)){let o=[dR.GLOBAL,dR.OVERSEA],a=Object.keys(pR);if(t===dR.GLOBAL)throw new HI(TT.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===dR.CHINA)n=[dR.OVERSEA];else if(i=t,yr(Pb).call(Pb,i)){let e=(r=t,Db[dR.GLOBAL][r]||[]),i=[...o,t,...e];n=a.filter((e=>!yr(i).call(i,e)))}else if(function(e){let t=!1;return Pb.forEach((n=>{var r;yr(r=Db[dR.GLOBAL][n]).call(r,e)&&(t=!0)})),t}(t)){let e=function(e){let t;return Pb.forEach((n=>{var r;yr(r=Db[dR.GLOBAL][n]).call(r,e)&&(t=n)})),t}(t),r=[...o,e,t];n=a.filter((e=>!yr(r).call(r,e)))}else n=e;n=function(e){let t=[];return Ub.forEach((n=>{yr(e).call(e,n)&&t.push(n)})),t.concat(e.filter((e=>!yr(Ub).call(Ub,e))))}(n)}else n=e;var r,i;return n};function kb(e){var t,n;if(!e&&yr(t=$v("AREAS")).call(t,dR.EXTENSIONS))return Ey.debug("update area from ap : reset"),void Mb(yy,!0);if(!yr(n=$v("AREAS")).call(n,dR.GLOBAL)||!e)return;let r=pR.EXTENSIONS;r&&(r={CODE:Bb(dR.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},Ey.debug("update area from ap success: ".concat(e,",config is "),r),Zv("AREAS",[dR.EXTENSIONS],!0),Object.keys(r).map((e=>{Zv(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?r[e][0]:r[e])})))}function Mb(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=vy.reportApiInvoke(null,{name:jT.SET_AREA,options:e,tag:GT.TRACER});try{let r=[];if("string"==typeof e&&(r=[e]),Array.isArray(e)&&(e.forEach((e=>{if(!yr(uR).call(uR,e))throw new HI(TT.INVALID_PARAMS,"invalid area code")})),r=e),"[object Object]"===Object.prototype.toString.call(e)){let{areaCode:t,excludedArea:n}=e;if(!t)throw new HI(TT.INVALID_PARAMS,"area code is needed");let i=t;"string"==typeof t&&(i=[t]),r=n?Lb(i,n):i}if(!t){if(ey.AREAS){let e=new HI(TT.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(e),void Ey.warning("setArea is prohibited because of config-distribute")}if(yr(r).call(r,dR.GLOBAL)&&$v("AREAS")===dR.EXTENSIONS){let e=new HI(TT.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(e),void Ey.warning("setArea is prohibited because of ap extensions")}}Zv("AREAS",r,t);let i=Nb(r);Object.keys(i).map((e=>{Zv(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?i[e][0]:i[e])})),Ey.debug("set area success:",r.join(","))}catch(r){throw n.onError(r),r}n.onSuccess()}function Fb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fb(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fb(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let Qb=1,Vb=1;function Hb(e,t,n,r){let i,{url:o,areaCode:a}=e,{clientId:s,sid:A}=t,c=Date.now(),[l,d]=Wb(t,a,[nb.CHOOSE_SERVER]),u=av.networkState;return Fv((async()=>{u&&av.networkState===ev.OFFLINE&&av.onlineWaiter&&await wu.race([av.onlineWaiter,wv(r&&r.maxRetryTimeout||kv.maxRetryTimeout)]),u=av.networkState;let{data:e,headers:a}=await bb(o,{data:l,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i="1"===a.http3?1:-1,vy.reportResourceTiming(o,A),jb(e,o,t,c,[nb.CHOOSE_SERVER],i);let s=lb(e,nb.CHOOSE_SERVER);return Gb(s),ab(s,o)}),(e=>(e&&vy.joinChooseServer(A,{lts:c,succ:!0,csAddr:o,opid:d,serverList:e.gatewayAddrs.map((e=>e.address)),ec:null,cid:e.cid.toString(),uid:e.uid.toString(),csIp:e.csIp,unilbsServerIds:[nb.CHOOSE_SERVER].toString(),isHttp3:i}),!1)),(e=>e.code!==TT.OPERATION_ABORTED&&(e.code===TT.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(vy.joinChooseServer(A,{lts:c,succ:!1,csAddr:o,serverList:null,opid:d,ec:e.code,csIp:e.data&&e.data.csIp,unilbsServerIds:[nb.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:u}),isHttp3:i}),Ey.warning("[".concat(s||"sid-".concat(A.slice(0,6)),"] Choose server network error, retry"),e),!0))),r)}function Kb(e,t,n,r){let i,o,{url:a,areaCode:s,serviceIds:A}=e,c=Date.now(),[l,d]=Wb(t,s,A);return Fv((async()=>{o&&av.networkState===ev.OFFLINE&&av.onlineWaiter&&await wu.race([av.onlineWaiter,wv(r&&r.maxRetryTimeout||kv.maxRetryTimeout)]),o=av.networkState;let{data:e,headers:s}=await bb(a,{data:l,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i="1"===s.http3?1:-1,vy.reportResourceTiming(a,t.sid),jb(e,a,t,c,A,i);let d=lb(e,nb.CHOOSE_SERVER),u=lb(e,"proxy5"===t.cloudProxyServer?nb.CLOUD_PROXY_5:"proxy3"===t.cloudProxyServer||"proxy4"===t.cloudProxyServer?nb.CLOUD_PROXY:nb.CLOUD_PROXY_FALLBACK);return Gb(d),{gatewayInfo:ab(d,a),proxyInfo:u,url:a}}),(e=>(e.gatewayInfo&&vy.joinChooseServer(t.sid,{lts:c,succ:!0,csAddr:a,serverList:e.gatewayInfo.gatewayAddrs.map((e=>e.address)),ec:null,opid:d,cid:e.gatewayInfo.cid.toString(),uid:e.gatewayInfo.uid.toString(),csIp:e.gatewayInfo.csIp,unilbsServerIds:A.toString(),isHttp3:i}),e.proxyInfo&&vy.joinWebProxyAP(t.sid,{lts:c,sucess:1,apServerAddr:a,turnServerAddrList:e.proxyInfo.addresses.map((e=>e.ip)).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:A.toString()}),!1)),(e=>e.code!==TT.OPERATION_ABORTED&&(e.code===TT.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(vy.joinWebProxyAP(t.sid,{lts:c,sucess:0,apServerAddr:a,turnServerAddrList:null,errorCode:e.code,eventType:t.cloudProxyServer,unilbsServerIds:A.toString(),extend:JSON.stringify({networkState:o})}),Ey.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),e),!0))),r)}let jb=(e,t,n,r,i,o)=>{let{sid:a,clientId:s,cloudProxyServer:A}=n,c=[],l=n=>{4096===n.flag?vy.joinChooseServer(a,{lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:n.error.message,csIp:n.error.data&&n.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:o}):1048576!==n.flag&&4194304!==n.flag&&4194310!==n.flag||vy.joinWebProxyAP(a,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:n.error.code,eventType:A,unilbsServerIds:i.toString()})};if(e.response_body.forEach((t=>{let n=t.buffer.code;if(23===t.uri&&0===n&&!t.buffer.edges_services)if(4194310===t.buffer.flag)Ey.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),t.buffer.edges_services=[];else{let n={error:new HI(TT.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:t.buffer.flag};c.push(n),l(n)}if(0!==n){let r=FR(n),i={error:new HI(TT.CAN_NOT_GET_GATEWAY_SERVER,r.desc,{desc:r.desc,retry:r.retry,csIp:e.detail[502]}),flag:t.buffer.flag};4194310===t.buffer.flag?Ey.warning(i.error.toString()):c.push(i),l(i)}})),c.length)throw Ey.warning("[".concat(s||"sid-".concat(a.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(c.map((e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message,", retry: ").concat(e.error.data.retry))).join(" | "))),new HI(TT.CAN_NOT_GET_GATEWAY_SERVER,c.map((e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message))).join(" | "),{retry:!!c.find((e=>e.error.data.retry)),csIp:e.detail[502],desc:[...new Set(c.map((e=>{var t;return null==e||null===(t=e.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.desc})).filter((e=>!!e)))]})},Gb=e=>{var t,n,r,i;if(e.addresses&&0===e.addresses.length&&0===e.code)throw new HI(TT.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if($v("AP_AREA")&&(null!==(r=e.detail)&&void 0!==r&&r[23]&&"string"==typeof(null===(i=e.detail)||void 0===i?void 0:i[23])?kb(e.detail[23].toLowerCase()):kb()),null!==(t=e.detail)&&void 0!==t&&t[19]&&"string"==typeof(null===(n=e.detail)||void 0===n?void 0:n[19])){let t=e.detail[19],n=null===t||void 0===t?void 0:t.split(";");for(let r=0;r<n.length;r++){var o;let t=_h(o=n[r]).call(o);e.addresses[r]&&n&&(e.addresses[r].fingerprint=t)}}if($v("GATEWAY_ADDRESS")&&$v("GATEWAY_ADDRESS").length>0){Ey.debug("assign gateway address to",$v("GATEWAY_ADDRESS"));let t=$v("GATEWAY_ADDRESS").map((t=>{var n,r;let i=null!==(n=null===(r=e.addresses.find((e=>e.ip===t.ip&&e.port===t.port)))||void 0===r?void 0:r.fingerprint)&&void 0!==n?n:"";return{ip:t.ip,port:t.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:i}}));e.addresses=t}},Wb=(e,t,n)=>{let r=Math.floor(1e12*Math.random()),i={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:xb({6:e.stringUid,11:t,12:$v("USE_NEW_TOKEN")?"1":void 0,22:t},e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};i.request_bodies.forEach((t=>{e.multiIP&&e.multiIP.gateway_ip&&(t.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))}));let o=new FormData;return o.append("request",JSON.stringify(i)),[o,r]},Yb=0;function Jb(e){return wu.all(e.map((e=>e.then((e=>{throw e}),(e=>e))))).then((e=>{throw e}),(e=>e))}let Xb=async e=>{let t,{fragementLength:n,referenceList:r,asyncMapHandler:i,allFailedhandler:o,promisesCollector:a}=e,s=0,A=n,c=0,l=async()=>{let e=(()=>{let e=s*A,t=e+A;return r.slice(e,t).map(i)})();a&&a.push(...e);try{t=await Jb(e)}catch(n){if(c+=A,s++,!(c>=r.length))return void await l();o(n)}e.forEach((e=>e.cancel()))};return await l(),t},zb=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:r}=e,i=t.length,o=0,a=async()=>{let e=n(t.shift());try{return await e}catch(s){if(o++,o>=i||null!=r&&r(s))throw s;return a()}};return a()};async function qb(e,t,n,r){return{gatewayInfo:await async function(e,t,n,r){let i=null,o=[],a=async()=>{let i=$v("WEBCS_DOMAIN").slice(0,$v("AJAX_REQUEST_CONCURRENT")).map((t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:Ob()}))),a=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map((e=>e.url))}),s=await Xb({fragementLength:$v("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(Ey.debug("[".concat(e.clientId,"] Connect to choose_server:"),r.url),Hb(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},a),e[0]},promisesCollector:o});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},a),s},s=async()=>{if(await wv(1e3),null!==i)return i;let a=$v("WEBCS_DOMAIN_BACKUP_LIST").map((t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:Ob()}))),s=r.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:a.map((e=>e.url))}),A=await Xb({fragementLength:$v("FRAGEMENT_LENGTH"),referenceList:a,asyncMapHandler:r=>(Ey.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),r.url),Hb(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},s),e[0]},promisesCollector:o});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},s),A};try{return i=await Jb([a(),s()]),o.length&&o.forEach((e=>e.cancel&&"function"==typeof e.cancel&&e.cancel())),i}catch(A){throw A[0]}}(e,t,n,r)}}async function Zb(e,t,n,r,i){let o=e.cloudProxyServer;if("disabled"===o){if(e.useLocalAccessPoint)return await qb(e,t,n,i);if($v("JOIN_WITH_FALLBACK_MEDIA_PROXY")){let{gatewayInfo:r,proxyInfo:o}=await nO(e,t,n,i);if(e.turnServer&&"auto"!==e.turnServer.mode)return{gatewayInfo:r};let s=o.map((e=>({turnServerURL:e.address,tcpport:e.tcpport||Iy.tcpport,udpport:e.udpport||Iy.udpport,username:e.username||Iy.username,password:e.password||Iy.password,forceturn:!1,security:!0})));if(i.useP2P){var a;let t=null!==(a=e.uid)&&void 0!==a?a:r.uid,n="glb:".concat(t.toString()),i=await QT(n),A=o.map((e=>({turnServerURL:e.address,tcpport:e.tcpport||Iy.tcpport,udpport:e.udpport||Iy.udpport,username:n,password:i,forceturn:!1,security:!0})));s.push(...A)}return e.turnServer={mode:"manual",servers:s},{gatewayInfo:r}}return await qb(e,t,n,i)}let{proxyInfo:s,gatewayInfo:A}=await nO(e,t,n,i),c={gatewayInfo:A},l=s.map((e=>({turnServerURL:e.address,tcpport:"proxy3"===o?void 0:e.tcpport?e.tcpport:Iy.tcpport,udpport:"proxy4"===o?void 0:e.udpport?e.udpport:Iy.udpport,username:e.username||Iy.username,password:e.password||Iy.password,forceturn:"proxy4"!==o,security:"proxy5"===o})));if(i.useP2P){var d;let t=null!==(d=e.uid)&&void 0!==d?d:A.uid,n="glb:".concat(t.toString()),r=await QT(n),i=s.map((e=>({turnServerURL:e.address,tcpport:"proxy3"===o?void 0:e.tcpport||Iy.tcpport,udpport:"proxy4"===o?void 0:e.udpport||Iy.udpport,username:n,password:r,forceturn:"proxy4"!==o,security:"proxy5"===o})));l.push(...i)}return e.turnServer={mode:"manual",servers:l},Ey.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(o)),c}async function $b(e,t,n,r,i){let o=$v("ACCOUNT_REGISTER").slice(0,$v("AJAX_REQUEST_CONCURRENT")),a=[];a=t.proxyServer?o.map((e=>"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1"))):o.map((e=>"https://".concat(e,"/api/v1")));let s=null===i||void 0===i?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:a});try{let o=await async function(e,t,n,r,i){let o=Date.now(),a={sid:n.sid,opid:10,appid:n.appId,string_uid:t},s=e[0],A=await Fv((()=>bb(s+"".concat(-1===s.indexOf("?")?"?":"&","action=stringuid"),{data:a,cancelToken:r,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}})),((n,r)=>{if(0===n.code){if(n.uid<=0||n.uid>=Math.pow(2,32))throw Ey.error("Invalid Uint Uid ".concat(t," => ").concat(n.uid),n),vy.reqUserAccount(a.sid,{lts:o,success:!1,serverAddr:s,stringUid:a.string_uid,uid:n.uid,errorCode:TT.INVALID_UINT_UID_FROM_STRING_UID,extend:a}),new HI(TT.INVALID_UINT_UID_FROM_STRING_UID);return vy.reqUserAccount(a.sid,{lts:o,success:!0,serverAddr:s,stringUid:a.string_uid,uid:n.uid,errorCode:null,extend:a}),!1}let i=FR(n.code);return i.retry&&(s=e[(r+1)%e.length]),vy.reqUserAccount(a.sid,{lts:o,success:!1,serverAddr:s,stringUid:a.string_uid,uid:n.uid,errorCode:i.desc,extend:a}),i.retry}),((t,n)=>t.code!==TT.OPERATION_ABORTED&&(vy.reqUserAccount(a.sid,{lts:o,success:!1,serverAddr:s,stringUid:a.string_uid,uid:null,errorCode:t.code,extend:a}),s=e[(n+1)%e.length],!0)),i);if(0!==A.code){let e=FR(A.code);throw new HI(TT.UNEXPECTED_RESPONSE,e.desc)}return A}(a,e,t,n,r);return null!==i&&void 0!==i&&i.recordJoinChannelService({status:"success",endTs:Date.now()},s),o.uid}catch(A){throw null!==i&&void 0!==i&&i.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[A]},s),A}}async function eO(e,t,n){let r=$v("ACCOUNT_REGISTER"),i=[];i=t.proxyServer?r.map((e=>"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1"))):r.map((e=>"https://".concat(e,"/api/v1")));try{return await zb({referenceList:i,asyncMapHandler:r=>async function(e,t,n,r){let i=Date.now(),o={sid:n.sid,opid:10,appid:n.appId,string_uid:t};try{let t=await bb(e+"".concat(-1===e.indexOf("?")?"?":"&","action=stringuid"),{data:o,cancelToken:r,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(0!==t.code){let e=FR(t.code);throw new HI(TT.UNEXPECTED_RESPONSE,"preload sua error:".concat(e.desc),e)}if(t.uid<=0||t.uid>=Math.pow(2,32))throw new HI(TT.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:i,url:e,req:o,uid:t.uid,elapse:Date.now()-i}}catch(a){throw a}}(r,e,t,n),closeFn:e=>e.code===TT.OPERATION_ABORTED||e.code===TT.UNEXPECTED_RESPONSE&&!e.data.retry})}catch(o){throw o}}async function tO(e,t){let n=$v("WEBCS_DOMAIN").concat($v("WEBCS_DOMAIN_BACKUP_LIST")).map((e=>({url:"https://".concat(e,"/api/v2/transpond/webrtc?v=2"),areaCode:Ob(),serviceIds:[nb.CHOOSE_SERVER,nb.CLOUD_PROXY_FALLBACK]})));try{return await zb({referenceList:n,asyncMapHandler:n=>async function(e,t,n){let r,{url:i,areaCode:o,serviceIds:a}=e,s=Date.now(),[A,c]=Wb(t,o,a),l=av.networkState;try{l&&av.networkState===ev.OFFLINE&&av.onlineWaiter&&await wu.race([av.onlineWaiter,wv(kv.maxRetryTimeout)]),l=av.networkState;let{data:e,headers:t}=await bb(i,{data:A,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);r="1"===t.http3?1:-1,(e=>{let t=[];if(e.response_body.forEach((n=>{let r=n.buffer.code;if(23===n.uri&&0===r&&!n.buffer.edges_services)if(4194310===n.buffer.flag)n.buffer.edges_services=[];else{let r={error:new HI(TT.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:n.buffer.flag};t.push(r)}if(0!==r){let i=FR(r),o={error:new HI(TT.CAN_NOT_GET_GATEWAY_SERVER,i.desc,{desc:i.desc,retry:i.retry,csIp:e.detail[502]}),flag:n.buffer.flag};4194310===n.buffer.flag?Ey.warning(o.error.toString()):t.push(o)}})),t.length)throw new HI(TT.CAN_NOT_GET_GATEWAY_SERVER,t.map((e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message))).join(" | "),{retry:!!t.find((e=>e.error.data.retry)),csIp:e.detail[502],desc:[...new Set(t.map((e=>{var t;return null==e||null===(t=e.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.desc})).filter((e=>!!e)))]})})(e);let o=lb(e,nb.CHOOSE_SERVER),a=lb(e,nb.CLOUD_PROXY_FALLBACK);return Gb(o),{gatewayInfo:ab(o,i),proxyInfo:a,opid:c,requestTime:s,url:i,isHttp3:r,elapse:Date.now()-s}}catch(d){throw d}}(n,e,t),closeFn:e=>e.code===TT.OPERATION_ABORTED||e.code===TT.CAN_NOT_GET_GATEWAY_SERVER&&!e.data.retry})}catch(r){throw r}}async function nO(e,t,n,r){let i,o,a,s=$v("PROXY_SERVER_TYPE3"),A=(e,t,n)=>{let r=n||s;return Array.isArray(r)&&(r=t%2==0?s[1]:s[0]),"https://".concat(r,"/ap/?url=").concat(e)},c=null,l=[],d=async()=>{let i=$v("WEBCS_DOMAIN").slice(0,$v("AJAX_REQUEST_CONCURRENT")).map(((t,n)=>{let r;return r="disabled"===e.cloudProxyServer&&e.proxyServer?A("".concat(t,"/api/v2/transpond/webrtc?v=2"),n,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):A("".concat(t,"/api/v2/transpond/webrtc?v=2"),n),{url:r,areaCode:Ob(),serviceIds:[nb.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?nb.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?nb.CLOUD_PROXY:nb.CLOUD_PROXY_FALLBACK]}})),o=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map((e=>e.url))}),a=await Xb({fragementLength:$v("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(Ey.debug("[".concat(e.clientId,"] Connect to choose_server:"),r.url),Kb(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},o),e[0]},promisesCollector:l});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},o),a},u=async()=>{if(await wv(1e3),null!==c)return c;let i=$v("WEBCS_DOMAIN_BACKUP_LIST").map(((t,n)=>{let r;return r="disabled"===e.cloudProxyServer&&e.proxyServer?A("".concat(t,"/api/v2/transpond/webrtc?v=2"),n,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):A("".concat(t,"/api/v2/transpond/webrtc?v=2"),n),{url:r,areaCode:Ob(),serviceIds:[nb.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?nb.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?nb.CLOUD_PROXY:nb.CLOUD_PROXY_FALLBACK]}})),o=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map((e=>e.url))}),a=await Xb({fragementLength:$v("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(Ey.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),r.url),Kb(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},o),e[0]},promisesCollector:l});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},o),a};try{({gatewayInfo:i,proxyInfo:o,url:a}=await Jb([d(),u()]))}catch(h){throw h[0]}if(l.length&&l.forEach((e=>e.cancel&&"function"==typeof e.cancel&&e.cancel())),!i||!o)throw new HI(TT.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=a,"disabled"!==e.cloudProxyServer&&Array.isArray(s)&&a){let t=/^https?:\/\/(.+?)(\/.*)?$/.exec(a)[1];yr(s).call(s,t)&&(e.proxyServer=t,Ey.setProxyServer(t),vy.setProxyServer(t))}return c={gatewayInfo:i,proxyInfo:await db(o,i.uid)},c}async function rO(e,t,n,r){let i=$v("UAP_AP").slice(0,$v("AJAX_REQUEST_CONCURRENT")).map((e=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1?action=uap"):"https://".concat(e,"/api/v1?action=uap")));return await function(e,t,n,r,i){Qb+=1;let o,a,s={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:Qb,requestId:Qb,version:Wv,cname:n.cname},A={service_name:t,json_body:JSON.stringify(s)},c=e[0];return Fv((async()=>{o=Date.now();let e=await bb(c,{data:A,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(a=Date.now()-o,0!==e.code){let t=new HI(TT.UNEXPECTED_RESPONSE,"live streaming ap error, code"+e.code,{retry:!0,responseTime:a});throw Ey.error(t.toString()),t}let n=JSON.parse(e.json_body);if(200!==n.code){let e=new HI(TT.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(n.code,", reason: ").concat(n.reason),{code:n.code,responseTime:a});throw Ey.error(e.toString()),e}if(!n.servers||0===n.servers.length){let e=new HI(TT.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:n.code,responseTime:a});throw Ey.error(e.toString()),e}let i=(l=t,{addressList:(s=n).servers.map((e=>"wss://".concat(e.address.replace(/\./g,"-"),".").concat($v("WORKER_DOMAIN"),":").concat(e.wss,"?serviceName=").concat(encodeURIComponent(l)))),workerToken:s.workerToken,vid:s.vid});var s,l;return $v("LIVE_STREAMING_ADDRESS")&&(i.addressList=$v("LIVE_STREAMING_ADDRESS")instanceof Array?$v("LIVE_STREAMING_ADDRESS"):[$v("LIVE_STREAMING_ADDRESS")]),xb(xb({},i),{},{responseTime:a})}),((r,i)=>(vy.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(r.addressList),firstSuccess:0===i,responseTime:a,serverIp:e[i%e.length]}),!1)),((r,i)=>(vy.apworkerEvent(n.sid,{success:!1,sc:r.data&&r.data.code||200,serviceName:t,responseTime:a,serverIp:e[i%e.length]}),!!(r.code!==TT.OPERATION_ABORTED&&r.code!==TT.UNEXPECTED_RESPONSE||r.data&&r.data.retry)&&(c=e[(i+1)%e.length],!0))),i)}(i,e,t,n,r)}async function iO(e,t,n){let r=null,i=[],o=async o=>{let a=$v(o?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map((t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2")));return o&&(await wv(1e3),null!==r)?r:await Xb({fragementLength:$v("FRAGEMENT_LENGTH"),referenceList:a,asyncMapHandler:r=>(Ey.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(o?"backup":""," choose_server:"),r),function(e,t,n,r){let[i]=((e,t)=>{let n=Math.floor(1e12*Math.random()),r={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map((e=>({ip:e.ip,port:e.port})))}}]},i=new FormData;return i.append("request",JSON.stringify(r)),[i,n]})(t,[nb.CHOOSE_SERVER]),o=av.networkState;return Fv((async()=>(o&&av.networkState===ev.OFFLINE&&av.onlineWaiter&&await wu.race([av.onlineWaiter,wv(r&&r.maxRetryTimeout||kv.maxRetryTimeout)]),o=av.networkState,((e,t)=>{if(e.response_body&&e.response_body.length){let t=e.response_body[0];if(0!==t.buffer.code){let e=FR(t.buffer.code);throw new HI(TT.UPDATE_TICKET_FAILED,"[".concat(t.buffer.code,"]: ").concat(e.desc),{retry:e.retry})}return t.buffer.ticket}throw Ey.debug("update ticket request received ap response without response body:",t),new HI(TT.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})})(await bb(e,{data:i,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0),e))),(()=>!1),(e=>e.code!==TT.OPERATION_ABORTED&&(e.code===TT.UPDATE_TICKET_FAILED?e.data.retry:(Ey.warning("[".concat(t.clientId,"] update ticket network error, retry"),e),!0))),r)}(r,e,t,n)),allFailedhandler:e=>{throw e[0]},promisesCollector:i})};try{return r=await Jb([o(!1),o(!0)]),i.length&&i.forEach((e=>e.cancel&&"function"==typeof e.cancel&&e.cancel())),r}catch(a){throw a[0]}}function oO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function aO(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oO(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oO(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class sO extends VT{get isSuccess(){return!!this.configs}constructor(){super(),O_(this,"configs",void 0),O_(this,"joinInfo",void 0),O_(this,"cancelToken",void 0),O_(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),O_(this,"interval",void 0),O_(this,"mutex",new Uv("config-distribute")),O_(this,"mutableParamsRead",!1)}startGetConfigDistribute(e,t){this.joinInfo=e,this.cancelToken=t,this.interval&&this.stopGetConfigDistribute(),$v("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval((()=>{this.updateConfigDistribute()}),$v("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,vy.reportApiInvoke(null,{options:void 0,name:jT.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:GT.TRACER}).onSuccess(JSON.stringify(ey))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void Ey.debug("[config-distribute] get config distribute interrupted have no joininfo");let e,t=await this.mutex.lock();try{e=await async function(e,t,n){let r=$v("CDS_AP").slice(0,$v("AJAX_REQUEST_CONCURRENT")).map((t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1"):"https://".concat(t,"/api/v1?action=config"))).map((r=>function(e,t,n,r){let i=WS(),o={flag:64,cipher_method:0,features:{device:i.name,system:i.os,system_general:navigator.userAgent,vendor:t.appId,version:Wv,cname:t.cname,sid:t.sid,session_id:t.sid,detail:"",proxyServer:t.proxyServer}};return Fv((()=>bb(e,{data:o,timeout:1e3,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}})),void 0,(e=>e.code!==TT.OPERATION_ABORTED),r)}(r,e,t,n))),i=null,o=null,a={};try{i=await Jb(r)}catch(s){if(s.code===TT.OPERATION_ABORTED)throw s;o=s}if(r.forEach((e=>e.cancel())),vy.reportApiInvoke(e.sid,{name:jT.REQUEST_CONFIG_DISTRIBUTE,options:{error:o,res:i}}).onSuccess(),i&&i.test_tags)try{a=function(e){if(!e.test_tags)return{};let t=e.test_tags,n=Object.keys(t),r={};return n.forEach((e=>{var n;let i=_h(n=e.slice(4)).call(n),o=JSON.parse(t[e])[1];r[i]=o})),r}(i)}catch{}return a}(this.joinInfo,this.cancelToken,this.retryConfig),Ey.debug("[config-distribute] get config distribute",JSON.stringify(e)),e.limit_bitrate&&this.handleBitrateLimit(e.limit_bitrate),this.cacheGlobalParameterConfig(e),this.configs=e}catch(n){let e=new HI(TT.NETWORK_RESPONSE_ERROR,n);Ey.warning("[config-distribute] ".concat(e.toString()))}finally{t()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(e){var t;(t=e)&&t.uplink&&t.id&&void 0!==t.uplink.max_bitrate&&void 0!==t.uplink.min_bitrate&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==e.id&&this.emit(fR.UPDATE_BITRATE_LIMIT,e):this.emit(fR.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&aO({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(e){var t;let n=Lp(t=Object.keys(e).filter((e=>/^webrtc_ng_global_parameter/.test(e)))).call(t);for(let o=0;o<n.length;o++)for(let t=n.length-1;t>o;t--){let r=n[t];if("number"==typeof e[r].__priority){let i=e[r].__priority,o=n[t-1];if("number"==typeof e[o].__priority){if(!(i>e[o].__priority))continue;{let e=r;n[t]=n[t-1],n[t-1]=e}}else{let e=r;n[t]=n[t-1],n[t-1]=e}}}let r={};n.forEach((t=>{let n=e[t],i=n.__expires;Object.keys(n).forEach((e=>{"__priority"===e||"__expires"===e||Object.prototype.hasOwnProperty.call(r,e)||(r[e]=aO({value:n[e]},i&&{expires:i}))}))}));try{!function(e){try{let t=Date.now();Object.keys(e).forEach((n=>{switch(n){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":case"ENABLE_AG_ADAPTATION":case"FORCE_AG_HIGH_FRAMERATE":case"FORCE_SUPPORT_AG_ADAPTATION":case"ENCODER_CONFIG_LIMIT":case"CAMERA_CAPTURE_CONFIG":case"ENABLE_PRELOAD":if(Object.prototype.hasOwnProperty.call(qv,n)){let{value:r,expires:i}=e[n];if(i&&i<=t)return;ey[n]=r,qv[n]=r,Ey.debug("Update global parameters from config distribute",n,r)}}}))}catch(t){Ey.error("Error update config immediately: ".concat(e),t.message)}}(r);let e=JSON.stringify(r),t=window.btoa(e);window.localStorage.setItem("websdk_ng_global_parameter",t),Ey.debug("Caching global parameters ".concat(e))}catch(i){Ey.error("Error caching global parameters:",i.message)}}}var AO,cO=t(Zy),lO=O,dO=A,uO=D,hO=n,pO=Gi,fO=Ni,EO=P,gO=Ye,mO=j,_O=Object.assign,CO=Object.defineProperty,wO=dO([].concat),SO=!_O||hO((function(){if(lO&&1!==_O({b:1},_O(CO({},"a",{enumerable:!0,get:function(){CO(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!=_O({},e)[n]||pO(_O({},t)).join("")!=r}))?function(e,t){for(var n=gO(e),r=arguments.length,i=1,o=fO.f,a=EO.f;r>i;)for(var s,A=mO(arguments[i++]),c=o?wO(pO(A),o(A)):pO(A),l=c.length,d=0;l>d;)s=c[d++],lO&&!uO(a,A,s)||(n[s]=A[s]);return n}:_O,TO=$t,vO=Jo,yO=Yt,IO=D,RO=Ye,bO=function(e,t,n,r){try{return r?t(TO(n)[0],n[1]):t(n)}catch(i){vO(e,"throw",i)}},OO=No,BO=IA,NO=Qn,DO=Wh,PO=jo,UO=Mo,LO=Array,kO=A,MO=2147483647,FO=/[^\0-\u007E]/,xO=/[.\u3002\uFF0E\uFF61]/g,QO="Overflow: input needs wider integers to process",VO=RangeError,HO=kO(xO.exec),KO=Math.floor,jO=String.fromCharCode,GO=kO("".charCodeAt),WO=kO([].join),YO=kO([].push),JO=kO("".replace),XO=kO("".split),zO=kO("".toLowerCase),qO=function(e){return e+22+75*(e<26)},ZO=function(e,t,n){var r=0;for(e=n?KO(e/700):e>>1,e+=KO(e/t);e>455;)e=KO(e/35),r+=36;return KO(r+36*e/(e+38))},$O=function(e){var t,n,r=[],i=(e=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=GO(e,n++);if(i>=55296&&i<=56319&&n<r){var o=GO(e,n++);56320==(64512&o)?YO(t,((1023&i)<<10)+(1023&o)+65536):(YO(t,i),n--)}else YO(t,i)}return t}(e)).length,o=128,a=0,s=72;for(t=0;t<e.length;t++)(n=e[t])<128&&YO(r,jO(n));var A=r.length,c=A;for(A&&YO(r,"-");c<i;){var l=MO;for(t=0;t<e.length;t++)(n=e[t])>=o&&n<l&&(l=n);var d=c+1;if(l-o>KO((MO-a)/d))throw VO(QO);for(a+=(l-o)*d,o=l,t=0;t<e.length;t++){if((n=e[t])<o&&++a>MO)throw VO(QO);if(n==o){for(var u=a,h=36;;){var p=h<=s?1:h>=s+26?26:h-s;if(u<p)break;var f=u-p,E=36-p;YO(r,jO(qO(p+f%E))),u=KO(f/E),h+=36}YO(r,jO(qO(u))),s=ZO(a,d,c==A),a=0,c++}}a++,o++}return WO(r,"")},eB=In,tB=O,nB=D_,rB=d,iB=Yt,oB=A,aB=$a,sB=qs,AB=iA,cB=ze,lB=SO,dB=function(e){var t=RO(e),n=BO(this),r=arguments.length,i=r>1?arguments[1]:void 0,o=void 0!==i;o&&(i=yO(i,r>2?arguments[2]:void 0));var a,s,A,c,l,d,u=UO(t),h=0;if(!u||this===LO&&OO(u))for(a=NO(t),s=n?new this(a):LO(a);a>h;h++)d=o?i(t[h],h):t[h],DO(s,h,d);else for(l=(c=PO(t,u)).next,s=n?new this:[];!(A=IO(l,c)).done;h++)d=o?bO(c,i,[A.value,h],!0):A.value,DO(s,h,d);return s.length=h,s},uB=Zh,hB=nu.codeAt,pB=hr,fB=ms,EB=kA,gB=YC,mB=Ga,_B=mB.set,CB=mB.getterFor("URL"),wB=gB.URLSearchParams,SB=gB.getState,TB=rB.URL,vB=rB.TypeError,yB=rB.parseInt,IB=Math.floor,RB=Math.pow,bB=oB("".charAt),OB=oB(/./.exec),BB=oB([].join),NB=oB(1..toString),DB=oB([].pop),PB=oB([].push),UB=oB("".replace),LB=oB([].shift),kB=oB("".split),MB=oB("".slice),FB=oB("".toLowerCase),xB=oB([].unshift),QB="Invalid scheme",VB="Invalid host",HB="Invalid port",KB=/[a-z]/i,jB=/[\d+-.a-z]/i,GB=/\d/,WB=/^0x/i,YB=/^[0-7]+$/,JB=/^\d+$/,XB=/^[\da-f]+$/i,zB=/[\0\t\n\r #%/:<>?@[\\\]^|]/,qB=/[\0\t\n\r #/:<>?@[\\\]^|]/,ZB=/^[\u0000-\u0020]+/,$B=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,eN=/[\t\n\r]/g,tN=function(e){var t,n,r,i;if("number"==typeof e){for(t=[],n=0;n<4;n++)xB(t,e%256),e=IB(e/256);return BB(t,".")}if("object"==typeof e){for(t="",r=function(e){for(var t=null,n=1,r=null,i=0,o=0;o<8;o++)0!==e[o]?(i>n&&(t=r,n=i),r=null,i=0):(null===r&&(r=o),++i);return i>n&&(t=r,n=i),t}(e),n=0;n<8;n++)i&&0===e[n]||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=NB(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},nN={},rN=lB({},nN,{" ":1,'"':1,"<":1,">":1,"`":1}),iN=lB({},rN,{"#":1,"?":1,"{":1,"}":1}),oN=lB({},iN,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),aN=function(e,t){var n=hB(e,0);return n>32&&n<127&&!cB(t,e)?e:encodeURIComponent(e)},sN={ftp:21,file:null,http:80,https:443,ws:80,wss:443},AN=function(e,t){var n;return 2==e.length&&OB(KB,bB(e,0))&&(":"==(n=bB(e,1))||!t&&"|"==n)},cN=function(e){var t;return e.length>1&&AN(MB(e,0,2))&&(2==e.length||"/"===(t=bB(e,2))||"\\"===t||"?"===t||"#"===t)},lN=function(e){return"."===e||"%2e"===FB(e)},dN={},uN={},hN={},pN={},fN={},EN={},gN={},mN={},_N={},CN={},wN={},SN={},TN={},vN={},yN={},IN={},RN={},bN={},ON={},BN={},NN={},DN=function(e,t,n){var r,i,o,a=pB(e);if(t){if(i=this.parse(a))throw vB(i);this.searchParams=null}else{if(void 0!==n&&(r=new DN(n,!0)),i=this.parse(a,null,r))throw vB(i);(o=SB(new wB)).bindURL(this),this.searchParams=o}};DN.prototype={type:"URL",parse:function(e,t,n){var r,i,o,a,s,A=this,c=t||dN,l=0,d="",u=!1,h=!1,p=!1;for(e=pB(e),t||(A.scheme="",A.username="",A.password="",A.host=null,A.port=null,A.path=[],A.query=null,A.fragment=null,A.cannotBeABaseURL=!1,e=UB(e,ZB,""),e=UB(e,$B,"$1")),e=UB(e,eN,""),r=dB(e);l<=r.length;){switch(i=r[l],c){case dN:if(!i||!OB(KB,i)){if(t)return QB;c=hN;continue}d+=FB(i),c=uN;break;case uN:if(i&&(OB(jB,i)||"+"==i||"-"==i||"."==i))d+=FB(i);else{if(":"!=i){if(t)return QB;d="",c=hN,l=0;continue}if(t&&(A.isSpecial()!=cB(sN,d)||"file"==d&&(A.includesCredentials()||null!==A.port)||"file"==A.scheme&&!A.host))return;if(A.scheme=d,t)return void(A.isSpecial()&&sN[A.scheme]==A.port&&(A.port=null));d="","file"==A.scheme?c=vN:A.isSpecial()&&n&&n.scheme==A.scheme?c=pN:A.isSpecial()?c=mN:"/"==r[l+1]?(c=fN,l++):(A.cannotBeABaseURL=!0,PB(A.path,""),c=ON)}break;case hN:if(!n||n.cannotBeABaseURL&&"#"!=i)return QB;if(n.cannotBeABaseURL&&"#"==i){A.scheme=n.scheme,A.path=uB(n.path),A.query=n.query,A.fragment="",A.cannotBeABaseURL=!0,c=NN;break}c="file"==n.scheme?vN:EN;continue;case pN:if("/"!=i||"/"!=r[l+1]){c=EN;continue}c=_N,l++;break;case fN:if("/"==i){c=CN;break}c=bN;continue;case EN:if(A.scheme=n.scheme,i==AO)A.username=n.username,A.password=n.password,A.host=n.host,A.port=n.port,A.path=uB(n.path),A.query=n.query;else if("/"==i||"\\"==i&&A.isSpecial())c=gN;else if("?"==i)A.username=n.username,A.password=n.password,A.host=n.host,A.port=n.port,A.path=uB(n.path),A.query="",c=BN;else{if("#"!=i){A.username=n.username,A.password=n.password,A.host=n.host,A.port=n.port,A.path=uB(n.path),A.path.length--,c=bN;continue}A.username=n.username,A.password=n.password,A.host=n.host,A.port=n.port,A.path=uB(n.path),A.query=n.query,A.fragment="",c=NN}break;case gN:if(!A.isSpecial()||"/"!=i&&"\\"!=i){if("/"!=i){A.username=n.username,A.password=n.password,A.host=n.host,A.port=n.port,c=bN;continue}c=CN}else c=_N;break;case mN:if(c=_N,"/"!=i||"/"!=bB(d,l+1))continue;l++;break;case _N:if("/"!=i&&"\\"!=i){c=CN;continue}break;case CN:if("@"==i){u&&(d="%40"+d),u=!0,o=dB(d);for(var f=0;f<o.length;f++){var E=o[f];if(":"!=E||p){var g=aN(E,oN);p?A.password+=g:A.username+=g}else p=!0}d=""}else if(i==AO||"/"==i||"?"==i||"#"==i||"\\"==i&&A.isSpecial()){if(u&&""==d)return"Invalid authority";l-=dB(d).length+1,d="",c=wN}else d+=i;break;case wN:case SN:if(t&&"file"==A.scheme){c=IN;continue}if(":"!=i||h){if(i==AO||"/"==i||"?"==i||"#"==i||"\\"==i&&A.isSpecial()){if(A.isSpecial()&&""==d)return VB;if(t&&""==d&&(A.includesCredentials()||null!==A.port))return;if(a=A.parseHost(d))return a;if(d="",c=RN,t)return;continue}"["==i?h=!0:"]"==i&&(h=!1),d+=i}else{if(""==d)return VB;if(a=A.parseHost(d))return a;if(d="",c=TN,t==SN)return}break;case TN:if(!OB(GB,i)){if(i==AO||"/"==i||"?"==i||"#"==i||"\\"==i&&A.isSpecial()||t){if(""!=d){var m=yB(d,10);if(m>65535)return HB;A.port=A.isSpecial()&&m===sN[A.scheme]?null:m,d=""}if(t)return;c=RN;continue}return HB}d+=i;break;case vN:if(A.scheme="file","/"==i||"\\"==i)c=yN;else{if(!n||"file"!=n.scheme){c=bN;continue}if(i==AO)A.host=n.host,A.path=uB(n.path),A.query=n.query;else if("?"==i)A.host=n.host,A.path=uB(n.path),A.query="",c=BN;else{if("#"!=i){cN(BB(uB(r,l),""))||(A.host=n.host,A.path=uB(n.path),A.shortenPath()),c=bN;continue}A.host=n.host,A.path=uB(n.path),A.query=n.query,A.fragment="",c=NN}}break;case yN:if("/"==i||"\\"==i){c=IN;break}n&&"file"==n.scheme&&!cN(BB(uB(r,l),""))&&(AN(n.path[0],!0)?PB(A.path,n.path[0]):A.host=n.host),c=bN;continue;case IN:if(i==AO||"/"==i||"\\"==i||"?"==i||"#"==i){if(!t&&AN(d))c=bN;else if(""==d){if(A.host="",t)return;c=RN}else{if(a=A.parseHost(d))return a;if("localhost"==A.host&&(A.host=""),t)return;d="",c=RN}continue}d+=i;break;case RN:if(A.isSpecial()){if(c=bN,"/"!=i&&"\\"!=i)continue}else if(t||"?"!=i)if(t||"#"!=i){if(i!=AO&&(c=bN,"/"!=i))continue}else A.fragment="",c=NN;else A.query="",c=BN;break;case bN:if(i==AO||"/"==i||"\\"==i&&A.isSpecial()||!t&&("?"==i||"#"==i)){if(".."===(s=FB(s=d))||"%2e."===s||".%2e"===s||"%2e%2e"===s?(A.shortenPath(),"/"==i||"\\"==i&&A.isSpecial()||PB(A.path,"")):lN(d)?"/"==i||"\\"==i&&A.isSpecial()||PB(A.path,""):("file"==A.scheme&&!A.path.length&&AN(d)&&(A.host&&(A.host=""),d=bB(d,0)+":"),PB(A.path,d)),d="","file"==A.scheme&&(i==AO||"?"==i||"#"==i))for(;A.path.length>1&&""===A.path[0];)LB(A.path);"?"==i?(A.query="",c=BN):"#"==i&&(A.fragment="",c=NN)}else d+=aN(i,iN);break;case ON:"?"==i?(A.query="",c=BN):"#"==i?(A.fragment="",c=NN):i!=AO&&(A.path[0]+=aN(i,nN));break;case BN:t||"#"!=i?i!=AO&&("'"==i&&A.isSpecial()?A.query+="%27":A.query+="#"==i?"%23":aN(i,nN)):(A.fragment="",c=NN);break;case NN:i!=AO&&(A.fragment+=aN(i,rN))}l++}},parseHost:function(e){var t,n,r;if("["==bB(e,0)){if("]"!=bB(e,e.length-1)||!(t=function(e){var t,n,r,i,o,a,s,A=[0,0,0,0,0,0,0,0],c=0,l=null,d=0,u=function(){return bB(e,d)};if(":"==u()){if(":"!=bB(e,1))return;d+=2,l=++c}for(;u();){if(8==c)return;if(":"!=u()){for(t=n=0;n<4&&OB(XB,u());)t=16*t+yB(u(),16),d++,n++;if("."==u()){if(0==n||(d-=n,c>6))return;for(r=0;u();){if(i=null,r>0){if(!("."==u()&&r<4))return;d++}if(!OB(GB,u()))return;for(;OB(GB,u());){if(o=yB(u(),10),null===i)i=o;else{if(0==i)return;i=10*i+o}if(i>255)return;d++}A[c]=256*A[c]+i,2!=++r&&4!=r||c++}if(4!=r)return;break}if(":"==u()){if(d++,!u())return}else if(u())return;A[c++]=t}else{if(null!==l)return;d++,l=++c}}if(null!==l)for(a=c-l,c=7;0!=c&&a>0;)s=A[c],A[c--]=A[l+a-1],A[l+--a]=s;else if(8!=c)return;return A}(MB(e,1,-1))))return VB;this.host=t}else if(this.isSpecial()){if(e=function(e){var t,n,r=[],i=XO(JO(zO(e),xO,"."),".");for(t=0;t<i.length;t++)n=i[t],YO(r,HO(FO,n)?"xn--"+$O(n):n);return WO(r,".")}(e),OB(zB,e)||null===(t=function(e){var t,n,r,i,o,a,s,A=kB(e,".");if(A.length&&""==A[A.length-1]&&A.length--,(t=A.length)>4)return e;for(n=[],r=0;r<t;r++){if(""==(i=A[r]))return e;if(o=10,i.length>1&&"0"==bB(i,0)&&(o=OB(WB,i)?16:8,i=MB(i,8==o?1:2)),""===i)a=0;else{if(!OB(10==o?JB:8==o?YB:XB,i))return e;a=yB(i,o)}PB(n,a)}for(r=0;r<t;r++)if(a=n[r],r==t-1){if(a>=RB(256,5-t))return null}else if(a>255)return null;for(s=DB(n),r=0;r<n.length;r++)s+=n[r]*RB(256,3-r);return s}(e)))return VB;this.host=t}else{if(OB(qB,e))return VB;for(t="",n=dB(e),r=0;r<n.length;r++)t+=aN(n[r],nN);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"==this.scheme},includesCredentials:function(){return""!=this.username||""!=this.password},isSpecial:function(){return cB(sN,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"==this.scheme&&1==t&&AN(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,r=e.password,i=e.host,o=e.port,a=e.path,s=e.query,A=e.fragment,c=t+":";return null!==i?(c+="//",e.includesCredentials()&&(c+=n+(r?":"+r:"")+"@"),c+=tN(i),null!==o&&(c+=":"+o)):"file"==t&&(c+="//"),c+=e.cannotBeABaseURL?a[0]:a.length?"/"+BB(a,"/"):"",null!==s&&(c+="?"+s),null!==A&&(c+="#"+A),c},setHref:function(e){var t=this.parse(e);if(t)throw vB(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"==e)try{return new PN(e.path[0]).origin}catch{return"null"}return"file"!=e&&this.isSpecial()?e+"://"+tN(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(pB(e)+":",dN)},getUsername:function(){return this.username},setUsername:function(e){var t=dB(pB(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=aN(t[n],oN)}},getPassword:function(){return this.password},setPassword:function(e){var t=dB(pB(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=aN(t[n],oN)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?tN(e):tN(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,wN)},getHostname:function(){var e=this.host;return null===e?"":tN(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,SN)},getPort:function(){var e=this.port;return null===e?"":pB(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""==(e=pB(e))?this.port=null:this.parse(e,TN))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+BB(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,RN))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""==(e=pB(e))?this.query=null:("?"==bB(e,0)&&(e=MB(e,1)),this.query="",this.parse(e,BN)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!=(e=pB(e))?("#"==bB(e,0)&&(e=MB(e,1)),this.fragment="",this.parse(e,NN)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var PN=function(e){var t=AB(this,UN),n=EB(arguments.length,1)>1?arguments[1]:void 0,r=_B(t,new DN(e,!1,n));tB||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},UN=PN.prototype,LN=function(e,t){return{get:function(){return CB(this)[e]()},set:t&&function(e){return CB(this)[t](e)},configurable:!0,enumerable:!0}};if(tB&&(sB(UN,"href",LN("serialize","setHref")),sB(UN,"origin",LN("getOrigin")),sB(UN,"protocol",LN("getProtocol","setProtocol")),sB(UN,"username",LN("getUsername","setUsername")),sB(UN,"password",LN("getPassword","setPassword")),sB(UN,"host",LN("getHost","setHost")),sB(UN,"hostname",LN("getHostname","setHostname")),sB(UN,"port",LN("getPort","setPort")),sB(UN,"pathname",LN("getPathname","setPathname")),sB(UN,"search",LN("getSearch","setSearch")),sB(UN,"searchParams",LN("getSearchParams")),sB(UN,"hash",LN("getHash","setHash"))),aB(UN,"toJSON",(function(){return CB(this).serialize()}),{enumerable:!0}),aB(UN,"toString",(function(){return CB(this).serialize()}),{enumerable:!0}),TB){var kN=TB.createObjectURL,MN=TB.revokeObjectURL;kN&&aB(PN,"createObjectURL",iB(kN,TB)),MN&&aB(PN,"revokeObjectURL",iB(MN,TB))}fB(PN,"URL"),eB({global:!0,constructor:!0,forced:!nB,sham:!tB},{URL:PN});var FN=In,xN=n,QN=kA,VN=hr,HN=D_,KN=ae("URL");FN({target:"URL",stat:!0,forced:!(HN&&xN((function(){KN.canParse()})))},{canParse:function(e){var t=QN(arguments.length,1),n=VN(e),r=t<2||void 0===arguments[1]?void 0:VN(arguments[1]);try{return!!new KN(n,r)}catch{return!1}}});var jN=t(te.URL),GN=c,WN=cw,YN=RegExp.prototype,JN=t((function(e){return e===YN||GN(YN,e)?WN(e):e.flags}));function XN(e){let t=e.length;for(;--t>=0;)e[t]=0}let zN=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),qN=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),ZN=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),$N=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),eD=new Array(576);XN(eD);let tD=new Array(60);XN(tD);let nD=new Array(512);XN(nD);let rD=new Array(256);XN(rD);let iD=new Array(29);XN(iD);let oD,aD,sD,AD=new Array(30);function cD(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function lD(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}XN(AD);let dD=e=>e<256?nD[e]:nD[256+(e>>>7)],uD=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},hD=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,uD(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},pD=(e,t,n)=>{hD(e,n[2*t],n[2*t+1])},fD=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},ED=(e,t,n)=>{let r,i,o=new Array(16),a=0;for(r=1;r<=15;r++)a=a+n[r-1]<<1,o[r]=a;for(i=0;i<=t;i++){let t=e[2*i+1];0!==t&&(e[2*i]=fD(o[t]++,t))}},gD=e=>{let t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},mD=e=>{e.bi_valid>8?uD(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},_D=(e,t,n,r)=>{let i=2*t,o=2*n;return e[i]<e[o]||e[i]===e[o]&&r[t]<=r[n]},CD=(e,t,n)=>{let r=e.heap[n],i=n<<1;for(;i<=e.heap_len&&(i<e.heap_len&&_D(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!_D(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},wD=(e,t,n)=>{let r,i,o,a,s=0;if(0!==e.sym_next)do{r=255&e.pending_buf[e.sym_buf+s++],r+=(255&e.pending_buf[e.sym_buf+s++])<<8,i=e.pending_buf[e.sym_buf+s++],0===r?pD(e,i,t):(o=rD[i],pD(e,o+256+1,t),a=zN[o],0!==a&&(i-=iD[o],hD(e,i,a)),r--,o=dD(r),pD(e,o,n),a=qN[o],0!==a&&(r-=AD[o],hD(e,r,a)))}while(s<e.sym_next);pD(e,256,t)},SD=(e,t)=>{let n,r,i,o=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,A=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<A;n++)0!==o[2*n]?(e.heap[++e.heap_len]=c=n,e.depth[n]=0):o[2*n+1]=0;for(;e.heap_len<2;)i=e.heap[++e.heap_len]=c<2?++c:0,o[2*i]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=a[2*i+1]);for(t.max_code=c,n=e.heap_len>>1;n>=1;n--)CD(e,o,n);i=A;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],CD(e,o,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,o[2*i]=o[2*n]+o[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,o[2*n+1]=o[2*r+1]=i,e.heap[1]=i++,CD(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{let n,r,i,o,a,s,A=t.dyn_tree,c=t.max_code,l=t.stat_desc.static_tree,d=t.stat_desc.has_stree,u=t.stat_desc.extra_bits,h=t.stat_desc.extra_base,p=t.stat_desc.max_length,f=0;for(o=0;o<=15;o++)e.bl_count[o]=0;for(A[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)r=e.heap[n],o=A[2*A[2*r+1]+1]+1,o>p&&(o=p,f++),A[2*r+1]=o,r>c||(e.bl_count[o]++,a=0,r>=h&&(a=u[r-h]),s=A[2*r],e.opt_len+=s*(o+a),d&&(e.static_len+=s*(l[2*r+1]+a)));if(0!==f){do{for(o=p-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[p]--,f-=2}while(f>0);for(o=p;0!==o;o--)for(r=e.bl_count[o];0!==r;)i=e.heap[--n],i>c||(A[2*i+1]!==o&&(e.opt_len+=(o-A[2*i+1])*A[2*i],A[2*i+1]=o),r--)}})(e,t),ED(o,c,e.bl_count)},TD=(e,t,n)=>{let r,i,o=-1,a=t[1],s=0,A=7,c=4;for(0===a&&(A=138,c=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=a,a=t[2*(r+1)+1],++s<A&&i===a||(s<c?e.bl_tree[2*i]+=s:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,o=i,0===a?(A=138,c=3):i===a?(A=6,c=3):(A=7,c=4))},vD=(e,t,n)=>{let r,i,o=-1,a=t[1],s=0,A=7,c=4;for(0===a&&(A=138,c=3),r=0;r<=n;r++)if(i=a,a=t[2*(r+1)+1],!(++s<A&&i===a)){if(s<c)do{pD(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==o&&(pD(e,i,e.bl_tree),s--),pD(e,16,e.bl_tree),hD(e,s-3,2)):s<=10?(pD(e,17,e.bl_tree),hD(e,s-3,3)):(pD(e,18,e.bl_tree),hD(e,s-11,7));s=0,o=i,0===a?(A=138,c=3):i===a?(A=6,c=3):(A=7,c=4)}},yD=!1,ID=(e,t,n,r)=>{hD(e,0+(r?1:0),3),mD(e),uD(e,n),uD(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var RD={_tr_init:e=>{yD||((()=>{let e,t,n,r,i,o=new Array(16);for(n=0,r=0;r<28;r++)for(iD[r]=n,e=0;e<1<<zN[r];e++)rD[n++]=r;for(rD[n-1]=r,i=0,r=0;r<16;r++)for(AD[r]=i,e=0;e<1<<qN[r];e++)nD[i++]=r;for(i>>=7;r<30;r++)for(AD[r]=i<<7,e=0;e<1<<qN[r]-7;e++)nD[256+i++]=r;for(t=0;t<=15;t++)o[t]=0;for(e=0;e<=143;)eD[2*e+1]=8,e++,o[8]++;for(;e<=255;)eD[2*e+1]=9,e++,o[9]++;for(;e<=279;)eD[2*e+1]=7,e++,o[7]++;for(;e<=287;)eD[2*e+1]=8,e++,o[8]++;for(ED(eD,287,o),e=0;e<30;e++)tD[2*e+1]=5,tD[2*e]=fD(e,5);oD=new cD(eD,zN,257,286,15),aD=new cD(tD,qN,0,30,15),sD=new cD(new Array(0),ZN,0,19,7)})(),yD=!0),e.l_desc=new lD(e.dyn_ltree,oD),e.d_desc=new lD(e.dyn_dtree,aD),e.bl_desc=new lD(e.bl_tree,sD),e.bi_buf=0,e.bi_valid=0,gD(e)},_tr_stored_block:ID,_tr_flush_block:(e,t,n,r)=>{let i,o,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),SD(e,e.l_desc),SD(e,e.d_desc),a=(e=>{let t;for(TD(e,e.dyn_ltree,e.l_desc.max_code),TD(e,e.dyn_dtree,e.d_desc.max_code),SD(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*$N[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),i=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=i&&(i=o)):i=o=n+5,n+4<=i&&-1!==t?ID(e,t,n,r):4===e.strategy||o===i?(hD(e,2+(r?1:0),3),wD(e,eD,tD)):(hD(e,4+(r?1:0),3),((e,t,n,r)=>{let i;for(hD(e,t-257,5),hD(e,n-1,5),hD(e,r-4,4),i=0;i<r;i++)hD(e,e.bl_tree[2*$N[i]+1],3);vD(e,e.dyn_ltree,t-1),vD(e,e.dyn_dtree,n-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),wD(e,e.dyn_ltree,e.dyn_dtree)),gD(e),r&&mD(e)},_tr_tally:(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(rD[n]+256+1)]++,e.dyn_dtree[2*dD(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{var t;hD(e,2,3),pD(e,256,eD),16===(t=e).bi_valid?(uD(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}},bD=(e,t,n,r)=>{let i=65535&e,o=e>>>16&65535,a=0;for(;0!==n;){a=n>2e3?2e3:n,n-=a;do{i=i+t[r++]|0,o=o+i|0}while(--a);i%=65521,o%=65521}return i|o<<16};let OD=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var BD=(e,t,n,r)=>{let i=OD,o=r+n;e^=-1;for(let a=r;a<o;a++)e=e>>>8^i[255&(e^t[a])];return~e},ND={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},DD={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};let{_tr_init:PD,_tr_stored_block:UD,_tr_flush_block:LD,_tr_tally:kD,_tr_align:MD}=RD,{Z_NO_FLUSH:FD,Z_PARTIAL_FLUSH:xD,Z_FULL_FLUSH:QD,Z_FINISH:VD,Z_BLOCK:HD,Z_OK:KD,Z_STREAM_END:jD,Z_STREAM_ERROR:GD,Z_DATA_ERROR:WD,Z_BUF_ERROR:YD,Z_DEFAULT_COMPRESSION:JD,Z_FILTERED:XD,Z_HUFFMAN_ONLY:zD,Z_RLE:qD,Z_FIXED:ZD,Z_DEFAULT_STRATEGY:$D,Z_UNKNOWN:eP,Z_DEFLATED:tP}=DD,nP=258,rP=262,iP=42,oP=113,aP=666,sP=(e,t)=>(e.msg=ND[t],t),AP=e=>2*e-(e>4?9:0),cP=e=>{let t=e.length;for(;--t>=0;)e[t]=0},lP=e=>{let t,n,r,i=e.w_size;t=e.hash_size,r=t;do{n=e.head[--r],e.head[r]=n>=i?n-i:0}while(--t);t=i,r=t;do{n=e.prev[--r],e.prev[r]=n>=i?n-i:0}while(--t)},dP=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask,uP=e=>{let t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},hP=(e,t)=>{LD(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,uP(e.strm)},pP=(e,t)=>{e.pending_buf[e.pending++]=t},fP=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},EP=(e,t,n,r)=>{let i=e.avail_in;return i>r&&(i=r),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),1===e.state.wrap?e.adler=bD(e.adler,t,i,n):2===e.state.wrap&&(e.adler=BD(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},gP=(e,t)=>{let n,r,i=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match,A=e.strstart>e.w_size-rP?e.strstart-(e.w_size-rP):0,c=e.window,l=e.w_mask,d=e.prev,u=e.strstart+nP,h=c[o+a-1],p=c[o+a];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(n=t,c[n+a]===p&&c[n+a-1]===h&&c[n]===c[o]&&c[++n]===c[o+1]){o+=2,n++;do{}while(c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&o<u);if(r=nP-(u-o),o=u-nP,r>a){if(e.match_start=t,a=r,r>=s)break;h=c[o+a-1],p=c[o+a]}}}while((t=d[t&l])>A&&0!=--i);return a<=e.lookahead?a:e.lookahead},mP=e=>{let t,n,r,i=e.w_size;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=i+(i-rP)&&(e.window.set(e.window.subarray(i,i+i-n),0),e.match_start-=i,e.strstart-=i,e.block_start-=i,e.insert>e.strstart&&(e.insert=e.strstart),lP(e),n+=i),0===e.strm.avail_in)break;if(t=EP(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=t,e.lookahead+e.insert>=3)for(r=e.strstart-e.insert,e.ins_h=e.window[r],e.ins_h=dP(e,e.ins_h,e.window[r+1]);e.insert&&(e.ins_h=dP(e,e.ins_h,e.window[r+3-1]),e.prev[r&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=r,r++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<rP&&0!==e.strm.avail_in)},_P=(e,t)=>{let n,r,i,o=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,a=0,s=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i||(i=e.strm.avail_out-i,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>i&&(n=i),n<o&&(0===n&&t!==VD||t===FD||n!==r+e.strm.avail_in)))break;a=t===VD&&n===r+e.strm.avail_in?1:0,UD(e,0,0,a),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,uP(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(EP(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===a);return s-=e.strm.avail_in,s&&(s>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=s&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-s,e.strm.next_in),e.strstart),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),a?4:t!==FD&&t!==VD&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(EP(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,o=i>e.w_size?e.w_size:i,r=e.strstart-e.block_start,(r>=o||(r||t===VD)&&t!==FD&&0===e.strm.avail_in&&r<=i)&&(n=r>i?i:r,a=t===VD&&0===e.strm.avail_in&&n===r?1:0,UD(e,e.block_start,n,a),e.block_start+=n,uP(e.strm)),a?3:1)},CP=(e,t)=>{let n,r;for(;;){if(e.lookahead<rP){if(mP(e),e.lookahead<rP&&t===FD)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=dP(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-rP&&(e.match_length=gP(e,n)),e.match_length>=3)if(r=kD(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=dP(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=dP(e,e.ins_h,e.window[e.strstart+1]);else r=kD(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(hP(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===VD?(hP(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(hP(e,!1),0===e.strm.avail_out)?1:2},wP=(e,t)=>{let n,r,i;for(;;){if(e.lookahead<rP){if(mP(e),e.lookahead<rP&&t===FD)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=dP(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-rP&&(e.match_length=gP(e,n),e.match_length<=5&&(e.strategy===XD||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=kD(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=dP(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(hP(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(r=kD(e,0,e.window[e.strstart-1]),r&&hP(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=kD(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===VD?(hP(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(hP(e,!1),0===e.strm.avail_out)?1:2};function SP(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}let TP=[new SP(0,0,0,0,_P),new SP(4,4,8,4,CP),new SP(4,5,16,8,CP),new SP(4,6,32,32,CP),new SP(4,4,16,16,wP),new SP(8,16,32,32,wP),new SP(8,16,128,128,wP),new SP(8,32,128,256,wP),new SP(32,128,258,1024,wP),new SP(32,258,258,4096,wP)];function vP(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=tP,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),cP(this.dyn_ltree),cP(this.dyn_dtree),cP(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),cP(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),cP(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}let yP=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.status!==iP&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==oP&&t.status!==aP?1:0},IP=e=>{if(yP(e))return sP(e,GD);e.total_in=e.total_out=0,e.data_type=eP;let t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?iP:oP,e.adler=2===t.wrap?0:1,t.last_flush=-2,PD(t),KD},RP=e=>{let t=IP(e);return t===KD&&((n=e.state).window_size=2*n.w_size,cP(n.head),n.max_lazy_match=TP[n.level].max_lazy,n.good_match=TP[n.level].good_length,n.nice_match=TP[n.level].nice_length,n.max_chain_length=TP[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0),t;var n},bP=(e,t,n,r,i,o)=>{if(!e)return GD;let a=1;if(t===JD&&(t=6),r<0?(a=0,r=-r):r>15&&(a=2,r-=16),i<1||i>9||n!==tP||r<8||r>15||t<0||t>9||o<0||o>ZD||8===r&&1!==a)return sP(e,GD);8===r&&(r=9);let s=new vP;return e.state=s,s.strm=e,s.status=iP,s.wrap=a,s.gzhead=null,s.w_bits=r,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=i+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<i+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.sym_buf=s.lit_bufsize,s.sym_end=3*(s.lit_bufsize-1),s.level=t,s.strategy=o,s.method=n,RP(e)};var OP={deflateInit:(e,t)=>bP(e,t,tP,15,8,$D),deflateInit2:bP,deflateReset:RP,deflateResetKeep:IP,deflateSetHeader:(e,t)=>yP(e)||2!==e.state.wrap?GD:(e.state.gzhead=t,KD),deflate:(e,t)=>{if(yP(e)||t>HD||t<0)return e?sP(e,GD):GD;let n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===aP&&t!==VD)return sP(e,0===e.avail_out?YD:GD);let r=n.last_flush;if(n.last_flush=t,0!==n.pending){if(uP(e),0===e.avail_out)return n.last_flush=-1,KD}else if(0===e.avail_in&&AP(t)<=AP(r)&&t!==VD)return sP(e,YD);if(n.status===aP&&0!==e.avail_in)return sP(e,YD);if(n.status===iP&&0===n.wrap&&(n.status=oP),n.status===iP){let t=tP+(n.w_bits-8<<4)<<8,r=-1;if(r=n.strategy>=zD||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=r<<6,0!==n.strstart&&(t|=32),t+=31-t%31,fP(n,t),0!==n.strstart&&(fP(n,e.adler>>>16),fP(n,65535&e.adler)),e.adler=1,n.status=oP,uP(e),0!==n.pending)return n.last_flush=-1,KD}if(57===n.status)if(e.adler=0,pP(n,31),pP(n,139),pP(n,8),n.gzhead)pP(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),pP(n,255&n.gzhead.time),pP(n,n.gzhead.time>>8&255),pP(n,n.gzhead.time>>16&255),pP(n,n.gzhead.time>>24&255),pP(n,9===n.level?2:n.strategy>=zD||n.level<2?4:0),pP(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(pP(n,255&n.gzhead.extra.length),pP(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=BD(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(pP(n,0),pP(n,0),pP(n,0),pP(n,0),pP(n,0),pP(n,9===n.level?2:n.strategy>=zD||n.level<2?4:0),pP(n,3),n.status=oP,uP(e),0!==n.pending)return n.last_flush=-1,KD;if(69===n.status){if(n.gzhead.extra){let t=n.pending,r=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+r>n.pending_buf_size;){let i=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+i),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>t&&(e.adler=BD(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex+=i,uP(e),0!==n.pending)return n.last_flush=-1,KD;t=0,r-=i}let i=new Uint8Array(n.gzhead.extra);n.pending_buf.set(i.subarray(n.gzindex,n.gzindex+r),n.pending),n.pending+=r,n.gzhead.hcrc&&n.pending>t&&(e.adler=BD(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=BD(e.adler,n.pending_buf,n.pending-r,r)),uP(e),0!==n.pending)return n.last_flush=-1,KD;r=0}t=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,pP(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=BD(e.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=BD(e.adler,n.pending_buf,n.pending-r,r)),uP(e),0!==n.pending)return n.last_flush=-1,KD;r=0}t=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,pP(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=BD(e.adler,n.pending_buf,n.pending-r,r))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(uP(e),0!==n.pending))return n.last_flush=-1,KD;pP(n,255&e.adler),pP(n,e.adler>>8&255),e.adler=0}if(n.status=oP,uP(e),0!==n.pending)return n.last_flush=-1,KD}if(0!==e.avail_in||0!==n.lookahead||t!==FD&&n.status!==aP){let r=0===n.level?_P(n,t):n.strategy===zD?((e,t)=>{let n;for(;;){if(0===e.lookahead&&(mP(e),0===e.lookahead)){if(t===FD)return 1;break}if(e.match_length=0,n=kD(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(hP(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===VD?(hP(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(hP(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===qD?((e,t)=>{let n,r,i,o,a=e.window;for(;;){if(e.lookahead<=nP){if(mP(e),e.lookahead<=nP&&t===FD)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=e.strstart-1,r=a[i],r===a[++i]&&r===a[++i]&&r===a[++i])){o=e.strstart+nP;do{}while(r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&i<o);e.match_length=nP-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=kD(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=kD(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(hP(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===VD?(hP(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(hP(e,!1),0===e.strm.avail_out)?1:2})(n,t):TP[n.level].func(n,t);if(3!==r&&4!==r||(n.status=aP),1===r||3===r)return 0===e.avail_out&&(n.last_flush=-1),KD;if(2===r&&(t===xD?MD(n):t!==HD&&(UD(n,0,0,!1),t===QD&&(cP(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),uP(e),0===e.avail_out))return n.last_flush=-1,KD}return t!==VD?KD:n.wrap<=0?jD:(2===n.wrap?(pP(n,255&e.adler),pP(n,e.adler>>8&255),pP(n,e.adler>>16&255),pP(n,e.adler>>24&255),pP(n,255&e.total_in),pP(n,e.total_in>>8&255),pP(n,e.total_in>>16&255),pP(n,e.total_in>>24&255)):(fP(n,e.adler>>>16),fP(n,65535&e.adler)),uP(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?KD:jD)},deflateEnd:e=>{if(yP(e))return GD;let t=e.state.status;return e.state=null,t===oP?sP(e,WD):KD},deflateSetDictionary:(e,t)=>{let n=t.length;if(yP(e))return GD;let r=e.state,i=r.wrap;if(2===i||1===i&&r.status!==iP||r.lookahead)return GD;if(1===i&&(e.adler=bD(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){0===i&&(cP(r.head),r.strstart=0,r.block_start=0,r.insert=0);let e=new Uint8Array(r.w_size);e.set(t.subarray(n-r.w_size,n),0),t=e,n=r.w_size}let o=e.avail_in,a=e.next_in,s=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,mP(r);r.lookahead>=3;){let e=r.strstart,t=r.lookahead-2;do{r.ins_h=dP(r,r.ins_h,r.window[e+3-1]),r.prev[e&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=e,e++}while(--t);r.strstart=e,r.lookahead=2,mP(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=a,e.input=s,e.avail_in=o,r.wrap=i,KD},deflateInfo:"pako deflate (from Nodeca project)"};let BP=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var NP={assign:function(e){let t=Array.prototype.slice.call(arguments,1);for(;t.length;){let n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(let t in n)BP(n,t)&&(e[t]=n[t])}}return e},flattenChunks:e=>{let t=0;for(let r=0,i=e.length;r<i;r++)t+=e[r].length;let n=new Uint8Array(t);for(let r=0,i=0,o=e.length;r<o;r++){let t=e[r];n.set(t,i),i+=t.length}return n}};let DP=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{DP=!1}let PP=new Uint8Array(256);for(let xj=0;xj<256;xj++)PP[xj]=xj>=252?6:xj>=248?5:xj>=240?4:xj>=224?3:xj>=192?2:1;PP[254]=PP[254]=1;var UP={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,r,i,o,a=e.length,s=0;for(i=0;i<a;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<a&&(r=e.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(s),o=0,i=0;o<s;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<a&&(r=e.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},buf2string:(e,t)=>{let n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let r,i,o=new Array(2*n);for(i=0,r=0;r<n;){let t=e[r++];if(t<128){o[i++]=t;continue}let a=PP[t];if(a>4)o[i++]=65533,r+=a-1;else{for(t&=2===a?31:3===a?15:7;a>1&&r<n;)t=t<<6|63&e[r++],a--;a>1?o[i++]=65533:t<65536?o[i++]=t:(t-=65536,o[i++]=55296|t>>10&1023,o[i++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&DP)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n})(o,i)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+PP[e[n]]>t?n:t}},LP=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};let kP=Object.prototype.toString,{Z_NO_FLUSH:MP,Z_SYNC_FLUSH:FP,Z_FULL_FLUSH:xP,Z_FINISH:QP,Z_OK:VP,Z_STREAM_END:HP,Z_DEFAULT_COMPRESSION:KP,Z_DEFAULT_STRATEGY:jP,Z_DEFLATED:GP}=DD;function WP(e){this.options=NP.assign({level:KP,method:GP,chunkSize:16384,windowBits:15,memLevel:8,strategy:jP},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new LP,this.strm.avail_out=0;let n=OP.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==VP)throw new Error(ND[n]);if(t.header&&OP.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?UP.string2buf(t.dictionary):"[object ArrayBuffer]"===kP.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=OP.deflateSetDictionary(this.strm,e),n!==VP)throw new Error(ND[n]);this._dict_set=!0}}function YP(e,t){let n=new WP(t);if(n.push(e,!0),n.err)throw n.msg||ND[n.err];return n.result}WP.prototype.push=function(e,t){let n,r,i=this.strm,o=this.options.chunkSize;if(this.ended)return!1;for(r=t===~~t?t:!0===t?QP:MP,"string"==typeof e?i.input=UP.string2buf(e):"[object ArrayBuffer]"===kP.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(o),i.next_out=0,i.avail_out=o),(r===FP||r===xP)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(n=OP.deflate(i,r),n===HP)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),n=OP.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===VP;if(0!==i.avail_out){if(r>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},WP.prototype.onData=function(e){this.chunks.push(e)},WP.prototype.onEnd=function(e){e===VP&&(this.result=NP.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var JP={Deflate:WP,deflate:YP,deflateRaw:function(e,t){return(t=t||{}).raw=!0,YP(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,YP(e,t)},constants:DD};let XP=16209;var zP=function(e,t){let n,r,i,o,a,s,A,c,l,d,u,h,p,f,E,g,m,_,C,w,S,T,v,y,I=e.state;n=e.next_in,v=e.input,r=n+(e.avail_in-5),i=e.next_out,y=e.output,o=i-(t-e.avail_out),a=i+(e.avail_out-257),s=I.dmax,A=I.wsize,c=I.whave,l=I.wnext,d=I.window,u=I.hold,h=I.bits,p=I.lencode,f=I.distcode,E=(1<<I.lenbits)-1,g=(1<<I.distbits)-1;e:do{h<15&&(u+=v[n++]<<h,h+=8,u+=v[n++]<<h,h+=8),m=p[u&E];t:for(;;){if(_=m>>>24,u>>>=_,h-=_,_=m>>>16&255,0===_)y[i++]=65535&m;else{if(!(16&_)){if(!(64&_)){m=p[(65535&m)+(u&(1<<_)-1)];continue t}if(32&_){I.mode=16191;break e}e.msg="invalid literal/length code",I.mode=XP;break e}C=65535&m,_&=15,_&&(h<_&&(u+=v[n++]<<h,h+=8),C+=u&(1<<_)-1,u>>>=_,h-=_),h<15&&(u+=v[n++]<<h,h+=8,u+=v[n++]<<h,h+=8),m=f[u&g];n:for(;;){if(_=m>>>24,u>>>=_,h-=_,_=m>>>16&255,!(16&_)){if(!(64&_)){m=f[(65535&m)+(u&(1<<_)-1)];continue n}e.msg="invalid distance code",I.mode=XP;break e}if(w=65535&m,_&=15,h<_&&(u+=v[n++]<<h,h+=8,h<_&&(u+=v[n++]<<h,h+=8)),w+=u&(1<<_)-1,w>s){e.msg="invalid distance too far back",I.mode=XP;break e}if(u>>>=_,h-=_,_=i-o,w>_){if(_=w-_,_>c&&I.sane){e.msg="invalid distance too far back",I.mode=XP;break e}if(S=0,T=d,0===l){if(S+=A-_,_<C){C-=_;do{y[i++]=d[S++]}while(--_);S=i-w,T=y}}else if(l<_){if(S+=A+l-_,_-=l,_<C){C-=_;do{y[i++]=d[S++]}while(--_);if(S=0,l<C){_=l,C-=_;do{y[i++]=d[S++]}while(--_);S=i-w,T=y}}}else if(S+=l-_,_<C){C-=_;do{y[i++]=d[S++]}while(--_);S=i-w,T=y}for(;C>2;)y[i++]=T[S++],y[i++]=T[S++],y[i++]=T[S++],C-=3;C&&(y[i++]=T[S++],C>1&&(y[i++]=T[S++]))}else{S=i-w;do{y[i++]=y[S++],y[i++]=y[S++],y[i++]=y[S++],C-=3}while(C>2);C&&(y[i++]=y[S++],C>1&&(y[i++]=y[S++]))}break}}break}}while(n<r&&i<a);C=h>>3,n-=C,h-=C<<3,u&=(1<<h)-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=i<a?a-i+257:257-(i-a),I.hold=u,I.bits=h};let qP=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ZP=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),$P=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),eU=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var tU=(e,t,n,r,i,o,a,s)=>{let A,c,l,d,u,h,p,f,E,g=s.bits,m=0,_=0,C=0,w=0,S=0,T=0,v=0,y=0,I=0,R=0,b=null,O=new Uint16Array(16),B=new Uint16Array(16),N=null;for(m=0;m<=15;m++)O[m]=0;for(_=0;_<r;_++)O[t[n+_]]++;for(S=g,w=15;w>=1&&0===O[w];w--);if(S>w&&(S=w),0===w)return i[o++]=20971520,i[o++]=20971520,s.bits=1,0;for(C=1;C<w&&0===O[C];C++);for(S<C&&(S=C),y=1,m=1;m<=15;m++)if(y<<=1,y-=O[m],y<0)return-1;if(y>0&&(0===e||1!==w))return-1;for(B[1]=0,m=1;m<15;m++)B[m+1]=B[m]+O[m];for(_=0;_<r;_++)0!==t[n+_]&&(a[B[t[n+_]]++]=_);if(0===e?(b=N=a,h=20):1===e?(b=qP,N=ZP,h=257):(b=$P,N=eU,h=0),R=0,_=0,m=C,u=o,T=S,v=0,l=-1,I=1<<S,d=I-1,1===e&&I>852||2===e&&I>592)return 1;for(;;){p=m-v,a[_]+1<h?(f=0,E=a[_]):a[_]>=h?(f=N[a[_]-h],E=b[a[_]-h]):(f=96,E=0),A=1<<m-v,c=1<<T,C=c;do{c-=A,i[u+(R>>v)+c]=p<<24|f<<16|E}while(0!==c);for(A=1<<m-1;R&A;)A>>=1;if(0!==A?(R&=A-1,R+=A):R=0,_++,0==--O[m]){if(m===w)break;m=t[n+a[_]]}if(m>S&&(R&d)!==l){for(0===v&&(v=S),u+=C,T=m-v,y=1<<T;T+v<w&&(y-=O[T+v],!(y<=0));)T++,y<<=1;if(I+=1<<T,1===e&&I>852||2===e&&I>592)return 1;l=R&d,i[l]=S<<24|T<<16|u-o}}return 0!==R&&(i[u+R]=m-v<<24|64<<16),s.bits=S,0};let{Z_FINISH:nU,Z_BLOCK:rU,Z_TREES:iU,Z_OK:oU,Z_STREAM_END:aU,Z_NEED_DICT:sU,Z_STREAM_ERROR:AU,Z_DATA_ERROR:cU,Z_MEM_ERROR:lU,Z_BUF_ERROR:dU,Z_DEFLATED:uU}=DD,hU=16180,pU=16190,fU=16191,EU=16192,gU=16194,mU=16199,_U=16200,CU=16206,wU=16209,SU=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function TU(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}let vU,yU,IU=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.mode<hU||t.mode>16211?1:0},RU=e=>{if(IU(e))return AU;let t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=hU,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,oU},bU=e=>{if(IU(e))return AU;let t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,RU(e)},OU=(e,t)=>{let n;if(IU(e))return AU;let r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?AU:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,bU(e))},BU=(e,t)=>{if(!e)return AU;let n=new TU;e.state=n,n.strm=e,n.window=null,n.mode=hU;let r=OU(e,t);return r!==oU&&(e.state=null),r},NU=!0,DU=e=>{if(NU){vU=new Int32Array(512),yU=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(tU(1,e.lens,0,288,vU,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;tU(2,e.lens,0,32,yU,0,e.work,{bits:5}),NU=!1}e.lencode=vU,e.lenbits=9,e.distcode=yU,e.distbits=5},PU=(e,t,n,r)=>{let i,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),r>=o.wsize?(o.window.set(t.subarray(n-o.wsize,n),0),o.wnext=0,o.whave=o.wsize):(i=o.wsize-o.wnext,i>r&&(i=r),o.window.set(t.subarray(n-r,n-r+i),o.wnext),(r-=i)?(o.window.set(t.subarray(n-r,n),0),o.wnext=r,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0};var UU={inflateReset:bU,inflateReset2:OU,inflateResetKeep:RU,inflateInit:e=>BU(e,15),inflateInit2:BU,inflate:(e,t)=>{let n,r,i,o,a,s,A,c,l,d,u,h,p,f,E,g,m,_,C,w,S,T,v,y,I=0,R=new Uint8Array(4),b=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(IU(e)||!e.output||!e.input&&0!==e.avail_in)return AU;n=e.state,n.mode===fU&&(n.mode=EU),a=e.next_out,i=e.output,A=e.avail_out,o=e.next_in,r=e.input,s=e.avail_in,c=n.hold,l=n.bits,d=s,u=A,T=oU;e:for(;;)switch(n.mode){case hU:if(0===n.wrap){n.mode=EU;break}for(;l<16;){if(0===s)break e;s--,c+=r[o++]<<l,l+=8}if(2&n.wrap&&35615===c){0===n.wbits&&(n.wbits=15),n.check=0,R[0]=255&c,R[1]=c>>>8&255,n.check=BD(n.check,R,2,0),c=0,l=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",n.mode=wU;break}if((15&c)!==uU){e.msg="unknown compression method",n.mode=wU;break}if(c>>>=4,l-=4,S=8+(15&c),0===n.wbits&&(n.wbits=S),S>15||S>n.wbits){e.msg="invalid window size",n.mode=wU;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&c?16189:fU,c=0,l=0;break;case 16181:for(;l<16;){if(0===s)break e;s--,c+=r[o++]<<l,l+=8}if(n.flags=c,(255&JN(n))!==uU){e.msg="unknown compression method",n.mode=wU;break}if(57344&JN(n)){e.msg="unknown header flags set",n.mode=wU;break}n.head&&(n.head.text=c>>8&1),512&JN(n)&&4&n.wrap&&(R[0]=255&c,R[1]=c>>>8&255,n.check=BD(n.check,R,2,0)),c=0,l=0,n.mode=16182;case 16182:for(;l<32;){if(0===s)break e;s--,c+=r[o++]<<l,l+=8}n.head&&(n.head.time=c),512&JN(n)&&4&n.wrap&&(R[0]=255&c,R[1]=c>>>8&255,R[2]=c>>>16&255,R[3]=c>>>24&255,n.check=BD(n.check,R,4,0)),c=0,l=0,n.mode=16183;case 16183:for(;l<16;){if(0===s)break e;s--,c+=r[o++]<<l,l+=8}n.head&&(n.head.xflags=255&c,n.head.os=c>>8),512&JN(n)&&4&n.wrap&&(R[0]=255&c,R[1]=c>>>8&255,n.check=BD(n.check,R,2,0)),c=0,l=0,n.mode=16184;case 16184:if(1024&JN(n)){for(;l<16;){if(0===s)break e;s--,c+=r[o++]<<l,l+=8}n.length=c,n.head&&(n.head.extra_len=c),512&JN(n)&&4&n.wrap&&(R[0]=255&c,R[1]=c>>>8&255,n.check=BD(n.check,R,2,0)),c=0,l=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&JN(n)&&(h=n.length,h>s&&(h=s),h&&(n.head&&(S=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(o,o+h),S)),512&JN(n)&&4&n.wrap&&(n.check=BD(n.check,r,h,o)),s-=h,o+=h,n.length-=h),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&JN(n)){if(0===s)break e;h=0;do{S=r[o+h++],n.head&&S&&n.length<65536&&(n.head.name+=String.fromCharCode(S))}while(S&&h<s);if(512&JN(n)&&4&n.wrap&&(n.check=BD(n.check,r,h,o)),s-=h,o+=h,S)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&JN(n)){if(0===s)break e;h=0;do{S=r[o+h++],n.head&&S&&n.length<65536&&(n.head.comment+=String.fromCharCode(S))}while(S&&h<s);if(512&JN(n)&&4&n.wrap&&(n.check=BD(n.check,r,h,o)),s-=h,o+=h,S)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&JN(n)){for(;l<16;){if(0===s)break e;s--,c+=r[o++]<<l,l+=8}if(4&n.wrap&&c!==(65535&n.check)){e.msg="header crc mismatch",n.mode=wU;break}c=0,l=0}n.head&&(n.head.hcrc=JN(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=fU;break;case 16189:for(;l<32;){if(0===s)break e;s--,c+=r[o++]<<l,l+=8}e.adler=n.check=SU(c),c=0,l=0,n.mode=pU;case pU:if(0===n.havedict)return e.next_out=a,e.avail_out=A,e.next_in=o,e.avail_in=s,n.hold=c,n.bits=l,sU;e.adler=n.check=1,n.mode=fU;case fU:if(t===rU||t===iU)break e;case EU:if(n.last){c>>>=7&l,l-=7&l,n.mode=CU;break}for(;l<3;){if(0===s)break e;s--,c+=r[o++]<<l,l+=8}switch(n.last=1&c,c>>>=1,l-=1,3&c){case 0:n.mode=16193;break;case 1:if(DU(n),n.mode=mU,t===iU){c>>>=2,l-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=wU}c>>>=2,l-=2;break;case 16193:for(c>>>=7&l,l-=7&l;l<32;){if(0===s)break e;s--,c+=r[o++]<<l,l+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",n.mode=wU;break}if(n.length=65535&c,c=0,l=0,n.mode=gU,t===iU)break e;case gU:n.mode=16195;case 16195:if(h=n.length,h){if(h>s&&(h=s),h>A&&(h=A),0===h)break e;i.set(r.subarray(o,o+h),a),s-=h,o+=h,A-=h,a+=h,n.length-=h;break}n.mode=fU;break;case 16196:for(;l<14;){if(0===s)break e;s--,c+=r[o++]<<l,l+=8}if(n.nlen=257+(31&c),c>>>=5,l-=5,n.ndist=1+(31&c),c>>>=5,l-=5,n.ncode=4+(15&c),c>>>=4,l-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=wU;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;l<3;){if(0===s)break e;s--,c+=r[o++]<<l,l+=8}n.lens[b[n.have++]]=7&c,c>>>=3,l-=3}for(;n.have<19;)n.lens[b[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,v={bits:n.lenbits},T=tU(0,n.lens,0,19,n.lencode,0,n.work,v),n.lenbits=v.bits,T){e.msg="invalid code lengths set",n.mode=wU;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;I=n.lencode[c&(1<<n.lenbits)-1],E=I>>>24,g=I>>>16&255,m=65535&I,!(E<=l);){if(0===s)break e;s--,c+=r[o++]<<l,l+=8}if(m<16)c>>>=E,l-=E,n.lens[n.have++]=m;else{if(16===m){for(y=E+2;l<y;){if(0===s)break e;s--,c+=r[o++]<<l,l+=8}if(c>>>=E,l-=E,0===n.have){e.msg="invalid bit length repeat",n.mode=wU;break}S=n.lens[n.have-1],h=3+(3&c),c>>>=2,l-=2}else if(17===m){for(y=E+3;l<y;){if(0===s)break e;s--,c+=r[o++]<<l,l+=8}c>>>=E,l-=E,S=0,h=3+(7&c),c>>>=3,l-=3}else{for(y=E+7;l<y;){if(0===s)break e;s--,c+=r[o++]<<l,l+=8}c>>>=E,l-=E,S=0,h=11+(127&c),c>>>=7,l-=7}if(n.have+h>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=wU;break}for(;h--;)n.lens[n.have++]=S}}if(n.mode===wU)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=wU;break}if(n.lenbits=9,v={bits:n.lenbits},T=tU(1,n.lens,0,n.nlen,n.lencode,0,n.work,v),n.lenbits=v.bits,T){e.msg="invalid literal/lengths set",n.mode=wU;break}if(n.distbits=6,n.distcode=n.distdyn,v={bits:n.distbits},T=tU(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,v),n.distbits=v.bits,T){e.msg="invalid distances set",n.mode=wU;break}if(n.mode=mU,t===iU)break e;case mU:n.mode=_U;case _U:if(s>=6&&A>=258){e.next_out=a,e.avail_out=A,e.next_in=o,e.avail_in=s,n.hold=c,n.bits=l,zP(e,u),a=e.next_out,i=e.output,A=e.avail_out,o=e.next_in,r=e.input,s=e.avail_in,c=n.hold,l=n.bits,n.mode===fU&&(n.back=-1);break}for(n.back=0;I=n.lencode[c&(1<<n.lenbits)-1],E=I>>>24,g=I>>>16&255,m=65535&I,!(E<=l);){if(0===s)break e;s--,c+=r[o++]<<l,l+=8}if(g&&!(240&g)){for(_=E,C=g,w=m;I=n.lencode[w+((c&(1<<_+C)-1)>>_)],E=I>>>24,g=I>>>16&255,m=65535&I,!(_+E<=l);){if(0===s)break e;s--,c+=r[o++]<<l,l+=8}c>>>=_,l-=_,n.back+=_}if(c>>>=E,l-=E,n.back+=E,n.length=m,0===g){n.mode=16205;break}if(32&g){n.back=-1,n.mode=fU;break}if(64&g){e.msg="invalid literal/length code",n.mode=wU;break}n.extra=15&g,n.mode=16201;case 16201:if(n.extra){for(y=n.extra;l<y;){if(0===s)break e;s--,c+=r[o++]<<l,l+=8}n.length+=c&(1<<n.extra)-1,c>>>=n.extra,l-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;I=n.distcode[c&(1<<n.distbits)-1],E=I>>>24,g=I>>>16&255,m=65535&I,!(E<=l);){if(0===s)break e;s--,c+=r[o++]<<l,l+=8}if(!(240&g)){for(_=E,C=g,w=m;I=n.distcode[w+((c&(1<<_+C)-1)>>_)],E=I>>>24,g=I>>>16&255,m=65535&I,!(_+E<=l);){if(0===s)break e;s--,c+=r[o++]<<l,l+=8}c>>>=_,l-=_,n.back+=_}if(c>>>=E,l-=E,n.back+=E,64&g){e.msg="invalid distance code",n.mode=wU;break}n.offset=m,n.extra=15&g,n.mode=16203;case 16203:if(n.extra){for(y=n.extra;l<y;){if(0===s)break e;s--,c+=r[o++]<<l,l+=8}n.offset+=c&(1<<n.extra)-1,c>>>=n.extra,l-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=wU;break}n.mode=16204;case 16204:if(0===A)break e;if(h=u-A,n.offset>h){if(h=n.offset-h,h>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=wU;break}h>n.wnext?(h-=n.wnext,p=n.wsize-h):p=n.wnext-h,h>n.length&&(h=n.length),f=n.window}else f=i,p=a-n.offset,h=n.length;h>A&&(h=A),A-=h,n.length-=h;do{i[a++]=f[p++]}while(--h);0===n.length&&(n.mode=_U);break;case 16205:if(0===A)break e;i[a++]=n.length,A--,n.mode=_U;break;case CU:if(n.wrap){for(;l<32;){if(0===s)break e;s--,c|=r[o++]<<l,l+=8}if(u-=A,e.total_out+=u,n.total+=u,4&n.wrap&&u&&(e.adler=n.check=JN(n)?BD(n.check,i,u,a-u):bD(n.check,i,u,a-u)),u=A,4&n.wrap&&(JN(n)?c:SU(c))!==n.check){e.msg="incorrect data check",n.mode=wU;break}c=0,l=0}n.mode=16207;case 16207:if(n.wrap&&JN(n)){for(;l<32;){if(0===s)break e;s--,c+=r[o++]<<l,l+=8}if(4&n.wrap&&c!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=wU;break}c=0,l=0}n.mode=16208;case 16208:T=aU;break e;case wU:T=cU;break e;case 16210:return lU;default:return AU}return e.next_out=a,e.avail_out=A,e.next_in=o,e.avail_in=s,n.hold=c,n.bits=l,(n.wsize||u!==e.avail_out&&n.mode<wU&&(n.mode<CU||t!==nU))&&PU(e,e.output,e.next_out,u-e.avail_out),d-=e.avail_in,u-=e.avail_out,e.total_in+=d,e.total_out+=u,n.total+=u,4&n.wrap&&u&&(e.adler=n.check=JN(n)?BD(n.check,i,u,e.next_out-u):bD(n.check,i,u,e.next_out-u)),e.data_type=n.bits+(n.last?64:0)+(n.mode===fU?128:0)+(n.mode===mU||n.mode===gU?256:0),(0===d&&0===u||t===nU)&&T===oU&&(T=dU),T},inflateEnd:e=>{if(IU(e))return AU;let t=e.state;return t.window&&(t.window=null),e.state=null,oU},inflateGetHeader:(e,t)=>{if(IU(e))return AU;let n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,oU):AU},inflateSetDictionary:(e,t)=>{let n,r,i,o=t.length;return IU(e)?AU:(n=e.state,0!==n.wrap&&n.mode!==pU?AU:n.mode===pU&&(r=1,r=bD(r,t,o,0),r!==n.check)?cU:(i=PU(e,t,o,o),i?(n.mode=16210,lU):(n.havedict=1,oU)))},inflateInfo:"pako inflate (from Nodeca project)"},LU=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};let kU=Object.prototype.toString,{Z_NO_FLUSH:MU,Z_FINISH:FU,Z_OK:xU,Z_STREAM_END:QU,Z_NEED_DICT:VU,Z_STREAM_ERROR:HU,Z_DATA_ERROR:KU,Z_MEM_ERROR:jU}=DD;function GU(e){this.options=NP.assign({chunkSize:65536,windowBits:15,to:""},e||{});let t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new LP,this.strm.avail_out=0;let n=UU.inflateInit2(this.strm,t.windowBits);if(n!==xU)throw new Error(ND[n]);if(this.header=new LU,UU.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=UP.string2buf(t.dictionary):"[object ArrayBuffer]"===kU.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=UU.inflateSetDictionary(this.strm,t.dictionary),n!==xU)))throw new Error(ND[n])}function WU(e,t){let n=new GU(t);if(n.push(e),n.err)throw n.msg||ND[n.err];return n.result}GU.prototype.push=function(e,t){let n,r,i,o=this.strm,a=this.options.chunkSize,s=this.options.dictionary;if(this.ended)return!1;for(r=t===~~t?t:!0===t?FU:MU,"[object ArrayBuffer]"===kU.call(e)?o.input=new Uint8Array(e):o.input=e,o.next_in=0,o.avail_in=o.input.length;;){for(0===o.avail_out&&(o.output=new Uint8Array(a),o.next_out=0,o.avail_out=a),n=UU.inflate(o,r),n===VU&&s&&(n=UU.inflateSetDictionary(o,s),n===xU?n=UU.inflate(o,r):n===KU&&(n=VU));o.avail_in>0&&n===QU&&o.state.wrap>0&&0!==e[o.next_in];)UU.inflateReset(o),n=UU.inflate(o,r);switch(n){case HU:case KU:case VU:case jU:return this.onEnd(n),this.ended=!0,!1}if(i=o.avail_out,o.next_out&&(0===o.avail_out||n===QU))if("string"===this.options.to){let e=UP.utf8border(o.output,o.next_out),t=o.next_out-e,n=UP.buf2string(o.output,e);o.next_out=t,o.avail_out=a-t,t&&o.output.set(o.output.subarray(e,e+t),0),this.onData(n)}else this.onData(o.output.length===o.next_out?o.output:o.output.subarray(0,o.next_out));if(n!==xU||0!==i){if(n===QU)return n=UU.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,!0;if(0===o.avail_in)break}}return!0},GU.prototype.onData=function(e){this.chunks.push(e)},GU.prototype.onEnd=function(e){e===xU&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=NP.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var YU={Inflate:GU,inflate:WU,inflateRaw:function(e,t){return(t=t||{}).raw=!0,WU(e,t)},ungzip:WU,constants:DD};let{Deflate:JU,deflate:XU,deflateRaw:zU,gzip:qU}=JP,{Inflate:ZU,inflate:$U,inflateRaw:eL,ungzip:tL}=YU;var nL=XU,rL=$U;let iL={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function oL(){return iL}function aL(){return"setSinkId"in HTMLAudioElement.prototype&&(!$v("RESTRICTION_SET_PLAYBACK_DEVICE")||(qS()||$S())&&!ET())}let sL=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function AL(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function cL(e,t,n,r,i){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:i}}function lL(e,t,n,r,i){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:i}}function dL(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}let uL={"90p":cL(160,90),"90p_1":cL(160,90),"120p":cL(160,120,15,30,65),"120p_1":cL(160,120,15,30,65),"120p_3":cL(120,120,15,30,50),"120p_4":cL(212,120),"180p":cL(320,180,15,30,140),"180p_1":cL(320,180,15,30,140),"180p_3":cL(180,180,15,30,100),"180p_4":cL(240,180,15,30,120),"240p":cL(320,240,15,40,200),"240p_1":cL(320,240,15,40,200),"240p_3":cL(240,240,15,40,140),"240p_4":cL(424,240,15,40,220),"360p":cL(640,360,15,80,400),"360p_1":cL(640,360,15,80,400),"360p_3":cL(360,360,15,80,260),"360p_4":cL(640,360,30,80,600),"360p_6":cL(360,360,30,80,400),"360p_7":cL(480,360,15,80,320),"360p_8":cL(480,360,30,80,490),"360p_9":cL(640,360,15,80,800),"360p_10":cL(640,360,24,80,800),"360p_11":cL(640,360,24,80,1e3),"480p":cL(640,480,15,100,500),"480p_1":cL(640,480,15,100,500),"480p_2":cL(640,480,30,100,1e3),"480p_3":cL(480,480,15,100,400),"480p_4":cL(640,480,30,100,750),"480p_6":cL(480,480,30,100,600),"480p_8":cL(848,480,15,100,610),"480p_9":cL(848,480,30,100,930),"480p_10":cL(640,480,10,100,400),"720p":cL(1280,720,15,120,1130),"720p_auto":cL(1280,720,30,900,3e3),"720p_1":cL(1280,720,15,120,1130),"720p_2":cL(1280,720,30,120,2e3),"720p_3":cL(1280,720,30,120,1710),"720p_5":cL(960,720,15,120,910),"720p_6":cL(960,720,30,120,1380),"1080p":cL(1920,1080,15,120,2080),"1080p_1":cL(1920,1080,15,120,2080),"1080p_2":cL(1920,1080,30,120,3e3),"1080p_3":cL(1920,1080,30,120,3150),"1080p_5":cL(1920,1080,60,120,4780),"1440p":cL(2560,1440,30,120,4850),"1440p_1":cL(2560,1440,30,120,4850),"1440p_2":cL(2560,1440,60,120,7350),"4k":cL(3840,2160,30,120,8910),"4k_1":cL(3840,2160,30,120,8910),"4k_3":cL(3840,2160,60,120,13500)},hL=[{scaleResolutionDownBy:2,width:1280,height:720,frameRate:30,bitrateMin:300,bitrateMax:900},{scaleResolutionDownBy:1.333333,width:1280,height:720,frameRate:30,bitrateMin:600,bitrateMax:2e3},{scaleResolutionDownBy:1,width:1280,height:720,frameRate:30,bitrateMin:900,bitrateMax:3e3}],pL={"480p":lL(640,480,5),"480p_1":lL(640,480,5),"480p_2":lL(640,480,30),"480p_3":lL(640,480,15),"720p":lL(1280,720,5),"720p_auto":cL(1280,720,30,900,3e3),"720p_1":lL(1280,720,5),"720p_2":lL(1280,720,30),"720p_3":lL(1280,720,15),"1080p":lL(1920,1080,5),"1080p_1":lL(1920,1080,5),"1080p_2":lL(1920,1080,30),"1080p_3":lL(1920,1080,15)},fL={"1SL1TL":dL(1,1),"3SL3TL":dL(3,3),"2SL3TL":dL(2,3)};function EL(e){return e||(e="480p_1"),"string"==typeof e?Object.assign({},uL[e]):e}function gL(e){return"string"==typeof e?Object.assign({},pL[e]):e}function mL(e){return"string"==typeof e?Object.assign({},fL[e]):e}let _L={speech_low_quality:AL(16e3,!1),speech_standard:AL(32e3,!1,18),music_standard:AL(48e3,!1),standard_stereo:AL(48e3,!0,56),high_quality:AL(48e3,!1,128),high_quality_stereo:AL(48e3,!0,192)};function CL(e){return"string"==typeof e?Object.assign({},_L[e]):e}let wL=[];function SL(e){return IT(e,"mediaSource",["screen","window","application"]),!0}let TL=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),vL=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e}({}),yL=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),IL=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),RL=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e}({}),bL=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),OL=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),BL=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),NL=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({}),DL={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},PL={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},UL={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},LL={uplinkNetworkQuality:0,downlinkNetworkQuality:0},kL={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},ML=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),FL=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),xL=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),QL=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),VL=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),HL=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({}),KL={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370},jL=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function GL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function WL(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?GL(Object(n),!0).forEach((function(t){YL(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):GL(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function YL(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function JL(e,t,n,r,i){var o,a,s={};return Object.keys(r).forEach((function(e){s[e]=r[e]})),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=Hr(o=cO(a=n.slice()).call(a)).call(o,(function(n,r){return r(e,t,n)||n}),s),i&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(i):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(e,t,s),s=null),s}class XL extends VT{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(bL.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,t){var n;super(),YL(this,"trackMediaType",void 0),YL(this,"_ID",void 0),YL(this,"_rtpTransceiver",void 0),YL(this,"_lowRtpTransceiver",void 0),YL(this,"_hints",[]),YL(this,"_isClosed",!1),YL(this,"_originMediaStreamTrack",void 0),YL(this,"mediaStreamTrack",void 0),YL(this,"_external",{}),this._ID=t||Sv(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,n=this,yr(wL).call(wL,n)||wL.push(n)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||hv((()=>{var e;vy.reportApiInvoke(null,{name:jT.GET_MEDIA_STREAM_TRACK,options:[],tag:GT.TRACER}).onSuccess((null===(e=this._mediaStreamTrack)||void 0===e?void 0:e.label)||"")}),this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===yL.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){let t=wL.indexOf(e);-1!==t&&wL.splice(t,1)}(this),this.emit(OL.CLOSED),this.removeAllListeners(bL.SEI_RECEIVED)}_updateRtpTransceiver(e,t){if(t===yL.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(bL.TRANSCEIVER_UPDATED,e,t)}}class zL extends XL{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,t){super(e,t),YL(this,"_enabled",!0),YL(this,"_muted",!1),YL(this,"_isExternalTrack",!1),YL(this,"_isClosed",!1),YL(this,"_enabledMutex",void 0),YL(this,"processor",void 0),YL(this,"_processorContext",void 0),YL(this,"_handleTrackEnded",(()=>{this.onTrackEnded()})),this._enabledMutex=new Uv("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,t;return null!==(e=null===(t=this._originMediaStreamTrack)||void 0===t?void 0:t.label)&&void 0!==e?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,Ey.debug("[".concat(this.getTrackId(),"] close")),this.emit(TL.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._isExternalTrack=n,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await rv(this,TL.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){Ey.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(OL.TRACK_ENDED)}stateCheck(e,t){if(Ey.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(t,"]")),yT(t,e),this._enabled&&this._muted&&"enabled"===e&&!1===t)throw new vT(TT.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",Ey);if(!this._enabled&&!this._muted&&"muted"===e&&!0===t)throw new vT(TT.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",Ey)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():wu.resolve([])}}let qL=window.AudioContext||window.webkitAudioContext,ZL=null,$L=new class extends VT{constructor(){super(...arguments),YL(this,"prevState",void 0),YL(this,"curState",void 0),YL(this,"currentTime",void 0),YL(this,"currentTimeStuckAt",void 0),YL(this,"interruptDetectorTrack",void 0),YL(this,"onLocalAudioTrackMute",(()=>{Ey.info("ios15-interruption-start"),this.emit(sL.IOS_15_16_INTERRUPTION_START)})),YL(this,"onLocalAudioTrackUnmute",(async()=>{Ey.info("ios15-interruption-end"),"running"!==this.curState||this.duringInterruption?Ey.info("ios15-interruption-end-canceled"):(ZL&&await ZL.suspend(),this.emit(sL.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return"running"===this.prevState&&"interrupted"===this.curState}bindInterruptDetectorTrack(e){Ey.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){Ey.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function ek(){if(!ZL){if(function(){if(!qL)return void Ey.error("your browser is not support web audio");Ey.info("create audio context");let e=WL({},$v("WEBAUDIO_INIT_OPTIONS"));Ey.debug("audio context init option:",JSON.stringify(e)),ZL=new qL(e),$L.curState=ZL.state,ZL.onstatechange=()=>{$L.prevState=$L.curState,$L.curState=ZL?ZL.state:void 0;let{prevState:e,curState:t}=$L,n="running"===t,r="interrupted"===t,i="running"===e,o="suspended"===e,a="interrupted"===e,s=WS().osVersion;(tT()||hT())&&i&&r&&(Ey.info("ios".concat(s,"-interruption-start")),$L.emit(sL.IOS_INTERRUPTION_START)),(tT()||hT())&&(o||a)&&n&&(Ey.info("ios".concat(s,"-interruption-end")),$L.emit(sL.IOS_INTERRUPTION_END)),e!==t&&$L.emit(sL.STATE_CHANGE,t,e)},setInterval((()=>{var e;let t=null===(e=ZL)||void 0===e?void 0:e.currentTime;$L.currentTime!==t?($L.currentTimeStuckAt&&(Ey.debug("AudioContext current time resume at ".concat(t)),$L.currentTimeStuckAt=void 0),$L.currentTime=t):(t!==$L.currentTimeStuckAt&&(vy.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:t},tag:GT.TRACER}).onSuccess(),Ey.warning("AudioContext current time stuck at ".concat(t))),$L.currentTimeStuckAt=t)}),5e3),async function(e){let t,n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],r=!1,i=!1,o=!1;function a(t){"running"===e.state?s(!1):tT()||hT()?"suspended"===e.state&&(s(!0),t&&e.resume().then(A,A)):"closed"!==e.state&&(s(!0),t&&e.resume().then(A,A))}function s(e){if(r!==e){r=e;for(let t=0,r=n;t<r.length;t+=1){let n=r[t];e?window.addEventListener(n,c,{capture:!0,passive:!0}):window.removeEventListener(n,c,{capture:!0,passive:!0})}}}function A(){a(!1)}function c(){a(!0)}function l(e){if(!o)if(t.paused)if(e){let e;d(!1),o=!0;try{e=t.play(),e?e.then(u,u):(t.addEventListener("playing",u),t.addEventListener("abort",u),t.addEventListener("error",u))}catch{u()}}else d(!0);else d(!1)}function d(e){if(i!==e){i=e;for(let t=0,r=n;t<r.length;t++){let n=r[t];e?window.addEventListener(n,h,{capture:!0,passive:!0}):window.removeEventListener(n,h,{capture:!0,passive:!0})}}}function u(){t.removeEventListener("playing",u),t.removeEventListener("abort",u),t.removeEventListener("error",u),o=!1,l(!1)}function h(){l(!0)}if(tT()){let n=e.createMediaStreamDestination(),r=document.createElement("div");r.innerHTML="<audio x-webkit-airplay='deny'></audio>",t=r.children.item(0),t.controls=!1,t.disableRemotePlayback=!0,t.preload="auto",t.srcObject=n.stream,l(!0)}$L.on(sL.STATE_CHANGE,(function(){a(!0)})),a(!1)}(ZL)}(),!ZL)throw new vT(TT.NOT_SUPPORTED,"can not create audio context");return ZL}return ZL}function tk(e){if(function(){if(null!==nk)return nk;let e=ek(),t=e.createBufferSource(),n=e.createGain(),r=e.createGain();t.connect(n),t.connect(r),t.disconnect(n);let i=!1;try{t.disconnect(n)}catch{i=!0}return t.disconnect(),nk=i,i}())return;let t=e.connect,n=e.disconnect;e.connect=(n,r,i)=>{var o;return e._inputNodes||(e._inputNodes=[]),yr(o=e._inputNodes).call(o,n)||(n instanceof AudioNode?(e._inputNodes.push(n),t.call(e,n,r,i)):t.call(e,n,r)),e},e.disconnect=(r,i,o)=>{n.call(e),r?sv(e._inputNodes,r):e._inputNodes=[];for(let n of e._inputNodes)t.call(e,n)}}let nk=null;function rk(e,t){let n=!1,r=1/t;if($v("DISABLE_WEBAUDIO")){let t=window.setInterval((()=>{n?window.clearInterval(t):e(performance.now()/1e3)}),1e3*r)}else{let t=ek(),i=t.createGain();i.gain.value=0,i.connect(t.destination);let o=()=>{if(n)return void(i=null);let a=t.createOscillator();a.onended=o,a.connect(i),a.start(0),a.stop(t.currentTime+r),e(t.currentTime)};o()}return()=>{n=!0}}class ik{constructor(){YL(this,"context",void 0),YL(this,"analyserNode",void 0),YL(this,"sourceNode",void 0),this.context=ek(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=e,null===e||void 0===e||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||tT()||hT()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode))return 0;let e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{let t=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(t);for(let n=0;n<e.length;++n)e[n]=t[n]/128-1}let t=Hr(e).call(e,((e,t)=>e+t*t),0)/e.length;return Math.max(10*Math.log10(t)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,t;null===(e=this.sourceNode)||void 0===e||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(t=this.sourceNode)||void 0===t||t.connect(this.analyserNode)}catch{Ey.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class ok extends VT{get processSourceNode(){return this.sourceNode}set processedNode(e){var t;if(!this.isDestroyed&&this._processedNode!==e){try{var n;null===(n=this.sourceNode)||void 0===n||n.disconnect(this.outputNode)}catch{}null===(t=this._processedNode)||void 0===t||t.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),YL(this,"outputNode",void 0),YL(this,"outputTrack",void 0),YL(this,"isPlayed",!1),YL(this,"sourceNode",void 0),YL(this,"context",void 0),YL(this,"audioBufferNode",void 0),YL(this,"destNode",void 0),YL(this,"audioOutputLevel",0),YL(this,"volumeLevelAnalyser",void 0),YL(this,"_processedNode",void 0),YL(this,"playNode",void 0),YL(this,"isDestroyed",!1),YL(this,"onNoAudioInput",void 0),YL(this,"isNoAudioInput",!1),YL(this,"_noAudioInputCount",0),this.context=ek(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),tk(this.outputNode),this.volumeLevelAnalyser=new ik}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=e=>{this.emit(NL.ON_AUDIO_BUFFER,function(e){for(let t=0;t<e.outputBuffer.numberOfChannels;t+=1){let n=e.outputBuffer.getChannelData(t);for(let e=0;e<n.length;e+=1)n[e]=0}return e.inputBuffer}(e))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!oL().webAudioMediaStreamDest)throw new vT(TT.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){"running"!==this.context.state&&cv((()=>{$L.emit("autoplay-failed")})),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;tT()||hT()?"suspended"===this.context.state&&this.context.resume():"running"!==this.context.state&&this.context.resume();let t,n=this.volumeLevelAnalyser.getAnalyserNode();n.getFloatTimeDomainData?(t=new Float32Array(n.fftSize),n.getFloatTimeDomainData(t)):(t=new Uint8Array(n.fftSize),n.getByteTimeDomainData(t));let r=!1;for(let i=0;i<t.length;i++)0!==t[i]&&(r=!0);return r?(this.isNoAudioInput=!1,!0):(await wv(200),await this.checkHasAudioInput(e?e+1:1)&&r)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,t;null===(e=this.processedNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?null===(e=this.processedNode)||void 0===e||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class ak extends ok{get isFreeze(){return!1}constructor(e,t,n){var r;if(super(),YL(this,"sourceNode",void 0),YL(this,"track",void 0),YL(this,"clonedTrack",void 0),YL(this,"audioElement",void 0),YL(this,"isCurrentTrackCloned",!1),YL(this,"isRemoteTrack",!1),YL(this,"originVolumeLevelAnalyser",void 0),YL(this,"rebuildWebAudio",(async()=>{if(Ey.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void Ey.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then((()=>Ey.info("resume success"))),Ey.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();let e=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?e.stop():this.isCurrentTrackCloned=!0;let t=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(t),tk(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();let n=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(n,this.context.currentTime),tk(this.outputNode),this.emit(NL.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=t,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()})),"audio"!==e.kind)throw new vT(TT.UNEXPECTED_ERROR);this.track=e;let i=new MediaStream([this.track]);if(this.isRemoteTrack=!!t,this.sourceNode=this.context.createMediaStreamSource(i),tk(this.sourceNode),n){let e=n.clone();e.enabled=!0,this.clonedTrack=e,Ey.debug("create an unmuted track ".concat(e.id," from the original track ").concat(n.id," to get the volume"));let t=this.context.createMediaStreamSource(new MediaStream([e]));tk(t),this.originVolumeLevelAnalyser=new ik,this.originVolumeLevelAnalyser.updateSource(t)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=i;let o=WS();t&&o.os===VS.IOS&&Number(null===(r=o.osVersion)||void 0===r?void 0:r.split(".")[0])<15&&($L.on(sL.STATE_CHANGE,(()=>{"suspended"===this.context.state?document.body.addEventListener("click",this.rebuildWebAudio,!0):"running"===this.context.state&&this.rebuildWebAudio()})),this.checkHasAudioInput().then((e=>{e||document.body.addEventListener("click",this.rebuildWebAudio,!0)})))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;let t=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(t),tk(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(NL.UPDATE_SOURCE),this.audioElement.srcObject=t}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),$L.off("state-change",this.rebuildWebAudio),null===(e=this.originVolumeLevelAnalyser)||void 0===e||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){let t=e.clone();t.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=t),Ey.debug("create an unmuted track ".concat(t.id," from the original track ").concat(e.id," to get the volume"));let n=this.context.createMediaStreamSource(new MediaStream([t]));tk(n),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(n)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function sk(e,t,n){let r=(e,t)=>e?"number"!=typeof e?e.max||e.exact||e.ideal||e.min||t:e:t,i={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:r(t.height,1080),maxWidth:r(t.width,1920)}}};return t.frameRate&&"number"!=typeof t.frameRate?(i.video.mandatory.maxFrameRate=t.frameRate.max,i.video.mandatory.minFrameRate=t.frameRate.min):"number"==typeof t.frameRate&&(i.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function Ak(e){let t=["window","screen"];"application"!==e&&"window"!==e||(t=["window"]),"screen"===e&&(t=["screen"]);let n=KT();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new vT(TT.ELECTRON_IS_NULL);let r=null;try{var i;r=(null===(i=n.desktopCapturer)||void 0===i?void 0:i.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{r=null}r&&r.then||(r=new wu(((e,r)=>{n.desktopCapturer.getSources({types:t},((t,n)=>{t?r(t):e(n)}))})));try{return await r}catch(o){throw new vT(TT.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,o.toString())}}let ck=new Uv("safari"),lk=!1,dk=!1;async function uk(e,t){let n=0,r=null;for(;n<2;)try{r=await hk(e,t,n>0);break}catch(i){if(i instanceof vT)throw Ey.error("[".concat(t,"] ").concat(i.toString())),i;let e=pk(i.name||i.code||i,i.message);if(e.code===TT.MEDIA_OPTION_INVALID){Ey.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await wv(500);continue}throw Ey.error("[".concat(t,"] ").concat(e.toString())),e}if(!r)throw new vT(TT.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function hk(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new vT(TT.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));let r=oL(),i=new MediaStream;if(e.audioSource&&i.addTrack(e.audioSource),e.videoSource&&i.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return Ey.debug("Using Video Source/ Audio Source"),i;if(e.screen)if(KT())e.screen.sourceId?fk(i,await sk(e.screen.sourceId,e.screen,e.screenAudio)):fk(i,await async function(e,t){let n=await Ak(e.mediaSource),{sourceId:r,audio:i}=await function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new wu(((n,r)=>{let i=document.createElement("div");i.innerText="share screen",i.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");let o=document.createElement("div");o.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");let a=document.createElement("div");a.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",a.setAttribute("style","height: 12%;");let s=document.createElement("div");s.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");let A=document.createElement("div");A.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");let c=document.createElement("button");c.innerHTML="cancel",c.setAttribute("style","width: 85px;"),c.onclick=()=>{document.body.removeChild(u);let e=new Error("NotAllowedError");e.name="NotAllowedError",r(e)};let l=t,d=document.createElement("div");if(t){let e=document.createElement("input");e.setAttribute("type","checkbox");let t=document.createElement("span");e.setAttribute("style","margin-right: 6px;"),t.innerText="Share audio",e.checked=l,e.onchange=()=>{l=e.checked},d.appendChild(e),d.appendChild(t)}A.appendChild(d),A.appendChild(c),o.appendChild(a),o.appendChild(s),o.appendChild(A);let u=document.createElement("div");u.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),u.appendChild(i),u.appendChild(o),document.body.appendChild(u),e.map((e=>{if(e.id){let r=document.createElement("div");r.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let i=e.thumbnail;try{let{width:e}=i.getSize();e>1920&&(i=i.resize({width:1920}))}catch(t){throw t&&t.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),t}r.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+i.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+e.name.replace(/[\u00A0-\u9999<>\&]/g,(function(e){return"&#"+e.charCodeAt(0)+";"}))+"</span>",r.onclick=()=>{document.body.removeChild(u),n({sourceId:e.id,audio:l})},s.appendChild(r)}}))}))}(n,t);return await sk(r,e,i)}(e.screen,e.screenAudio));else if(qS()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new vT(TT.NOT_SUPPORTED,"This browser does not support screen sharing");Ey.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));let n=await(a=e.screen.extensionId,s=t,new wu(((e,t)=>{try{chrome.runtime.sendMessage(a,{getStream:!0},(n=>{if(!n||!n.streamId)return Ey.error("[".concat(s,"] No response from Chrome Plugin. Plugin not installed properly"),n),void t(new vT(TT.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));e(n.streamId)}))}catch(n){Ey.error("[".concat(s,"] AgoraRTC screensharing plugin is not accessible(").concat(a,")"),n.toString()),t(new vT(TT.CHROME_PLUGIN_NOT_INSTALL))}})));e.screen.mandatory.chromeMediaSourceId=n,fk(i,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var o;e.screen.mediaSource&&SL(e.screen.mediaSource);let n={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:null!==(o=e.screen.displaySurface)&&void 0!==o?o:"screen"===e.screen.mediaSource?"monitor":e.screen.mediaSource},{selfBrowserSurface:r,surfaceSwitching:a,systemAudio:s}=e.screen,A={selfBrowserSurface:r,surfaceSwitching:a,systemAudio:s};!r&&delete A.selfBrowserSurface,!a&&delete A.surfaceSwitching,!s&&delete A.systemAudio,Ey.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:n,audio:!!e.screenAudio,controls:A})),fk(i,await navigator.mediaDevices.getDisplayMedia(WL({video:n,audio:!!e.screenAudio},A)))}else{if(!eT())throw Ey.error("[".concat(t,"] This browser does not support screenSharing")),new vT(TT.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&SL(e.screen.mediaSource);let n={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};Ey.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(n))),fk(i,await navigator.mediaDevices.getUserMedia(n))}}var a,s;if(!e.video&&!e.audio)return i;let A={video:e.video,audio:e.audio},c=$v("MEDIA_DEVICE_CONSTRAINTS");if(c)try{"string"==typeof c&&(c=JSON.parse(c)),A=bv(A,c)}catch{}Ey.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(A)),WS();let l,d=null;(ZS()||tT()||zS())&&(d=await ck.lock());try{l=await navigator.mediaDevices.getUserMedia(A)}catch(u){throw d&&d(),u}return A.audio&&(lk=!0),A.video&&(dk=!0),fk(i,l),d&&d(),i}function pk(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new vT(TT.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new vT(TT.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new vT(TT.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new vT(TT.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new vT(TT.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new vT(TT.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return Ey.error("getUserMedia unexpected error",e),new vT(TT.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function fk(e,t){let n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],i=t.getVideoTracks()[0],o=t.getAudioTracks()[0];o&&(r&&e.removeTrack(r),e.addTrack(o)),i&&(n&&e.removeTrack(n),e.addTrack(i))}let Ek=new class extends VT{get state(){return this._state}set state(e){e!==this._state&&(this.emit(QL.STATE_CHANGE,e),this._state=e)}constructor(){super(),YL(this,"_state",xL.IDLE),YL(this,"isAccessMicrophonePermission",!1),YL(this,"isAccessCameraPermission",!1),YL(this,"lastAccessMicrophonePermission",!1),YL(this,"lastAccessCameraPermission",!1),YL(this,"checkdeviceMatched",!1),YL(this,"deviceInfoMap",new Map),this.init().then((()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval((()=>{($v("ENUMERATE_DEVICES_INTERVAL")||(mT()||JS()===VS.HARMONY_OS)&&gT())&&this.updateDevicesInfo()}),$v("ENUMERATE_DEVICES_INTERVAL_TIME"))})).catch((e=>Ey.error(e.toString())))}async enumerateDevices(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new vT(TT.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();let r=await navigator.mediaDevices.enumerateDevices(),i=this.checkMediaDeviceInfoIsOk(r),o=!this.isAccessMicrophonePermission&&e,a=!this.isAccessCameraPermission&&t;i.audio&&(o=!1),i.video&&(a=!1);let s=null,A=null,c=null;if(!n&&(o||a)){if(ck.isLocked&&(Ey.debug("[device manager] wait GUM lock"),(await ck.lock())(),Ey.debug("[device manager] GUM unlock")),lk&&(o=!1,this.isAccessMicrophonePermission=!0),dk&&(a=!1,this.isAccessCameraPermission=!0),Ey.debug("[device manager] check media device permissions",e,t,o,a),o&&a){try{c=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(l){let e=pk(l.name||l.code||l,l.message);if(e.code===TT.PERMISSION_DENIED)throw e;Ey.warning("getUserMedia failed in getDevices",e)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(o){try{s=await navigator.mediaDevices.getUserMedia({audio:e})}catch(l){let e=pk(l.name||l.code||l,l.message);if(e.code===TT.PERMISSION_DENIED)throw e;Ey.warning("getUserMedia failed in getDevices",e)}this.isAccessMicrophonePermission=!0}else if(a){try{A=await navigator.mediaDevices.getUserMedia({video:t})}catch(l){let e=pk(l.name||l.code||l,l.message);if(e.code===TT.PERMISSION_DENIED)throw e;Ey.warning("getUserMedia failed in getDevices",e)}this.isAccessCameraPermission=!0}Ey.debug("[device manager] mic permission",e,"cam permission",t)}try{let e=await navigator.mediaDevices.enumerateDevices();return s&&s.getTracks().forEach((e=>e.stop())),A&&A.getTracks().forEach((e=>e.stop())),c&&c.getTracks().forEach((e=>e.stop())),s=null,A=null,c=null,e}catch(l){return s&&s.getTracks().forEach((e=>e.stop())),A&&A.getTracks().forEach((e=>e.stop())),c&&c.getTracks().forEach((e=>e.stop())),s=null,A=null,c=null,new vT(TT.ENUMERATE_DEVICES_FAILED,l.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter((e=>"audioinput"===e.kind))}async getCamerasDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter((e=>"videoinput"===e.kind))}async getSpeakers(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter((e=>"audiooutput"===e.kind))}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach((n=>{n.device.label===e&&(t=n.device.deviceId)})),t}async getDeviceById(e){let t=(await this.enumerateDevices(!0,!0,!0)).find((t=>t.deviceId===e));if(!t)throw new vT(TT.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=xL.INITING;try{await this.updateDevicesInfo(),this.state=xL.INITEND}catch(th){throw Ey.warning("Device Detection functionality cannot start properly.",th.toString()),this.state=xL.IDLE,("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)||new vT(TT.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),th}}async updateDevicesInfo(){let e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&!1===this.checkdeviceMatched){this.checkdeviceMatched=!0;let t=e.find((e=>"audioinput"===e.kind&&"default"===e.deviceId)),n=e.find((e=>"audiooutput"===e.kind&&"default"===e.deviceId));t&&n?n.groupId===t.groupId?Ey.debug("[device-check] default input ".concat(t.label," and output ").concat(n.label," is the same group")):Ey.warning("[device-check] default input ".concat(t.label," and output ").concat(n.label," is not the same group")):Ey.debug("[device-check] default input or output not found")}let r=this.checkMediaDeviceInfoIsOk(e);if(e.forEach((e=>{if(!e.deviceId)return;let r=this.deviceInfoMap.get("".concat(e.kind,"_").concat(e.deviceId));if("ACTIVE"!==(r?r.state:"INACTIVE")){let r={initAt:t,updateAt:t,device:e,state:"ACTIVE"};this.deviceInfoMap.set("".concat(e.kind,"_").concat(e.deviceId),r),n.push(r)}r&&(r.updateAt=t)})),this.deviceInfoMap.forEach(((e,r)=>{"ACTIVE"===e.state&&e.updateAt!==t&&(e.state="INACTIVE",n.push(e))})),this.state!==xL.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach((e=>{switch(e.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(QL.RECORDING_DEVICE_CHANGED,e);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(QL.CAMERA_DEVICE_CHANGED,e);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(QL.PLAYOUT_DEVICE_CHANGED,e)}})),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){let t=e.filter((e=>"audioinput"===e.kind)),n=e.filter((e=>"videoinput"===e.kind)),r={audio:!1,video:!1};for(let i of t)if(i.label&&i.deviceId){r.audio=!0;break}for(let i of n)if(i.label&&i.deviceId){r.video=!0;break}return r}},gk=!1,mk=new class extends VT{constructor(){super(...arguments),YL(this,"onAutoplayFailed",void 0),YL(this,"onAudioAutoplayFailed",void 0)}};function _k(){if(WS(),!gk){let e=t=>{t.preventDefault(),gk=!1,_T()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};gk=!0,_T()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),Ey.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),mk.onAutoplayFailed?mk.onAutoplayFailed():mk.onAudioAutoplayFailed?Ey.warning("AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."):Ey.warning("We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),mk.emit("autoplay-failed")}}function Ck(e,t,n,r){if(!e)return;let i=vy.getBaseInfoBySessionId(e);if(!i)return;let o=i.info,a=Date.now(),s=WL(WL({},o),{},{vid:void 0===o.vid?0:Number(o.vid),lts:a,elapse:a-i.startTime,cbRegistered:mk.onAutoplayFailed||mk.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:r,extend:void 0});vy.send({type:wy.AUTOPLAY_FAILED,data:s},!0)}let wk=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Sk=new class{constructor(){YL(this,"onAutoplayFailed",void 0),YL(this,"elementMap",new Map),YL(this,"elementStateMap",new Map),YL(this,"elementsNeedToResume",[]),YL(this,"sinkIdMap",new Map),YL(this,"autoResumeAfterInterruption",(e=>{Array.from(this.elementMap.entries()).forEach((t=>{let[n,r]=t,i=this.elementStateMap.get(n),o=r.srcObject.getAudioTracks()[0],a=o&&o.readyState;if(Ey.debug("resume after interrupted, ele: ".concat(i," audio: ").concat(a," ").concat(e)),"live"===a){if(e)return r.pause(),void r.play();if("running"===$L.curState)return lT()?(r.pause(),void r.play()):void(i&&"paused"===i&&r.play())}}))})),YL(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{Array.from(this.elementMap.entries()).forEach((e=>{let[t,n]=e,r=n.srcObject.getAudioTracks()[0];r&&"live"===r.readyState&&(Ey.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())}))})),this.autoResumeAudioElement(),$L.on(sL.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),$L.on(sL.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),$L.on(sL.STATE_CHANGE,(()=>{tT()&&"suspended"===$L.prevState&&"running"===$L.curState&&this.autoResumeAfterInterruption()}))}async setSinkID(e,t){let n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(r){throw new vT(TT.PERMISSION_DENIED,"can not set sink id: "+r.toString())}}play(e,t,n,r){if(this.elementMap.has(t))return;let i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,i),this.elementMap.set(t,i),this.elementStateMap.set(t,VL.INIT),this.setVolume(t,n);let o=this.sinkIdMap.get(t);if(o)try{i.setSinkId(o).catch((e=>{Ey.warning("[".concat(t,"] set sink id failed"),e.toString())}))}catch(s){Ey.warning("[".concat(t,"] set sink id failed"),s.toString())}let a=i.play();a&&a.then&&a.catch((e=>{r&&Ck(r,"audio",e.message,t),Ey.warning("audio element play warning",e.toString()),this.elementMap.has(t)&&"NotAllowedError"===e.name&&(Ey.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),cv((()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),_k()})))}))}updateTrack(e,t){let n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&"playing"===this.elementStateMap.get(e)}setVolume(e,t){let n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){let t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;let n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){wk.forEach((n=>{t.addEventListener(n,(n=>{let r=this.elementStateMap.get(e),i="pause"===n.type?"paused":n.type;if(Ey.debug("[".concat(e,"] audio-element-status change ").concat(r," => ").concat(i)),"error"===n.type){let n=null===t||void 0===t?void 0:t.error;n&&Ey.error("[".concat(e,"] media error, code: ").concat(n.code,", message: ").concat(n.message))}this.elementStateMap.set(e,i)}))}))}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){let e=()=>{this.elementsNeedToResume.forEach((e=>{e.play().then((e=>{Ey.debug("Auto resume audio element success")})).catch((e=>{Ey.warning("Auto resume audio element failed!",e)}))})),this.elementsNeedToResume=[]};new wu((e=>{document.body?e():window.addEventListener("load",(()=>e()))})).then((()=>{_T()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))}))}};function Tk(){return function(e,t,n){let r=n.value;return"function"==typeof r&&(n.value=function(){this._isClosed&&new vT(TT.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",Ey);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let i=r.apply(this,t);return i instanceof wu?new wu(((e,t)=>{i.then(e).catch(t)})):i}),n}}class vk extends VT{constructor(e){super(),YL(this,"name","VideoProcessorDestination"),YL(this,"ID","0"),YL(this,"_source",void 0),YL(this,"videoContext",void 0),YL(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new vT(TT.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new vT(TT.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(ML.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(ML.ON_TRACK,void 0)}}class yk extends VT{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t){super(),YL(this,"constraintsMap",new Map),YL(this,"statsRegistry",[]),YL(this,"usageRegistry",[]),YL(this,"trackId",void 0),YL(this,"direction",void 0),YL(this,"_chained",!1),this.trackId=e,this.direction=t}async getConstraints(){return await nv(this,FL.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,t){var n;return Ey.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),rv(this,FL.REQUEST_UPDATE_CONSTRAINTS,Array.from(RI(n=this.constraintsMap).call(n)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return Ey.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),rv(this,FL.REQUEST_UPDATE_CONSTRAINTS,Array.from(RI(t=this.constraintsMap).call(t)))}registerStats(e,t,n){this.statsRegistry.find((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t))||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}unregisterStats(e,t){let n=this.statsRegistry.findIndex((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t));-1!==n&&this.statsRegistry.splice(n,1)}gatherStats(){let e=[];for(let{processorID:n,processorName:r,type:i,cb:o}of this.statsRegistry)try{let t=o();e.push({processorID:n,processorName:r,type:i,stats:t})}catch(t){Ey.error(new vT(TT.UNEXPECTED_ERROR,t.message))}return e}registerUsage(e,t){this.usageRegistry.find((t=>t.processorID===e.ID&&t.processorName===e.name))||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){let t=this.usageRegistry.findIndex((t=>t.processorID===e.ID&&t.processorName===e.name));-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){let e=[];if(!this.chained)return[];for(let{cb:n}of this.usageRegistry)try{let t=n();t instanceof wu&&(t=await t),e.push(WL(WL({},t),{},{direction:this.direction}))}catch(t){Ey.error("gather extension usage error",t)}return e}getDirection(){return this.direction}}class Ik extends VT{constructor(e){super(),YL(this,"name","AudioProcessorDestination"),YL(this,"ID","0"),YL(this,"inputTrack",void 0),YL(this,"inputNode",void 0),YL(this,"audioProcessorContext",void 0),YL(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new vT(TT.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new vT(TT.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(ML.ON_TRACK,void 0),this.emit(ML.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(ML.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(ML.ON_NODE,this.inputNode))}}class Rk extends VT{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t,n){super(),YL(this,"constraintsMap",new Map),YL(this,"statsRegistry",[]),YL(this,"audioContext",void 0),YL(this,"trackId",void 0),YL(this,"direction",void 0),YL(this,"usageRegistry",[]),YL(this,"_chained",!1),this.audioContext=e,this.trackId=t,this.direction=n}async getConstraints(){return nv(this,FL.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,t){var n;return Ey.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),rv(this,FL.REQUEST_UPDATE_CONSTRAINTS,Array.from(RI(n=this.constraintsMap).call(n)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),rv(this,FL.REQUEST_UPDATE_CONSTRAINTS,Array.from(RI(t=this.constraintsMap).call(t)))}registerStats(e,t,n){this.statsRegistry.find((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t))||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}unregisterStats(e,t){let n=this.statsRegistry.findIndex((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t));-1!==n&&this.statsRegistry.splice(n,1)}gatherStats(){let e=[];for(let{processorID:n,processorName:r,type:i,cb:o}of this.statsRegistry)try{let t=o();e.push({processorID:n,processorName:r,type:i,stats:t})}catch(t){Ey.error(new vT(TT.UNEXPECTED_ERROR,t.message))}return e}registerUsage(e,t){this.usageRegistry.find((t=>t.processorID===e.ID&&t.processorName===e.name))||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){let t=this.usageRegistry.findIndex((t=>t.processorID===e.ID&&t.processorName===e.name));-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){let e=[];if(!this.chained)return[];for(let{cb:n}of this.usageRegistry)try{let t=n();t instanceof wu&&(t=await t),e.push(WL(WL({},t),{},{direction:this.direction}))}catch(t){Ey.error("gather extension usage error",t)}return e}getDirection(){return this.direction}}class bk extends VT{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),YL(this,"context",void 0),YL(this,"processSourceNode",void 0),YL(this,"outputTrack",void 0),YL(this,"processedNode",void 0),YL(this,"clonedTrack",void 0),YL(this,"outputNode",void 0),this.outputNode=new Ok}setVolume(){}createOutputTrack(){throw new vT(TT.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Ok{disconnect(){}connect(){}}function Bk(e){return new wu(((t,n)=>{let r=!1,i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);let o=tT()?"canplay":"playing";i.addEventListener(o,(()=>{let e=i.videoWidth,n=i.videoHeight;!e&&eT()||(r=!0,i.srcObject=null,i.remove(),t([e,n]))})),i.srcObject=new MediaStream([e]),i.play().catch(vv),setTimeout((()=>{r||(i.srcObject=null,i.remove(),t([i.videoWidth,i.videoHeight]))}),4e3)}))}function Nk(e){let t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});let n=EL(e.encoderConfig);return null!=n.width&&(t.width=n.width),null!=n.height&&(t.height=n.height),!fT()&&n.frameRate&&(t.frameRate=n.frameRate),$S()&&"object"==typeof t.frameRate&&(t.frameRate.max=60),eT()&&(t.frameRate={ideal:30,max:30}),t}function Dk(e){let t={};if(fT()||(void 0!==e.AGC&&(t.autoGainControl=e.AGC),void 0!==e.AEC&&(t.echoCancellation=e.AEC),void 0!==e.ANS&&(t.noiseSuppression=e.ANS,qS()&&e.ANS&&(t.googHighpassFilter=e.ANS))),e.encoderConfig){let n=CL(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),mT()&&(t.sampleRate=void 0),t}let Pk=async(e,t,n)=>await(async(e,t,n)=>{let r=function(e){let t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.slice(n,n+2),16));return Uint8Array.from(t)}(Nv(""+t+n)).slice(0,16),i=r.slice(0,12),o=await window.crypto.subtle.importKey("raw",r,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i},o,e))})(e.buffer,t,n),Uk=e=>{let t=document.createElement("canvas");return t.width=2,t.height=2,new wu(((n,r)=>{t.toBlob((async e=>{if(t.remove(),e){let r=await Lk(e);n({buffer:r,width:t.width,height:t.height})}else r(new vT(TT.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),e,1)}))},Lk=async e=>{let t=await e.arrayBuffer();return new Uint8Array(t)};var kk,Mk,Fk,xk,Qk,Vk,Hk,Kk,jk,Gk,Wk,Yk,Jk,Xk,zk,qk,Zk,$k,eM,tM,nM,rM,iM,oM,aM,sM,AM,cM,lM,dM,uM,hM,pM,fM,EM,gM,mM,_M,CM,wM;let SM=(kk=Ty({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),Mk=Ty({argsMap:(e,t)=>[e.getTrackId(),t]}),Fk=Tk(),xk=Lv("LocalAudioTrack","_enabledMutex"),Qk=Ty({argsMap:(e,t)=>[e.getTrackId(),t]}),Vk=Tk(),Hk=Lv("LocalAudioTrack","_enabledMutex"),Kk=Ty({argsMap:(e,t)=>[e.getTrackId(),t]}),jk=Tk(),Gk=Tk(),Wk=Tk(),Yk=Ty({argsMap:e=>[e.getTrackId()]}),Jk=Tk(),Xk=Ty({argsMap:e=>[e.getTrackId()]}),zk=Tk(),qk=Ty({argsMap:e=>[e.getTrackId()]}),Zk=Ty({argsMap:(e,t)=>[e.getTrackId(),t.name]}),$k=Ty({argsMap:e=>[e.getTrackId()]}),JL((eM=class extends zL{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Sk.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,r){super(e,n),YL(this,"trackMediaType","audio"),YL(this,"_encoderConfig",void 0),YL(this,"_trackSource",void 0),YL(this,"_enabled",!0),YL(this,"_volume",100),YL(this,"_useAudioElement",!0),YL(this,"_bypassWebAudio",!1),YL(this,"processor",void 0),YL(this,"_processorContext",void 0),YL(this,"_processorDestination",void 0),YL(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r,this._trackSource=new bk,$v("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),$v("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),ZS()&&!ZL?setTimeout((()=>this.initWebAudio())):this.initWebAudio()}setVolume(e){RT(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Sk.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void Ey.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));let e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,rv(this,TL.NEED_REPLACE_TRACK,this).then((()=>{Ey.debug("[".concat(this.getTrackId(),"] replace web audio track success"))})).catch((e=>{Ey.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),e)})))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!aL())throw new vT(TT.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Sk.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(Ey.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await rv(this,TL.NEED_ENABLE_TRACK,this),Ey.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(r){throw n||(this._enabled=!1),Ey.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await rv(this,TL.NEED_DISABLE_TRACK,this)}catch(r){throw n||(this._enabled=!0),Ey.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,Ey.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await rv(this,TL.NEED_MUTE_TRACK,this):await rv(this,TL.NEED_UNMUTE_TRACK,this))}getStats(){return hv((()=>{Ey.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")}),"localAudioTrackGetStatsWarning"),iv(this,TL.GET_STATS)||WL({},DL)}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(NL.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(NL.ON_AUDIO_BUFFER),this._source.on(NL.ON_AUDIO_BUFFER,(t=>e(t)))}play(){Ey.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(Ey.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Sk.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){Ey.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Sk.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Ey.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Sk.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await rv(this,TL.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return wu.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new vT(TT.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new vT(TT.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;let t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(ML.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await rv(this,TL.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await rv(this,TL.NEED_REPLACE_TRACK,this))})),e.on(ML.ON_NODE,(e=>{this._source.processedNode=e}))}unbindProcessorDestinationEvents(e){e.removeAllListeners(ML.ON_TRACK),e.removeAllListeners(ML.ON_NODE)}bindProcessorContextEvents(e){e.on(FL.REQUEST_CONSTRAINTS,(async e=>{e(this._originMediaStreamTrack.getSettings())}))}unbindProcessorContextEvents(e){e.removeAllListeners(FL.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof bk&&(this._trackSource=new ak(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){let e=new Rk(this._source.context,this.getTrackId(),"local"),t=new Ik(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(NL.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})})),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Sk.stop(this.getTrackId()),this._source.play()),rv(this,TL.NEED_REPLACE_MIXING_TRACK,this).then((()=>{Ey.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))})).catch((e=>{Ey.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),e)}))),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[kk],Object.getOwnPropertyDescriptor(eM.prototype,"setVolume"),eM.prototype),JL(eM.prototype,"setPlaybackDevice",[Mk,Fk],Object.getOwnPropertyDescriptor(eM.prototype,"setPlaybackDevice"),eM.prototype),JL(eM.prototype,"setEnabled",[xk,Qk,Vk],Object.getOwnPropertyDescriptor(eM.prototype,"setEnabled"),eM.prototype),JL(eM.prototype,"setMuted",[Hk,Kk,jk],Object.getOwnPropertyDescriptor(eM.prototype,"setMuted"),eM.prototype),JL(eM.prototype,"getStats",[Gk],Object.getOwnPropertyDescriptor(eM.prototype,"getStats"),eM.prototype),JL(eM.prototype,"setAudioFrameCallback",[Wk],Object.getOwnPropertyDescriptor(eM.prototype,"setAudioFrameCallback"),eM.prototype),JL(eM.prototype,"play",[Yk,Jk],Object.getOwnPropertyDescriptor(eM.prototype,"play"),eM.prototype),JL(eM.prototype,"stop",[Xk,zk],Object.getOwnPropertyDescriptor(eM.prototype,"stop"),eM.prototype),JL(eM.prototype,"close",[qk],Object.getOwnPropertyDescriptor(eM.prototype,"close"),eM.prototype),JL(eM.prototype,"pipe",[Zk],Object.getOwnPropertyDescriptor(eM.prototype,"pipe"),eM.prototype),JL(eM.prototype,"unpipe",[$k],Object.getOwnPropertyDescriptor(eM.prototype,"unpipe"),eM.prototype),eM),TM=(tM=Ty({argsMap:(e,t)=>[e.getTrackId(),t]}),nM=Tk(),rM=Lv("MicrophoneAudioTrack","_enabledMutex"),iM=Ty({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),oM=Tk(),aM=Ty({argsMap:e=>[e.getTrackId()]}),JL((sM=class extends SM{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,r){super(e,t.encoderConfig?CL(t.encoderConfig):{},r,$v("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),YL(this,"_config",void 0),YL(this,"_deviceName","default"),YL(this,"_constraints",void 0),YL(this,"_originalConstraints",void 0),YL(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,"boolean"==typeof t.bypassWebAudio&&(this._bypassWebAudio=t.bypassWebAudio),(lT()||dT())&&$L.bindInterruptDetectorTrack(this)}async setDevice(e){if(Ey.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{let n=await Ek.getDeviceById(e),r={};r.audio=WL({},this._constraints),r.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let i=null;try{i=await uk(r,this.getTrackId())}catch(t){throw Ey.error("[".concat(this.getTrackId(),"] setDevice failed"),t.toString()),i=await uk({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),t}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=n.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(n){throw Ey.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{let t=await Ek.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(n){throw Ey.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}Ey.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return Ey.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(Ey.info("[".concat(this.getTrackId(),"] start setEnabled"),e),$v("AUTO_RESET_AUDIO_ROUTE")&&(tT()||hT())){let t=navigator.audioSession;t&&(e||(t.type="playback"),t.type="auto")}if(!e){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),null===(r=this._source.clonedTrack)||void 0===r||r.stop(),n||(this._enabled=!1);try{await rv(this,TL.NEED_DISABLE_TRACK,this)}catch(a){throw Ey.error("[".concat(this.getTrackId(),"] setEnabled false failed"),a.toString()),a}return}let i=WL({},this._constraints),o=Ek.searchDeviceIdByName(this._deviceName);o&&!i.deviceId&&(i.deviceId=o);try{n||(this._enabled=!0);let e=await uk({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!1),await rv(this,TL.NEED_ENABLE_TRACK,this)}catch(a){throw n||(this._enabled=!1),Ey.error("[".concat(this.getTrackId(),"] setEnabled true failed"),a.toString()),a}Ey.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(lT()||dT())&&$L.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((tT()||hT())&&this._enabled&&!this._isClosed&&$L.duringInterruption){let e=async()=>{$L.off(sL.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(Ey.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};$L.on(sL.IOS_INTERRUPTION_END,e)}else Ey.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(OL.TRACK_ENDED)}async renewMediaStreamTrack(e){let t=e||this._constraints,n=Ek.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();let e=await uk({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(FL.REQUEST_UPDATE_CONSTRAINTS,(async(e,t,n)=>{try{let n=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(n),t()}catch(r){n(r)}}))}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(FL.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[tM,nM],Object.getOwnPropertyDescriptor(sM.prototype,"setDevice"),sM.prototype),JL(sM.prototype,"setEnabled",[rM,iM,oM],Object.getOwnPropertyDescriptor(sM.prototype,"setEnabled"),sM.prototype),JL(sM.prototype,"close",[aM],Object.getOwnPropertyDescriptor(sM.prototype,"close"),sM.prototype),sM),vM=(AM=Ty({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),cM=Tk(),lM=Ty({argsMap:e=>[e.getTrackId()]}),dM=Tk(),uM=Ty({argsMap:e=>[e.getTrackId()]}),hM=Tk(),pM=Ty({argsMap:e=>[e.getTrackId()]}),fM=Tk(),EM=Ty({argsMap:e=>[e.getTrackId()]}),gM=Tk(),mM=Ty({argsMap:e=>[e.getTrackId()]}),_M=Ty({argsMap:e=>[e.getTrackId()]}),CM=Tk(),JL((wM=class extends SM{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,r){super(t.createOutputTrack(),n,r),YL(this,"source",void 0),YL(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(NL.AUDIO_SOURCE_STATE_CHANGE,(e=>{this.safeEmit(OL.SOURCE_STATE_CHANGE,e)}));try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){RT(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[AM,cM],Object.getOwnPropertyDescriptor(wM.prototype,"startProcessAudioBuffer"),wM.prototype),JL(wM.prototype,"pauseProcessAudioBuffer",[lM,dM],Object.getOwnPropertyDescriptor(wM.prototype,"pauseProcessAudioBuffer"),wM.prototype),JL(wM.prototype,"seekAudioBuffer",[uM,hM],Object.getOwnPropertyDescriptor(wM.prototype,"seekAudioBuffer"),wM.prototype),JL(wM.prototype,"resumeProcessAudioBuffer",[pM,fM],Object.getOwnPropertyDescriptor(wM.prototype,"resumeProcessAudioBuffer"),wM.prototype),JL(wM.prototype,"stopProcessAudioBuffer",[EM,gM],Object.getOwnPropertyDescriptor(wM.prototype,"stopProcessAudioBuffer"),wM.prototype),JL(wM.prototype,"close",[mM],Object.getOwnPropertyDescriptor(wM.prototype,"close"),wM.prototype),JL(wM.prototype,"setAudioBufferPlaybackSpeed",[_M,CM],Object.getOwnPropertyDescriptor(wM.prototype,"setAudioBufferPlaybackSpeed"),wM.prototype),wM);class yM extends SM{get __className__(){return"MixingAudioTrack"}get isActive(){for(let e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){let e=ek().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,Sv(8,"track-mix-")),YL(this,"trackList",void 0),YL(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return-1!==this.trackList.indexOf(e)}addAudioTrack(e){-1===this.trackList.indexOf(e)?(Ey.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):Ey.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(-1!==this.trackList.indexOf(e)){Ey.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch{}sv(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){let e={};this.trackList.forEach((t=>{t._encoderConfig&&((t._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=t._encoderConfig.bitrate),(t._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=t._encoderConfig.sampleRate),(t._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=t._encoderConfig.sampleSize),t._encoderConfig.stereo&&(e.stereo=!0))})),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach((t=>{t instanceof yM?t.emit(bL.TRANSCEIVER_UPDATED,e):t._updateRtpTransceiver(e)})))}}class IM extends ok{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(NL.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),YL(this,"audioBuffer",void 0),YL(this,"sourceNode",void 0),YL(this,"startPlayTime",0),YL(this,"startPlayOffset",0),YL(this,"pausePlayTime",0),YL(this,"options",void 0),YL(this,"currentLoopCount",0),YL(this,"currentPlaybackSpeed",100),YL(this,"_currentState","stopped"),this.audioBuffer=e,this.options=t,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){"stopped"===this.currentState?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):Ey.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=e,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&("playing"===this.currentState&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){let e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}let RM=new Map;class bM{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){let e=this.renderStats.curTs-this.renderStats.lastTs,t=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/e;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,t}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){e!==this._videoElementStatus&&(Ey.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var t;e!==this._videoState&&(this._videoState=e,null===(t=this.onVideoStateChanged)||void 0===t||t.call(this,this.videoState))}constructor(e){YL(this,"trackId",void 0),YL(this,"config",void 0),YL(this,"onFirstVideoFrameDecoded",void 0),YL(this,"onVideoStateChanged",void 0),YL(this,"freezeTimeCounterList",[]),YL(this,"renderFreezeAccTime",0),YL(this,"isKeepLastFrame",!1),YL(this,"timeUpdatedCount",0),YL(this,"freezeTime",0),YL(this,"playbackTime",0),YL(this,"lastTimeUpdatedTime",0),YL(this,"autoplayFailed",!1),YL(this,"videoTrack",void 0),YL(this,"videoElement",void 0),YL(this,"cacheVideoElement",void 0),YL(this,"renderStats",void 0),YL(this,"_videoState",HL.VideoStateStopped),YL(this,"videoElementCheckInterval",void 0),YL(this,"videoElementFreezeTimeout",void 0),YL(this,"_videoElementStatus",VL.NONE),YL(this,"isGettingVideoDimensions",!1),YL(this,"startGetVideoDimensions",(()=>{let e=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return Ey.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(e,500)};!this.isGettingVideoDimensions&&e()})),YL(this,"autoResumeAfterInterruption",(()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&"running"===$L.curState&&(Ey.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(XS())),uT()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),YL(this,"handleVideoEvents",(e=>{switch(e.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=VL.PLAYING;break;case"loadeddata":if(this.videoState=HL.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=VL.CANPLAY;break;case"stalled":this.videoElementStatus=VL.STALLED;break;case"suspend":this.videoElementStatus=VL.SUSPEND;break;case"pause":this.videoElementStatus=VL.PAUSED,tT()||hT()||ZS()&&this.autoplayFailed||!this.videoTrack||"live"!==this.videoTrack.readyState||(Ey.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=VL.WAITING;break;case"abort":this.videoElementStatus=VL.ABORT;break;case"ended":this.videoElementStatus=VL.ENDED;break;case"emptied":this.videoElementStatus=VL.EMPTIED;break;case"error":{let e=this.videoElement.error;e?(this.videoElementStatus=VL.ERROR,Ey.error("[".concat(this.trackId,"] media error: ").concat(e.message," (").concat(e.code,")"))):Ey.debug("[".concat(this.trackId,"] media not been an error."));break}case"timeupdate":{let e=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=e);let t=e-this.lastTimeUpdatedTime,n=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=e,BF.lastVisibleTime<BF.lastHiddenTime||n<BF.lastHiddenTime||n<BF.lastVisibleTime)return;for(t>$v("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=t),this.playbackTime+=t;this.playbackTime>=6e3;){this.playbackTime-=6e3;let e=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(e),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}})),YL(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&(Ey.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(XS())),uT()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),$L.on(sL.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),$L.on(sL.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return null!==(e=this.videoElement.parentElement)&&void 0!==e?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){let t=this.videoElement.play();t&&t.catch&&t.catch((t=>{e&&Ck(e,"video",t.message,this.trackId),"NotAllowedError"===t.name?(Ey.warning("detected video element autoplay failed",t),this.autoplayFailed=!0,this.handleAutoPlayFailed()):Ey.warning("[".concat(this.trackId,"] play warning: "),t)}));let n=WS();if(("Safari"===n.name&&15===Number(n.version)||lT())&&t&&t.then){let e=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};t.then(e).catch(e)}}getCurrentFrame(){let e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;let t=e.getContext("2d");if(!t)return Ey.error("create canvas context failed!"),new ImageData(2,2);t.drawImage(this.videoElement,0,0,e.width,e.height);let n=t.getImageData(0,0,e.width,e.height);return e.remove(),n}async getCurrentFrameToUint8Array(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=document.createElement("canvas");n.width=this.videoElement.videoWidth,n.height=this.videoElement.videoHeight;let r=n.getContext("2d");return r?(r.drawImage(this.videoElement,0,0,n.width,n.height),new wu(((r,i)=>{n.toBlob((async e=>{if(n.remove(),e){let t=await Lk(e);r({buffer:t,width:n.width,height:n.height})}else i(new vT(TT.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),e,t<0?.1:t>1?1:t)}))):await Uk(e)}destroy(){this.renderStats=void 0,$L.off(sL.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),$L.off(sL.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=HL.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=VL.INIT,!this.videoElementCheckInterval&&(OM.forEach((e=>{this.videoElement.addEventListener(e,this.handleVideoEvents)})),this.videoElementCheckInterval=window.setInterval((()=>{var e;(e=this.videoElement)!==document.body&&document.body.contains(e)||(this.videoElementStatus=VL.DESTROYED)}),1e3),$v("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,t;let n,r=()=>{"visible"===document.visibilityState&&(document.removeEventListener("visibilitychange",r),this.videoElementFreezeTimeout=window.setTimeout(i,$v("VIDEO_FREEZE_DURATION")))},i=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===HL.VideoStateDecoding&&("visible"===document.visibilityState?this.videoState=HL.VideoStateFrozen:document.addEventListener("visibilitychange",r))},o=(e,t)=>{if(this.videoElementStatus===VL.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=t.mediaTime):this.renderStats={lastTs:t.mediaTime,curTs:t.mediaTime,lastRenderNum:0,renderNum:0},n){let e=t.presentationTime-n.presentationTime;this.videoState===HL.VideoStateStarting&&(this.videoState=HL.VideoStateDecoding),this.videoState===HL.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(i,$v("VIDEO_FREEZE_DURATION"))),e<$v("VIDEO_FREEZE_DURATION")&&this.videoState===HL.VideoStateFrozen&&(this.videoState=HL.VideoStateDecoding),e>$v("VIDEO_FREEZE_DURATION")&&BF.lastVisibleTime>=BF.lastHiddenTime&&n.timestamp>BF.lastVisibleTime&&n.timestamp>BF.lastHiddenTime&&(this.renderFreezeAccTime+=e)}n=WL(WL({},t),{},{timestamp:e})}var r,a;$v("ENABLE_VIDEO_FRAME_CALLBACK")&&(null===(r=(a=this.videoElement).requestVideoFrameCallback)||void 0===r||r.call(a,o))};null===(e=(t=this.videoElement).requestVideoFrameCallback)||void 0===e||e.call(t,o)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),mT()&&!$v("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");let n=WS();"Safari"===n.name&&15===Number(n.version)||lT()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,eT()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,eT()&&this.videoElement.load());let r=this.videoElement.play();void 0!==r&&r.catch((e=>{Ey.debug("[".concat(this.trackId,"] playback interrupted"),e.toString())}))}resetVideoElement(){OM.forEach((e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)})),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=VL.NONE}handleAutoPlayFailed(){let e=t=>{t.preventDefault(),this.videoElement.play().then((()=>{Ey.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))})).catch((e=>{Ey.error(e)})),this.autoplayFailed=!1,_T()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};_T()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),_k()}}let OM=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class BM extends bM{constructor(e){super(e),YL(this,"container",void 0),YL(this,"slot",void 0),this.slot=e.element,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;let t=e.element;t!==this.slot&&(this.destroy(),this.slot=t),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var t;null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,n):await Uk(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",$v("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e;!this.container||null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if(null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var NM,DM,PM,UM,LM,kM,MM,FM,xM,QM,VM,HM,KM,jM,GM,WM,YM,JM,XM,zM,qM,ZM,$M,eF,tF,nF,rF,iF,oF,aF,sF,AF,cF,lF,dF;let uF=(NM=Ty({argsMap:(e,t,n)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),DM=Tk(),PM=Ty({argsMap:e=>[e.getTrackId()]}),UM=Lv("LocalVideoTrack","_enabledMutex"),LM=Ty({argsMap:(e,t)=>[e.getTrackId(),t]}),kM=Tk(),MM=Lv("LocalVideoTrack","_enabledMutex"),FM=Ty({argsMap:(e,t)=>[e.getTrackId(),t]}),xM=Tk(),QM=Ty({argsMap:(e,t)=>[e.getTrackId(),t]}),VM=Tk(),HM=Tk(),KM=Ty({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),jM=Tk(),GM=Tk(),WM=Tk(),YM=Tk(),JM=Tk(),XM=Tk(),zM=Tk(),qM=Ty({argsMap:(e,t)=>[e.getTrackId(),t.name]}),ZM=Ty({argsMap:e=>[e.getTrackId()]}),$M=Ty({argsMap:e=>[e.getTrackId()]}),eF=Ty({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),tF=Ty(),nF=class e extends zL{get videoHeight(){if(ZS()){let{height:e}=this._mediaStreamTrack.getSettings();return this._videoHeight=e,this._videoHeight}return this._videoHeight}get videoWidth(){if(ZS()){let{width:e}=this._mediaStreamTrack.getSettings();return this._videoWidth=e,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==VL.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,t,n,r,i,o){if(super(e,i),YL(this,"trackMediaType","video"),YL(this,"_player",void 0),YL(this,"isUseScaleResolutionDownBy",!1),YL(this,"_videoVisibleTimer",null),YL(this,"_statsTimer",null),YL(this,"_previousVideoVisibleStatus",void 0),YL(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),YL(this,"_encoderConfig",void 0),YL(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),YL(this,"_optimizationMode",void 0),YL(this,"_videoHeight",void 0),YL(this,"_videoWidth",void 0),YL(this,"_forceBitrateLimit",void 0),YL(this,"_enabled",!0),YL(this,"_processorDestination",void 0),YL(this,"_processorContext",void 0),ZS()){let{width:t,height:n}=e.getSettings();this._videoWidth=t,this._videoHeight=n}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=t,this._scalabilityMode=n,this._optimizationMode=r,this._hints=o||[],-1===this._hints.indexOf(vL.SCREEN_TRACK))this.updateBitrateFromProfile();else if(function(e,t,n){let r=WS();return!(r.name!==e||!r.osVersion)&&115===Number(r.version)}(HS.CHROME)&&-1!==JS().indexOf("Windows")){let t=function(e,t){if("VideoFrame"in window&&"TransformStream"in window&&oL().supportWebRTCInsertableStream){let t,n,r=new MediaStreamTrackProcessor(e),i=new MediaStreamTrackGenerator({kind:"video"}),o=Date.now(),a=()=>{s&&(clearInterval(s),s=void 0),t&&(t.close(),t=void 0),e.stop(),n=void 0,i.removeEventListener("ended",a)},s=window.setInterval((()=>{if(n&&t&&Date.now()-o>1e3)try{"live"===i.readyState?n.enqueue(t.clone()):a()}catch{a()}}),1e3),A=new TransformStream({transform:(e,r)=>{"live"===i.readyState?(n=r,o=Date.now(),void 0===t?(t=e,r.enqueue(e.clone())):(r.enqueue(t),t=e)):e.close()}});return i.addEventListener("ended",a),r.readable.pipeThrough(A).pipeTo(i.writable),i}}(e);t&&(Ey.info("local screen video track begin to inject frame"),this._mediaStreamTrack=t)}t&&-1!==this._hints.indexOf(vL.CUSTOM_TRACK)&&this.setEncoderConfiguration(t),this._processorContext=new yk(this.getTrackId(),"local"),this._processorDestination=new vk(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){let t=document.getElementById(e);t?e=t:(Ey.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}Ey.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));let n=WL(WL(WL({},this._getDefaultPlayerConfig()),t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new bM(n):this._player=new BM(n),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{let e=this.getVideoElementVisibleStatus();this.safeEmit(OL.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch{}}),$v("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._statsTimer&&(this.isUseScaleResolutionDownBy=!1,window.clearInterval(this._statsTimer),this._statsTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,Ey.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(Ey.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await rv(this,TL.NEED_DISABLE_TRACK,this)}catch(n){throw Ey.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n.toString()),n}return t||(this._enabled=!1),void Ey.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await rv(this,TL.NEED_ENABLE_TRACK,this)}catch(n){throw Ey.error("[".concat(this.getTrackId(),"] setEnabled to true error"),n.toString()),n}Ey.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,Ey.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await rv(this,TL.NEED_MUTE_TRACK,this):await rv(this,TL.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(e,t){if(!this._enabled)throw new vT(TT.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if("720p_auto"===e?this.startMonitorStats():this._statsTimer&&(window.clearInterval(this._statsTimer),this._statsTimer=null),e=EL(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){let t=Nk({encoderConfig:e});(ZS()||tT()||hT())&&(t.deviceId=void 0),Ey.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(t));try{await this._originMediaStreamTrack.applyConstraints(t),this.updateMediaStreamTrackResolution()}catch(n){let e=new vT(TT.UNEXPECTED_ERROR,n.toString());throw Ey.error("[".concat(this.getTrackId(),"] applyConstraints error"),e.toString()),e}}this._encoderConfig=e,-1===this._hints.indexOf(vL.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await rv(this,TL.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(Ey)}}getStats(){return hv((()=>{Ey.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")}),"localVideoTrackGetStatsWarning"),iv(this,TL.GET_STATS)||WL({},PL)}async setBeautyEffect(e){Ey.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,t):await Uk(e)}async setBitrateLimit(e){if(Ey.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e){this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate);try{await rv(this,TL.NEED_UPDATE_VIDEO_ENCODER,this)}catch(t){return t.throw(Ey)}}}async setOptimizationMode(e){if("motion"!==e&&"detail"!==e&&"balanced"!==e)return void Ey.error(TT.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");let t=this._optimizationMode;try{this._optimizationMode=e,await rv(this,TL.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(n){throw this._optimizationMode=t,Ey.error("[".concat(this.getTrackId(),"] set optimization mode failed"),n.toString()),n}Ey.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(1===e.numSpatialLayers&&1!==e.numTemporalLayers)return Ey.error(TT.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,Ey.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){Bk(this._originMediaStreamTrack).then((e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t})).catch(vv)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new vT(TT.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");Ey.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=EL(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,-1===this._hints.indexOf(vL.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await rv(this,TL.NEED_UPDATE_VIDEO_ENCODER,this)}catch(t){return t.throw(Ey)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;let{width:e,height:t,frameRate:n}=this.getMediaStreamTrackSettings();if(!e||!t||!n)return;let{bitrateMax:r,bitrateMin:i}=this._encoderConfig;if(null==i||null==r){let{max:o,min:a}=function(e,t,n,r,i){let o=$v("BITRATE_ADAPTER_TYPE");if("DEFAULT_BITRATE"===o)return{min:r,max:i};if(void 0===i){var a;let s=Math.floor(200*Math.pow(n/15,.6)*Math.pow(e*t/640/360,.75));i="STANDARD_BITRATE"===o?4*s:2*s,r=null!==(a=r)&&void 0!==a?a:s}else{var s;r=null!==(s=r)&&void 0!==s?s:Math.floor(i/10)}return{min:r,max:i}}(e,t,n,i,r);this._encoderConfig.bitrateMin=a,this._encoderConfig.bitrateMax=o,Ey.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(t,", fps: ").concat(n,"] => [brMax: ").concat(o,", brMin: ").concat(a,"]"))}}getVideoElementVisibleStatus(){try{var e,t;let n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),r={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null===n||void 0===n?void 0:n.parentElement},{element:i,slot:o}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&o instanceof HTMLElement){let e=MT.checkOneElementVisible(i),t=Object.assign({},e);if(t.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=t.visible;let e=vy.reportApiInvoke(null,{tag:GT.TRACER,name:jT.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});t.visible?e.onSuccess("Video is visible"):e.onSuccess("Invisible because of ".concat(t.reason))}return t}return}catch(n){throw new vT(TT.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new vT(TT.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;let e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this._encoderConfig;t&&(r=WL(WL({},r),EL(t))),r=dv(r);let i=Sv(8,"track-video-cloned-"),o=new e(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,dv(this._scalabilityMode),this._optimizationMode,i,dv(this._hints));return t&&r&&o.setEncoderConfiguration(r),Ey.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),o}async replaceTrack(e,t){if(!(e instanceof MediaStreamTrack))throw new vT(TT.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if("video"!==e.kind)throw new vT(TT.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,t,!0),this.updateMediaStreamTrackResolution()}startMonitorStats(){if(!ZS()&&!tT())return;this._statsTimer&&window.clearInterval(this._statsTimer);let e=2,t=hL[e],n=-1,r=Date.now(),i=e=>{e>2||e<0||(r=Date.now(),t=hL[e],this.setSenderConfiguration(t))};this.isUseScaleResolutionDownBy=!0,this._statsTimer=window.setInterval((()=>{let o=this.getStats(),a=iv(this,TL.GET_RTC_STATS);if(o.sendPackets>0&&a){-1===n&&(n=Date.now());let s=Date.now();if(s-n<1e3||s-r<$v("PROFILE_SWITCH_INTERVAL"))return;let A=o.sendFrameRate,c=.6*t.frameRate,l=.9*t.frameRate;"number"==typeof A&&A>0&&A<c?e>0&&(e--,i(e),Ey.debug("[".concat(this.getTrackId(),"] step down for fps ").concat(A,", switchProfile to ").concat(e))):a.OutgoingAvailableBandwidth<t.bitrateMin?e>0&&(e--,i(e),Ey.debug("[".concat(this.getTrackId(),"] step down for OutgoingAvailableBandwidth ").concat(a.OutgoingAvailableBandwidth,", bitrateMin ").concat(t.bitrateMin,", switchProfile to ").concat(e))):"number"==typeof A&&A>l&&e<hL.length-1&&a.OutgoingAvailableBandwidth>1.2*hL[e+1].bitrateMin&&(e++,i(e),Ey.debug("[".concat(this.getTrackId(),"] step up for fps ").concat(A,", OutgoingAvailableBandwidth ").concat(a.OutgoingAvailableBandwidth,", switchProfile to ").concat(e)))}}),$v("CHECK_LOCAL_STATS_INTERVAL"))}sendSeiData(e){if(hv((()=>{vy.reportApiInvoke(null,{name:jT.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:GT.TRACER}).onSuccess("")}),this._mediaStreamTrack.id||this.getTrackId()),!$v("ENABLE_VIDEO_SEI")||!$v("ENABLE_ENCODED_TRANSFORM"))return void Ey.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e instanceof Uint8Array==0)return new vT(TT.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();let t=this.getRTCRtpTransceiver();if(!t)return void Ey.warning("Video track is not published, SEI can not be send");let n=t.sender.getParameters();if(0===n.codecs.length)return;let r=n.codecs[0].mimeType.toLocaleLowerCase();"video/h264"===r?this.safeEmit("sei-to-send",e):Ey.warning("SEI is not supported by ".concat(r))}bindProcessorDestinationEvents(){this.processorDestination.on(ML.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await rv(this,TL.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await rv(this,TL.NEED_REPLACE_TRACK,this))}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ML.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(FL.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(FL.REQUEST_CONSTRAINTS)}},JL(nF.prototype,"play",[NM,DM],Object.getOwnPropertyDescriptor(nF.prototype,"play"),nF.prototype),JL(nF.prototype,"stop",[PM],Object.getOwnPropertyDescriptor(nF.prototype,"stop"),nF.prototype),JL(nF.prototype,"setEnabled",[UM,LM,kM],Object.getOwnPropertyDescriptor(nF.prototype,"setEnabled"),nF.prototype),JL(nF.prototype,"setMuted",[MM,FM,xM],Object.getOwnPropertyDescriptor(nF.prototype,"setMuted"),nF.prototype),JL(nF.prototype,"setEncoderConfiguration",[QM,VM],Object.getOwnPropertyDescriptor(nF.prototype,"setEncoderConfiguration"),nF.prototype),JL(nF.prototype,"getStats",[HM],Object.getOwnPropertyDescriptor(nF.prototype,"getStats"),nF.prototype),JL(nF.prototype,"setBeautyEffect",[KM,jM],Object.getOwnPropertyDescriptor(nF.prototype,"setBeautyEffect"),nF.prototype),JL(nF.prototype,"getCurrentFrameData",[GM],Object.getOwnPropertyDescriptor(nF.prototype,"getCurrentFrameData"),nF.prototype),JL(nF.prototype,"getCurrentFrameImage",[WM],Object.getOwnPropertyDescriptor(nF.prototype,"getCurrentFrameImage"),nF.prototype),JL(nF.prototype,"setBitrateLimit",[YM],Object.getOwnPropertyDescriptor(nF.prototype,"setBitrateLimit"),nF.prototype),JL(nF.prototype,"setOptimizationMode",[JM],Object.getOwnPropertyDescriptor(nF.prototype,"setOptimizationMode"),nF.prototype),JL(nF.prototype,"setScalabiltyMode",[XM],Object.getOwnPropertyDescriptor(nF.prototype,"setScalabiltyMode"),nF.prototype),JL(nF.prototype,"updateMediaStreamTrackResolution",[zM],Object.getOwnPropertyDescriptor(nF.prototype,"updateMediaStreamTrackResolution"),nF.prototype),JL(nF.prototype,"pipe",[qM],Object.getOwnPropertyDescriptor(nF.prototype,"pipe"),nF.prototype),JL(nF.prototype,"unpipe",[ZM],Object.getOwnPropertyDescriptor(nF.prototype,"unpipe"),nF.prototype),JL(nF.prototype,"close",[$M],Object.getOwnPropertyDescriptor(nF.prototype,"close"),nF.prototype),JL(nF.prototype,"replaceTrack",[eF],Object.getOwnPropertyDescriptor(nF.prototype,"replaceTrack"),nF.prototype),JL(nF.prototype,"startMonitorStats",[tF],Object.getOwnPropertyDescriptor(nF.prototype,"startMonitorStats"),nF.prototype),nF),hF=(rF=Ty({argsMap:(e,t)=>[e.getTrackId(),t]}),iF=Tk(),oF=Lv("CameraVideoTrack","_enabledMutex"),aF=Ty({argsMap:(e,t)=>[e.getTrackId(),t]}),sF=Tk(),AF=Ty({argsMap:(e,t)=>[e.getTrackId(),t]}),cF=Tk(),lF=Ty({argsMap:e=>[e.getTrackId()]}),dF=class e extends uF{get __className__(){return"CameraVideoTrack"}constructor(e,t,n,r,i,o){super(e,EL(t.encoderConfig),r,i,o),YL(this,"_config",void 0),YL(this,"_originalConstraints",void 0),YL(this,"_constraints",void 0),YL(this,"_enabled",!0),YL(this,"_deviceName","default"),YL(this,"tryResumeVideoForIOS15_16WeChat",(async()=>{(lT()||dT())&&!function(){let e=WS();if(e.os!==VS.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=2}()&&pT()&&this._enabled&&!this._isClosed&&(Ey.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())})),this._config=t,this._originalConstraints=n,this._constraints=n,this._deviceName=e.label,this._encoderConfig=EL(this._config.encoderConfig),$L.on(sL.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),$L.on(sL.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return"string"==typeof e?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(Ey.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{let n=await Ek.getDeviceById(e),r={};r.video=WL({},this._constraints),r.video.deviceId={exact:e},r.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i=null;try{i=await uk(r,this.getTrackId())}catch(t){throw Ey.error("[".concat(this.getTrackId(),"] setDevice failed"),t.toString()),i=await uk({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),t}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw Ey.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{let t=await Ek.getDeviceById(e);this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw Ey.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}Ey.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){Ey.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));let t={video:WL(WL({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let e=null;try{e=await uk(t,this.getTrackId())}catch(n){throw Ey.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),n.toString()),e=await uk({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1),n}await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=WL({},t.video),Ey.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(Ey.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{let e=await uk({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1)}await rv(this,TL.NEED_ENABLE_TRACK,this)}catch(n){throw Ey.error("[".concat(this.getTrackId(),"] setEnabled true error"),n.toString()),n}this.updateMediaStreamTrackResolution(),Ey.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),t||(this._enabled=!1);try{await rv(this,TL.NEED_DISABLE_TRACK,this)}catch(n){throw Ey.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n.toString()),n}Ey.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new vT(TT.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");"720p_auto"===e?this.startMonitorStats():this._statsTimer&&(window.clearInterval(this._statsTimer),this._statsTimer=null),e=EL(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate||e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate||e.bitrateMin);let n=lv(this._config);n.encoderConfig=e;let r=Nk(n);(ZS()||tT()||hT())&&(r.deviceId=void 0),Ey.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(i){let e=new vT(TT.UNEXPECTED_ERROR,i.toString());throw Ey.error("[".concat(this.getTrackId(),"] applyConstraints error"),e.toString()),e}this._config=n,this._constraints=r,this._originalConstraints=r,this._encoderConfig=e,-1===this._hints.indexOf(vL.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await rv(this,TL.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(Ey)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((tT()||hT())&&this._enabled&&!this._isClosed&&$L.duringInterruption){let e=async()=>{$L.off(sL.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(Ey.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};$L.on(sL.IOS_INTERRUPTION_END,e)}else Ey.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(OL.TRACK_ENDED)}async renewMediaStreamTrack(e){let t=e||this._constraints,n=Ek.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId={exact:n}),this._enabled){let e=await uk({video:t},this.getTrackId());this._constraints=t,await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),$L.off(sL.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),$L.off(sL.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this._encoderConfig;t&&(r=WL(WL({},r),EL(t))),r=dv(r);let i=Sv(8,"track-cam-cloned-"),o=new e(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,dv(WL(WL({},this._config),{},{encoderConfig:r})),dv(this._constraints),dv(this._scalabilityMode),this._optimizationMode,i);return t&&r&&o.setEncoderConfiguration(r),Ey.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),o}bindProcessorContextEvents(){this.processorContext.on(FL.REQUEST_UPDATE_CONSTRAINTS,(async(e,t,n)=>{try{let n=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(n),t()}catch(r){n(r)}})),this.processorContext.on(FL.REQUEST_CONSTRAINTS,(async e=>{e(this._originMediaStreamTrack.getSettings())}))}},JL(dF.prototype,"setDevice",[rF,iF],Object.getOwnPropertyDescriptor(dF.prototype,"setDevice"),dF.prototype),JL(dF.prototype,"setEnabled",[oF,aF,sF],Object.getOwnPropertyDescriptor(dF.prototype,"setEnabled"),dF.prototype),JL(dF.prototype,"setEncoderConfiguration",[AF,cF],Object.getOwnPropertyDescriptor(dF.prototype,"setEncoderConfiguration"),dF.prototype),JL(dF.prototype,"close",[lF],Object.getOwnPropertyDescriptor(dF.prototype,"close"),dF.prototype),dF);function pF(e,t,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=WL(WL({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),"motion"!==n.optimizationMode&&"detail"!==n.optimizationMode||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?Ey.debug("[".concat(e,"] set content hint to"),n.optimizationMode):Ey.debug("[".concat(e,"] set content hint failed")))):Ey.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var fF,EF,gF,mF,_F,CF,wF,SF,TF,vF,yF,IF;class RF extends XL{getUserId(){return this._userId}constructor(e,t,n,r){super(e,"track-".concat(e.kind,"-").concat(t,"-").concat(r.clientId,"_").concat(Sv(5,""))),YL(this,"_userId",void 0),YL(this,"_uintId",void 0),YL(this,"_isDestroyed",!1),YL(this,"store",void 0),YL(this,"processor",void 0),YL(this,"processorContext",void 0),this._userId=t,this._uintId=n,this.store=r}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,Ey.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let bF=(fF=Ty({argsMap:(e,t,n)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),EF=Ty({argsMap:e=>[e.getTrackId()]}),gF=Ty({argsMap:(e,t)=>[e.getTrackId(),t.name]}),mF=Ty({argsMap:e=>[e.getTrackId()]}),JL((_F=class extends RF{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==VL.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,r){super(e,t,n,r),YL(this,"_videoVisibleTimer",null),YL(this,"_previousVideoVisibleStatus",void 0),YL(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),YL(this,"trackMediaType","video"),YL(this,"_videoWidth",void 0),YL(this,"_videoHeight",void 0),YL(this,"_player",void 0),YL(this,"processorDestination",void 0),YL(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new yk(this.getTrackId(),"remote"),this.processorDestination=new vk(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return hv((()=>{Ey.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")}),"remoteVideoTrackGetStatsWarning"),iv(this,TL.GET_STATS)||WL({},kL)}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){let t=document.getElementById(e);t?e=t:(Ey.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}Ey.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));let n=WL(WL({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new bM(n):this._player=new BM(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(BL.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=e=>{this.safeEmit(BL.VIDEO_STATE_CHANGED,e)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{let e=this.getVideoElementVisibleStatus();this.safeEmit(BL.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch{}}),$v("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,Ey.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){Bk(this._originMediaStreamTrack).then((e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t})).catch(vv)}_updatePlayerSource(){Ey.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;let n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),r={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null===n||void 0===n?void 0:n.parentElement},{element:i,slot:o}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&o instanceof HTMLElement){let e=MT.checkOneElementVisible(i),t=Object.assign({},e);if(t.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=t.visible;let e=vy.reportApiInvoke(null,{tag:GT.TRACER,name:jT.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});t.visible?e.onSuccess("Video is visible"):e.onSuccess("Invisible because of ".concat(t.reason))}return t}return}catch(n){throw new vT(TT.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new vT(TT.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;let e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ML.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ML.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(bL.SEI_RECEIVED,e)}}).prototype,"play",[fF],Object.getOwnPropertyDescriptor(_F.prototype,"play"),_F.prototype),JL(_F.prototype,"stop",[EF],Object.getOwnPropertyDescriptor(_F.prototype,"stop"),_F.prototype),JL(_F.prototype,"pipe",[gF],Object.getOwnPropertyDescriptor(_F.prototype,"pipe"),_F.prototype),JL(_F.prototype,"unpipe",[mF],Object.getOwnPropertyDescriptor(_F.prototype,"unpipe"),_F.prototype),_F),OF=(CF=Ty({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),wF=Ty({argsMap:(e,t)=>[e.getTrackId(),t]}),SF=Ty({argsMap:e=>[e.getTrackId()]}),TF=Ty({argsMap:e=>[e.getTrackId()]}),vF=Ty({argsMap:(e,t)=>[e.getTrackId(),t.name]}),yF=Ty({argsMap:e=>[e.getTrackId()]}),JL((IF=class extends RF{get isPlaying(){return this._useAudioElement?Sk.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,r){super(e,t,n,r),YL(this,"trackMediaType","audio"),YL(this,"_source",void 0),YL(this,"_useAudioElement",!0),YL(this,"_volume",100),YL(this,"processorContext",void 0),YL(this,"processorDestination",void 0),YL(this,"_played",!1),YL(this,"_bypassWebAudio",!1),$v("DISABLE_WEBAUDIO")?(this._source=new bk,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new ak(e,!0),$v("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(NL.RECEIVE_TRACK_BUFFER,(()=>{this.safeEmit(BL.FIRST_FRAME_DECODED)})),this.processorContext=new Rk(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new Ik(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(NL.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})}))}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(NL.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(NL.ON_AUDIO_BUFFER),this._source.on(NL.ON_AUDIO_BUFFER,(t=>e(t)))}setVolume(e){this._volume=e,this._useAudioElement?Sk.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!aL())throw new vT(TT.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Sk.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return hv((()=>{Ey.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")}),"remoteAudioTrackGetStatsWarning"),iv(this,TL.GET_STATS)||WL({},UL)}play(){Ey.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(Ey.debug("[".concat(this.getTrackId(),"] use audio element to play")),Sk.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){Ey.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Sk.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Ey.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Sk.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new vT(TT.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new vT(TT.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new vT(TT.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;let t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ML.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})),this.processorDestination.on(ML.ON_NODE,(e=>{this._source.processedNode=e;let t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ML.ON_TRACK),this.processorDestination.removeAllListeners(ML.ON_NODE)}}).prototype,"setVolume",[CF],Object.getOwnPropertyDescriptor(IF.prototype,"setVolume"),IF.prototype),JL(IF.prototype,"setPlaybackDevice",[wF],Object.getOwnPropertyDescriptor(IF.prototype,"setPlaybackDevice"),IF.prototype),JL(IF.prototype,"play",[SF],Object.getOwnPropertyDescriptor(IF.prototype,"play"),IF.prototype),JL(IF.prototype,"stop",[TF],Object.getOwnPropertyDescriptor(IF.prototype,"stop"),IF.prototype),JL(IF.prototype,"pipe",[vF],Object.getOwnPropertyDescriptor(IF.prototype,"pipe"),IF.prototype),JL(IF.prototype,"unpipe",[yF],Object.getOwnPropertyDescriptor(IF.prototype,"unpipe"),IF.prototype),IF),BF=new class extends VT{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),YL(this,"_lastHiddenTime",0),YL(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),Ey.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)}))}};var NF=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(NF||{});class DF{constructor(){YL(this,"_sequence",0),YL(this,"_startTime",Date.now()),YL(this,"isUseOneByte",!0)}get startTime(){let e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){let t={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){let n=new Uint8Array(4);n.set([1,0,0,0]);let r={id:0,length:4,data:n.buffer},i={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[r]};t.commonPacketHeader.extension=1,t.extension=i,t.payload=this.compress(e),t.commonPacketHeader.length=8+(t.extension.length+2)+t.payload.byteLength}else t.commonPacketHeader.length=8+t.payload.byteLength;$v("SHOW_DATASTREAM2_LOG")&&Ey.debug("send data header: ".concat(JSON.stringify(t.commonPacketHeader)));let n=new ArrayBuffer(t.commonPacketHeader.length),r=new Uint8Array(n),i=new DataView(n),o=0;if(i.setUint16(o,t.commonPacketHeader.extension<<15|t.commonPacketHeader.reserved<<14|t.commonPacketHeader.length,!0),o+=2,i.setUint32(o,t.commonPacketHeader.sequence,!0),o+=4,i.setUint16(o,t.commonStreamHeader,!0),o+=2,t.extension){let e=this.serializeExtension(t.extension);r.set(new Uint8Array(e),o),o+=e.byteLength}if(r.set(new Uint8Array(t.payload),o),o+=t.payload.byteLength,o!==t.commonPacketHeader.length)throw Error("serialize error!");return n}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);let t=new DataView(e),n=0,r=t.getUint16(n,!0);n+=2;let i,o,a={length:16383&r,reserved:(16384&r)>>14,extension:(32768&r)>>15,sequence:t.getUint16(n+2,!0)<<16|t.getUint16(n,!0)};if(n+=4,$v("SHOW_DATASTREAM2_LOG")&&Ey.debug("receive data header: ".concat(JSON.stringify(a))),t.getUint16(n,!0),n+=2,a.extension){o=this.deserializeExtension(e.slice(n)),n+=2+o.length,i=e.slice(n);let t=!1;if(o.datas.length>0){let e=o.datas.find((e=>0===e.id));e&&(t=1==(1&new DataView(e.data).getUint32(0,!0)))}i=t?this.decompress(i):i}else i=e.slice(8);return i}serializeExtension(e){let{profile:t,length:n,datas:r}=e,i=new ArrayBuffer(n+2),o=new Uint8Array(i),a=new DataView(i),s=0;if(a.setUint8(s++,t),a.setUint8(s++,n),r.forEach((e=>{t?(a.setUint8(s++,e.id),a.setUint8(s++,e.length),o.set(new Uint8Array(e.data),s),s+=e.data.byteLength):(a.setUint8(s++,e.id|e.length<<4),o.set(new Uint8Array(e.data),s),s+=e.data.byteLength)})),s!==n+2)throw Error("serialize extension error, is ".concat(s,"!==").concat(n+2));return i}deserializeExtension(e){let t=new DataView(e),n=0,r=t.getUint8(n);n++;let i=t.getUint8(n);n++;let o=r===NF.TWO_BYTE,a=[],s=new DataView(e,2),A=0;for(;A<i;){let e=0,t=0,n=new ArrayBuffer(0);o?(e=s.getUint8(A),A++,t=s.getUint8(A),A++):(e=15&s.getUint8(A),t=s.getUint8(A)>>4,A++),t>0&&(n=s.buffer.slice(A+2,A+2+t),A+=n.byteLength),a.push({id:e,length:t,data:n})}if(A!==i)throw Error("parse error");return{profile:r,length:i,datas:a}}decompress(e){return rL(new Uint8Array(e))}compress(e){return nL(new Uint8Array(e))}}class PF extends VT{constructor(e,t){super(),YL(this,"_version",1),YL(this,"_type",3),YL(this,"_config",void 0),YL(this,"_originDataChannel",void 0),YL(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),YL(this,"_dataStreamPacketHandler",void 0),YL(this,"_datachannelEventMap",new Map),this._config=e,t&&(this._originDataChannel=t,this._bandDataChannelEvents(t)),this._initPacketHeader(),this._dataStreamPacketHandler=new DF}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return $v("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,t;return null!==(e=null===(t=this._originDataChannel)||void 0===t?void 0:t.readyState)&&void 0!==e?e:"connecting"}get _originDataChannelId(){var e,t;return null!==(e=null===(t=this._originDataChannel)||void 0===t?void 0:t.id)&&void 0!==e?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new wu(((e,t)=>{if(this._originDataChannel){"open"===this._originDataChannel.readyState&&e();let n=setTimeout((()=>{var e;t(new vT(TT.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat(null===(e=this._originDataChannel)||void 0===e?void 0:e.id)))}),1e4);this._originDataChannel.onopen=()=>{clearTimeout(n),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(n),new vT(TT.DATACHANNEL_CONNECTION_TIMEOUT)}}else t(new vT(TT.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))}))}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){let e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[jL.OPEN,jL.CLOSE,jL.ERROR].forEach((t=>{let n=()=>{this.emit(t)};this._datachannelEventMap.set(t,n),e.addEventListener(t,n)}))}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach((t=>{let[n,r]=t;e.removeEventListener(n,r)})),this._datachannelEventMap.clear()}}class UF extends PF{constructor(e){super(e),YL(this,"_messageListener",void 0),this._messageListener=e=>{if(e.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);let t=e.data.slice(0,this._dataStreamPacketHeader.byteLength),n=new DataView(t).getUint8(3);if(n!==this.id)return void($v("SHOW_DATASTREAM2_LOG")&&Ey.debug("invalid datachannel id: ".concat(n," !== ").concat(this.id)));let r=e.data.slice(this._dataStreamPacketHeader.byteLength);r=this._dataStreamPacketHandler.deserialize(r),this.emit(jL.MESSAGE,r)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class LF extends PF{send(e){if(this._originDataChannel){let t=e;t=this._dataStreamPacketHandler.serialize(e);let n=new Uint8Array(this._dataStreamPacketHeader.byteLength+t.byteLength);n.set(new Uint8Array(this._dataStreamPacketHeader),0),n.set(new Uint8Array(t),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(n.buffer)}}}function kF(){let e=new Blob([atob("ZnVuY3Rpb24gZShlKXtjb25zdCB0PW5ldyBEYXRhVmlldyhlLmRhdGEpO2lmKDA9PT10LmdldFVpbnQ4KDApJiYwPT09dC5nZXRVaW50OCgxKSYmMD09PXQuZ2V0VWludDgoMikmJjE9PT10LmdldFVpbnQ4KDMpJiY2PT09dC5nZXRVaW50OCg0KSl7bGV0IG49NixyPTAsbz0wO2Zvcig7MjU1PT09KG89dC5nZXRVaW50OChuKyspKTspcis9MjU1O3IrPW87Y29uc3QgYT1mdW5jdGlvbihlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLG89W10sYT0wO2Zvcig7YTxuOylhKzM8biYmMD09PXJbYV0mJjA9PT1yW2ErMV0mJjM9PT1yW2ErMl0mJigwPT09clthKzNdfHwxPT09clthKzNdfHwyPT09clthKzNdfHwzPT09clthKzNdKT8oby5wdXNoKHJbYV0sclthKzFdLHJbYSszXSksYSs9NCk6KG8ucHVzaChyW2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShvKX0oZS5kYXRhLG4scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGEpfXJldHVybiBudWxsfWZ1bmN0aW9uIHQoZSx0KXtjb25zdCBuPWZ1bmN0aW9uKGUpe2NvbnN0IHQ9ZS5sZW5ndGg7bGV0IG49W10scj0wO2Zvcig7cjx0OylyKzI8dCYmMD09PWVbcl0mJjA9PT1lW3IrMV0mJigwPT09ZVtyKzJdfHwxPT09ZVtyKzJdfHwyPT09ZVtyKzJdfHwzPT09ZVtyKzJdKT8obi5wdXNoKGVbcl0sZVtyKzFdLDMsZVtyKzJdKSxyKz0zKToobi5wdXNoKGVbcl0pLHIrKyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KG4pfSh0KSxyPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihyLzI1NSksYT1yJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK3IrZS5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBpPTA7Zm9yKDtpPG87KXNbNitpXT0yNTUsaSsrO3JldHVybiBzWzYraV09YSxpKysscy5zZXQobiw2K2kpLHMuc2V0KG5ldyBVaW50OEFycmF5KGUpLDYraStyKSxzLmJ1ZmZlcn1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIlNhZmFyaSIpPi0xJiYtMT09PW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiQ2hyb21lIikmJihzZWxmLm9ucnRjdHJhbnNmb3JtPW49Pntjb25zdCByPW4udHJhbnNmb3JtZXI7bGV0IG89W107ci5vcHRpb25zLnBvcnQub25tZXNzYWdlPWU9PntlLmRhdGEuc2VpJiZvLnB1c2goZS5kYXRhLnNlaSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBhPXIucmVhZGFibGUuZ2V0UmVhZGVyKCkscz1yLndyaXRhYmxlLmdldFdyaXRlcigpOyJyeCI9PT1yLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2EucmVhZCgpLnRoZW4oKHI9PntpZighci5kb25lKXtpZihyLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7YS5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1vLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout((()=>jN.revokeObjectURL(e)),0),new Worker(jN.createObjectURL(e))}let MF=new Map,FF=new Map,xF=new Map,QF=new Map;!function(){let e=WS();iL.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),iL.getStreamFromExtension=e.name===HS.CHROME&&Number(e.version)>34,iL.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let e=new RTCPeerConnection,t=!1;try{e.addTransceiver("audio"),t=!0}catch{}return e.close(),t}(),iL.supportMinBitrate=e.name===HS.CHROME||e.name===HS.EDGE,iL.supportSetRtpSenderParameters=function(){let e=WS();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!gT()||!(!ZS()&&!zS())||e.name===HS.FIREFOX&&Number(e.version)>=64)}(),e.name===HS.SAFARI&&(Number(e.version)>=14?iL.supportDualStream=!0:iL.supportDualStream=!1),iL.webAudioMediaStreamDest=function(){let e=WS();return!(e.name===HS.SAFARI&&Number(e.version)<12)}(),iL.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,iL.supportWebGL=typeof WebGLRenderingContext<"u",iL.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,gT()||(iL.webAudioWithAEC=!0),iL.supportShareAudio=function(){let e=WS();return(e.os===VS.WIN_10||e.os===VS.WIN_81||e.os===VS.WIN_7||e.os===VS.LINUX||e.os===VS.MAC_OS||e.os===VS.CHROMIUM_OS)&&e.name===HS.CHROME&&Number(e.version)>=74}(),iL.supportDataChannel=!!(nT(76)||function(e){let t=WS();return!(t.name!==HS.FIREFOX||!t.osVersion)&&Number(t.version)>=68}()||iT(14)),iL.supportPCSetConfiguration=function(){let e=window.RTCPeerConnection;return!eT()&&!!e&&e.prototype.setConfiguration instanceof Function}(),iL.supportWebRTCEncodedTransform=function(){let e=WS();return"Chrome"===e.name&&Number(e.version)>=86||"Safari"===e.name&&Number(e.version)>=15}(),iL.supportWebRTCInsertableStream=function(){let e=WS();return(e.name===HS.CHROME||e.name===HS.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),iL.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,iL.supportWebCrypto=typeof window<"u"&&void 0!==window.crypto&&void 0!==window.crypto.subtle,cv((()=>{iL.supportDualStreamEncoding=function(){let e=WS();return!!$v("DISABLE_WEBAUDIO")||"Safari"===e.name&&Number(e.version)>=14||!!("Chrome"===e.name&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&$v("CHROME_DUAL_STREAM_USE_ENCODING"))}(),Ey.info("browser compatibility",JSON.stringify(iL),JSON.stringify(e))}))}();class VF extends VT{constructor(){super(...arguments),O_(this,"resultStorage",new Map)}setLocalAudioStats(e,t,n){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(n,t)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(n,t))}setLocalVideoStats(e,t,n){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(n,t)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(n,t)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(n))}setRemoteAudioStats(e,t){let n=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",n,this.checkAudioOutputLevel(t))}setRemoteVideoStats(e,t){let n=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",n,this.checkVideoDecode(t))}record(e,t,n){if($v("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});let r=this.resultStorage.get(e);if(r&&(r.result.push(n),r.result.length>=5)){var i;let n=yr(i=r.result).call(i,!0);r.isPrevNormal&&!n&&this.emit("exception",HF[e],e,t),!r.isPrevNormal&&n&&this.emit("exception",HF[e]+2e3,e+"_RECOVER",t),r.isPrevNormal=n,r.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&0===e.receiveLevel)}checkAudioInputLevel(e,t){return t instanceof yM&&!t.isActive||!!t.muted||0!==e.sendVolumeLevel}checkFramerateInput(e,t){let n=null;t._encoderConfig&&t._encoderConfig.frameRate&&(n=sb(t._encoderConfig.frameRate));let r=e.captureFrameRate;return!n||!r||!(n>10&&r<5||n<10&&n>=5&&r<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checkSendVideoBitrate(e,t){return!!t.muted||0!==e.sendBitrate}checkSendAudioBitrate(e,t){return t instanceof yM&&!t.isActive||!!t.muted||0!==e.sendBitrate}checkVideoDecode(e){return 0===e.receiveBitrate||0!==e.decodeFrameRate}}let HF={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},KF=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){let n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){let e=n[n.length-1];return Math.round(performance.now()-e.startTime)}return 0}measureFromPublishStart(e,t){let n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){let e=n[n.length-1];return Math.round(performance.now()-e.startTime)}return 0}};function jF(e,t){this.v=e,this.k=t}function GF(e){return new jF(e,0)}var WF=Cu,YF=rl;In({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=YF.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var JF=rl,XF=Fc;In({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=JF.f(this),n=XF(e);return(n.error?t.reject:t.resolve)(n.value),t.promise}});var zF=t(WF),qF=BE.f("asyncIterator"),ZF=t(qF);function $F(e){var t,n;function r(t,n){try{var o=e[t](n),a=o.value,s=a instanceof jF;zF.resolve(s?a.v:a).then((function(n){if(s){var A="return"===t?"return":"next";if(!a.k||n.done)return r(A,n);n=e[A](n).value}i(o.done?"return":"normal",n)}),(function(e){r("throw",e)}))}catch(A){i("throw",A)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,i){return new zF((function(o,a){var s={key:e,arg:i,resolve:o,reject:a,next:null};n?n=n.next=s:(t=n=s,r(e,i))}))},"function"!=typeof e.return&&(this.return=void 0)}function ex(e){return function(){return new $F(e.apply(this,arguments))}}$F.prototype["function"==typeof y_&&ZF||"@@asyncIterator"]=function(){return this},$F.prototype.next=function(e){return this._invoke("next",e)},$F.prototype.throw=function(e){return this._invoke("throw",e)},$F.prototype.return=function(e){return this._invoke("return",e)};var tx=t(te.Object.getOwnPropertySymbols),nx=In,rx=Gn.indexOf,ix=Ur,ox=T([].indexOf),ax=!!ox&&1/ox([1],1,-0)<0;nx({target:"Array",proto:!0,forced:ax||!ix("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return ax?ox(this,e,t)||0:rx(this,e,t)}});var sx=Jn("Array").indexOf,Ax=c,cx=sx,lx=Array.prototype,dx=t((function(e){var t=e.indexOf;return e===lx||Ax(lx,e)&&t===lx.indexOf?cx:t})),ux={exports:{}};!function(e,t){e.exports=(()=>{var e={8:(e,t,n)=>{n.r(t),n.d(t,{Parser:()=>T,Printer:()=>b,parse:()=>D,print:()=>P});let r,i="\n",o="".concat("\r").concat(i),a=" ";function s(e){return e>="0"&&e<="9"}function A(e){return e>="!"&&e<="~"}function c(e){return A(e)||e>="\x80"&&e<="\xff"}function l(e){return"!"===e||e>="#"&&e<="'"||e>="*"&&e<="+"||e>="-"&&e<="."||e>="0"&&e<="9"||e>="A"&&e<="Z"||e>="^"&&e<="~"}function d(e){return e>="1"&&e<="9"}function u(e){return e>="A"&&e<="Z"||e>="a"&&e<="z"}function h(e){return"d"===e||"h"===e||"m"===e||"s"===e}function p(e){return e>"\x01"&&e<"\t"||e>"\v"&&e<"\f"||e>"\x0e"&&e<"\xff"}function f(e){return u(e)||s(e)||"+"===e||"/"===e}function E(e){return s(e)||u(e)||"+"===e||"/"===e||"-"===e||"_"===e}function g(e){return u(e)||s(e)||"+"===e||"/"===e}function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){C(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var w;(w=r||(r={})).VERSION="v",w.ORIGIN="o",w.SESSION_NAME="s",w.INFORMATION="i",w.URI="u",w.EMAIL="e",w.PHONE="p",w.CONNECTION="c",w.BANDWIDTH="b",w.TIME="t",w.REPEAT="r",w.ZONE_ADJUSTMENTS="z",w.KEY="k",w.ATTRIBUTE="a",w.MEDIA="m";class S{consumeText(e,t){let n=t;for(;n<e.length;){let t=e[n];if("\0"===t||"\r"===t||t===i)break;n+=1}if(n-t==0)throw new Error("Invalid text, at ".concat(e));return n}consumeUnicastAddress(e,t,n){return this.consumeTill(e,t,a)}consumeOneOrMore(e,t,n){let r=t;for(;n(e[r]);)r++;if(r-t==0)throw new Error("Invalid rule at ".concat(t,"."));return r}consumeSpace(e,t){if(e[t]===a)return t+1;throw new Error("Invalid space at ".concat(t,"."))}consumeIP4Address(e,t){let n=t;for(let r=0;r<4;r++)if(n=this.consumeDecimalUChar(e,n),3!==r){if("."!==e[n])throw new Error("Invalid IP4 address.");n++}return n}consumeDecimalUChar(e,t){let n=t;for(let i=0;i<3&&s(e[n]);i++,n++);if(n-t==0)throw new Error("Invalid decimal uchar.");let r=parseInt(e.slice(t,n));if(r>=0&&r<=255)return n;throw new Error("Invalid decimal uchar")}consumeIP6Address(e,t){let n=this.consumeHexpart(e,t);return":"===e[n]&&(n+=1,n=this.consumeIP4Address(e,n)),n}consumeHexpart(e,t){let n=t;if(":"===e[n]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch{}return n}if(n=this.consumeHexseq(e,n),":"===e[n]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch{}return n}return n}consumeHexseq(e,t){let n=t;for(;n=this.consumeHex4(e,n),":"===e[n]&&":"!==e[n+1];)n+=1;return n}consumeHex4(e,t){let n=0;for(;n<4;n++)if(!((r=e[t+n])>="0"&&r<="9"||r>="a"&&r<="f"||r>="A"&&r<="F")){if(0===n)throw new Error("Invalid hex 4");break}var r;return t+n}consumeFQDN(e,t){let n=t;for(;s(e[n])||u(e[n])||"-"===e[n]||"."===e[n];)n+=1;if(n-t<4)throw new Error("Invalid FQDN");return n}consumeExtnAddr(e,t){return this.consumeOneOrMore(e,t,c)}consumeMulticastAddress(e,t,n){switch(n){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(e,t);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(e,t);default:try{return this.consumeFQDN(e,t)}catch{return this.consumeExtnAddr(e,t)}}}consumeIP6MulticastAddress(e,t){let n=this.consumeHexpart(e,t);return"/"===e[n]?this.consumeInteger(e,n+1):n}consumeIP4MulticastAddress(e,t){let n=t+3,r=e.slice(t,n),i=parseInt(r);if(i<224||i>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let o=0;o<3;o++){if("."!==e[n])throw new Error("Invalid IP4 multicast address.");n+=1,n=this.consumeDecimalUChar(e,n)}return"/"===e[n]&&(n+=1),n=this.consumeTTL(e,n),"/"===e[n]&&(n=this.consumeInteger(e,n)),n}consumeInteger(e,t){if(!d(e[t]))throw new Error("Invalid integer.");for(t+=1;s(e[t]);)t+=1;return t}consumeTTL(e,t){if("0"===e[t])return t+1;if(!d(e[t]))throw new Error("Invalid TTL.");t+=1;for(let n=0;n<2&&s(e[t]);n++)t+=1;return t}consumeToken(e,t){return this.consumeOneOrMore(e,t,l)}consumeTime(e,t){let n=t;if("0"===e[n])return n+1;for(d(e[n])&&(n+=1);s(e[n]);)n++;if(n-t<10)throw new Error("Invalid time");return n}consumeAddress(e,t){return this.consumeTill(e,t,a)}consumeTypedTime(e,t){let n=t;return n=this.consumeOneOrMore(e,n,s),h(e[n])?n+1:n}consumeRepeatInterval(e,t){if(!d(e[t]))throw new Error("Invalid repeat interval");for(t+=1;s(e[t]);)t+=1;return h(e[t])&&(t+=1),t}consumePort(e,t){return this.consumeOneOrMore(e,t,s)}consume(e,t,n){for(let r=0;r<n.length;r++){if(t+r>=e.length)throw new Error("consume exceeding value length");if(e[t+r]!==n[r])throw new Error("consume ".concat(n," failed at ").concat(r))}return t+n.length}consumeTill(e,t,n){let r=t;for(;r<e.length&&("string"!=typeof n||e[r]!==n)&&("function"!=typeof n||!n(e[r]));)r++;return r}}class T extends S{constructor(){super(),C(this,"records",[]),C(this,"currentLine",0)}parse(e){let t=this.probeEOL(e);this.records=e.split(t).filter((e=>!!_h(e).call(e))).map(this.parseLine),this.currentLine=0;let n=this.parseVersion(),r=this.parseOrigin(),i=this.parseSessionName(),o=this.parseInformation(),a=this.parseUri(),s=this.parseEmail(),A=this.parsePhone(),c=this.parseConnection(),l=this.parseBandWidth(),d=this.parseTimeFields(),u=this.parseKey(),h=this.parseSessionAttribute(),p=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:n,origin:r,sessionName:i,information:o,uri:a,emails:s,phones:A,connection:c,bandwidths:l,timeFields:d,key:u,attributes:h,mediaDescriptions:p}}getCurrentRecord(){let e=this.records[this.currentLine];if(!e)throw new Error("Record doesn't exit.");return e}probeEOL(e){for(let t=0;t<e.length;t++)if(e[t]===i)return"\r"===e[t-1]?o:i;throw new Error("Invalid newline character.")}parseLine(e,t){if(e.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");let n=e[0];if("="!==e[1])throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:n,value:e.slice(2),line:t,cur:0}}parseSessionAttribute(){let e=new y;for(;this.currentLine<this.records.length;){let t=this.getCurrentRecord();if(t.type!==r.ATTRIBUTE)break;let n={attField:this.extractOneOrMore(t,(e=>l(e)&&":"!==e)),_cur:0};":"===t.value[t.cur]&&(t.cur+=1,n.attValue=this.extractOneOrMore(t,p)),e.parse(n),this.currentLine++}return e.digest()}parseMediaAttributes(e){let t=new I(e);for(;this.currentLine<this.records.length;){let e=this.getCurrentRecord();if(e.type!==r.ATTRIBUTE)break;let n={attField:this.extractOneOrMore(e,(e=>l(e)&&":"!==e)),_cur:0};":"===e.value[e.cur]&&(e.cur+=1,n.attValue=this.extractOneOrMore(e,p)),t.parse(n),this.currentLine++}return t.digest()}parseKey(){let e=this.getCurrentRecord();if(e.type===r.KEY){if("prompt"===e.value||"clear:"===e.value||"base64:"===e.value||"uri:"===e.value)return e.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){let e=this.getCurrentRecord();if(e.type===r.ZONE_ADJUSTMENTS){let t=[];for(;;)try{let n=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);let r=!1;"-"===e.value[e.cur]&&(r=!0,e.cur+=1);let i=this.extract(e,this.consumeTypedTime);t.push({time:n,typedTime:i,back:r})}catch{break}if(0===t.length)throw new Error("Invalid zone adjustments");return this.currentLine++,t}return[]}parseRepeat(){let e=[];for(;;){let t=this.getCurrentRecord();if(t.type!==r.REPEAT)break;{let n=this.extract(t,this.consumeRepeatInterval),r=this.parseTypedTime(t);e.push({repeatInterval:n,typedTimes:r}),this.currentLine++}}return e}parseTypedTime(e){let t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeTypedTime))}catch{break}if(0===t.length)throw new Error("Invalid typed time.");return t}parseTime(){let e=this.getCurrentRecord(),t=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);let n=this.extract(e,this.consumeTime);return this.currentLine++,{startTime:t,stopTime:n}}parseBandWidth(){let e=[];for(;this.currentLine<this.records.length;){let t=this.getCurrentRecord();if(t.type!==r.BANDWIDTH)break;{let n=this.extractOneOrMore(t,l);if(":"!==t.value[t.cur])throw new Error("Invalid bandwidth field.");t.cur++;let r=this.extractOneOrMore(t,s);e.push({bwtype:n,bandwidth:r}),this.currentLine++}}return e}parseVersion(){let e=this.getCurrentRecord();if(e.type!==r.VERSION)throw new Error("first sdp record must be version");let t=e.value.slice(0,this.consumeOneOrMore(e.value,0,s));if(t.length!==e.value.length)throw new Error('invalid proto version, "v='.concat(e.value,'"'));return this.currentLine++,t}parseOrigin(){let e=this.getCurrentRecord();if(e.type!==r.ORIGIN)throw new Error("second line of sdp must be origin");let t=this.extractOneOrMore(e,c);this.consumeSpaceForRecord(e);let n=this.extractOneOrMore(e,s);this.consumeSpaceForRecord(e);let i=this.extractOneOrMore(e,s);this.consumeSpaceForRecord(e);let o=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);let a=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);let A=this.extract(e,this.consumeUnicastAddress);return this.currentLine++,{username:t,sessId:n,sessVersion:i,nettype:o,addrtype:a,unicastAddress:A}}parseSessionName(){let e=this.getCurrentRecord();if(e.type===r.SESSION_NAME){let t=this.extract(e,this.consumeText);return this.currentLine++,t}}parseInformation(){let e=this.getCurrentRecord();if(e.type!==r.INFORMATION)return;let t=this.extract(e,this.consumeText);return this.currentLine++,t}parseUri(){let e=this.getCurrentRecord();if(e.type===r.URI)return this.currentLine++,e.value}parseEmail(){let e=[];for(;;){let t=this.getCurrentRecord();if(t.type!==r.EMAIL)break;e.push(t.value),this.currentLine++}return e}parsePhone(){let e=[];for(;;){let t=this.getCurrentRecord();if(t.type!==r.PHONE)break;e.push(t.value),this.currentLine++}return e}parseConnection(){let e=this.getCurrentRecord();if(e.type===r.CONNECTION){let t=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);let n=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);let r=this.extract(e,this.consumeAddress);return this.currentLine++,{nettype:t,addrtype:n,address:r}}}parseMedia(){let e=this.getCurrentRecord(),t=this.extract(e,this.consumeToken);this.consumeSpaceForRecord(e);let n=this.extract(e,this.consumePort);"/"===e.value[e.cur]&&(e.cur+=1,n+=this.extract(e,this.consumeInteger)),this.consumeSpaceForRecord(e);let r=[];for(r.push(this.extract(e,this.consumeToken));"/"===e.value[e.cur];)e.cur+=1,r.push(this.extract(e,this.consumeToken));if(0===r.length)throw new Error("Invalid proto");let i=this.parseFmt(e);return this.currentLine++,{mediaType:t,port:n,protos:r,fmts:i}}parseTimeFields(){let e=[];for(;this.getCurrentRecord().type===r.TIME;){let t=this.parseTime(),n=this.parseRepeat(),r=this.parseZone();e.push({time:t,repeats:n,zones:r})}return e}parseMediaDescription(){let e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===r.MEDIA;){let t=this.parseMedia(),n=this.parseInformation(),r=this.parseConnections(),i=this.parseBandWidth(),o=this.parseKey(),a=this.parseMediaAttributes(t);e.push({media:t,information:n,connections:r,bandwidths:i,key:o,attributes:a})}return e}parseConnections(){let e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===r.CONNECTION;)e.push(this.parseConnection());return e}parseFmt(e){let t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeToken))}catch{break}if(0===t.length)throw new Error("Invalid fmts");return t}extract(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];let o=t.call(this,e.value,e.cur,...r),a=e.value.slice(e.cur,o);return e.cur=o,a}extractOneOrMore(e,t){let n=this.consumeOneOrMore(e.value,e.cur,t),r=e.value.slice(e.cur,n);return e.cur=n,r}consumeSpaceForRecord(e){if(e.value[e.cur]!==a)throw new Error("Invalid space at ".concat(e.cur,"."));e.cur+=1}}class v extends S{constructor(){super(...arguments),C(this,"attributes",void 0),C(this,"digested",!1)}extractOneOrMore(e,t,n){let r=this.consumeOneOrMore(e.attValue,e._cur,t),i=e.attValue.slice(e._cur,r),[o,a]=n||[];if("number"==typeof o&&i.length<o)throw new Error("error in length, should be more or equal than ".concat(o," characters."));if("number"==typeof a&&i.length>a)throw new Error("error in length, should be less or equal than ".concat(a," characters."));return e._cur=r,i}consumeAttributeSpace(e){if(e.attValue[e._cur]!==a)throw new Error("Invalid space at ".concat(e._cur,"."));e._cur+=1}extract(e,t){if(!e.attValue)throw new Error("Nothing to extract from attValue.");for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];let o=t.call(this,e.attValue,e._cur,...r),a=e.attValue.slice(e._cur,o);return e._cur=o,a}atEnd(e){if(!e.attValue)throw new Error;return e._cur>=e.attValue.length}peekChar(e){if(!e.attValue)throw new Error;return e.attValue[e._cur]}peek(e,t){if(!e.attValue)throw new Error;for(let n=0;n<t.length;n++)if(t[n]!==e.attValue[e._cur+n])return!1;return!0}parseIceUfrag(e){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(e,f,[4,256])}parseIcePwd(e){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(e,f,[22,256])}parseIceOptions(e){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");let t=[];for(;!this.atEnd(e);){t.push(this.extractOneOrMore(e,f));try{this.consumeAttributeSpace(e)}catch(n){if(this.atEnd(e))break;throw n}}this.attributes.iceOptions=t}parseFingerprint(e){let t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);let n=this.extract(e,this.consumeTill);this.attributes.fingerprints.push({hashFunction:t,fingerprint:n})}parseExtmap(e){let t,n=this.extractOneOrMore(e,s);"/"===this.peekChar(e)&&(this.extract(e,this.consume,"/"),t=this.extract(e,this.consumeToken)),this.consumeAttributeSpace(e);let r=this.extract(e,this.consumeTill,a),i=_(_({entry:parseInt(n,10)},t&&{direction:t}),{},{extensionName:r});this.peekChar(e)===a&&(this.consumeAttributeSpace(e),i.extensionAttributes=this.extract(e,this.consumeTill)),this.attributes.extmaps.push(i)}parseSetup(e){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");let t=this.extract(e,this.consumeTill);if("active"!==t&&"passive"!==t&&"actpass"!==t&&"holdconn"!==t)throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=t}}class y extends v{constructor(){super(...arguments),C(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"group":this.parseGroup(e);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"fingerprint":this.parseFingerprint(e);break;case"setup":this.parseSetup(e);break;case"tls-id":this.parseTlsId(e);break;case"identity":this.parseIdentity(e);break;case"extmap":this.parseExtmap(e);break;case"msid-semantic":this.parseMsidSemantic(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing session attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(e){let t=this.extract(e,this.consumeToken),n=[];for(;!this.atEnd(e)&&this.peekChar(e)===a;)this.consumeAttributeSpace(e),n.push(this.extract(e,this.consumeToken));this.attributes.groups.push({semantic:t,identificationTag:n})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(e){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(e,E)}parseIdentity(e){let t=this.extractOneOrMore(e,g),n=[];for(;!this.atEnd(e)&&this.peekChar(e)===a;){this.consumeAttributeSpace(e);let t=this.extract(e,this.consumeToken);this.extract(e,this.consume,"=");let r=this.extractOneOrMore(e,(e=>e!==a&&p(e)));n.push({name:t,value:r})}this.attributes.identities.push({assertionValue:t,extensions:n})}parseMsidSemantic(e){this.peekChar(e)===a&&this.consumeAttributeSpace(e);let t={semantic:this.extract(e,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(e)}catch{break}if("*"===this.peekChar(e)){this.extract(e,this.consume,"*"),t.applyForAll=!0;break}{let n=this.extract(e,this.consumeTill,a);t.identifierList.push(n)}}this.attributes.msidSemantic=t}}class I extends v{constructor(e){super(),C(this,"attributes",void 0),-1!==e.protos.indexOf("RTP")||e.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"extmap":this.parseExtmap(e);break;case"setup":this.parseSetup(e);break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"candidate":this.parseCandidate(e);break;case"remote-candidate":this.parseRemoteCandidate(e);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(e);break;case"rtpmap":this.parseRtpmap(e);break;case"ptime":this.parsePtime(e);break;case"maxptime":this.parseMaxPtime(e);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(e);break;case"ssrc":this.parseSSRC(e);break;case"fmtp":this.parseFmtp(e);break;case"rtcp-fb":this.parseRtcpFb(e);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(e);break;case"mid":this.parseMid(e);break;case"msid":this.parseMsid(e);break;case"imageattr":this.parseImageAttr(e);break;case"rid":this.parseRid(e);break;case"simulcast":this.parseSimulcast(e);break;case"sctp-port":this.parseSctpPort(e);break;case"max-message-size":this.parseMaxMessageSize(e);break;case"ssrc-group":this.parseSSRCGroup(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing media attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}parseCandidate(e){let t=this.extractOneOrMore(e,f,[1,32]);this.consumeAttributeSpace(e);let n=this.extractOneOrMore(e,s,[1,5]);this.consumeAttributeSpace(e);let r=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);let i=this.extractOneOrMore(e,s,[1,10]);this.consumeAttributeSpace(e);let o=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);let c=this.extract(e,this.consumePort);this.consumeAttributeSpace(e),this.extract(e,this.consume,"typ"),this.consumeAttributeSpace(e);let l={foundation:t,componentId:n,transport:r,priority:i,connectionAddress:o,port:c,type:this.extract(e,this.consumeToken),extension:{}};for(this.peek(e," raddr")&&(this.extract(e,this.consume," raddr"),this.consumeAttributeSpace(e),l.relAddr=this.extract(e,this.consumeAddress)),this.peek(e," rport")&&(this.extract(e,this.consume," rport"),this.consumeAttributeSpace(e),l.relPort=this.extract(e,this.consumePort));this.peekChar(e)===a;){this.consumeAttributeSpace(e);let t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e),l.extension[t]=this.extractOneOrMore(e,A)}this.attributes.candidates.push(l)}parseRemoteCandidate(e){let t=[];for(;;){let n=this.extractOneOrMore(e,s,[1,5]);this.consumeAttributeSpace(e);let r=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);let i=this.extract(e,this.consumePort);t.push({componentId:n,connectionAddress:r,port:i});try{this.consumeAttributeSpace(e)}catch{break}}this.attributes.remoteCandidatesList.push(t)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(e){let t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);let n=this.extract(e,this.consumeTill,"/");this.extract(e,this.consume,"/");let r={encodingName:n,clockRate:this.extractOneOrMore(e,s)};this.atEnd(e)||"/"!==this.peekChar(e)||(this.extract(e,this.consume,"/"),r.encodingParameters=parseInt(this.extract(e,this.consumeTill),10));let i=this.attributes.payloads.find((e=>e.payloadType===parseInt(t,10)));i?i.rtpMap=r:this.attributes.payloads.push({payloadType:parseInt(t,10),rtpMap:r,rtcpFeedbacks:[]})}parsePtime(e){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(e,this.consumeTill)}parseMaxPtime(e){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(e,this.consumeTill)}parseDirection(e){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=e.attField}parseSSRC(e){let t=this.extractOneOrMore(e,s);this.consumeAttributeSpace(e);let n,r=this.extract(e,this.consumeTill,":");":"===this.peekChar(e)&&(this.extract(e,this.consume,":"),n=this.extract(e,this.consumeTill));let i=this.attributes.ssrcs.find((e=>e.ssrcId===parseInt(t,10)));i?i.attributes[r]=n:this.attributes.ssrcs.push({ssrcId:parseInt(t,10),attributes:{[r]:n}})}parseFmtp(e){let t=this.extract(e,this.consumeTill,a);this.consumeAttributeSpace(e);let n=this.extract(e,this.consumeTill),r={};n.split(";").forEach((e=>{let[t,n]=e.split("=");t=_h(t).call(t);let i="string"==typeof n?_h(n).call(n):null;"string"==typeof t&&t.length>0&&(r[t]=i)}));let i=this.attributes.payloads.find((e=>e.payloadType===parseInt(t,10)));i?i.fmtp={parameters:r}:this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[],fmtp:{parameters:r}})}parseFmtParameters(e){let t={},n=this.extract(e,this.consumeTill,"=");e._cur++;let r=this.extract(e,this.consumeTill,";");for(t[n]=r;";"===e.attValue[e._cur];){let n=this.extract(e,this.consumeTill,"=");e._cur++;let r=this.extract(e,this.consumeTill,";");t[n]=r}return t}parseRtcpFb(e){let t="";t="*"===this.peekChar(e)?this.extract(e,this.consume,"*"):this.extract(e,this.consumeTill,a),this.consumeAttributeSpace(e);let n,r=this.extract(e,this.consumeTill,a);if("trr-int"===r)n={type:r,interval:this.extract(e,this.consumeTill)};else{let t={type:r};this.peekChar(e)===a&&(this.consumeAttributeSpace(e),t.parameter=this.extract(e,this.consumeToken),this.peekChar(e)===a&&(t.additional=this.extract(e,this.consumeTill))),n=t}if("*"===t)this.attributes.rtcpFeedbackWildcards.push(n);else{let e=this.attributes.payloads.find((e=>e.payloadType===parseInt(t,10)));e?e.rtcpFeedbacks.push(n):this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[n]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(e){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");let t={port:this.extract(e,this.consumePort)};this.peekChar(e)===a&&(this.consumeAttributeSpace(e),t.netType=this.extractOneOrMore(e,l),this.consumeAttributeSpace(e),t.addressType=this.extractOneOrMore(e,l),this.consumeAttributeSpace(e),t.address=this.extract(e,this.consumeAddress)),this.attributes.rtcp=t}parseMsid(e){let t={id:this.extractOneOrMore(e,l,[1,64])};this.peekChar(e)===a&&(this.consumeAttributeSpace(e),t.appdata=this.extractOneOrMore(e,l,[1,64])),this.attributes.msids.push(t)}parseImageAttr(e){this.attributes.imageattr.push(e.attValue)}parseRid(e){let t=this.extractOneOrMore(e,(e=>u(e)||s(e)||"_"===e||"-"===e));this.consumeAttributeSpace(e);let n={id:t,direction:this.extract(e,this.consumeToken),params:[]};if(this.peekChar(e)===a){if(this.consumeAttributeSpace(e),this.peek(e,"pt=")){this.extract(e,this.consume,"pt=");let t=[];for(;;){let n=this.extract(e,this.consumeToken);t.push(n);try{this.extract(e,this.consume,",")}catch{break}}n.payloads=t,this.peekChar(e)===a&&this.extract(e,this.consume,a)}for(;;){let t=this.extract(e,this.consumeToken);switch(t){case"depend":{let r={type:t,rids:this.extract(e,this.consume,"=").split(",")};n.params.push(r);break}default:{let r={type:t};"="===this.peekChar(e)&&(this.extract(e,this.consume,"="),r.val=this.extract(e,this.consumeTill,";")),n.params.push(r)}}try{this.extract(e,this.consume,";")}catch{break}}}this.attributes.rids.push(n)}parseSimulcast(e){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=e.attValue,this.extract(e,this.consumeTill)}parseSctpPort(e){this.attributes.sctpPort=this.extractOneOrMore(e,s,[1,5])}parseMaxMessageSize(e){this.attributes.maxMessageSize=this.extractOneOrMore(e,s,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(e){this.attributes.mid=this.extract(e,this.consumeToken)}parseSSRCGroup(e){let t=this.extract(e,this.consumeToken),n=[];for(;;)try{this.consumeAttributeSpace(e);let t=this.extract(e,this.consumeInteger);n.push(parseInt(t,10))}catch{break}this.attributes.ssrcGroups.push({semantic:t,ssrcIds:n})}}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class b{constructor(){R(this,"eol",o)}print(e,t){let n="";return t&&(this.eol=t),n+=this.printVersion(e.version),n+=this.printOrigin(e.origin),n+=this.printSessionName(e.sessionName),n+=this.printInformation(e.information),n+=this.printUri(e.uri),n+=this.printEmail(e.emails),n+=this.printPhone(e.phones),n+=this.printConnection(e.connection),n+=this.printBandwidth(e.bandwidths),n+=this.printTimeFields(e.timeFields),n+=this.printKey(e.key),n+=this.printSessionAttributes(e.attributes),n+=this.printMediaDescription(e.mediaDescriptions),n}printVersion(e){return"v=".concat(e).concat(this.eol)}printOrigin(e){return"o=".concat(e.username," ").concat(e.sessId," ").concat(e.sessVersion," ").concat(e.nettype," ").concat(e.addrtype," ").concat(e.unicastAddress).concat(this.eol)}printSessionName(e){return e?"s=".concat(e).concat(this.eol):""}printInformation(e){return e?"i=".concat(e).concat(this.eol):""}printUri(e){return e?"u=".concat(e).concat(this.eol):""}printEmail(e){let t="";for(let n of e)t+="e=".concat(n).concat(this.eol);return t}printPhone(e){let t="";for(let n of e)t+="e=".concat(n).concat(this.eol);return t}printConnection(e){return e?"c=".concat(e.nettype," ").concat(e.addrtype," ").concat(e.address).concat(this.eol):""}printBandwidth(e){let t="";for(let n of e)t+="b=".concat(n.bwtype,":").concat(n.bandwidth).concat(this.eol);return t}printTimeFields(e){let t="";for(let n of e){t+="t=".concat(n.time.startTime," ").concat(n.time.startTime).concat(this.eol);for(let e of n.repeats)t+="r=".concat(e.repeatInterval," ").concat(e.typedTimes.join(" ")).concat(this.eol);n.zoneAdjustments&&(t+="z=",t+="z=".concat(n.zoneAdjustments.map((e=>"".concat(e.time," ").concat(e.back?"-":""," ").concat(e.typedTime))).join(" ")).concat(this.eol),t+=this.eol)}return t}printKey(e){return e?"k=".concat(e).concat(this.eol):""}printAttributes(e){let t="";for(let n of e)t+="a=".concat(n.attField).concat(n.attValue?":".concat(n.attValue):"").concat(this.eol);return t}printMediaDescription(e){let t="";for(let n of e)t+=this.printMedia(n.media),t+=this.printInformation(n.information),t+=this.printConnections(n.connections),t+=this.printBandwidth(n.bandwidths),t+=this.printKey(n.key),t+=this.printMediaAttributes(n);return t}printConnections(e){let t="";for(let n of e)t+=this.printConnection(n);return t}printMedia(e){return"m=".concat(e.mediaType," ").concat(e.port," ").concat(e.protos.join("/")," ").concat(e.fmts.join(" ")).concat(this.eol)}printSessionAttributes(e){return new B(this.eol).print(e)}printMediaAttributes(e){return new N(this.eol).print(e)}}class O{constructor(e){R(this,"eol",void 0),this.eol=e}printIceUfrag(e){return void 0===e?"":"a=ice-ufrag:".concat(e).concat(this.eol)}printIcePwd(e){return void 0===e?"":"a=ice-pwd:".concat(e).concat(this.eol)}printIceOptions(e){return void 0===e?"":"a=ice-options:".concat(e.join(a)).concat(this.eol)}printFingerprints(e){return e.length>0?e.map((e=>"a=fingerprint:".concat(e.hashFunction).concat(a).concat(e.fingerprint))).join(this.eol)+this.eol:""}printExtmap(e){return e.map((e=>"a=extmap:".concat(e.entry).concat(e.direction?"/".concat(e.direction):"").concat(a).concat(e.extensionName).concat(e.extensionAttributes?"".concat(a).concat(e.extensionAttributes):"").concat(this.eol))).join("")}printSetup(e){return void 0===e?"":"a=setup:".concat(e).concat(this.eol)}printUnrecognized(e){return e.map((e=>"a=".concat(e.attField).concat(e.attValue?":".concat(e.attValue):"").concat(this.eol))).join("")}}class B extends O{print(e){let t="";return t+=this.printGroups(e.groups),t+=this.printMsidSemantic(e.msidSemantic),t+=this.printIceLite(e.iceLite),t+=this.printIceUfrag(e.iceUfrag),t+=this.printIcePwd(e.icePwd),t+=this.printIceOptions(e.iceOptions),t+=this.printFingerprints(e.fingerprints),t+=this.printSetup(e.setup),t+=this.printTlsId(e.tlsId),t+=this.printIdentity(e.identities),t+=this.printExtmap(e.extmaps),t+=this.printUnrecognized(e.unrecognized),t}printGroups(e){let t="";return e.length>0&&(t+=e.map((e=>"a=group:".concat(e.semantic).concat(e.identificationTag.map((e=>"".concat(a).concat(e))).join("")).concat(this.eol))).join("")),t}printIceLite(e){return void 0===e?"":"a=ice-lite"+this.eol}printTlsId(e){return e?"a=tls-id:".concat(e).concat(this.eol):""}printIdentity(e){return 0===e.length?"":e.map((e=>"a=identity:".concat(e.assertionValue).concat(e.extensions.map((e=>"".concat(a).concat(e.name).concat(e.value?"=".concat(e.value):"")))))).join(this.eol)+this.eol}printMsidSemantic(e){if(!e)return"";let t="a=msid-semantic:".concat(e.semantic);return e.applyForAll?t+="".concat(a,"*"):e.identifierList.length>0&&(t+=e.identifierList.map((e=>"".concat(a).concat(e)))),t+this.eol}}class N extends O{print(e){let t=e.attributes,n="";return n+=this.printRTCP(t.rtcp),n+=this.printIceUfrag(t.iceUfrag),n+=this.printIcePwd(t.icePwd),n+=this.printIceOptions(t.iceOptions),n+=this.printCandidates(t.candidates),n+=this.printRemoteCandidatesList(t.remoteCandidatesList),n+=this.printEndOfCandidates(t.endOfCandidates),n+=this.printFingerprints(t.fingerprints),n+=this.printSetup(t.setup),n+=this.printMid(t.mid),n+=this.printExtmap(t.extmaps),n+=this.printRTPRelated(t),n+=this.printPtime(t.ptime),n+=this.printMaxPtime(t.maxPtime),n+=this.printDirection(t.direction),n+=this.printSSRCGroups(t.ssrcGroups),n+=this.printSSRC(t.ssrcs),n+=this.printRTCPMux(t.rtcpMux),n+=this.printRTCPMuxOnly(t.rtcpMuxOnly),n+=this.printRTCPRsize(t.rtcpRsize),n+=this.printMSId(t.msids),n+=this.printImageattr(t.imageattr),n+=this.printRid(t.rids),n+=this.printSimulcast(t.simulcast),n+=this.printSCTPPort(t.sctpPort),n+=this.printMaxMessageSize(t.maxMessageSize),n+=this.printUnrecognized(t.unrecognized),n}printCandidates(e){return e.map((e=>"a=candidate:".concat(e.foundation).concat(a).concat(e.componentId).concat(a).concat(e.transport).concat(a).concat(e.priority).concat(a).concat(e.connectionAddress).concat(a).concat(e.port).concat(a,"typ").concat(a).concat(e.type).concat(e.relAddr?"".concat(a,"raddr").concat(a).concat(e.relAddr):"").concat(e.relPort?"".concat(a,"rport").concat(a).concat(e.relPort):"").concat(Object.keys(e.extension).map((t=>"".concat(a).concat(t).concat(a).concat(e.extension[t]))).join("")).concat(this.eol))).join("")}printRemoteCandidatesList(e){return e.map((e=>"a=remote-candidates:".concat(e.join(a)).concat(this.eol))).join("")}printEndOfCandidates(e){return void 0===e?"":"a=end-of-candidates"+this.eol}printRTPRelated(e){if(!e.payloads)return"";let t=e.payloads,n="";n+=e.rtcpFeedbackWildcards.map((e=>this.printRTCPFeedback("*",e))).join("");for(let r of t)n+=this.printRtpMap(r.payloadType,r.rtpMap),n+=this.printFmtp(r.payloadType,r.fmtp),n+=r.rtcpFeedbacks.map((e=>this.printRTCPFeedback(r.payloadType,e))).join("");return n}printFmtp(e,t){if(!t)return"";let n=Object.keys(t.parameters);return 1===n.length&&null===t.parameters[n[0]]?"a=fmtp:".concat(e).concat(a).concat(n[0]).concat(this.eol):"a=fmtp:".concat(e).concat(a).concat(Object.keys(t.parameters).map((e=>"".concat(e,"=").concat(t.parameters[e]))).join(";")).concat(this.eol)}printRtpMap(e,t){return t?"a=rtpmap:".concat(e).concat(a).concat(t.encodingName,"/").concat(t.clockRate).concat(t.encodingParameters?"/".concat(t.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(e,t){let n="a=rtcp-fb:".concat(e).concat(a),r=t;return"trr-int"===r.type?n+="ttr-int".concat(a).concat(r.interval):(n+="".concat(r.type),r.parameter&&(n+="".concat(a).concat(r.parameter),r.additional&&(n+="".concat(a).concat(r.additional)))),n+this.eol}printPtime(e){return void 0===e?"":"a=ptime:".concat(e).concat(this.eol)}printMaxPtime(e){return void 0===e?"":"a=maxptime:".concat(e).concat(this.eol)}printDirection(e){return void 0===e?"":"a=".concat(e).concat(this.eol)}printSSRC(e){return e.map((e=>Object.keys(e.attributes).map((t=>"a=ssrc:".concat(e.ssrcId.toString(10)).concat(a).concat(t).concat(e.attributes[t]?":".concat(e.attributes[t]):"").concat(this.eol))).join(""))).join("")}printRTCPMux(e){return void 0===e?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(e){return void 0===e?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(e){return void 0===e?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(e){if(void 0===e)return"";let t="a=rtcp:".concat(e.port);return e.netType&&(t+="".concat(a).concat(e.netType)),e.addressType&&(t+="".concat(a).concat(e.addressType)),e.address&&(t+="".concat(a).concat(e.address)),t+this.eol}printMSId(e){return e.map((e=>"a=msid:".concat(e.id).concat(e.appdata?"".concat(a).concat(e.appdata):"").concat(this.eol))).join("")}printImageattr(e){return e.map((e=>"a=imageattr:".concat(e).concat(this.eol))).join("")}printRid(e){return e.map((e=>{let t="a=rid:".concat(e.id).concat(a).concat(e.direction);return e.payloads&&(t+="".concat(a,"pt=").concat(e.payloads.join(","))),e.params.length>0&&(t+="".concat(a).concat(e.params.map((e=>"depend"===e.type?"depend=".concat(e.rids.join(",")):"".concat(e.type,"=").concat(e.val))).join(";"))),t+this.eol})).join("")}printSimulcast(e){return void 0===e?"":"a=simulcast:".concat(e).concat(this.eol)}printSCTPPort(e){return void 0===e?"":"a=sctp-port:".concat(e).concat(this.eol)}printMaxMessageSize(e){return void 0===e?"":"a=max-message-size:".concat(e).concat(this.eol)}printMid(e){return void 0===e?"":"a=mid:".concat(e).concat(this.eol)}printSSRCGroups(e){return e.map((e=>"a=ssrc-group:".concat(e.semantic).concat(e.ssrcIds.map((e=>"".concat(a).concat(e.toString(10)))).join("")).concat(this.eol))).join("")}}function D(e){return(new T).parse(e)}function P(e,t){return(new b).print(e,t)}}},t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}return n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(8)})()}(ux);var hx=ux.exports;function px(e){if(Array.isArray(e))return e.map((e=>e));if(!fx(e))return e;let t={};for(let n in e){let r=e[n];fx(r)||Array.isArray(r)?t[n]=px(r):t[n]=r}return t}function fx(e){return!("object"!=typeof e||Array.isArray(e)||!e)}class Ex{constructor(e){O_(this,"input",[]),O_(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}let gx={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},mx={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:gx,remoteCandidate:gx}},_x={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0},Cx={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},wx={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},Sx={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function Tx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function vx(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Tx(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tx(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class yx{constructor(e,t){O_(this,"onFirstVideoReceived",void 0),O_(this,"onFirstVideoDecoded",void 0),O_(this,"onFirstAudioReceived",void 0),O_(this,"onFirstVideoDecodedTimeout",void 0),O_(this,"onFirstAudioDecoded",void 0),O_(this,"onSelectedLocalCandidateChanged",void 0),O_(this,"onSelectedRemoteCandidateChanged",void 0),O_(this,"videoIsReady",!1),O_(this,"videoIsReady2",{}),O_(this,"pc",void 0),O_(this,"options",void 0),O_(this,"intervalTimer",void 0),O_(this,"stats",px(mx)),O_(this,"isFirstVideoReceived",{}),O_(this,"isFirstVideoDecoded",{}),O_(this,"isFirstAudioReceived",{}),O_(this,"isFirstAudioDecoded",{}),O_(this,"isFirstVideoDecodedTimeout",{}),O_(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval((async()=>{this.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new wu((e=>{e({local:vx({},gx),remote:vx({},gx)})}))}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);let t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"],r=0,i=0,o=0,a=0;for(let s of n)e[s].forEach(((e,n)=>{if(!this.lossRateWindowStats[t-1][s][n]||!this.lossRateWindowStats[0][s][n])return;let A=this.lossRateWindowStats[t-1][s][n].packets-this.lossRateWindowStats[0][s][n].packets,c=this.lossRateWindowStats[t-1][s][n].packetsLost-this.lossRateWindowStats[0][s][n].packetsLost;"videoSend"===s||"audioSend"===s?(r+=A,o+=c):(i+=A,a+=c),Number.isNaN(A)||Number.isNaN(A)?e.packetLostRate=0:e.packetLostRate=A<=0||c<=0?0:c/(A+c)}));e.sendPacketLossRate=r<=0||o<=0?0:o/(r+o),e.recvPacketLossRate=i<=0||a<=0?0:a/(i+a)}}function Ix(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Rx(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ix(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ix(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class bx extends yx{constructor(){super(...arguments),O_(this,"_stats",mx),O_(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){let e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=px(mx);let n=t.filter((e=>"ssrc"===e.type));this.processSSRCStats(n);let r=t.find((e=>"VideoBwe"===e.type));r&&this.processBandwidthStats(r),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach((e=>{var t;let n=yr(t=e.id).call(t,"send");switch("".concat(e.mediaType,"_").concat(n?"send":"recv")){case"video_send":{let t=px(Cx);t.codec=e.googCodecName,t.adaptionChangeReason="none",e.googCpuLimitedResolution&&(t.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(t.adaptionChangeReason="bandwidth"),t.avgEncodeMs=Number(e.googAvgEncodeMs),t.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.firsCount=Number(e.googFirReceived),t.nacksCount=Number(e.googNacksReceived),t.plisCount=Number(e.googPlisReceived),t.frameCount=Number(e.framesEncoded),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(t),this._stats.rtt=t.rttMs;break}case"video_recv":{let t=px(_x),n=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(t.codec=e.googCodecName,t.targetDelayMs=Number(e.googTargetDelayMs),t.renderDelayMs=Number(e.googRenderDelayMs),t.currentDelayMs=Number(e.googCurrentDelayMs),t.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),t.decodeMs=Number(e.googDecodeMs),t.maxDecodeMs=Number(e.googMaxDecodeMs),t.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},t.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},t.decodeFrameRate=Number(e.googFrameRateDecoded),t.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},t.jitterBufferMs=Number(e.googJitterBufferMs),t.firsCount=Number(e.googFirsSent),t.nacksCount=Number(e.googNacksSent),t.plisCount=Number(e.googPlisSent),t.framesDecodeCount=Number(e.framesDecoded),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,t.decodedFrame.width,t.decodedFrame.height),this.isFirstVideoDecoded[t.ssrc]=!0),n){let r=n.stats,i=Date.now()-n.lts;t.framesDecodeFreezeTime=r.framesDecodeFreezeTime,t.framesDecodeInterval=r.framesDecodeInterval,t.framesDecodeCount>r.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=i,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<n.stats.framesDecodeCount&&(t.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:Rx({},t),lts:Date.now()}),this._stats.videoRecv.push(t);break}case"audio_recv":{let t=px(Sx);t.codec=e.googCodecName,t.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,t.decodingCNG=Number(e.googDecodingCNG),t.decodingCTN=Number(e.googDecodingCTN),t.decodingCTSG=Number(e.googDecodingCTSG),t.decodingNormal=Number(e.googDecodingNormal),t.decodingPLC=Number(e.googDecodingPLC),t.decodingPLCCNG=Number(e.googDecodingPLCCNG),t.expandRate=Number(e.googExpandRate),t.accelerateRate=Number(e.googAccelerateRate),t.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),t.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),t.speechExpandRate=Number(e.googSpeechExpandRate),t.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),t.jitterBufferMs=Number(e.googJitterBufferMs),t.jitterMs=Number(e.googJitterReceived),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),t.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.decodingNormal>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),this._stats.audioRecv.push(t);break}case"audio_send":{let t=px(wx);t.codec=e.googCodecName,t.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,t.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),t.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),t.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),t.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.rtt=t.rttMs,this._stats.audioSend.push(t);break}}}))}_getStats(){return new wu(((e,t)=>{this.pc.getStats(e,t)}))}statsResponsesToObjects(e){let t=[];return e.result().forEach((e=>{let n={id:e.id,timestamp:e.timestamp.valueOf().toString(),type:e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t.push(n)})),t}}function Ox(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Bx(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ox(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ox(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class Nx extends yx{constructor(){super(...arguments),O_(this,"_stats",mx),O_(this,"report",void 0),O_(this,"lastDecodeVideoReceiverStats",new Map),O_(this,"lastVideoFramesRecv",new Map),O_(this,"lastVideoFramesSent",new Map),O_(this,"lastVideoFramesDecode",new Map),O_(this,"lastVideoFramesOutput",new Map),O_(this,"lastVideoJBDelay",new Map),O_(this,"lastAudioJBDelay",new Map),O_(this,"mediaBytesSent",new Map),O_(this,"mediaBytesRetransmit",new Map),O_(this,"mediaBytesTargetEncode",new Map),O_(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=px(mx),this.report.forEach((e=>{switch(e.type){case OI.OUTBOUND:case OI.INBOUND:{let t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,r=!t&&!("frameWidth"in e);e.type===OI.OUTBOUND?"audio"===t||r?this.processAudioOutboundStats(e):("video"===t||n)&&this.processVideoOutboundStats(e):e.type===OI.INBOUND&&("audio"===t||r?this.processAudioInboundStats(e):("video"===t||n)&&this.processVideoInboundStats(e));break}case OI.TRANSPORT:{let t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case OI.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}})),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){let e=await this.pc.getStats(),t={local:Bx({},gx),remote:Bx({},gx)};return e.forEach((n=>{let r;if(n.type===OI.TRANSPORT&&(r=e.get(n.selectedCandidatePairId)),n.type===OI.CANDIDATE_PAIR&&n.selected&&(r=n),r){let n=(e,t)=>{e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol)};if(r.localCandidateId){let i=e.get(r.localCandidateId);i&&n(t.local,i)}if(r.remoteCandidateId){let i=e.get(r.remoteCandidateId);i&&n(t.remote,i)}}})),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.audioSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){let t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){let t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===OI.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===OI.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===OI.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Bx({},t),Bx({},this.stats.selectedCandidatePair.localCandidate)),e.type===OI.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Bx({},t),Bx({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find((t=>t.ssrc===e.ssrc));t||(t=px(Sx),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,this.processAudioTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),"number"==typeof e.concealedSamples&&(t.concealedSamples=e.concealedSamples)}processVideoInboundStats(e){let t=this._stats.videoRecv.find((t=>t.ssrc===e.ssrc));t||(t=px(_x),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration;let n=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),i=this.lastVideoFramesOutput.get(t.ssrc),o=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){let e=t.decodedFrame?t.decodedFrame.width:0,n=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,e,n),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){let r=n.stats,i=o-n.lts;t.framesDecodeFreezeTime=r.framesDecodeFreezeTime,t.framesDecodeInterval=r.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&i>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>r.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=i,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<r.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}r&&o-r.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((o-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:o,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:o,rate:0}),t.framesDroppedCount&&e.framesReceived&&(i&&o-i.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-i.count)/((o-i.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:o,rate:Math.max(t.outputFrameRate,0)})):i?t.outputFrameRate=i.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:o,rate:0})),e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:Bx({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find((t=>t.ssrc===e.ssrc));t||(t=px(Cx),this._stats.videoSend.push(t));let n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{let t=new Ex(10);t.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,t)}if(void 0!==e.retransmittedBytesSent){let t=this.mediaBytesRetransmit.get(e.ssrc);if(t)t.add(e.retransmittedBytesSent);else{let t=new Ex(10);t.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,t)}}if(e.totalEncodedBytesTarget){let t=this.mediaBytesTargetEncode.get(e.ssrc);if(t)t.add(e.totalEncodedBytesTarget);else{let t=new Ex(10);t.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,t)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,e.totalEncodeTime&&e.framesEncoded){let n=this.lastEncoderMs.get(e.ssrc);if(!n||n.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{let r=e.framesEncoded-n.lastFrameCount,i=e.totalEncodeTime-n.lastEncoderTime;t.avgEncodeMs=1e3*i/r}}if(e.framesEncoded&&e.qpSum){let n=this.lastEncoderMs.get(e.ssrc);!n||n.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-n.lastQpSum)/(e.framesEncoded-n.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let n=this.findRemoteStatsId(e.ssrc,OI.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find((t=>t.ssrc===e.ssrc));if(t||(t=px(wx),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let n=this.findRemoteStatsId(e.ssrc,OI.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}findRemoteStatsId(e,t){var n;let r=Array.from(RI(n=this.report).call(n)).find((n=>n.type===t&&n.ssrc===e));return r?r.id:null}processVideoMediaSource(e,t){let n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){let n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var r,i,o,a;let s=t?this.report.get(t):void 0,A=null!==(r=null===s||void 0===s?void 0:s.framesSent)&&void 0!==r?r:e.framesSent;if("number"!=typeof A)return;let c=null!==(i=null===s||void 0===s?void 0:s.frameWidth)&&void 0!==i?i:e.frameWidth,l=null!==(o=null===s||void 0===s?void 0:s.frameHeight)&&void 0!==o?o:e.frameHeight,d=null!==(a=null===s||void 0===s?void 0:s.framesPerSecond)&&void 0!==a?a:e.framesPerSecond;if("number"==typeof c&&"number"==typeof l||(c=0,l=0),null==d){let e=Date.now(),t=this.lastVideoFramesSent.get(n.ssrc);t&&e-t.lts>=800?(d=Math.round((A-t.count)/((e-t.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:A,lts:e,rate:d})):t?d=t.rate:this.lastVideoFramesSent.set(n.ssrc,{count:A,lts:e,rate:0})}n.sentFrame={width:c,height:l,frameRate:Math.max(0,d)}}processVideoTrackReceiverStats(e,t,n){var r,i,o,a,s;let A=t?this.report.get(t):void 0,c=null!==(r=null===A||void 0===A?void 0:A.framesReceived)&&void 0!==r?r:e.framesReceived,l=null!==(i=null===A||void 0===A?void 0:A.frameWidth)&&void 0!==i?i:e.frameWidth,d=null!==(o=null===A||void 0===A?void 0:A.frameHeight)&&void 0!==o?o:e.frameHeight,u=null!==(a=null===A||void 0===A?void 0:A.jitterBufferDelay)&&void 0!==a?a:e.jitterBufferDelay,h=null!==(s=null===A||void 0===A?void 0:A.jitterBufferEmittedCount)&&void 0!==s?s:e.jitterBufferEmittedCount;if("number"==typeof c){let e=this.lastVideoFramesRecv.get(n.ssrc),t=Date.now();n.framesReceivedCount=c;let r=0;e&&t-e.lts>=800?(r=Math.round((c-e.count)/((t-e.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:c,lts:t,rate:r})):e?r=e.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:c,lts:t,rate:0}),n.receivedFrame={width:l||0,height:d||0,frameRate:r||0},n.decodedFrame={width:l||0,height:d||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:l||0,height:d||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(u&&h){let e=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},t=e.jitterBufferMs,r=h-e.jitterBufferEmittedCount;r>0&&(t=1e3*(u-e.jitterBufferDelay)/r),n.jitterBufferMs=t,n.currentDelayMs=Math.round(t),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:u,jitterBufferEmittedCount:h,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var r,i,o,a;let s=t?this.report.get(t):void 0,A=null!==(r=null!==(i=null===s||void 0===s?void 0:s.echoReturnLoss)&&void 0!==i?i:e.echoReturnLoss)&&void 0!==r?r:0,c=null!==(o=null!==(a=null===s||void 0===s?void 0:s.echoReturnLossEnhancement)&&void 0!==a?a:e.echoReturnLossEnhancement)&&void 0!==o?o:0;n.aecReturnLoss=A,n.aecReturnLossEnhancement=c}processAudioTrackReceiverStats(e,t,n){var r,i,o,a,s,A,c;let l=t?this.report.get(t):void 0,d=null!==(r=null===l||void 0===l?void 0:l.removedSamplesForAcceleration)&&void 0!==r?r:e.removedSamplesForAcceleration,u=null!==(i=null===l||void 0===l?void 0:l.totalSamplesReceived)&&void 0!==i?i:e.totalSamplesReceived,h=null!==(o=null===l||void 0===l?void 0:l.jitterBufferDelay)&&void 0!==o?o:e.jitterBufferDelay,p=null!==(a=null===l||void 0===l?void 0:l.jitterBufferEmittedCount)&&void 0!==a?a:e.jitterBufferEmittedCount,f=null!==(s=null===l||void 0===l?void 0:l.audioLevel)&&void 0!==s?s:null===e||void 0===e?void 0:e.audioLevel,E=null!==(A=null===l||void 0===l?void 0:l.totalSamplesDuration)&&void 0!==A?A:null===e||void 0===e?void 0:e.totalSamplesDuration,g=null!==(c=null===l||void 0===l?void 0:l.concealedSamples)&&void 0!==c?c:e.concealedSamples;if(d&&u&&(n.accelerateRate=d/u),h&&p){let e=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},t=e.jitterBufferMs,r=p-e.jitterBufferEmittedCount;r>0&&(t=1e3*(h-e.jitterBufferDelay)/r),n.jitterBufferMs=Math.round(t),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:h,jitterBufferEmittedCount:p,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=f;let m=1920;E&&u&&(m=u/E/50,n.receivedFrames=Math.round(u/m)),g&&(n.droppedFrames=Math.round(g/m))}processRemoteInboundStats(e,t){let n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){let t=this.report.get(e);if(!t)return"";let n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach((t=>{e+=t.diffMean()})),this.mediaBytesRetransmit.forEach((e=>{t=null===t?e.diffMean():t+e.diffMean()})),this.mediaBytesTargetEncode.forEach((e=>{n=null===n?e.diffMean():n+e.diffMean()}));let r=null!==t?e-t:e;this._stats.bitrate={actualEncoded:8*r/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},null!==t&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),null!==n&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}}class Dx extends yx{updateStats(){return wu.resolve()}}function Px(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4,o=function(){let e=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return e&&e[0]?Number(e[0].split("/")[1]):null}();return o?o<76?new bx(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new Nx(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):(a=e,window.RTCStatsReport&&a.getStats()instanceof wu?new Nx(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new Dx(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}));var a}function Ux(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Lx(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ux(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ux(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function kx(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,{filterRTX:i,filterVideoFec:o,filterAudioFec:a,filterAudioCodec:s,filterVideoCodec:A}=t,{useXR:c}=n,l=[],d=[],u=[],h=[],p=!1,f=!1;if(hx.parse(e).mediaDescriptions.forEach((e=>{r&&r!==e.attributes.direction||("video"!==e.media.mediaType||p||(d=e.attributes.payloads,h=e.attributes.extmaps,p=!0),"audio"!==e.media.mediaType||f||(l=e.attributes.payloads,u=e.attributes.extmaps,f=!0))})),!h||0===d.length)throw new Error("Cannot get video capabilities from SDP.");if(!u||0===l.length)throw new Error("Cannot get audio capabilities from SDP.");if(d.forEach((e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),c&&e.rtcpFeedbacks.push({type:"rrtr"})})),l.forEach((e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),c&&e.rtcpFeedbacks.push({type:"rrtr"})})),i&&(l=l.filter((e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())})),d=d.filter((e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())}))),o&&(d=d.filter((e=>{var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")}))),a&&(l=l.filter((e=>{var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")}))),s&&(null===s||void 0===s?void 0:s.length)>0&&(l=l.filter((e=>{var t;return yr(s).call(s,(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")}))),A&&(null===A||void 0===A?void 0:A.length)>0){let e=d.filter((e=>{var t;return yr(A).call(A,(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")}));d=e.concat(i?[]:eQ(e,d))}let E=$v("UNSUPPORTED_VIDEO_CODEC");return E&&E.length>0&&(d=d.filter((e=>!(e.rtpMap&&yr(E).call(E,e.rtpMap.encodingName.toLowerCase()))))),{audioCodecs:l,videoCodecs:d,audioExtensions:u,videoExtensions:h}}function Mx(e){let t,n,r=hx.parse(e);for(let i of r.mediaDescriptions){if(!t){let e=i.attributes.iceUfrag,n=i.attributes.icePwd;if(!e||!n)throw new Error("Cannot get iceUfrag or icePwd from SDP.");t={iceUfrag:e,icePwd:n}}if(!n){let e=i.attributes.fingerprints;e.length>0&&(n={fingerprints:e})}}if(!n&&r.attributes.fingerprints.length>0&&(n={fingerprints:r.attributes.fingerprints}),!n||!t)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:t,dtlsParameters:n}}function Fx(e,t){let n=[],r=e.attributes.ssrcGroups.filter((e=>"FID"===e.semantic)),i=e.attributes.ssrcGroups.find((e=>"SIM"===e.semantic)),o=e.attributes.ssrcs;if(i)i.ssrcIds.forEach((e=>{var i;let o=null===(i=r.find((t=>t.ssrcIds[0]===e)))||void 0===i?void 0:i.ssrcIds[1];n.push({ssrcId:e,rtx:t?o:void 0})}));else if(r.length>0){let e=r[0].ssrcIds[0],i=r[0].ssrcIds[1];n.push({ssrcId:e,rtx:t?i:void 0})}else{if(0===o.length)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:o[0].ssrcId})}return n}function xx(e,t){let n,{cname:r}=e;t&&t.ip&&"number"==typeof t.port?(n=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],Ey.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(n.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),Ey.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))):n=e.iceParameters.candidates.map((e=>({foundation:e.foundation,componentId:"1",transport:e.protocol,priority:e.priority.toString(),connectionAddress:e.ip,port:e.port.toString(),type:e.type,extension:{}})));let i,o={fingerprints:e.dtlsParameters.fingerprints.map((e=>({hashFunction:e.algorithm,fingerprint:e.fingerprint})))},a={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};switch(e.dtlsParameters.role){case"server":i="passive";break;case"client":i="active";break;case"auto":i="actpass"}return{dtlsParameters:o,iceParameters:a,candidates:n,rtpCapabilities:zx(e.rtpCapabilities),setup:i,cname:r}}function Qx(e,t,n){let r=[],i=[];return e.forEach((e=>{let{ssrcId:o,rtx:a}=e,s=Sv(8,"track-"),A={ssrcId:o,attributes:Lx({label:s,mslabel:n=n||Sv(10,""),msid:"".concat(n," ").concat(s)},t&&{cname:t})};if(r.push(A),void 0!==a){let e={ssrcId:a,attributes:Lx({label:s,mslabel:n,msid:"".concat(n," ").concat(s)},t&&{cname:t})};r.push(e),i.push({semantic:"FID",ssrcIds:[o,a]})}})),e.length>1&&i.push({semantic:"SIM",ssrcIds:e.map((e=>{let{ssrcId:t}=e;return t}))}),{ssrcs:r,ssrcGroups:i}}function Vx(e,t){t instanceof SM&&e.attributes.payloads.forEach((e=>{var n;let r=null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase();if(!r||-1===["opus","pcmu","pcma","g722"].indexOf(r))return;e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.minptime="10",e.fmtp.parameters.useinbandfec="1";let i=t._encoderConfig;i&&"pcmu"!==r&&"pcma"!==r&&"g722"!==r&&(i.bitrate&&!eT()&&(e.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*i.bitrate))),i.sampleRate&&(e.fmtp.parameters.maxplaybackrate="".concat(i.sampleRate),e.fmtp.parameters["sprop-maxcapturerate"]="".concat(i.sampleRate)),i.stereo&&(e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"))}))}function Hx(e){let t=e.attributes.unrecognized.findIndex((e=>"x-google-flag"===e.attField&&"conference"===e.attValue));-1!==t&&e.attributes.unrecognized.splice(t,1)}function Kx(e,t){var n;if(!(t instanceof uF&&t._encoderConfig&&-1===t._hints.indexOf(vL.SCREEN_TRACK)))return;let r=t._encoderConfig;oL().supportMinBitrate&&r.bitrateMin&&e.attributes.payloads.forEach((e=>{var t,n;yr(t=["h264","h265","vp8","vp9","av1"]).call(t,(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))})),oL().supportMinBitrate&&!yr(n=t._hints).call(n,vL.LOW_STREAM)&&r.bitrateMax&&e.attributes.payloads.forEach((e=>{var t,n;yr(t=["h264","h265","vp8","vp9","av1"]).call(t,(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-start-bitrate"]="".concat($v("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))}))}function jx(e){if("video"!==e.media.mediaType)return;let t=WS();if(t.name!==HS.SAFARI&&t.os!==VS.IOS)return;let n=e.attributes.extmaps.findIndex((e=>/video-orientation/g.test(e.extensionName)));-1!==n&&e.attributes.extmaps.splice(n,1)}function Gx(e,t,n){if(!t)return;let r,i;if("video"===e.media.mediaType?(r=n.videoExtensions,i=n.videoCodecs):(r=n.audioExtensions,i=n.audioCodecs),!0===t.twcc){let t=r.find((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName));t&&(e.attributes.extmaps.find((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName))||e.attributes.extmaps.push({entry:t.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),(o=i,a=e.attributes.payloads,a.filter((e=>!!o.find((t=>t.payloadType===e.payloadType&&!!t.rtcpFeedbacks.find((e=>"transport-cc"===e.type))))))).forEach((e=>{e.rtcpFeedbacks.find((e=>"transport-cc"===e.type))||e.rtcpFeedbacks.push({type:"transport-cc"})})))}else if(!1===t.twcc){let t=e.attributes.extmaps.findIndex((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName));-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach((e=>{let t=e.rtcpFeedbacks.findIndex((e=>"transport-cc"===e.type));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}var o,a;if(!0===t.remb){let t=r.find((e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.extensionName));t&&(e.attributes.extmaps.find((e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.extensionName))||e.attributes.extmaps.push({entry:t.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(e,t){return t.filter((t=>!!e.find((e=>e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find((e=>"goog-remb"===e.type))))))}(i,e.attributes.payloads).forEach((e=>{e.rtcpFeedbacks.find((e=>"goog-remb"===e.type))||e.rtcpFeedbacks.push({type:"goog-remb"})})))}else if(!1===t.remb){let t=e.attributes.extmaps.findIndex((e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.extensionName));-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach((e=>{let t=e.rtcpFeedbacks.findIndex((e=>"goog-remb"===e.type));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}}function Wx(e,t,n){if(eT()||"video"!==e.media.mediaType||!(t instanceof uF)||"vp9"!==n&&"vp8"!==n||"vp8"===n&&!$v("SIMULCAST")||void 0===t._scalabilityMode||t._scalabilityMode.numSpatialLayers<=1)return;let r="vp8"===n?2:t._scalabilityMode.numSpatialLayers,i=e.attributes.ssrcs[0],o=e.attributes.ssrcGroups.find((e=>"FID"===e.semantic&&e.ssrcIds[0]===i.ssrcId)),a={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let s=1;s<r;s++)e.attributes.ssrcs.push({ssrcId:i.ssrcId+s,attributes:lv(i.attributes)}),a.ssrcIds.push(i.ssrcId+s),o&&(e.attributes.ssrcs.push({ssrcId:o.ssrcIds[1]+s,attributes:lv(i.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+s,o.ssrcIds[1]+s]}));e.attributes.ssrcGroups.unshift(a)}async function Yx(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});let r=(await n.createOffer()).sdp,{send:i,recv:o,sendrecv:a}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=kx(n,e,t,"sendonly"),i=kx(n,e,t,"recvonly"),o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Xx(r,i,"videoExtensions",o,a,s),Xx(r,i,"videoCodecs",o,a,s),Xx(r,i,"audioExtensions",o,a,s),Xx(r,i,"audioCodecs",o,a,s),$v("RAISE_H264_BASELINE_PRIORITY")){let e=s.videoCodecs.findIndex((e=>{var t,n;return"h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&"42001f"===(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"])}));if(-1!==e){let t=s.videoCodecs.findIndex((e=>{var t;return"h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())}));if(t<e){Ey.debug("raising H264 baseline profile priority");let n=s.videoCodecs[e];s.videoCodecs.splice(e,1),s.videoCodecs.splice(t,0,n)}-1!==t&&(a.videoCodecs=a.videoCodecs.filter((e=>{var t,n;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"]))}))),-1!==t&&$v("FILTER_SEND_H264_BASELINE")&&(o.videoCodecs=o.videoCodecs.filter((e=>{var t,n;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"]))})))}}return{send:o,recv:a,sendrecv:s}}(e,t,r);try{n.close()}catch{}return{send:i,recv:o,sendrecv:a}}function Jx(){let e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=kx(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Xx(e,t,"videoExtensions",n,r,i),Xx(e,t,"videoCodecs",n,r,i),Xx(e,t,"audioExtensions",n,r,i),Xx(e,t,"audioCodecs",n,r,i),$v("RAISE_H264_BASELINE_PRIORITY")){let e=i.videoCodecs.findIndex((e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"===e.fmtp.parameters["profile-level-id"]));if(-1!==e){let t=i.videoCodecs.findIndex((e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()));if(t<e){Ey.debug("raising H264 baseline profile priority");let n=i.videoCodecs[e];i.videoCodecs.splice(e,1),i.videoCodecs.splice(t,0,n)}-1!==t&&(r.videoCodecs=r.videoCodecs.filter((e=>!(e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"!==e.fmtp.parameters["profile-level-id"]))))}}return{send:n,recv:r,sendrecv:i}}function Xx(e,t,n,r,i,o){if("videoExtensions"===n||"audioExtensions"===n){let a=[];return e[n].forEach((e=>{t[n].some(((t,n)=>{if(e.entry===t.entry&&e.extensionName===t.extensionName)return a.push(n),!0}))?o[n].push(e):r[n].push(e)})),void t[n].forEach(((e,t)=>{-1===a.indexOf(t)&&i[n].push(e)}))}if("videoCodecs"===n||"audioCodecs"===n){let a=[];return e[n].forEach((e=>{t[n].some(((t,n)=>{if(e.payloadType===t.payloadType&&JSON.stringify(e)===JSON.stringify(t))return a.push(n),!0}))?o[n].push(e):r[n].push(e)})),void t[n].forEach(((e,t)=>{-1===a.indexOf(t)&&i[n].push(e)}))}}function zx(e){let t,n,{send:r,recv:i,sendrecv:o}=e;if(!o){if(!r||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:i}}return r?(t={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},t.audioCodecs=[...r.audioCodecs,...o.audioCodecs],t.videoCodecs=[...r.videoCodecs,...o.videoCodecs],t.audioExtensions=[...r.audioExtensions,...o.audioExtensions],t.videoExtensions=[...r.videoExtensions,...o.videoExtensions]):t=o,i?(n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},n.audioCodecs=[...i.audioCodecs,...o.audioCodecs],n.videoCodecs=[...i.videoCodecs,...o.videoCodecs],n.audioExtensions=[...i.audioExtensions,...o.audioExtensions],n.videoExtensions=[...i.videoExtensions,...o.videoExtensions]):n=o,{send:t,recv:n}}function qx(e){"audio"===e.media.mediaType&&e.attributes.payloads.filter((e=>{var t;return"opus"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())})).forEach((e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"}))}function Zx(e){e.mediaDescriptions.forEach((e=>{"video"!==e.media.mediaType&&"audio"!==e.media.mediaType||e.attributes.payloads.forEach((e=>{-1===e.rtcpFeedbacks.findIndex((e=>"rrtr"===e.type))&&e.rtcpFeedbacks.push({type:"rrtr"})}))}))}function $x(e,t,n,r){let i=[];if(e===mR.VIDEO){if($v("H264_PROFILE_LEVEL_ID")&&"h264"===r&&(i=t.videoCodecs.filter((e=>{var t;return yr(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,r)&&e&&e.fmtp&&e.fmtp.parameters["profile-level-id"]===$v("H264_PROFILE_LEVEL_ID")}))),!Array.isArray(i)||0===i.length){let e=[],o=[],a=[],s=[];if(n.videoCodecs.forEach((t=>{let n=t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"";yr(n).call(n,r)?e.push(t):yr(n).call(n,"vp9")?o.push(t):yr(n).call(n,"vp8")?a.push(t):yr(n).call(n,"h264")&&s.push(t)})),0===e.length){let t="";0!==o.length?(e=o,t="vp9"):0!==a.length?(e=a,t="vp8"):0!==s.length&&(e=s,t="h264"),Ey.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t))}0!==e.length&&(i=t.videoCodecs.filter((t=>e.some((e=>e.payloadType===t.payloadType)))))}if(0===i.length&&(Ey.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),i=t.videoCodecs),$v("USE_PUB_RTX")||$v("USE_SUB_RTX")){let e=eQ(i,t.videoCodecs);i=[...i,...e]}}else i=t.audioCodecs.filter((e=>{var t;return yr(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,r)})),0===i.length&&(Ey.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),i=t.audioCodecs.filter((e=>{var t;return yr(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,"opus")})));return i}function eQ(e,t){let n=e.map((e=>e.payloadType.toString()));return t.filter((e=>e.rtpMap&&"rtx"===e.rtpMap.encodingName&&e.fmtp&&e.fmtp.parameters.apt&&yr(n).call(n,e.fmtp&&e.fmtp.parameters.apt)))}let tQ=class{get localCapabilities(){return lv(this._localCapabilities)}get rtpCapabilities(){return lv(this._rtpCapabilities)}get candidates(){return lv(this._candidates)}get iceParameters(){return lv(this._iceParameters)}get dtlsParameters(){return lv(this._dtlsParameters)}constructor(e){O_(this,"sessionDesc",void 0),O_(this,"_localCapabilities",void 0),O_(this,"_rtpCapabilities",void 0),O_(this,"_candidates",void 0),O_(this,"_iceParameters",void 0),O_(this,"_dtlsParameters",void 0),O_(this,"setup",void 0),O_(this,"currentMidIndex",void 0),O_(this,"cname","o/i14u9pJrxRKAsu"),O_(this,"firefoxSsrcMidMap",new Map),e=lv(e);let t,{remoteIceParameters:n,remoteDtlsParameters:r,candidates:i,remoteRTPCapabilities:o,localCapabilities:a,direction:s,setup:A,videoCodec:c,audioCodec:l}=e;this.setup=A,t=s===QI.RECEIVE_ONLY?hx.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n"):hx.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n"),this._rtpCapabilities=o,this._candidates=i,this._iceParameters=n,this._dtlsParameters=r,this._localCapabilities=a;let d=s===QI.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,u=s===QI.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,h=s===QI.RECEIVE_ONLY?o.send.videoCodecs:$x(mR.VIDEO,d,u,c),p=s===QI.RECEIVE_ONLY?o.send.audioCodecs:$x(mR.AUDIO,d,u,l);for(let f of t.mediaDescriptions)f.attributes.iceUfrag=n.iceUfrag,f.attributes.icePwd=n.icePwd,f.attributes.fingerprints=r.fingerprints,f.attributes.candidates=i,f.attributes.setup=this.setup,"application"===f.media.mediaType&&(f.attributes.sctpPort="5000"),"video"===f.media.mediaType&&(f.media.fmts=h.map((e=>e.payloadType.toString(10))),f.attributes.payloads=h,f.attributes.extmaps=d.videoExtensions),"audio"===f.media.mediaType&&(f.media.fmts=p.map((e=>e.payloadType.toString(10))),f.attributes.payloads=p,f.attributes.extmaps=d.audioExtensions,qx(f));this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1}toString(){return hx.print(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every((e=>this.hasMid(e))):this.sessionDesc.mediaDescriptions.some((t=>t.attributes.mid===e))}send(e,t,n,r,i){n=n.replace(/ /g,"-");let{ssrcs:o,ssrcGroups:a}=Qx(t,this.cname,$v("SYNC_GROUP")?n:void 0),s=this.findPreloadMediaDesc(o);if(s){if(eT()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,s.attributes.mid),i&&(i.twcc||i.remb)){let e=this.sessionDesc.mediaDescriptions.indexOf(s);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(s,i),{mid:s.attributes.mid,needExchangeSDP:!0}}return{mid:s.attributes.mid,needExchangeSDP:!1}}{let t,n=this.findAvailableMediaIndex(e,o,r);return-1===n?(t=this.createOrRecycleSendMedia(e,o,a,"sendonly",r,i),this.updateBundleMids()):(t=lv(this.sessionDesc.mediaDescriptions[n]),t.attributes.direction="sendonly",t.attributes.ssrcs=o,t.attributes.ssrcGroups=a,this.sessionDesc.mediaDescriptions[n]=this.mungSendMediaDesc(t,i)),eT()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,t.attributes.mid),{needExchangeSDP:!0,mid:t.attributes.mid}}}stopSending(e){let t=this.sessionDesc.mediaDescriptions.filter((t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((e=>{e.attributes.ssrcs=[]})),this.updateBundleMids()}receive(e,t,n){let r=[];return e.forEach((e=>{let i,o=e._mediaStreamTrack.kind,a=this.findAvailableRecvMediaIndex(o),s=!1;-1===a?(s=!0,i=this.createOrRecycleRecvMedia(e,[],"recvonly",t,n),this.updateBundleMids()):(i=lv(this.sessionDesc.mediaDescriptions[a]),i.attributes.direction="recvonly"),r.push({mid:i.attributes.mid,needCreateTransceiver:s})})),r}stopReceiving(e){let t=this.sessionDesc.mediaDescriptions.filter((t=>-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((e=>{e.media.port="0",e.attributes.direction="inactive"})),this.updateBundleMids()}addRemoteCandidate(e){let{foundation:t,protocol:n,address:r,port:i,type:o,relatedAddress:a,relatedPort:s,priority:A}=new RTCIceCandidate(e),c={foundation:null!==t&&void 0!==t?t:"",componentId:"1",transport:null!==n&&void 0!==n?n:"",priority:A?A+"":"",connectionAddress:null!==r&&void 0!==r?r:"",port:i?i+"":"",type:o?o+"":"",relAddr:null!==a&&void 0!==a?a:"",relPort:s?s+"":"",extension:{}};this.candidates.some((e=>e.priority===c.priority&&e.connectionAddress===c.connectionAddress&&e.port===c.port))||(this._candidates.push(c),this.sessionDesc.mediaDescriptions.forEach((e=>{e.attributes.candidates=this.candidates})))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,r,i){let o=e._mediaStreamTrack.kind,a=this.rtpCapabilities.recv,s=$x(o,a,this.localCapabilities.send,o===mR.AUDIO?i:r),A=o===mR.VIDEO?a.videoExtensions:a.audioExtensions,c="".concat(++this.currentMidIndex),l={media:{mediaType:o,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:s.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:A,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:s,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(c)}};l=this.mungRecvMediaDsec(l,e);let d=this.findFirstClosedMedia(o);if(d){let e=this.sessionDesc.mediaDescriptions.indexOf(d);this.sessionDesc.mediaDescriptions[e]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}muteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter((t=>yr(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="inactive"}))}unmuteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter((t=>yr(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="recvonly"}))}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex((r=>{let i=r.media.mediaType===e&&"0"!==r.media.port&&("sendonly"===r.attributes.direction||"sendrecv"===r.attributes.direction)&&0===r.attributes.ssrcs.length;if(eT()){if(i){let e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==r.attributes.mid&&"1"!==r.attributes.mid)||!(!e||e!==r.attributes.mid)}return!1}return i&&r.attributes.mid===n}))}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex((t=>{let n=t.media.mediaType===e&&"0"!==t.media.port&&("recvonly"===t.attributes.direction||"sendrecv"===t.attributes.direction);return"0"!==t.attributes.mid&&"1"!==t.attributes.mid&&n}))}predictReceivingMids(e){let t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=lv(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}createOrRecycleSendMedia(e,t,n,r,i,o){let a=this.rtpCapabilities.send,s=e===mR.VIDEO?a.videoCodecs:a.audioCodecs,A=e===mR.VIDEO?a.videoExtensions:a.audioExtensions;eT()&&(i="".concat(++this.currentMidIndex));let c={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:s.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:A,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:s,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:i}};c=this.mungSendMediaDesc(c,o);let l=this.findFirstClosedMedia(e);if(l){let e=this.sessionDesc.mediaDescriptions.indexOf(l);this.sessionDesc.mediaDescriptions[e]=c}else this.sessionDesc.mediaDescriptions.push(c);return c}mungRecvMediaDsec(e,t,n){let r=lv(e);return Hx(r),Vx(r,t),Kx(r,t),jx(r),Gx(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){let n=lv(e);return Gx(n,t,this.localCapabilities.recv),qx(n),n}updateRecvMedia(e,t){let n=this.sessionDesc.mediaDescriptions.findIndex((t=>t.attributes.mid===e));if(-1!==n){let e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((e=>"0"!==e.media.port)).map((e=>e.attributes.mid))}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find((t=>{var n;return(null===(n=t.attributes)||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId)===e[0].ssrcId}))}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find((t=>eT()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port))}},nQ=["sdp"];var rQ;function iQ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function oQ(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?iQ(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):iQ(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let aQ=(rQ=class e extends ER{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.state)&&void 0!==e?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,r){super(t,n),O_(this,"direction",void 0),O_(this,"name",void 0),O_(this,"store",void 0),O_(this,"spec",void 0),O_(this,"peerConnection",void 0),O_(this,"initialOffer",void 0),O_(this,"transport",void 0),O_(this,"statsFilter",void 0),O_(this,"localCandidateCount",0),O_(this,"_isInRestartIce",!1),O_(this,"mutex",new Uv("P2PConnection-mutex")),O_(this,"onLocalCandidate",void 0),O_(this,"remoteSDP",void 0),O_(this,"pendingCandidates",[]),O_(this,"localCapabilities",void 0),O_(this,"isReady",!1),O_(this,"restartCnt",0),O_(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=null!==r&&void 0!==r?r:QI.SEND_ONLY,this.name=this.direction===QI.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=Px(this.peerConnection,$v("STATS_UPDATE_INTERVAL"),void 0,eT()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{let t=await Yx();if(this.localCapabilities=zx(t),e){let{sdp:t}=e,n=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Hy(e);for(r=0;r<o.length;r++)n=o[r],dx(t).call(t,n)>=0||(i[n]=e[n]);return i}(e,t);if(tx){var o=tx(e);for(r=0;r<o.length;r++)n=o[r],dx(t).call(t,n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,nQ),r=function(){let e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=kx(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"sendonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Xx(t,e,"videoExtensions",n,r,i),Xx(t,e,"videoCodecs",n,r,i),Xx(t,e,"audioExtensions",n,r,i),Xx(t,e,"audioCodecs",n,r,i),$v("RAISE_H264_BASELINE_PRIORITY")){let e=i.videoCodecs.findIndex((e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"===e.fmtp.parameters["profile-level-id"]));if(-1!==e){let t=i.videoCodecs.findIndex((e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()));if(t<e){Ey.debug("raising H264 baseline profile priority");let n=i.videoCodecs[e];i.videoCodecs.splice(e,1),i.videoCodecs.splice(t,0,n)}-1!==t&&$v("FILTER_SEND_H264_BASELINE")&&(n.videoCodecs=n.videoCodecs.filter((e=>!(e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"!==e.fmtp.parameters["profile-level-id"]))))}}return{send:n,recv:r,sendrecv:i}}({},{},t);this.remoteSDP=new tQ({remoteIceParameters:n.iceParameters,remoteDtlsParameters:n.dtlsParameters,candidates:[],remoteRTPCapabilities:r,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;let i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");let o=Mx(i.sdp);await this.peerConnection.setLocalDescription(i);let a=await Jx({},{},i.sdp);this.localCapabilities=zx(a);let s=this.peerConnection.getTransceivers()[0];return null!=s&&s.receiver&&s.receiver.transport&&this.tryBindTransportEvents(s.receiver.transport),oQ(oQ({},o),{},{sdp:i.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});let e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let t=Mx(e.sdp);return this.initialOffer=e,oQ(oQ({},t),{},{sdp:e.sdp})}}catch(t){throw new vT(TT.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);let{sdp:t,iceParameters:n,dtlsParameters:r}=e,i=await Jx({},{},t);this.remoteSDP=new tQ({remoteIceParameters:n,remoteDtlsParameters:r,candidates:[],remoteRTPCapabilities:i,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});let o=this.peerConnection.getTransceivers()[0];null!=o&&o.sender&&o.sender.transport&&this.tryBindTransportEvents(o.sender.transport)}catch(t){throw new vT(TT.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(t.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach((e=>{this.peerConnection.addIceCandidate(e)})),this.pendingCandidates=[])}catch(t){throw new vT(TT.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(t.toString()))}}send(e,t,n){var r=this;return ex((function*(){let i=yield GF(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let i=[],a=r.remoteSDP.receive(e,t,n);e.forEach(((e,t)=>{if(a[t].needCreateTransceiver){let t=r.peerConnection.addTransceiver(e._mediaStreamTrack,{direction:"sendonly"});i.push(t),e._updateRtpTransceiver(t)}else{let n=r.peerConnection.getTransceivers().find((e=>e.mid===a[t].mid));if(!n)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(a[t].mid));i.push(n),e._updateRtpTransceiver(n)}})),eT()&&!0===$v("SIMULCAST")&&(yield GF(r.applySimulcastForFirefox(i,e)));let s=a.map((e=>e.mid)),A=yield GF(r.peerConnection.createOffer()),c=r.mungSendOfferSDP(A.sdp,e,s),l=hx.parse(c),d=s.map((e=>{let t=l.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return Fx(t,$v("USE_PUB_RTX"))})),u=i.map(((e,t)=>{let n=s[t];return{localSSRC:d[t],id:n}}));yield GF(r.peerConnection.setLocalDescription({type:"offer",sdp:c}));try{yield u}catch(o){let e=r.remoteSDP.toString();throw yield GF(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield GF(r.peerConnection.setRemoteDescription({type:"answer",sdp:e})),yield GF(r.stopSending(s,!0)),o}yield GF(r.applySimulcastEncodings(i,e)),yield GF(r.applySendEncodings(i,e));let h=r.remoteSDP.toString(),p=r.logSDPExchange(c,"offer","local","send");return null!==p&&void 0!==p&&p(h),yield GF(r.setRemoteDescription({type:"answer",sdp:h})),i.map(((e,t)=>{let n=s[t];return{localSSRC:d[t],id:n}}))}catch(a){throw a instanceof vT?a:new vT(TT.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(a.toString()))}finally{i()}}))()}async stopSending(e,t){let n=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let t=this.peerConnection.getTransceivers().filter((t=>-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length (".concat(t.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));t.map((e=>{var t;e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)}));let n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);let i=this.remoteSDP.toString();null!==r&&void 0!==r&&r(i),await this.setRemoteDescription({type:"answer",sdp:i})}catch(r){throw new vT(TT.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}finally{n&&n()}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));let{mid:i,needExchangeSDP:o}=this.remoteSDP.send(e,t,n,r);if(o){let t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:t});let r=await this.peerConnection.createAnswer(),o=this.mungReceiveAnswerSDP(r.sdp,i,e);null!==n&&void 0!==n&&n(o||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:o}),Ey.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else Ey.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));let a=this.peerConnection.getTransceivers().find((e=>e.mid===i));if(!a||null===a.mid)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,mid:a.mid,transceiver:a}}catch(i){throw new vT(TT.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async mockReceive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));let{mid:i,needExchangeSDP:o}=this.remoteSDP.send(e,t,n,r);if(o){let t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:t});let r=await this.peerConnection.createAnswer(),o=this.mungReceiveAnswerSDP(r.sdp,i,e);null!==n&&void 0!==n&&n(o||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:o}),Ey.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else Ey.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(i){throw new vT(TT.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);let t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:t});let r=await this.peerConnection.createAnswer();null!==n&&void 0!==n&&n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(t){throw new vT(TT.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(t.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===Jv.Auto&&(this.store.p2pTransport=Jv.SdRtn,oL().supportPCSetConfiguration&&this.peerConnection.setConfiguration(e.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,oL().supportPCSetConfiguration&&this.peerConnection.setConfiguration(e.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;let e=await this.peerConnection.createOffer({iceRestart:!0});if(!e.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let{iceParameters:t}=Mx(e.sdp);return this.store.descriptionStart(),this.direction===QI.SEND_ONLY&&await this.peerConnection.setLocalDescription(e),t}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===QI.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});let e=await this.peerConnection.createAnswer();if(!e.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");let{iceParameters:t}=Mx(e.sdp);return await this.peerConnection.setLocalDescription(e),t}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new vT(TT.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let n=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(n.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);let i=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),null!==o&&void 0!==o&&o(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(n){throw new vT(TT.EXCHANGE_SDP_FAILED,n.toString())}}async updateSendParameters(e,t){let n=this.peerConnection.getTransceivers().filter((t=>t.mid===e));1===n.length&&(this.isVP8Simulcast(t)?eT()||await this.applySimulcastEncodings(n,[t]):await this.applySendEncodings(n,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){let n=this.peerConnection.getTransceivers().find((e=>e.mid===t));n&&await n.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){let e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){let t=e[0].transport.iceTransport,{local:n,remote:r}=t.getSelectedCandidatePair();return{local:oQ(oQ({},gx),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:oQ(oQ({},gx),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,t;yr(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),null===(t=this.onICEConnectionStateChange)||void 0===t||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;"connected"===this.peerConnection.connectionState&&(this.restartCnt=0),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{var t;e.candidate?(e.candidate.candidate&&(null===(t=this.onLocalCandidate)||void 0===t||t.call(this,e.candidate.toJSON())),this.localCandidateCount+=1):Ey.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i={iceServers:[]};var o;return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(XT(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers,n,r)),$v("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,r)),yr(o=[Jv.Relay,Jv.SdRtn]).call(o,n)&&(i.iceTransportPolicy="relay"),$v("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(i.iceTransportPolicy="relay")})))),$v("ENABLE_ENCODED_TRANSFORM")&&oL().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),Ey.debug("P2PConnection p2pTransport is ".concat(n)),i}static turnServerConfigToIceServers(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[],i=e.filter((e=>e.tcpport));Ey.debug("P2PConnection turnServers is ".concat(i,", current index is ").concat(n));let o=i.length>n?i[n]:i[0];switch(t){case Jv.SdRtn:let t=e.filter((e=>{var t;return yr(t=e.username).call(t,"glb:")&&e.turnServerURL==e.turnServerURL})),i=t.length>n?t[n]:t[0];i&&(r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(ob(i.turnServerURL),":").concat(i.tcpport,"?transport=udp")}),r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(ob(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}));break;case Jv.Relay:o&&(r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(ob(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}));break;default:o&&(r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(ob(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}),r.push({username:o.username,credential:o.password,credentialType:"password",urls:"stun:".concat(o.turnServerURL,":").concat(o.tcpport)}))}return r}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var t;null!=e&&e.state&&(null===(t=this.onDTLSTransportStateChange)||void 0===t||t.call(this,e.state))},e.onerror=e=>{var t;null===(t=this.onDTLSTransportError)||void 0===t||t.call(this,"error"in e?e.error:e)};let t=e.iceTransport;t&&(t.onstatechange=()=>{let t=null===e||void 0===e?void 0:e.iceTransport.state;var n;t&&(null===(n=this.onICETransportStateChange)||void 0===n||n.call(this,t))},t.getSelectedCandidatePair&&(t.onselectedcandidatepairchange=()=>{if(t.getSelectedCandidatePair()){let{local:e,remote:n}=t.getSelectedCandidatePair();Ey.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:e.type,protocol:e.protocol}),", remote ").concat(JSON.stringify({candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var n;if(t||(t=this.peerConnection.getSenders().find((t=>t.track===e._mediaStreamTrack))),!t)return Ey.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return Ey.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!oL().supportSetRtpSenderParameters)return Ey.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let r={},i={};switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(e._encoderConfig){var o;let{bitrateMax:t,frameRate:n,scaleResolutionDownBy:r}=e._encoderConfig;t&&(i.maxBitrate=1e3*t),yr(o=e._hints).call(o,vL.LOW_STREAM)&&(n&&(i.maxFramerate=sb(n)),r&&r>=1&&(i.scaleResolutionDownBy=r))}if($v("DSCP_TYPE")&&gT()){var a;let e=$v("DSCP_TYPE");yr(a=["very-low","low","medium","high"]).call(a,e)&&(i.networkPriority=e)}let s=t.getParameters(),A=null===(n=s.encodings)||void 0===n?void 0:n[0];eT()&&!A&&(r.encodings=[i]),A&&Object.assign(A,i),Object.assign(s,r),Ey.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(s.encodings))),await t.setParameters(s)}async applySendEncodings(e,t){try{if(!oL().supportSetRtpSenderParameters||e.length!==t.length)return;for(let n=0;n<e.length;n++){let r=e[n],i=t[n];i instanceof uF&&!this.isVP8Simulcast(i)&&await this.updateRtpSenderEncodings(i,r.sender)}}catch{Ey.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,n){let r=hx.parse(e);return t.forEach(((e,t)=>{let i=n[t],o=r.mediaDescriptions.find((e=>e.attributes.mid===i));o&&(Vx(o,e),Wx(o,e,this.store.codec))})),hx.print(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let s=0;s<e.length;s++){var n,r,i,o,a;let A=e[s],c=t[s];if(c instanceof uF&&!yr(n=c._hints).call(n,vL.LOW_STREAM)&&null!==(r=c._encoderConfig)&&void 0!==r&&r.bitrateMax&&(null===(i=c._encoderConfig)||void 0===i?void 0:i.bitrateMax)>200&&null!==(o=c._scalabilityMode)&&void 0!==o&&o.numSpatialLayers&&(null===(a=c._scalabilityMode)||void 0===a?void 0:a.numSpatialLayers)>1&&"vp8"===this.store.codec){let e={},t={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];let n=A.sender.getParameters();await A.sender.setParameters(Object.assign(n,e))}}}async applySimulcastEncodings(e,t){if(!eT()&&e.length===t.length)for(let n=0;n<e.length;n++){let r=t[n];if(r instanceof uF&&this.isVP8Simulcast(r)){let t=e[n],i={},o={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};i.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:o.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:o.medium,scaleResolutionDownBy:4}];let a=t.sender.getParameters();await t.sender.setParameters(Object.assign(a,i))}}}isVP8Simulcast(e){var t,n,r,i,o;return!!(e instanceof uF&&$v("SIMULCAST")&&"vp8"===this.store.codec&&!yr(t=e._hints).call(t,vL.LOW_STREAM)&&null!==(n=e._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=e._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=e._scalabilityMode)&&void 0!==i&&i.numSpatialLayers&&(null===(o=e._scalabilityMode)||void 0===o?void 0:o.numSpatialLayers)>1)}logSDPExchange(e,t,n,r){if($v("SDP_LOGGING"))return Ey.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((e=>{e.direction="inactive"}));let n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);let i=this.remoteSDP.toString();null!==r&&void 0!==r&&r(i),await this.setRemoteDescription({type:"answer",sdp:i})}catch(t){throw new vT(TT.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(t.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((async e=>{e.direction="sendonly"}));let n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e);let i=this.remoteSDP.toString();null!==r&&void 0!==r&&r(i),await this.setRemoteDescription({type:"answer",sdp:i})}catch(t){throw new vT(TT.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(t.toString()))}}async getRemoteSSRC(e,t){var n,r;if(t=null!==(n=t)&&void 0!==n?n:null===(r=this.currentRemoteDescription)||void 0===r?void 0:r.sdp){var i;let n=null===(i=hx.parse(t).mediaDescriptions.find((t=>t.attributes.mid===e)))||void 0===i?void 0:i.attributes.ssrcs;return null===n||void 0===n?void 0:n[0].ssrcId}}async setRemoteDescription(e){var t;await this.peerConnection.setRemoteDescription(e),yr(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,t,n){let r=hx.parse(e),i=r.mediaDescriptions.find((e=>e.attributes.mid===t));return i&&n===mR.AUDIO&&"audio"===i.media.mediaType&&qx(i),hx.print(r)}},_I(rQ.prototype,"establish",[sQ],Object.getOwnPropertyDescriptor(rQ.prototype,"establish"),rQ.prototype),_I(rQ.prototype,"connect",[sQ],Object.getOwnPropertyDescriptor(rQ.prototype,"connect"),rQ.prototype),_I(rQ.prototype,"receive",[sQ],Object.getOwnPropertyDescriptor(rQ.prototype,"receive"),rQ.prototype),_I(rQ.prototype,"mockReceive",[sQ],Object.getOwnPropertyDescriptor(rQ.prototype,"mockReceive"),rQ.prototype),_I(rQ.prototype,"stopReceiving",[sQ],Object.getOwnPropertyDescriptor(rQ.prototype,"stopReceiving"),rQ.prototype),_I(rQ.prototype,"restartICE",[sQ],Object.getOwnPropertyDescriptor(rQ.prototype,"restartICE"),rQ.prototype),_I(rQ.prototype,"close",[sQ],Object.getOwnPropertyDescriptor(rQ.prototype,"close"),rQ.prototype),_I(rQ.prototype,"updateEncoderConfig",[sQ],Object.getOwnPropertyDescriptor(rQ.prototype,"updateEncoderConfig"),rQ.prototype),_I(rQ.prototype,"updateSendParameters",[sQ],Object.getOwnPropertyDescriptor(rQ.prototype,"updateSendParameters"),rQ.prototype),_I(rQ.prototype,"replaceTrack",[sQ],Object.getOwnPropertyDescriptor(rQ.prototype,"replaceTrack"),rQ.prototype),_I(rQ.prototype,"muteLocal",[sQ],Object.getOwnPropertyDescriptor(rQ.prototype,"muteLocal"),rQ.prototype),_I(rQ.prototype,"unmuteLocal",[sQ],Object.getOwnPropertyDescriptor(rQ.prototype,"unmuteLocal"),rQ.prototype),rQ);function sQ(e,t,n){let r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){let e=this.mutex,n=await e.lock("From P2PConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return await r.apply(this,o)}finally{n()}},n}function AQ(e,t){let n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=sb(t.width),r.height=sb(t.height);let i=sb(t.framerate||15);document.body.append(n),document.body.append(r);let o=e._mediaStreamTrack;n.srcObject=new MediaStream([o]),n.play();let a=r.getContext("2d");if(!a)throw new HI(TT.UNEXPECTED_ERROR,"can not get canvas context");let s=oL(),A=r.captureStream(s.supportRequestFrame?0:i).getVideoTracks()[0];A.canvas||(A.canvas=r),r.startCapture=()=>{if(!n)return r.stopCapture&&r.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){let e=n.videoWidth,t=n.videoHeight/e,i=r.width*t;Math.abs(i-r.height)>=2&&(Ey.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(i)),r.height=i)}a.drawImage(n,0,0,r.width,r.height),A.requestFrame&&A.requestFrame(),o!==e._mediaStreamTrack&&(o=e._mediaStreamTrack,n.srcObject=new MediaStream([o]))},r.stopCapture=rk((()=>r.startCapture&&r.startCapture()),i);let c=A.stop;return A.stop=()=>{c.call(A),n&&(n.remove(),n.srcObject=null,n=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),Ey.debug("clean low stream renderer")},A}var cQ=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(cQ||{}),lQ=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e}(lQ||{}),dQ=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(dQ||{}),uQ=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e}(uQ||{}),hQ=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(hQ||{}),pQ=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(pQ||{}),fQ=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e}(fQ||{}),EQ=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e}(EQ||{}),gQ=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(gQ||{}),mQ=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e}(mQ||{});let _Q=1e3;function CQ(e,t,n){null!=n&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function wQ(e){let t={[mQ.CONN_TYPE]:0,[mQ.RTT]:e.rtt};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{let n=e.selectedCandidatePair.localCandidate.relayProtocol;"udp"===n&&(t[mQ.CONN_TYPE]=1),"tcp"===n&&(t[mQ.CONN_TYPE]=3),"tls"===n&&(t[mQ.CONN_TYPE]=4);break}case"srflx":t[mQ.CONN_TYPE]=2}return t}function SQ(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class TQ extends VT{constructor(e){super(),O_(this,"store",void 0),O_(this,"uploadWRTCStatsTimer",void 0),O_(this,"uploadOutboundDenoiserStatsTimer",void 0),O_(this,"uploadExtStatsTimer",void 0),O_(this,"uploadExtUsageStatsTimer",void 0),O_(this,"uploadInboundExtStatsTimer",void 0),O_(this,"requestStats",void 0),O_(this,"requestTransportStats",void 0),O_(this,"requestLocalMedia",void 0),O_(this,"requestRemoteMedia",void 0),O_(this,"requestAllTracks",void 0),O_(this,"requestVideoIsReady",void 0),O_(this,"requestUploadStats",void 0),O_(this,"requestUpload",void 0),O_(this,"uploadOutboundStarted",!1),O_(this,"uploadInboundStarted",!1),O_(this,"uploadTransportStarted",!1),O_(this,"uploadExtensionUsageStarted",!1),O_(this,"lastRecvStats",void 0),O_(this,"lastSendStats",void 0),O_(this,"lastFullRecvStats",void 0),O_(this,"lastFullSendStats",void 0),O_(this,"needUploadRenderFreezeTime",!0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;let t,n;if(this.uploadTransportStarted&&(t=this.requestStats(),this.store.useP2P&&(n=this.requestStats(!0))),!t&&this.uploadOutboundStarted&&(t=this.requestStats()),!n&&this.uploadInboundStarted&&(n=this.requestStats(!0)),t||n){let r={};if(this.uploadTransportStarted&&t){let i=this.getTransportStats(t,n,e);i&&(r.misc=[i])}if(this.uploadOutboundStarted&&t){let n=this.getOutboundStats(t,e?this.lastSendStats:this.lastFullSendStats,e);n&&(r.outbound=[n])}if(this.uploadInboundStarted&&n){let t=this.getInboundStats(n,e?this.lastRecvStats:this.lastFullRecvStats,e);t&&(r.inbound=t)}this.requestUploadStats(r)}this.lastRecvStats=n,this.lastSendStats=t,e||(this.lastFullRecvStats=n,this.lastFullSendStats=t)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;let e=1;this.uploadWRTCStatsTimer=window.setInterval((()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted)return this.stopUploadWRTCStats();this.uploadWRTCStats(3!==e),4===++e&&(e=1)}),_Q)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(e,t,n){if(!this.requestStats)return;if(n)return null==e.rtt?void 0:{addition:{[mQ.RTT]:e.rtt,[mQ.CONN_TYPE]:void 0}};let r=wQ(e);if(this.store.useP2P){if(t){let e=wQ(t);r[mQ.CONN_TYPE]+=e[mQ.CONN_TYPE]<<3}r[mQ.CONN_TYPE]+=110}else r[mQ.CONN_TYPE]+=100;return{addition:r}}getOutboundStats(e,t,n){if(!this.requestUploadStats||!this.requestLocalMedia)return;let r,i,o,a=this.requestLocalMedia();return a&&0!==a.length?(a.forEach((a=>{let[s,{track:A,ssrcs:c}]=a;switch(s){case wR.LocalVideoLowTrack:case wR.LocalVideoTrack:if(s===wR.LocalVideoTrack){let r=function(e,t,n,r,i){let o=t.videoSend.find((t=>t.ssrc===e));if(!o)return;let a={},{sentFrame:s,inputFrame:A}=o;if(A&&s){let e=A.frameRate,t=s.frameRate;a[lQ.FREEZE]=function(e,t){let n=!0;return n=!(e<=5)&&(e<=10?t<3:e<=20?t<4:t<5),n}(e,t)?1:0}if(CQ(a,lQ.QP_SUM,o.qpSumPerFrame),i)return a;switch(s&&(CQ(a,lQ.HEIGHT,s.height),CQ(a,lQ.WIDTH,s.width),CQ(a,lQ.FRAME_RATE,s.frameRate)),a[lQ.DISABLED]=r._originMediaStreamTrack&&!r._originMediaStreamTrack.enabled||r._mediaStreamTrack&&!r._mediaStreamTrack.enabled?1:0,o.adaptionChangeReason){case"none":a[lQ.ADAPTATION]=0;break;case"cpu":a[lQ.ADAPTATION]=1;break;case"bandwidth":a[lQ.ADAPTATION]=2;break;case"other":a[lQ.ADAPTATION]=3}let c=0;o.adaptionChangeReason&&(c+=SQ(o.adaptionChangeReason)),t.qualityLimitationReason&&(c+=SQ(t.qualityLimitationReason)<<3),a[lQ.ADAPTATION]=c,a[lQ.PLAYER_STATUS]=KL[r._player?r._player.videoElementStatus:"uninit"],CQ(a,lQ.NACKS,o.nacksCount),CQ(a,lQ.PLIS,o.plisCount),CQ(a,lQ.FIRS,o.firsCount),CQ(a,lQ.AVG_ENCODE,o.avgEncodeMs);let l=n&&n.videoSend.find((t=>t.ssrc===e));if(l){let e=i?_Q:3e3;l.timestamp&&o.timestamp&&(e=o.timestamp-l.timestamp),null!=l.packets&&null!=o.packets&&CQ(a,lQ.PACKAGE_RATE,1e3*(o.packets-l.packets)/e),null!=o.packetsLost&&null!=l.packetsLost&&CQ(a,lQ.PACKAGE_LOST,o.packetsLost-l.packetsLost),null!=l.bytes&&null!=o.bytes&&CQ(a,lQ.BITRATE,8*(o.bytes-l.bytes)/e)}return a}(c[0].ssrcId,e,t,A,n),o=n?null:function(e,t,n){let r=t.videoSend.find((t=>t.ssrc===e));if(!r)return null;let i={},o=r.inputFrame,a=o&&o.height||n&&n.videoHeight||0,s=o&&o.width||n&&n.videoWidth||0,A=o&&o.frameRate||0;return CQ(i,cQ.HEIGHT,a),CQ(i,cQ.WIDTH,s),CQ(i,cQ.FRAME_RATE,A),i}(c[0].ssrcId,e,A),a=n?null:function(e){let t={};return CQ(t,lQ.RETRANSMIT,e.bitrate.retransmit),CQ(t,lQ.TARGET_ENCODED,e.bitrate.targetEncoded),CQ(t,lQ.ACTUAL_ENCODED,e.bitrate.actualEncoded),CQ(t,lQ.TRANSMIT,e.bitrate.transmit),CQ(t,lQ.BANDWIDTH,e.sendBandwidth),t}(e);i=Object.assign({},r,o,a)}else o=n?void 0:function(e,t,n){let r=t.videoSend.find((t=>t.ssrc===e));if(!r)return;let i={},o=r.sentFrame;if(o&&(CQ(i,dQ.HEIGHT,o.height),CQ(i,dQ.WIDTH,o.width),CQ(i,dQ.FRAME_RATE,o.frameRate)),n){let t=n.videoSend.find((t=>t.ssrc===e));if(t){let e=3e3;t.timestamp&&r.timestamp&&(e=r.timestamp-t.timestamp),null!=t.packets&&null!=r.packets&&CQ(i,dQ.PACKAGE_RATE,1e3*(r.packets-t.packets)/e),null!=r.packetsLost&&null!=t.packetsLost&&CQ(i,dQ.PACKAGE_LOST,r.packetsLost-t.packetsLost),null!=t.bytes&&null!=r.bytes&&CQ(i,dQ.BITRATE,8*(r.bytes-t.bytes)/e)}}return i}(c[0].ssrcId,e,t);break;case wR.LocalAudioTrack:r=n?void 0:function(e,t,n,r){let i=t.audioSend.find((t=>t.ssrc===e));if(!i)return;let o={};o[fQ.DISABLED]=r._originMediaStreamTrack&&!r._originMediaStreamTrack.enabled||r._mediaStreamTrack&&!r._mediaStreamTrack.enabled?1:0;let a=100*r._source.getAccurateVolumeLevel(),s=i.inputLevel;if(null!=s){let e=Math.ceil(50*Math.log10(100*s+1));CQ(o,fQ.LEVEL,e)}CQ(o,pQ.PCM_LEVEL,a),CQ(o,fQ.AEC_RETURN_LOSS,i.aecReturnLoss),CQ(o,fQ.AEC_RETURN_LOSS_ENH,i.aecReturnLossEnhancement),o[fQ.FREEZE]=0;let A=n&&n.audioSend.find((t=>t.ssrc===e));if(A){let e=3e3;A.timestamp&&i.timestamp&&(e=i.timestamp-A.timestamp),null!=A.bytes&&null!=i.bytes&&CQ(o,fQ.BITRATE,8*(i.bytes-A.bytes)/e),null!=A.packets&&null!=i.packets&&CQ(o,fQ.PACKAGE_RATE,1e3*(i.packets-A.packets)/e)}return o}(c[0].ssrcId,e,t,A)}})),{high:i,low:o,audio:r}):void 0}getInboundStats(e,t,n){if(!this.requestRemoteMedia)return;let r=this.requestRemoteMedia()||[],i=[];return r.forEach((r=>{let[o,a]=r,s={peer:o.uid};if(a.has(mR.VIDEO)&&o.videoTrack){let r=o._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(o._videoSSRC)||!1,i=o.videoTrack?function(e,t,n,r,i,o,a){var s;let A=t.videoRecv.find((t=>t.ssrc===e));if(!A)return;let c={},{receivedFrame:l,outputFrame:d,decodeFrameRate:u}=A,h=n&&n.videoRecv.find((t=>t.ssrc===e));if(c[uQ.FREEZE]=i&&YQ.isRemoteVideoFreeze(r,A,h)?1:0,CQ(c,hQ.FRAME_RATE_DECODE,u),CQ(c,uQ.QP_SUM,A.qpSumPerFrame),A.framesRateFirefox&&CQ(c,uQ.FRAME_RATE,A.framesRateFirefox),l&&CQ(c,uQ.FRAME_RATE,l.frameRate),h){let e=t.timestamp-n.timestamp||(a?_Q:3e3);null!=A.packetsLost&&null!=h.packetsLost&&CQ(c,uQ.PACKAGE_LOST,A.packetsLost-h.packetsLost),null!=h.bytes&&null!=A.bytes&&CQ(c,uQ.BITRATE,8*(A.bytes-h.bytes)/e),null!=h.packets&&null!=A.packets&&CQ(c,uQ.PACKAGE_RATE,1e3*(A.packets-h.packets)/e)}if(a)return c;l?(CQ(c,uQ.HEIGHT,l.height),CQ(c,uQ.WIDTH,l.width)):r&&(CQ(c,uQ.HEIGHT,r._videoHeight||0),CQ(c,uQ.WIDTH,r._videoWidth||0)),d&&CQ(c,hQ.FRAME_RATE_OUTPUT,d.frameRate);let p=null===(s=r._player)||void 0===s?void 0:s.rendFrameRate.toFixed(0);if(p&&CQ(c,hQ.FRAME_RATE_RENDER,+p),CQ(c,uQ.JITTER_BUFFER,A.jitterBufferMs),CQ(c,uQ.CURRENT_DELAY,A.currentDelayMs),CQ(c,uQ.FIRS,A.firsCount),CQ(c,uQ.NACKS,A.nacksCount),CQ(c,uQ.PLIS,A.plisCount),r){c[uQ.DISABLED]=r._originMediaStreamTrack.enabled&&r._mediaStreamTrack.enabled?0:1;let e=r._player;if(e){let{freezeTimeCounterList:t,renderFreezeAccTime:n,videoElementStatus:r}=e;if(t&&t.length>0&&CQ(c,hQ.FREEZE_TIME,t.splice(0,1)[0]),o&&"visible"===BF.visibility&&r===VL.PLAYING&&oL().supportRequestVideoFrameCallback){let t=Math.min(6e3,n);e.renderFreezeAccTime=Math.max(0,n-t),CQ(c,hQ.FREEZE_TIME_RENDER,t)}if("number"==typeof A.totalFreezesDuration){let e=h&&h.totalFreezesDuration?A.totalFreezesDuration-h.totalFreezesDuration:A.totalFreezesDuration;CQ(c,hQ.FREEZE_DURATION,1e3*e)}}}if(c[uQ.PLAYER_STATUS]=KL[r._player?r._player.videoElementStatus:"uninit"],h&&void 0!==A.totalInterFrameDelay&&void 0!==A.totalSquaredInterFrameDelay&&void 0!==h.totalInterFrameDelay&&void 0!==h.totalSquaredInterFrameDelay){let e=A.totalInterFrameDelay-h.totalInterFrameDelay,t=A.totalSquaredInterFrameDelay-h.totalSquaredInterFrameDelay,n=A.framesDecodeCount-h.framesDecodeCount,r=e/n*1e3,i=Math.round(1e3*Math.sqrt((t-Math.pow(e,2)/n)/n));!isNaN(i)&&r+i>Math.max(3*r,r+150)&&(c[uQ.I_FRAME_DELAY]=i)}return c}(o._videoSSRC,e,t,o.videoTrack,!0===r,this.needUploadRenderFreezeTime,n):void 0;i&&(s.video=i)}if(a.has(mR.AUDIO)&&o.audioTrack){let r=o.audioTrack?function(e,t,n,r,i){let o=t.audioRecv.find((t=>t.ssrc===e));if(!o)return;let a={},s=n&&n.audioRecv.find((t=>t.ssrc===e)),{receivedFrames:A,droppedFrames:c}=o;var l;if(CQ(a,EQ.JITTER,o.jitterMs),null!=A&&null!=c&&(a[EQ.FREEZE]=0===(l=A)||100*c/l>20?1:0),s){let e=t.timestamp-n.timestamp||(i?_Q:3e3);null!=o.packets&&null!=s.packets&&CQ(a,EQ.PACKAGE_RATE,1e3*(o.packets-s.packets)/e),null!=s.bytes&&null!=o.bytes&&CQ(a,EQ.BITRATE,8*(o.bytes-s.bytes)/e),null!=o.packetsLost&&null!=s.packetsLost&&CQ(a,EQ.PACKAGE_LOST,o.packetsLost-s.packetsLost)}if(i)return a;let d=100*r._source.getAccurateVolumeLevel(),u=o.outputLevel;if(null!=u){let e=Math.ceil(50*Math.log10(100*u+1));CQ(a,gQ.LEVEL,e)}if(CQ(a,EQ.PCM_LEVEL,d),r&&(a[EQ.DISABLED]=r._originMediaStreamTrack.enabled&&r._mediaStreamTrack.enabled?0:1),CQ(a,EQ.JITTER_BUFFER,o.jitterBufferMs),CQ(a,EQ.CURRENT_DELAY,o.jitterBufferMs),a[EQ.PLAYER_STATUS]=KL[Sk.getPlayerState(r.getTrackId())],s){let e=o.concealedSamples-s.concealedSamples;e>0&&CQ(a,EQ.CONCEALED_SAMPLES,e)}return a}(o._audioSSRC,e,t,o.audioTrack,n):void 0;r&&(s.audio=r)}(s.video||s.audio)&&i.push(s)})),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,i}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval((()=>{if(!this.requestAllTracks||!this.requestUpload)return;let e=(this.requestAllTracks()||[]).find((e=>e instanceof TM));if(e&&e._external.getDenoiserStats){let t=e._external.getDenoiserStats();t&&this.requestUpload(FI.DENOISER_STATS,t)}}),2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval((()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach((e=>{e.getProcessorStats().forEach((e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)}))}))}),2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval((()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach((e=>{let[t,n]=e;n.has(mR.VIDEO)&&t.videoTrack&&t.videoTrack.getProcessorStats().forEach((e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)})),n.has(mR.AUDIO)&&t.audioTrack&&t.audioTrack.getProcessorStats().forEach((e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)}))}))}),2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);let e=new Map;this.uploadExtUsageStatsTimer=window.setInterval((async()=>{let t=Date.now(),n={connectionInterval:$v("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:t},r=[],i=this.requestAllTracks&&this.requestAllTracks()||[];for(let e of i)!e.muted&&e.enabled&&(r=r.concat(await e.getProcessorUsage()));let o=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(let[e,A]of o)A.has(mR.VIDEO)&&e.videoTrack&&(r=r.concat(await e.videoTrack.getProcessorUsage())),A.has(mR.AUDIO)&&e.audioTrack&&(r=r.concat(await e.audioTrack.getProcessorUsage()));if(0===r.length)return;n.details=function(e,t){let n={};for(let{id:a,value:s,level:A,direction:c}of e){var r;let e=null!==(r=t.get(a))&&void 0!==r?r:0,l=2===s?e+$v("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:e;var i,o;t.set(a,l),n[a]?(2===s&&(n[a].value=s),A>n[a].level&&(n[a].level=A),"remote"===c&&(n[a].remoteUidCount+=1),n[a].totalTs=null!==(i=t.get(a))&&void 0!==i?i:0):n[a]={value:s,level:A,remoteUidCount:"local"===c?0:1,totalTs:null!==(o=t.get(a))&&void 0!==o?o:0}}return Object.keys(n).map((e=>{let{level:t,value:r,totalTs:i}=n[e];return{id:e,level:t,value:r,totalTs:i}}))}(r,e);let a=Date.now(),s=a>t?a:t+1;this.requestUpload&&this.requestUpload(FI.EXTENSION_USAGE_STATS,{usageStats:n,sendTs:s})}),$v("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}}class vQ{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,t){O_(this,"uid",void 0),O_(this,"_uintid",void 0),O_(this,"_trust_in_room_",!0),O_(this,"_trust_audio_enabled_state_",!0),O_(this,"_trust_video_enabled_state_",!0),O_(this,"_trust_audio_mute_state_",!0),O_(this,"_trust_video_mute_state_",!0),O_(this,"_audio_muted_",!1),O_(this,"_video_muted_",!1),O_(this,"_audio_enabled_",!0),O_(this,"_video_enabled_",!0),O_(this,"_audio_added_",!1),O_(this,"_video_added_",!1),O_(this,"_is_pre_created",!1),O_(this,"_video_pre_subscribed",!1),O_(this,"_audio_pre_subscribed",!1),O_(this,"_trust_video_stream_added_state_",!0),O_(this,"_trust_audio_stream_added_state_",!0),O_(this,"_audioTrack",void 0),O_(this,"_videoTrack",void 0),O_(this,"_dataChannels",[]),O_(this,"_audioSSRC",void 0),O_(this,"_videoSSRC",void 0),O_(this,"_audioOrtc",void 0),O_(this,"_videoOrtc",void 0),O_(this,"_cname",void 0),O_(this,"_rtxSsrcId",void 0),O_(this,"_videoMid",void 0),O_(this,"_audioMid",void 0),this.uid=e,this._uintid=t}}let yQ=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});function IQ(e,t){var n;let r;switch(t){case wR.LocalAudioTrack:r=aR.Audio;break;case wR.LocalVideoTrack:r=yr(n=e._hints).call(n,vL.SCREEN_TRACK)?aR.Screen:aR.High;break;case wR.LocalVideoLowTrack:r=aR.Low}return r}function RQ(e){let t=oL();if(e.some((e=>e._bypassWebAudio)))throw new vT(TT.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new vT(TT.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function bQ(e,t){RQ(e);let n=new yM;return e.forEach((e=>n.addAudioTrack(e))),n}var OQ,BQ,NQ,DQ,PQ,UQ,LQ,kQ,MQ,FQ,xQ,QQ;function VQ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function HQ(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?VQ(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VQ(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let KQ=(OQ=jQ(yQ.SEND_ONLY),BQ=jQ(yQ.SEND_ONLY),NQ=jQ(),DQ=jQ(yQ.RECEIVE_ONLY),PQ=jQ(yQ.RECEIVE_ONLY),UQ=jQ(yQ.RECEIVE_ONLY),LQ=jQ(yQ.RECEIVE_ONLY),kQ=jQ(yQ.RECEIVE_ONLY),MQ=jQ(yQ.RECEIVE_ONLY),FQ=jQ(),xQ=jQ(yQ.RECEIVE_ONLY),QQ=class extends VT{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(TR.StateChange,t,this._state)}constructor(e,t){super(),O_(this,"store",void 0),O_(this,"statsUploader",void 0),O_(this,"sendConnection",void 0),O_(this,"recvConnection",void 0),O_(this,"localTrackMap",new Map),O_(this,"remoteUserMap",new Map),O_(this,"localDataChannels",[]),O_(this,"pendingLocalTracks",[]),O_(this,"pendingRemoteTracks",[]),O_(this,"statsCollector",void 0),O_(this,"dtlsFailedCount",0),O_(this,"sendMutex",new Uv("P2PChannel2-send-mutex")),O_(this,"recvMutex",new Uv("P2PChannel2-recv-mutex")),O_(this,"_state",SR.Disconnected),O_(this,"_restartStates",["disconnected","failed"]),O_(this,"reconnectInterval",void 0),O_(this,"uploadUnplinkStarted",!1),O_(this,"uploadDownlinkStarted",!1),O_(this,"uplinkStateUploadInterval",void 0),O_(this,"downlinkStatsUploadInterval",void 0),O_(this,"handleMuteLocalTrack",(async(e,t,n)=>{let r=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==SR.Connected)return void n(new vT(TT.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));let r=this.filterTobeMutedTracks(e);if(0===r.length)return void t();let a=r.find((e=>"videoLowTrack"===e[0]));a&&a[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(r.map((e=>{let[,{id:t}]=e;return t})));let s=!1;var i,o;s="video"===e.trackMediaType?!(null===(i=this.localTrackMap.get(wR.LocalAudioTrack))||void 0===i||!i.track._muted):void 0===(null===(o=this.localTrackMap.get(wR.LocalVideoTrack))||void 0===o?void 0:o.id);let A=this.createMuteMessage(r);await rv(this,TR.RequestMuteLocal,A);let c="video"===e.trackMediaType?LR.MUTE_LOCAL_VIDEO:LR.MUTE_LOCAL_AUDIO;await rv(this,TR.RequestP2PMuteLocal,{action:c,message:A,isMuteAll:s}),t()}catch(a){n(a)}finally{r()}})),O_(this,"handleUnmuteLocalTrack",(async(e,t,n)=>{let r=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==SR.Connected)return void n(new vT(TT.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));let r=this.filterTobeUnmutedTracks(e);if(0===r.length)return void t();await this.sendConnection.unmuteLocal(r.map((e=>{let[,{id:t}]=e;return t})));let i=this.createUnmuteMessage(r),o="video"===e.trackMediaType?LR.UNMUTE_LOCAL_VIDEO:LR.UNMUTE_LOCAL_AUDIO;await rv(this,TR.RequestP2PMuteLocal,{action:o,message:i}),t()}catch(i){n(i)}finally{r()}})),O_(this,"handleUpdateVideoEncoder",(async(e,t,n)=>{let r=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{let n=this.localTrackMap.get(wR.LocalVideoTrack);if(!this.sendConnection||!n||n.track!==e||this.state!==SR.Connected)return void t();let{id:r,track:i}=n;r&&(await this.sendConnection.updateSendParameters(r,i),await this.sendConnection.updateEncoderConfig(r,i),this.emit(TR.UpdateVideoEncoder,i)),t()}catch(i){n(i)}finally{r()}})),O_(this,"handleUpdateVideoSendParameters",(async(e,t,n)=>{let r=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{let n=this.localTrackMap.get(wR.LocalVideoTrack);if(!this.sendConnection||!n||n.track!==e||this.state!==SR.Connected)return void t();let{id:r,track:i}=n;r&&await this.sendConnection.updateSendParameters(r,i),t()}catch(i){n(i)}finally{r()}})),O_(this,"handleReplaceTrack",(async(e,t,n,r)=>{let i;Ey.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(e.getTrackId(),"]")),"boolean"==typeof r&&r||(i=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var o;let n=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(!this.sendConnection||!n||void 0===n[1].id||this.state!==SR.Connected)return void t();if(await(null===(o=this.sendConnection)||void 0===o?void 0:o.replaceTrack(e,n[1].id)),n[0]===wR.LocalVideoTrack&&oL().supportDualStreamEncoding){let t=this.localTrackMap.get(wR.LocalVideoLowTrack);if(t){let n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new wu(((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)}))}}t()}catch(s){n(s)}finally{var a;null===(a=i)||void 0===a||a()}})),O_(this,"handleGetLocalVideoStats",(e=>{e(this.statsCollector.getLocalVideoTrackStats())})),O_(this,"handleGetLocalAudioStats",(e=>{e(this.statsCollector.getLocalAudioTrackStats())})),O_(this,"handleGetRemoteVideoStats",(e=>this.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid])),O_(this,"handleGetRemoteAudioStats",(e=>this.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid])),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new TQ(e),this.bindStatsUploaderEvents(),this.reconnectInterval=window.setInterval((()=>{[this.sendConnection,this.recvConnection].forEach((e=>{e&&("disconnected"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||this.handleDisconnect(e.direction))}))}),$v("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new vT(TT.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e,t,n,r,i,o){throw new vT(TT.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(Ey.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new aQ(e,this.store,QI.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);let r=await this.recvConnection.establish(t);return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}{this.state=SR.New,this.sendConnection&&(Ey.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new aQ(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);let t=await this.sendConnection.establish();return{iceParameters:t.iceParameters,dtlsParameters:t.dtlsParameters,sdp:t.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new vT(TT.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=SR.Connected}async addRemoteCandidate(e,t){if(t===QI.RECEIVE_ONLY){if(!this.sendConnection)throw new vT(TT.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new vT(TT.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var r=this;return ex((function*(){let i=yield GF(r.sendMutex.lock("From P2PChannel.publish"));try{if(!r.sendConnection||r.state!==SR.Connected){r.throwIfTrackTypeNotMatch(e);let t=e.filter((e=>-1===r.pendingLocalTracks.indexOf(e)));return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(t))}r.store.pubId=r.store.pubId+1,KF.markPublishStart(r.store.clientId,r.store.pubId);let i=r.filterTobePublishedTracks(e,t,n);if(0===i.length)return void(yield GF(r.tryToUnmuteAudio(e)));i.forEach((e=>{let{track:t,type:n}=e,i=Date.now();r.store.publish(t.getTrackId(),n===wR.LocalAudioTrack?"audio":"video",i)})),r.bindLocalTrackEvents(i);let a=yield GF(r.sendConnection.send(i.map((e=>{let{track:t}=e;return t})),r.store.codec,r.store.audioCodec)),s=(yield GF(a.next())).value,A=r.createGatewayPublishMessage(i,s);try{yield A}catch(o){throw a.throw(o),(null===o||void 0===o?void 0:o.code)===TT.WS_ABORT&&i.forEach((e=>{let{track:t}=e;-1===r.pendingLocalTracks.indexOf(t)&&r.pendingLocalTracks.push(t)})),r.unbindLocalTrackEvents(i),o}yield GF(a.next()),i.forEach((e=>{let{type:t}=e;r.statsCollector.addLocalStats(t)})),r.statsUploader.startUploadOutboundStats(),r.assignLocalTracks(i,s),i.forEach((e=>{let{track:t,type:n}=e,i=Date.now();r.store.publish(t.getTrackId(),n===wR.LocalAudioTrack?"audio":"video",void 0,i)})),r.startUploadUplinkState()}finally{i()}}))()}async unpublish(e){if(!this.sendConnection||this.state!==SR.Connected)return void(0===e.length?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter((t=>!yr(e).call(e,t))));let t=this.filterTobeUnpublishedTracks(e);if(0===t.length)return;let n=t.find((e=>"videoLowTrack"===e[0]));n&&n[1].track.close();let r=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map((e=>{let[,{id:t}]=e;return t}))),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map((e=>{let[t,{track:n}]=e;return{type:t,track:n}}))),t.forEach((e=>{let[t]=e;this.statsCollector.removeLocalStats(t)})),0===this.localTrackMap.size&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===SR.Connected)return n&&n[1].track.close(),r;e.forEach((e=>{let t=this.pendingLocalTracks.indexOf(e);-1!==t&&this.pendingLocalTracks.splice(t,1)}))}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);let e=()=>{let e=[],t=[];Array.from(this.localTrackMap.entries()).forEach((n=>{let[r,{track:i,ssrcs:o}]=n,a={stream_type:IQ(i,r),ssrcs:o};i._muted||!i._enabled?e.push(a):t.push(a)})),e.length>0&&e.forEach((e=>{rv(this,TR.RequestMuteLocal,[e])})),t.length>0&&t.forEach((e=>{rv(this,TR.RequestUnmuteLocal,[e])}))};e(),this.uplinkStateUploadInterval=window.setInterval((()=>{e()}),3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return ex((function*(){throw new vT(TT.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")}))()}async republish(){this.pendingLocalTracks.length>0&&(Ey.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await nv(this,TR.RequestRePublish,this.pendingLocalTracks),this.emit(TR.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new vT(TT.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,r){var i;if(!this.recvConnection)throw new vT(TT.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if(null!==(i=this.remoteUserMap.get(e))&&void 0!==i&&i.has(t))return;let{track:o,mid:a,transceiver:s}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),r);t===mR.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(o):(e._audioTrack=new OF(o,e.uid,e._uintid,this.store),Ey.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),s&&e._audioTrack._updateRtpTransceiver(s),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(o):(e._videoTrack=new bF(o,e.uid,e._uintid,this.store),Ey.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),s&&e._videoTrack._updateRtpTransceiver(s),this.bindRemoteTrackEvents(e,e._videoTrack));let A=this.remoteUserMap.get(e);A?A.set(t,a):this.remoteUserMap.set(e,new Map([[t,a]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();let c=this.pendingRemoteTracks.findIndex((n=>{let{user:r,kind:i}=n;return r.uid===e.uid&&t===i}));-1!==c&&(this.pendingRemoteTracks.splice(c,1),this.emit(TR.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,r){if(!this.recvConnection)throw new vT(TT.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),r)}async unsubscribe(e,t,n){let r=this.pendingRemoteTracks.filter((n=>{let{user:r,kind:i}=n;return void 0!==t?r.uid===e.uid&&t===i:r.uid===e.uid}));if(r.forEach((e=>{let t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)})),this.recvConnection||n||r.forEach((t=>{let{kind:n}=t;var r;if(n===mR.AUDIO)null===(r=e._audioTrack)||void 0===r||r._destroy(),e._audioTrack=void 0;else if(n===mR.VIDEO){var i;null===(i=e._videoTrack)||void 0===i||i._destroy(),e._videoTrack=void 0}})),!this.recvConnection)return;let i=this.filterTobeUnSubscribedTracks(e,t);0!==i.length&&(await this.recvConnection.stopReceiving(i.map((e=>{let[,{id:t}]=e;return t}))),this.withdrawRemoteTracks(i),0===this.remoteUserMap.size&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i.forEach((e=>{let[t,{kind:r}]=e;var i,o;if(r===mR.VIDEO&&t._videoSSRC&&(null===(i=this.recvConnection)||void 0===i||i.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),r===mR.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),n||(null===(o=t._videoTrack)||void 0===o||o._destroy(),t._videoTrack=void 0);else if(r===mR.AUDIO){var a;this.unbindRemoteTrackEvents(t._audioTrack),!n&&(null===(a=t._audioTrack)||void 0===a||a._destroy(),t._audioTrack=void 0)}})),i.forEach((e=>{let[,{kind:t}]=e;rv(this,TR.RequestP2PMuteRemote,t)})))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let e=()=>Array.from(this.remoteUserMap.entries()).forEach((e=>{let[,t]=e;[mR.VIDEO,mR.AUDIO].forEach((e=>{t.has(e)?rv(this,TR.RequestP2PUnmuteRemote,e):rv(this,TR.RequestP2PMuteRemote,e)}))}));e(),this.downlinkStatsUploadInterval=window.setInterval((()=>{e()}),3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new vT(TT.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new vT(TT.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new vT(TT.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new vT(TT.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;let n=this.remoteUserMap.get(e);if(!n)return void Ey.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void Ey.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let r=t===mR.VIDEO?e._videoSSRC:e._audioSSRC;void 0!==r&&this.recvConnection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;let n=this.remoteUserMap.get(e);n?n.get(t)||Ey.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,".")):Ey.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."))}getAllTracks(e){let t=this.localTrackMap.get(wR.LocalAudioTrack);if((null===t||void 0===t?void 0:t.track)instanceof yM){let n=t.track;return Array.from(this.localTrackMap.entries()).filter((e=>{let[t]=e;return t!==wR.LocalAudioTrack})).filter((t=>{let[n]=t;return!(e&&n===wR.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t})).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter((t=>{let[n]=t;return!(e&&n===wR.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t}))}reportPublishEvent(e,t,n,r,i){if(e){let n=this.localTrackMap.get(wR.LocalAudioTrack),o=r?this.localTrackMap.get(wR.LocalVideoLowTrack):this.localTrackMap.get(wR.LocalVideoTrack);vy.publish(this.store.sessionId,{eventElapse:KF.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null===n||void 0===n?void 0:n.track.getTrackLabel(),videoName:null===o||void 0===o?void 0:o.track.getTrackLabel(),screenshare:-1!==(null===o||void 0===o?void 0:o.track._hints.indexOf(vL.SCREEN_TRACK)),audio:!!n,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var o;n||(n=[]);let a=n.find((e=>e instanceof SM)),s=r?null===(o=this.localTrackMap.get(wR.LocalVideoTrack))||void 0===o?void 0:o.track:n.find((e=>e instanceof uF));vy.publish(this.store.sessionId,{eventElapse:KF.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null===a||void 0===a?void 0:a.getTrackLabel(),videoName:null===s||void 0===s?void 0:s.getTrackLabel(),screenshare:-1!==(null===s||void 0===s?void 0:s._hints.indexOf(vL.SCREEN_TRACK)),audio:!!a,video:!!s,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){let i=r===mR.VIDEO?n._videoSSRC:n._audioSSRC;i&&vy.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===mR.VIDEO,audio:r===mR.AUDIO,peerid:n.uid,subscribeRequestid:r===mR.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:KF.measureFromSubscribeStart(this.store.clientId,i)})}reset(){Ey.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Uv("P2PChannel2-send-mutex"),this.sendMutex=new Uv("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(wR.LocalAudioTrack);if((null===e||void 0===e?void 0:e.track)instanceof yM){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach((e=>{t.removeAudioTrack(e)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=SR.Disconnected}getStats(e){var t,n;return e?null===(n=this.recvConnection)||void 0===n?void 0:n.getStats():null===(t=this.sendConnection)||void 0===t?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return(null===(t=this.recvConnection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(wR.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(wR.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof uF||t&&t.track instanceof SM?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;let n=Array.from(Qh(t=this.remoteUserMap).call(t)).find((t=>t.uid===e));return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map((e=>{let[t]=e;return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}})),t=this.localTrackMap.get(wR.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Lp(e).call(e,((e,t)=>e.level-t.level)),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(Ey.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=SR.Reconnecting,$v("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&(null===(n=t._videoTrack._player.getVideoElement())||void 0===n||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())})),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach((e=>{var t;let[n,{track:r}]=e;switch(n){case wR.LocalVideoTrack:yr(t=r._hints).call(t,vL.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case wR.LocalAudioTrack:r instanceof yM?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case wR.LocalVideoLowTrack:}})),this.emit(TR.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;Array.from(Qh(n).call(n)).forEach((e=>{this.setPendingRemoteMedia(t,e)})),this.emit(TR.MediaReconnectStart,t.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),Ey.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(let n of this.pendingRemoteTracks){let{user:r,kind:i}=n;if((e instanceof vQ?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,r;if(e===QI.SEND_ONLY){if(!this.sendConnection)throw new vT(TT.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),r=this.sendConnection}else{if(!this.recvConnection)throw new vT(TT.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),r=this.recvConnection}try{if(t){let e=await r.restartICE(t);return r.isInRestartIce=!1,e}{let e=await r.restartICE();if(e){let t=await nv(this,TR.RequestP2PRestartICE,{direction:QI.RECEIVE_ONLY,iceParameter:e});await r.restartICE(t),r.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;let e=this.sendConnection.getStats(),t=this.localTrackMap.get(wR.LocalVideoTrack),n=this.localTrackMap.get(wR.LocalAudioTrack),r=e.videoSend.find((e=>{var n;return e.ssrc===(null==t||null===(n=t.ssrcs)||void 0===n?void 0:n[0].ssrcId)})),i=e.audioSend.find((e=>{var t;return e.ssrc===(null==n||null===(t=n.ssrcs)||void 0===t?void 0:t[0].ssrcId)}));if(!r||!i)return 1;let o=iv(this,TR.NeedSignalRTT),a=r?r.rttMs:void 0,s=i?i.rttMs:void 0,A=a&&s?(a+s)/2:a||s,c=(A&&o?(A+o)/2:A||o)||0,l=100*e.sendPacketLossRate*.7/50+.3*c/1500,d=l<.17?1:l<.36?2:l<.59?3:l<.1?4:5,u=null===t||void 0===t?void 0:t.track;if(u&&u._encoderConfig&&-1===u._hints.indexOf(vL.SCREEN_TRACK)){let t=u._encoderConfig.bitrateMax,n=e.bitrate.actualEncoded;if(t&&n){let e=(1e3*t-n)/(1e3*t);return Ry[e<.15?0:e<.3?1:e<.45?2:e<.6?3:4][d]}}return d}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;let e=this.recvConnection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach((n=>{let[r]=n,i=r._audioSSRC,o=r._videoSSRC,a=e.audioRecv.find((e=>e.ssrc===i)),s=e.videoRecv.find((e=>e.ssrc===o));if(!a&&!s)return void(t+=1);let A=iv(this,TR.NeedSignalRTT),c=e.rtt,l=(c&&A?(c+A)/2:c||A)||0,d=a?a.jitterMs:void 0,u=e.recvPacketLossRate,h=.7*u*100/50+.3*l/1500;d&&(h=.6*u*100/50+.2*l/1500+.2*d/400),t+=h<.1?1:h<.17?2:h<.36?3:h<.59?4:5})),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new wu(((t,n)=>{this.handleMuteLocalTrack(e,t,n)}))}filterTobePublishedTracks(e,t,n){let r=[],i=oL(),o=this.getAllTracks();e=Av(e=e.filter((e=>-1===o.indexOf(e))));let a=!1,s=!1;for(let A of e){if(A instanceof uF&&(this.localTrackMap.has(wR.LocalVideoTrack)||a?new vT(TT.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:A,type:wR.LocalVideoTrack}),a=!0),t)){let e=this.getLowVideoTrack(A,n);r.push({track:e,type:wR.LocalVideoLowTrack})}if(A instanceof SM){let e=this.localTrackMap.get(wR.LocalAudioTrack);if(e){if(!(e.track instanceof yM))throw new vT(TT.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(A._bypassWebAudio)throw new vT(TT.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(A),this.bindLocalAudioTrackEvents(A,!0)}else if(s){let e=r.find((e=>{let{type:t}=e;return t===wR.LocalAudioTrack}));if(!(e.track instanceof yM))throw new vT(TT.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(A._bypassWebAudio)throw new vT(TT.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(A)}else{if(!i.webAudioMediaStreamDest||A instanceof yM||A._bypassWebAudio)r.push({track:A,type:wR.LocalAudioTrack});else{let e=new yM;e.addAudioTrack(A),r.push({track:e,type:wR.LocalAudioTrack})}s=!0}}}return r}filterTobeUnpublishedTracks(e){let t=[],n=this.getAllTracks();e=Av(e=e.filter((e=>-1!==n.indexOf(e))));for(let r of e){if(r instanceof SM){let e=this.localTrackMap.get(wR.LocalAudioTrack);if(!e)continue;e.track instanceof yM?(e.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),0===e.track.trackList.length&&(t.push([wR.LocalAudioTrack,e]),e.track.close())):t.push([wR.LocalAudioTrack,e])}if(r instanceof uF){let e=this.localTrackMap.get(wR.LocalVideoTrack);if(!e)continue;t.push([wR.LocalVideoTrack,e]);let n=this.localTrackMap.get(wR.LocalVideoLowTrack);n&&t.push([wR.LocalVideoLowTrack,n])}}return t}bindLocalTrackEvents(e){e.forEach((e=>{let{track:t,type:n}=e;switch(n){case wR.LocalVideoTrack:t.addListener(TL.GET_STATS,this.handleGetLocalVideoStats),t.addListener(TL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(TL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(TL.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(TL.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.addListener(TL.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(TL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(TL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case wR.LocalAudioTrack:this.bindLocalAudioTrackEvents(t);case wR.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(e,t){e instanceof yM?e.trackList.forEach((e=>{e.addListener(TL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(TL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(TL.GET_STATS,this.handleGetLocalAudioStats),e.addListener(TL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(TL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.addListener(TL.GET_STATS,this.handleGetLocalAudioStats),e.addListener(TL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(TL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(TL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(TL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(TL.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map((e=>{let[t,{track:n}]=e;return{track:n,type:t}}))),e.forEach((e=>{let{track:t,type:n}=e;switch(n){case wR.LocalVideoTrack:t.off(TL.GET_STATS,this.handleGetLocalVideoStats),t.off(TL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(TL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(TL.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(TL.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.off(TL.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(TL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(TL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case wR.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t);case wR.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(e){e instanceof yM?e.trackList.forEach((e=>{e.off(TL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(TL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(TL.GET_STATS,this.handleGetLocalAudioStats),e.off(TL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(TL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.off(TL.GET_STATS,this.handleGetLocalAudioStats),e.off(TL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(TL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(TL.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(TL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(TL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof bF&&t.addListener(TL.GET_STATS,(t=>{t(this.handleGetRemoteVideoStats(e))})),t instanceof OF&&t.addListener(TL.GET_STATS,(t=>{t(this.handleGetRemoteAudioStats(e))}))}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(TL.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;n.has(mR.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(mR.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)}))}createGatewayPublishMessage(e,t){return e.map(((e,n)=>{var r;let i,{track:o,type:a}=e;switch(a){case wR.LocalAudioTrack:i=aR.Audio;break;case wR.LocalVideoTrack:i=yr(r=o._hints).call(r,vL.SCREEN_TRACK)?aR.Screen:aR.High;break;case wR.LocalVideoLowTrack:i=aR.Low}return{kind:a===wR.LocalAudioTrack?mR.AUDIO:mR.VIDEO,stream_type:i,mid:t[n].id,ssrcs:t[n].localSSRC,isMuted:o.muted||!o.enabled}}))}createGatewayUnpublishMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:o,id:a}]=e;switch(r){case wR.LocalVideoTrack:n=yr(t=i._hints).call(t,vL.SCREEN_TRACK)?aR.Screen:aR.High;break;case wR.LocalAudioTrack:n=aR.Audio;break;case wR.LocalVideoLowTrack:n=aR.Low}return{stream_type:n,ssrcs:o,mid:a}}))}assignLocalTracks(e,t){e.forEach(((e,n)=>{let{track:r,type:i}=e;this.localTrackMap.set(i,{track:r,id:t[n].id,ssrcs:t[n].localSSRC})}))}withdrawLocalTracks(e){e.forEach((e=>{let[t]=e;this.localTrackMap.delete(t)}))}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;Ey.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(TR.PeerConnectionStateChange,t),"connected"!==t||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),"connected"===t&&(e.isInRestartIce=!1),yr(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&("disconnected"===t&&await wv(800),"disconnected"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=e=>{"connected"!==e||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),Ey.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),vy.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:GT.TRACER}).onSuccess(),this.emit(TR.IceConnectionStateChange,e)},e.onICETransportStateChange=e=>{Ey.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=e=>{Ey.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=e=>{Ey.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=e=>{var t;let n=Array.from(Qh(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));var r;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),null===(r=n.audioTrack)||void 0===r||r.emit(BL.FIRST_FRAME_DECODED),vy.firstRemoteFrame(this.store.sessionId,Cy.FIRST_AUDIO_DECODE,wy.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:KF.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=e=>{var t;let n=Array.from(Qh(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));n&&vy.firstRemoteFrame(this.store.sessionId,Cy.FIRST_AUDIO_RECEIVED,wy.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:KF.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(e,t,n)=>{this.reportVideoFirstFrameDecoded(e,t,n)},e.onFirstVideoReceived=e=>{var t;let n=Array.from(Qh(t=this.remoteUserMap).call(t)).find((t=>t._videoSSRC===e));n&&vy.firstRemoteFrame(this.store.sessionId,Cy.FIRST_VIDEO_RECEIVED,wy.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:KF.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(e,t)=>{let n="relay"===e.candidateType,r="relay"===t.candidateType;"unknown"!==t.candidateType&&n===r||this.emit(TR.ConnectionTypeChange,n),Ey.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(hb(t))," -> ").concat(JSON.stringify(hb(e)),")"))},e.onSelectedRemoteCandidateChanged=(e,t)=>{Ey.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(hb(t))," -> ").concat(JSON.stringify(hb(e)),")"))},e.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(TR.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){let t=e===QI.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,Ey.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===QI.SEND_ONLY?this.restartICE(e):nv(this,TR.RequestP2PRestartICE,{direction:QI.SEND_ONLY}))}filterTobeMutedTracks(e){let t=[];if(-1===this.getAllTracks().indexOf(e))return t;let n=this.localTrackMap.get(wR.LocalAudioTrack);if(e instanceof SM&&(null===n||void 0===n?void 0:n.track)instanceof yM)return n.track.isActive||t.push([wR.LocalAudioTrack,n]),t;let r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r&&(t.push(r),r[0]===wR.LocalVideoTrack)){let e=this.localTrackMap.get(wR.LocalVideoLowTrack);e&&t.push([wR.LocalVideoLowTrack,e])}return t}filterTobeUnmutedTracks(e){let t=[],n=this.localTrackMap.get(wR.LocalAudioTrack);if(e instanceof SM&&(null===n||void 0===n?void 0:n.track)instanceof yM)return n.track.isActive&&t.push([wR.LocalAudioTrack,n]),t;let r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r)if(r[0]===wR.LocalVideoTrack){t.push(r);let e=this.localTrackMap.get(wR.LocalVideoLowTrack);e&&t.push([wR.LocalVideoLowTrack,e])}else t.push(r);return t}createMuteMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:o,id:a}]=e;switch(r){case wR.LocalAudioTrack:n=aR.Audio;break;case wR.LocalVideoTrack:n=yr(t=i._hints).call(t,vL.SCREEN_TRACK)?aR.Screen:aR.High;break;case wR.LocalVideoLowTrack:n=aR.Low}return{stream_type:n,ssrcs:o,mid:a}}))}createUnmuteMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:o,id:a}]=e;switch(r){case wR.LocalAudioTrack:n=aR.Audio;break;case wR.LocalVideoTrack:n=yr(t=i._hints).call(t,vL.SCREEN_TRACK)?aR.Screen:aR.High;break;case wR.LocalVideoLowTrack:n=aR.Low}return{stream_type:n,ssrcs:o,mid:a}}))}filterTobeUnSubscribedTracks(e,t){let n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){let i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach((t=>{let[r,i]=t;n.push([e,{kind:r,id:i}])}));return n}createUnsubscribeMessage(e){let t=[];return e.forEach((e=>{let[n,{kind:r,id:i}]=e;switch(r){case mR.VIDEO:return void(n._videoSSRC&&t.push({stream_type:mR.VIDEO,ssrcId:n._videoSSRC}));case mR.AUDIO:return void(n._audioSSRC&&t.push({stream_type:mR.AUDIO,ssrcId:n._audioSSRC}))}})),t}withdrawRemoteTracks(e){e.forEach((e=>{let[t,{kind:n}]=e,r=this.remoteUserMap.get(t);r&&(r.delete(n),0===Array.from(r.entries()).length&&this.remoteUserMap.delete(t))}))}async updateBitrateLimit(e){let t=this.localTrackMap.get(wR.LocalVideoTrack),n=this.localTrackMap.get(wR.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),n&&e.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){let e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return"connected"!==e&&"connected"!==t}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof SM){let n=this.filterTobeUnmutedTracks(e[t]);if(0===n.length)continue;let r=this.createUnmuteMessage(n);return void await rv(this,TR.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter((e=>{let[,{ssrcs:t}]=e;return!!t})),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!(null===(t=this.recvConnection)||void 0===t||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(TR.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(TR.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await wv(Mv(this.dtlsFailedCount,kv)),this.emit(TR.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(wR.LocalVideoTrack)||this.pendingLocalTracks.some((e=>e instanceof uF))}throwIfTrackTypeNotMatch(e){if(e.filter((e=>e instanceof uF)).length>1)throw new vT(TT.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((e=>e instanceof SM)).length>1&&(e.some((e=>e instanceof SM&&e._bypassWebAudio))||!oL().webAudioMediaStreamDest))throw new vT(TT.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof uF&&this.pendingLocalTracks.some((e=>e instanceof uF)))throw new vT(TT.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof SM&&this.pendingLocalTracks.some((e=>e instanceof SM))&&(!oL().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some((e=>e instanceof SM&&e._bypassWebAudio))))throw new vT(TT.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){let n,r=!$v("DISABLE_DUAL_STREAM_USE_ENCODING")&&oL().supportDualStreamEncoding,i=HQ(HQ({},{width:160,height:120,framerate:15,bitrate:50}),t);n=r?e._mediaStreamTrack.clone():AQ(e,i);let o=Sv(8,"track-low-"),a=new uF(n,HQ(HQ({},r&&{scaleResolutionDownBy:ub(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,o);return a.on(bL.TRANSCEIVER_UPDATED,(t=>{e._updateRtpTransceiver(t,yL.LOW_STREAM)})),a._hints.push(vL.LOW_STREAM),e.addListener(TL.NEED_CLOSE,(()=>{a.close()})),a}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,r){var i;let o=Array.from(Qh(i=this.remoteUserMap).call(i)).find((t=>t._videoSSRC===e));if(o){r||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());let i=this.store.keyMetrics,a=i.subscribe.find((e=>e.userId===o.uid&&"video"===e.type));vy.firstRemoteVideoDecode(this.store.sessionId,Cy.FIRST_VIDEO_DECODE,wy.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:t,videoheight:n,subscribeElapse:KF.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:i.requestAPEnd||0,apStart:i.requestAPStart||0,joinGwEnd:i.joinGatewayEnd||0,joinGwStart:i.joinGatewayStart||0,pcEnd:i.peerConnectionEnd||0,pcStart:i.peerConnectionStart||0,subscriberEnd:(null===a||void 0===a?void 0:a.subscribeEnd)||0,subscriberStart:(null===a||void 0===a?void 0:a.subscribeStart)||0,videoAddNotify:(null===a||void 0===a?void 0:a.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;let r=this.remoteUserMap.get(e);if(!r)return!1;let i=r.get(t);if(!i)return!1;let o=await this.recvConnection.getRemoteSSRC(i);return void 0!==o&&o!==n}resetConnection(e){Ey.debug("[".concat(this.store.clientId,"] [P2PChannel2] reset connection to ").concat(e)),this.state===SR.Connected?(Ey.debug("[".concat(this.store.clientId,"] [P2PChannel2] fallback to websocket but P2PChannel2 state still connected, disconnect first")),this.disconnectForReconnect()):(this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0))}async publishDataChannel(e){throw new vT(TT.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new vT(TT.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new vT(TT.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new vT(TT.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new vT(TT.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new vT(TT.NOT_SUPPORTED)}async preConnect(e,t,n,r,i,o){throw new vT(TT.NOT_SUPPORTED)}getEstablishParams(){throw new vT(TT.NOT_SUPPORTED)}async reSubscribe(e){throw new vT(TT.NOT_SUPPORTED)}async updateVideoStreamParameter(e,t){throw new vT(TT.NOT_SUPPORTED)}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach((e=>{let[t,{track:n}]=e;t===wR.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,yL.LOW_STREAM):n._updateRtpTransceiver(void 0)}))}},_I(QQ.prototype,"p2pConnect",[OQ],Object.getOwnPropertyDescriptor(QQ.prototype,"p2pConnect"),QQ.prototype),_I(QQ.prototype,"unpublish",[BQ],Object.getOwnPropertyDescriptor(QQ.prototype,"unpublish"),QQ.prototype),_I(QQ.prototype,"unpublishLowStream",[NQ],Object.getOwnPropertyDescriptor(QQ.prototype,"unpublishLowStream"),QQ.prototype),_I(QQ.prototype,"subscribe",[DQ],Object.getOwnPropertyDescriptor(QQ.prototype,"subscribe"),QQ.prototype),_I(QQ.prototype,"mockSubscribe",[PQ],Object.getOwnPropertyDescriptor(QQ.prototype,"mockSubscribe"),QQ.prototype),_I(QQ.prototype,"unsubscribe",[UQ],Object.getOwnPropertyDescriptor(QQ.prototype,"unsubscribe"),QQ.prototype),_I(QQ.prototype,"muteRemote",[LQ],Object.getOwnPropertyDescriptor(QQ.prototype,"muteRemote"),QQ.prototype),_I(QQ.prototype,"unmuteRemote",[kQ],Object.getOwnPropertyDescriptor(QQ.prototype,"unmuteRemote"),QQ.prototype),_I(QQ.prototype,"hasRemoteMediaWithLock",[MQ],Object.getOwnPropertyDescriptor(QQ.prototype,"hasRemoteMediaWithLock"),QQ.prototype),_I(QQ.prototype,"disconnectForReconnect",[FQ],Object.getOwnPropertyDescriptor(QQ.prototype,"disconnectForReconnect"),QQ.prototype),_I(QQ.prototype,"remoteMediaSsrcChanged",[xQ],Object.getOwnPropertyDescriptor(QQ.prototype,"remoteMediaSsrcChanged"),QQ.prototype),QQ);function jQ(e){return function(t,n,r){let i=t[n];if("function"!=typeof i)throw new Error("Cannot use mutex on object property.");return r.value=async function(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];switch(e){case yQ.SEND_ONLY:{let e=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,r)}finally{e()}}case yQ.RECEIVE_ONLY:{let e=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,r)}finally{e()}}default:{let e=await this.sendMutex.lock("From P2PChannel2.".concat(n)),t=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,r)}finally{e(),t()}}}},r}}function GQ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function WQ(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?GQ(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):GQ(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class YQ{constructor(e){O_(this,"store",void 0),O_(this,"onStatsException",void 0),O_(this,"onUploadPublishDuration",void 0),O_(this,"onStatsChanged",void 0),O_(this,"localStats",new Map),O_(this,"remoteStats",new Map),O_(this,"updateStatsInterval",void 0),O_(this,"trafficStats",void 0),O_(this,"trafficStatsPeerList",[]),O_(this,"uplinkStats",void 0),O_(this,"exceptionMonitor",void 0),O_(this,"p2pChannel",void 0),O_(this,"scalabilityMode",bI.L1T1),O_(this,"updateStats",(()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))})),this.store=e,this.exceptionMonitor=new VF,this.exceptionMonitor.on("exception",((e,t,n)=>{this.onStatsException&&this.onStatsException(e,t,n)}))}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(wR.LocalAudioTrack)||WQ({},DL)}getLocalVideoTrackStats(){return this.localStats.get(wR.LocalVideoTrack)||WQ({},PL)}getRemoteAudioTrackStats(e){let t=(e,t)=>{if(!this.trafficStats)return t;let n=this.trafficStats.peer_delay.find((t=>t.peer_uid===e));return n&&(t.publishDuration=n.B_ppad+(Date.now()-this.trafficStats.timestamp)),t},n={};if(e){var r;let i=null===(r=this.remoteStats.get(e))||void 0===r?void 0:r.audioStats;i&&(n[e]=t(e,i))}else Array.from(this.remoteStats.entries()).forEach((e=>{let[r,{audioStats:i}]=e;i&&(n[r]=t(r,i))}));return n}getRemoteNetworkQualityStats(e){let t={};if(e){var n;let r=null===(n=this.remoteStats.get(e))||void 0===n?void 0:n.networkStats;r&&(t[e]=r)}else Array.from(this.remoteStats.entries()).forEach((e=>{let[n,{networkStats:r}]=e;r&&(t[n]=r)}));return t}getRemoteVideoTrackStats(e){let t=(e,t)=>{if(!this.trafficStats)return t;let n=this.trafficStats.peer_delay.find((t=>t.peer_uid===e));return n&&(t.publishDuration=n.B_ppvd+(Date.now()-this.trafficStats.timestamp)),t},n={};if(e){var r;let i=null===(r=this.remoteStats.get(e))||void 0===r?void 0:r.videoStats;i&&(n[e]=t(e,i))}else Array.from(this.remoteStats.entries()).forEach((e=>{let[r,{videoStats:i}]=e;i&&(n[r]=t(r,i))}));return n}getRTCStats(){let e=0,t=0,n=0,r=0,i=this.localStats.get(wR.LocalAudioTrack);i&&(e+=i.sendBytes,t+=i.sendBitrate);let o=this.localStats.get(wR.LocalVideoTrack);o&&(e+=o.sendBytes,t+=o.sendBitrate);let a=this.localStats.get(wR.LocalVideoLowTrack);a&&(e+=a.sendBytes,t+=a.sendBitrate),this.remoteStats.forEach((e=>{let{audioStats:t,videoStats:i}=e;t&&(n+=t.receiveBytes,r+=t.receiveBitrate),i&&(n+=i.receiveBytes,r+=i.receiveBitrate)}));let s=1;return this.trafficStats&&(s+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:s,SendBitrate:t,SendBytes:e,RecvBytes:n,RecvBitrate:r,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter((e=>void 0!==e.B_ppad||void 0!==e.B_ppvd)),e.peer_delay.filter((e=>-1===this.trafficStatsPeerList.indexOf(e.peer_uid))).forEach((e=>{var t;let n=null===(t=this.p2pChannel)||void 0===t?void 0:t.getRemoteMedia(e.peer_uid),r=null!=n&&n.videoSSRC?KF.measureFromSubscribeStart(this.store.clientId,n.videoSSRC):0,i=null!=n&&n.audioSSRC?KF.measureFromSubscribeStart(this.store.clientId,n.audioSSRC):0;void 0!==e.B_ppad&&void 0!==e.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(e.peer_uid,e.B_ppad,e.B_ppvd,r>i?r:i),this.trafficStatsPeerList.push(e.peer_uid))})),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&Ey.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,t,n){if(!e)return!1;let r=!!n&&t.framesDecodeFreezeTime>n.framesDecodeFreezeTime,i=!n||t.framesDecodeCount>n.framesDecodeCount;return r||!i}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach((t=>{let[n,r]=t;switch(n){case wR.LocalVideoTrack:case wR.LocalVideoLowTrack:{let t=r,o=WQ({},PL),a=e.getStats(),s=e.getLocalMedia(n);if(a){let n=a.videoSend.find((e=>e.ssrc===(null===s||void 0===s?void 0:s.ssrcs[0].ssrcId)));if(n){let r=e.getLocalVideoSize(),i=e.getEncoderConfig(wR.LocalVideoTrack);"H264"!==n.codec&&"H265"!==n.codec&&"VP8"!==n.codec&&"VP9"!==n.codec&&"AV1X"!==n.codec&&"AV1"!==n.codec||(o.codecType=n.codec),o.sendBytes=n.bytes,o.sendBitrate=t?8*Math.max(0,o.sendBytes-t.sendBytes):0,n.inputFrame?(o.captureFrameRate=n.inputFrame.frameRate,o.captureResolutionHeight=n.inputFrame.height,o.captureResolutionWidth=n.inputFrame.width):r&&(o.captureResolutionWidth=r.width,o.captureResolutionHeight=r.height),n.sentFrame?(o.sendFrameRate=n.sentFrame.frameRate,o.sendResolutionHeight=n.sentFrame.height,o.sendResolutionWidth=n.sentFrame.width):r&&(o.sendResolutionWidth=r.width,o.sendResolutionHeight=r.height),n.avgEncodeMs&&(o.encodeDelay=n.avgEncodeMs),i&&i.bitrateMax&&(o.targetSendBitrate=1e3*i.bitrateMax),o.sendPackets=n.packets,o.sendPacketsLost=n.packetsLost,o.sendJitterMs=n.jitterMs,o.sendRttMs=n.rttMs,o.totalDuration=t?t.totalDuration+1:1,o.totalFreezeTime=t?t.totalFreezeTime:0,this.isLocalVideoFreeze(n)&&(o.totalFreezeTime+=1),n.scalabilityMode&&this.scalabilityMode!==n.scalabilityMode&&(Ey.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(n.scalabilityMode)),this.scalabilityMode=n.scalabilityMode)}this.trafficStats&&(o.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var i;this.localStats.set(n,o),((null===t||void 0===t?void 0:t.sendResolutionWidth)!==o.sendResolutionWidth||(null===t||void 0===t?void 0:t.sendResolutionHeight)!==o.sendResolutionHeight)&&(null===(i=this.onStatsChanged)||void 0===i||i.call(this,"resolution",{width:o.sendResolutionWidth,height:o.sendResolutionHeight})),o&&s&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,s.track,o);break}case wR.LocalAudioTrack:{let t=r,i=WQ({},DL),o=e.getStats(),a=e.getLocalMedia(n);if(o){let n=o.audioSend.find((e=>e.ssrc===(null===a||void 0===a?void 0:a.ssrcs[0].ssrcId)));if(n){if("opus"!==n.codec&&"aac"!==n.codec&&"PCMU"!==n.codec&&"PCMA"!==n.codec&&"G722"!==n.codec||(i.codecType=n.codec),n.inputLevel)i.sendVolumeLevel=Math.round(32767*n.inputLevel);else{let t=e.getLocalAudioVolume();t&&(i.sendVolumeLevel=Math.round(32767*t))}i.sendBytes=n.bytes,i.sendPackets=n.packets,i.sendPacketsLost=n.packetsLost,i.sendJitterMs=n.jitterMs,i.sendRttMs=n.rttMs,i.sendBitrate=t?8*Math.max(0,i.sendBytes-t.sendBytes):0}}this.trafficStats&&(i.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(wR.LocalAudioTrack,i),i&&a&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,a.track,i);break}}}))}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach((t=>{var n,r;let i,[o,{videoStats:a,audioStats:s,videoPcStats:A}]=t,c=s,l=a,d=A,u=WQ({},UL),h=WQ({},kL),p=WQ({},LL),{audioTrack:f,videoTrack:E,audioSSRC:g,videoSSRC:m}=e.getRemoteMedia(o);i=e instanceof KQ?e.getStats(!0):e.getStats();let _=null===(n=i)||void 0===n?void 0:n.audioRecv.find((e=>e.ssrc===g)),C=null===(r=i)||void 0===r?void 0:r.videoRecv.find((e=>e.ssrc===m)),w=this.trafficStats&&this.trafficStats.peer_delay.find((e=>e.peer_uid===o));if(_&&("opus"!==_.codec&&"aac"!==_.codec&&"PCMU"!==_.codec&&"PCMA"!==_.codec&&"G722"!==_.codec||(u.codecType=_.codec),_.outputLevel?u.receiveLevel=Math.round(32767*_.outputLevel):f&&(u.receiveLevel=Math.round(32767*f.getVolumeLevel())),u.receiveBytes=_.bytes,u.receivePackets=_.packets,u.receivePacketsLost=_.packetsLost,u.packetLossRate=u.receivePacketsLost/(u.receivePackets+u.receivePacketsLost),u.receiveBitrate=c?8*Math.max(0,u.receiveBytes-c.receiveBytes):0,u.totalDuration=c?c.totalDuration+1:1,u.totalFreezeTime=c?c.totalFreezeTime:0,u.freezeRate=u.totalFreezeTime/u.totalDuration,u.receiveDelay=_.jitterBufferMs,u.totalDuration>10&&YQ.isRemoteAudioFreeze(f)&&(u.totalFreezeTime+=1)),C){"H264"!==C.codec&&"H265"!==C.codec&&"VP8"!==C.codec&&"VP9"!==C.codec&&"AV1X"!==C.codec&&"AV1"!==C.codec||(h.codecType=C.codec),h.receiveBytes=C.bytes,h.receiveBitrate=l?8*Math.max(0,h.receiveBytes-l.receiveBytes):0,h.decodeFrameRate=C.decodeFrameRate<0?0:C.decodeFrameRate,h.renderFrameRate=C.decodeFrameRate<0?0:C.decodeFrameRate,C.outputFrame&&(h.renderFrameRate=C.outputFrame.frameRate),C.receivedFrame?(h.receiveFrameRate=C.receivedFrame.frameRate,h.receiveResolutionHeight=C.receivedFrame.height,h.receiveResolutionWidth=C.receivedFrame.width):E&&(h.receiveResolutionHeight=E._videoHeight||0,h.receiveResolutionWidth=E._videoWidth||0),void 0!==C.framesRateFirefox&&(h.receiveFrameRate=Math.round(C.framesRateFirefox)),h.receivePackets=C.packets,h.receivePacketsLost=C.packetsLost,h.packetLossRate=h.receivePacketsLost/(h.receivePackets+h.receivePacketsLost),h.totalDuration=l?l.totalDuration+1:1,h.totalFreezeTime=l?l.totalFreezeTime:0,h.receiveDelay=C.jitterBufferMs||0;let t=!!m&&e.getRemoteVideoIsReady(m);E&&t&&YQ.isRemoteVideoFreeze(E,C,d)&&(h.totalFreezeTime+=1),h.freezeRate=h.totalFreezeTime/h.totalDuration}w&&(u.end2EndDelay=w.B_ad,h.end2EndDelay=w.B_vd,u.transportDelay=w.B_ed,h.transportDelay=w.B_ed,u.currentPacketLossRate=w.B_ealr4/100,h.currentPacketLossRate=w.B_evlr4/100,p.uplinkNetworkQuality=w.B_punq?w.B_punq:0,p.downlinkNetworkQuality=w.B_pdnq?w.B_pdnq:0),this.remoteStats.set(o,{audioStats:u,videoStats:h,videoPcStats:C,networkStats:p}),f&&this.exceptionMonitor.setRemoteAudioStats(f,u),E&&this.exceptionMonitor.setRemoteVideoStats(E,h)}))}}function JQ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function XQ(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?JQ(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):JQ(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class zQ extends VT{constructor(e,t,n,r){super(),O_(this,"spec",void 0),O_(this,"token",void 0),O_(this,"websocket",void 0),O_(this,"pingpongTimer",void 0),O_(this,"reconnectMode","retry"),O_(this,"serviceMode",void 0),O_(this,"reqId",0),O_(this,"commandReqId",0),O_(this,"handleWebSocketOpen",(()=>{this.reconnectMode="retry",this.startPingPong()})),O_(this,"handleWebSocketMessage",(e=>{if(!e.data)return;let t=JSON.parse(e.data);t.requestId?this.emit("@".concat(t.requestId,"-").concat(t.sid),t):this.serviceMode===GI.INJECT?this.emit(ZI.INJECT_STREAM_STATUS,t):(vy.workerEvent(this.spec.sid,{actionType:"status",serverCode:t.code,workerType:this.serviceMode===GI.TRANSCODE?1:2}),this.emit(ZI.PUBLISH_STREAM_STATUS,t))})),this.spec=t,this.token=e,this.serviceMode=r,this.websocket=new eb("live-streaming",n),this.websocket.on(VI.CONNECTED,this.handleWebSocketOpen),this.websocket.on(VI.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(VI.REQUEST_NEW_URLS,((e,t)=>{nv(this,ZI.REQUEST_NEW_ADDRESS).then(e).catch(t)})),this.websocket.on(VI.RECONNECTING,(()=>{this.websocket.reconnectMode=this.reconnectMode}))}init(e){return this.websocket.init(e)}async request(e,t,n,r){this.reqId+=1,"request"===e&&(this.commandReqId+=1);let i=this.commandReqId,o=this.reqId;if(!o||!this.websocket)throw new HI(TT.UNEXPECTED_ERROR);let a=XQ({command:e,sdkVersion:"4.21.0"===Wv?"0.0.1":Wv,seq:o,requestId:o,allocate:n,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},t);if("closed"===this.websocket.state)throw new HI(TT.WS_DISCONNECT);let s=()=>new wu(((e,t)=>{this.websocket.once(VI.CLOSED,(()=>t(new HI(TT.WS_ABORT)))),this.websocket.once(VI.CONNECTED,e)}));"connected"!==this.websocket.state&&await s(),a.clientRequest&&(a.clientRequest.workerToken=this.token);let A=new wu(((e,t)=>{let n=()=>{t(new HI(TT.WS_ABORT))};this.websocket.once(VI.RECONNECTING,n),this.websocket.once(VI.CLOSED,n),this.once("@".concat(o,"-").concat(this.spec.sid),(t=>{e(t)}))}));r&&vy.workerEvent(this.spec.sid,XQ(XQ({},r),{},{requestId:i,actionType:"request",payload:JSON.stringify(t.clientRequest),serverCode:0,code:0}));let c=Date.now();this.websocket.sendMessage(a);let l=null;try{l=await A}catch(d){if("closed"===this.websocket.state)throw d;return await s(),await this.request(e,t,n)}return r&&vy.workerEvent(this.spec.sid,XQ(XQ({},r),{},{requestId:i,actionType:"response",payload:JSON.stringify(l.serverResponse),serverCode:l.code,success:200===l.code,responseTime:Date.now()-c})),200!==l.code&&this.handleResponseError(l),l}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){let e="4.21.0"===Wv?"0.0.1":Wv;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case eR.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void Ey.warning("live stream response already exists stream");case eR.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case eR.LIVE_STREAM_RESPONSE_BAD_STREAM:case eR.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new HI(TT.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case eR.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)return;throw new HI(TT.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case eR.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new HI(TT.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case eR.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let t=new HI(TT.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(ZI.WARNING,t,e.serverResponse.url)}case eR.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{let t=new HI(TT.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(ZI.WARNING,t,e.serverResponse.url)}case eR.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new HI(TT.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case eR.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new HI(TT.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case eR.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{let t=new HI(TT.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(ZI.WARNING,t,e.serverResponse.url)}case eR.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new HI(TT.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case eR.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new HI(TT.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case eR.LIVE_STREAM_RESPONSE_WORKER_LOST:case eR.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)return;throw new HI(TT.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case eR.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)return;if("UpdateTranscoding"===e.serverResponse.command||"ControlStream"===e.serverResponse.command)return new HI(TT.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new HI(TT.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case eR.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case eR.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case eR.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case eR.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new HI(TT.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval((()=>{"connected"===this.websocket.state&&this.request("ping",{}).catch(vv)}),6e3)}}function qQ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ZQ(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qQ(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qQ(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class $Q extends VT{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:kv,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:kv;super(),O_(this,"onLiveStreamWarning",void 0),O_(this,"onLiveStreamError",void 0),O_(this,"onInjectStatusChange",void 0),O_(this,"spec",void 0),O_(this,"retryTimeout",1e4),O_(this,"connection",void 0),O_(this,"httpRetryConfig",void 0),O_(this,"wsRetryConfig",void 0),O_(this,"streamingTasks",new Map),O_(this,"isStartingStreamingTask",!1),O_(this,"taskMutex",new Uv("live-streaming")),O_(this,"cancelToken",LS.CancelToken.source()),O_(this,"transcodingConfig",void 0),O_(this,"injectConfig",ZQ({},qI)),O_(this,"injectLoopTimes",0),O_(this,"uapResponse",void 0),O_(this,"lastTaskId",1),O_(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=n,this.wsRetryConfig=t}async setTranscodingConfig(e){let t=ZQ(ZQ({},zI),e);var n;66!==t.videoCodecProfile&&77!==t.videoCodecProfile&&100!==t.videoCodecProfile&&(Ey.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(t.videoCodecProfile," -> 100")),t.videoCodecProfile=100),t.transcodingUsers||(t.transcodingUsers=t.userConfigs),t.transcodingUsers&&(t.transcodingUsers=t.transcodingUsers.map((e=>ZQ(ZQ(ZQ({},YI),e),{},{zOrder:e.zOrder?e.zOrder+1:1})))),NT((n=t).width)||RT(n.width,"config.width",0,1e4),NT(n.height)||RT(n.height,"config.height",0,1e4),NT(n.videoBitrate)||RT(n.videoBitrate,"config.videoBitrate",1,1e6),NT(n.videoFrameRate)||RT(n.videoFrameRate,"config.videoFrameRate"),NT(n.lowLatency)||yT(n.lowLatency,"config.lowLatency"),NT(n.audioSampleRate)||IT(n.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),NT(n.audioBitrate)||RT(n.audioBitrate,"config.audioBitrate",1,128),NT(n.audioChannels)||IT(n.audioChannels,"config.audioChannels",[1,2,3,4,5]),NT(n.videoGop)||RT(n.videoGop,"config.videoGop"),NT(n.videoCodecProfile)||IT(n.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),NT(n.userCount)||RT(n.userCount,"config.userCount",0,17),NT(n.backgroundColor)||RT(n.backgroundColor,"config.backgroundColor",0,16777215),NT(n.userConfigExtraInfo)||OT(n.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),n.transcodingUsers&&!NT(n.transcodingUsers)&&(BT(n.transcodingUsers,"config.transcodingUsers"),n.transcodingUsers.forEach(((e,t)=>{jI(e.uid),NT(e.x)||RT(e.x,"transcodingUser[".concat(t,"].x"),0,1e4),NT(e.y)||RT(e.y,"transcodingUser[".concat(t,"].y"),0,1e4),NT(e.width)||RT(e.width,"transcodingUser[".concat(t,"].width"),0,1e4),NT(e.height)||RT(e.height,"transcodingUser[".concat(t,"].height"),0,1e4),NT(e.zOrder)||RT(e.zOrder-1,"transcodingUser[".concat(t,"].zOrder"),0,100),NT(e.alpha)||RT(e.alpha,"transcodingUser[".concat(t,"].alpha"),0,1,!1)}))),NT(n.watermark)||XI(n.watermark,"watermark"),NT(n.backgroundImage)||XI(n.backgroundImage,"backgroundImage"),n.images&&!NT(n.images)&&(BT(n.images,"config.images"),n.images.forEach(((e,t)=>{XI(e,"images[".concat(t,"]"))})));let r=[];t.images&&r.push(...t.images.map((e=>ZQ(ZQ(ZQ({},JI),e),{},{zOrder:255})))),t.backgroundImage&&(r.push(ZQ(ZQ(ZQ({},JI),t.backgroundImage),{},{zOrder:0})),delete t.backgroundImage),t.watermark&&(r.push(ZQ(ZQ(ZQ({},JI),t.watermark),{},{zOrder:255})),delete t.watermark),t.images=r,t.transcodingUsers&&(t.userConfigs=t.transcodingUsers.map((e=>ZQ({},e))),t.userCount=t.transcodingUsers.length,delete t.transcodingUsers);let i=(t.userConfigs||[]).map((e=>"number"==typeof e.uid?wu.resolve(e.uid):$b(e.uid,this.spec,this.cancelToken.token,this.httpRetryConfig)));if((await wu.all(i)).forEach(((e,n)=>{t.userConfigs&&t.userConfigs[n]&&(t.userConfigs[n].uid=e)})),this.transcodingConfig=t,this.connection)try{var o;let e=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(RI(o=this.streamingTasks).call(o)).map((e=>e.taskId)).join("#")});Ey.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(e.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(n){if(!n.data||!n.data.retry)throw n;n.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach((e=>{Ey.warning("[".concat(this.spec.clientId,"] live streaming receive error"),n.toString(),"try to republish",e.url),this.startLiveStreamingTask(e.url,e.mode,n).then((()=>{Ey.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(e.url," success"))})).catch((t=>{Ey.error("[".concat(this.spec.clientId,"] live streaming republish failed"),e.url,t.toString()),this.onLiveStreamError&&this.onLiveStreamError(e.url,t)}))}))}}setInjectStreamConfig(e,t){this.injectConfig=Object.assign({},this.injectConfig,e),this.injectLoopTimes=t}async startLiveStreamingTask(e,t,n){var r;if(Array.from(RI(r=this.streamingTasks).call(r)).find((e=>e.mode===GI.INJECT))&&t===GI.INJECT)return new HI(TT.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&t===GI.TRANSCODE)throw new HI(TT.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let i={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};Ey.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(t));let o=await this.taskMutex.lock();if(!this.connection&&n)return void o();if(this.streamingTasks.get(e)&&!n)return o(),new HI(TT.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(t))}catch(s){throw o(),s}switch(t){case GI.TRANSCODE:i.transcodingConfig=ZQ({},this.transcodingConfig);break;case GI.RAW:break;case GI.INJECT:i={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:e,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(i.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;let a=this.lastTaskId++;try{let r=new wu(((t,r)=>{wv(this.retryTimeout).then((()=>{if(n)return r(n);let t=this.statusError.get(e);return t?(this.statusError.delete(e),r(t)):void 0}))})),s=await wu.race([this.connection.request("request",{clientRequest:i},!0,{url:e,command:"PublishStream",workerType:t===GI.TRANSCODE?1:2,requestByUser:!n,tid:a.toString()}),r]);this.isStartingStreamingTask=!1,Ey.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(s.code)),this.streamingTasks.set(e,{clientRequest:i,mode:t,url:e,taskId:a}),o()}catch(s){if(o(),this.isStartingStreamingTask=!1,!s.data||!s.data.retry||n)throw s;return s.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,t,s)):await this.startLiveStreamingTask(e,t,s)}}stopLiveStreamingTask(e){return new wu(((t,n)=>{let r=this.streamingTasks.get(e);if(!r||!this.connection)return new HI(TT.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();let i=r.mode;r.abortTask=()=>{Ey.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),t()},this.connection.request("request",{clientRequest:{command:i===GI.INJECT?"UninjectStream":"UnpublishStream",url:r.url}},!1,{url:e,command:"UnPublishStream",workerType:i===GI.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then((n=>{Ey.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(n.code)),this.streamingTasks.delete(e),0===this.streamingTasks.size&&i!==GI.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),t(),i===GI.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(WI.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,e)})).catch(n)}))}async controlInjectStream(e,t,n,r){let i=this.streamingTasks.get(e);if(!i||!this.connection||i.mode!==GI.INJECT)throw new HI(TT.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:e,control:t,audioVolume:n,position:r}})).serverResponse}resetAllTask(){var e;let t=Array.from(RI(e=this.streamingTasks).call(e));this.terminate();for(let n of t)this.startLiveStreamingTask(n.url,n.mode).catch((e=>{this.onLiveStreamError&&this.onLiveStreamError(n.url,e)}))}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=LS.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new HI(TT.UNEXPECTED_ERROR,"live streaming connection has already connected");let t=await nv(this,$I.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=t,this.connection=new zQ(t.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(ZI.WARNING,((e,t)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e))),this.connection.on(ZI.PUBLISH_STREAM_STATUS,(e=>this.handlePublishStreamServer(e))),this.connection.on(ZI.INJECT_STREAM_STATUS,(e=>this.handleInjectStreamServerStatus(e))),this.connection.on(ZI.REQUEST_NEW_ADDRESS,((t,n)=>{if(!this.connection)return n(new HI(TT.UNEXPECTED_ERROR,"can not get new live streaming address list"));nv(this,$I.REQUEST_WORKER_MANAGER_LIST,e).then((e=>{this.uapResponse=e,t(e.addressList)})).catch(n)})),await this.connection.init(t.addressList),this.connection}handlePublishStreamServer(e){let t=e.serverStatus&&e.serverStatus.url||"empty_url",n=this.streamingTasks.get(t),r=e.reason;switch(e.code){case eR.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case eR.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case eR.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case eR.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{let r=new HI(TT.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(n)return Ey.error(r.toString()),this.onLiveStreamError&&this.onLiveStreamError(t,r);if(!this.isStartingStreamingTask)return;this.statusError.set(t,r)}case eR.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let e=new HI(TT.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,r);return this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e)}case eR.LIVE_STREAM_RESPONSE_WORKER_LOST:case eR.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var i;if(!this.connection)return;this.connection.tryNextAddress();let t=Array.from(RI(i=this.streamingTasks).call(i));for(let n of t)n.abortTask?n.abortTask():(Ey.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",n.url),this.startLiveStreamingTask(n.url,n.mode,new HI(TT.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then((()=>{Ey.debug("[".concat(this.spec.clientId,"] republish live stream success"),n.url)})).catch((e=>{Ey.error(e.toString()),this.onLiveStreamError&&this.onLiveStreamError(n.url,e)})));return}}}handleInjectStreamServerStatus(e){let t=Number(e.uid),n=e.serverStatus&&e.serverStatus.url;switch(e.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(WI.INJECT_STREAM_STATUS_START_SUCCESS,t,n));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(WI.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,t,n),void this.streamingTasks.delete(n);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(WI.INJECT_STREAM_STATUS_START_UNAUTHORIZED,t,n),void this.streamingTasks.delete(n);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(WI.INJECT_STREAM_STATUS_BROKEN,t,n),void this.streamingTasks.delete(n);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(WI.INJECT_STREAM_STATUS_START_TIMEOUT,t,n),void this.streamingTasks.delete(n);default:return void Ey.debug("inject stream server status",e)}}hasUrl(e){return this.streamingTasks.has(e)}}class eV{constructor(){O_(this,"destChannelMediaInfos",new Map),O_(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){tR(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){tR(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){KI(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function tV(e){if(!(e instanceof eV))return new HI(TT.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();let t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();return t?0===n.size?new HI(TT.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new HI(TT.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}class nV extends VT{constructor(e,t,n){super(),O_(this,"ws",void 0),O_(this,"requestId",1),O_(this,"heartBeatTimer",void 0),O_(this,"joinInfo",void 0),O_(this,"clientId",void 0),O_(this,"onOpen",(()=>{this.emit("open"),this.startHeartBeatCheck()})),O_(this,"onClose",(e=>{this.emit("close"),this.dispose()})),O_(this,"onMessage",(e=>{let t=JSON.parse(e.data);if(!t||"serverResponse"!==t.command||!t.requestId)return t&&"serverStatus"===t.command&&t.serverStatus&&t.serverStatus.command?(this.emit("status",t.serverStatus),void this.emit(t.serverStatus.command,t.serverStatus)):void 0;this.emit("req_".concat(t.requestId),t)})),this.joinInfo=e,this.clientId=t,this.ws=new eb("cross-channel-".concat(this.clientId),n),this.ws.on(VI.RECONNECTING,(()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")})),this.ws.on(VI.CONNECTED,this.onOpen),this.ws.on(VI.ON_MESSAGE,this.onMessage),this.ws.on(VI.CLOSED,this.onClose)}isConnect(){return"connected"===this.ws.state}sendMessage(e){let t=this.requestId++;return e.requestId=t,e.seq=t,this.ws.sendMessage(e),t}waitStatus(e){return new wu(((t,n)=>{let r=window.setTimeout((()=>{n(new HI(TT.TIMEOUT,"wait status timeout, status: ".concat(e)))}),5e3);this.once(e,(i=>{window.clearTimeout(r),i.state&&0!==i.state?n(new HI(TT.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):t(void 0)})),this.once("dispose",(()=>{window.clearTimeout(r),n(new HI(TT.WS_ABORT))}))}))}async request(e){if("closed"===this.ws.state)throw new HI(TT.WS_DISCONNECT);"connected"!==this.ws.state&&await(()=>new wu(((e,t)=>{this.ws.once(VI.CLOSED,(()=>t(new HI(TT.WS_ABORT)))),this.ws.once(VI.CONNECTED,e)})))();let t=this.sendMessage(e),n=new wu(((e,n)=>{let r=()=>{n(new HI(TT.WS_ABORT))};this.ws.once(VI.RECONNECTING,r),this.ws.once(VI.CLOSED,r),this.once("req_".concat(t),e),wv(3e3).then((()=>{this.removeAllListeners("req_".concat(t)),this.ws.off(VI.RECONNECTING,r),this.ws.off(VI.CLOSED,r),n(new HI(TT.TIMEOUT,"cross channel ws request timeout"))}))})),r=await n;if(!r||200!==r.code)throw new HI(TT.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(r)));return r}async connect(e){this.ws.removeAllListeners(VI.REQUEST_NEW_URLS),this.ws.on(VI.REQUEST_NEW_URLS,(t=>{t(e)})),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){let t=this.requestId++;return e.requestId=t,this.ws.sendMessage(e),t}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval((()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})}),3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class rV extends VT{set state(e){e!==this._state&&(e!==iR.RELAY_STATE_FAILURE&&(this.errorCode=oR.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,t,n,r,i){super(),O_(this,"joinInfo",void 0),O_(this,"sid",void 0),O_(this,"clientId",void 0),O_(this,"cancelToken",LS.CancelToken.source()),O_(this,"workerToken",void 0),O_(this,"requestId",0),O_(this,"signal",void 0),O_(this,"prevChannelMediaConfig",void 0),O_(this,"httpRetryConfig",void 0),O_(this,"_resolution",void 0),O_(this,"_state",iR.RELAY_STATE_IDLE),O_(this,"errorCode",oR.RELAY_OK),O_(this,"onStatus",(e=>{Ey.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(e))),e&&e.command&&("onAudioPacketReceived"===e.command&&this.emit("event",rR.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===e.command&&this.emit("event",rR.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===e.command&&(this.errorCode=oR.SRC_TOKEN_EXPIRED,this.state=iR.RELAY_STATE_FAILURE),"onDestTokenPrivilegeDidExpire"===e.command&&(this.errorCode=oR.DEST_TOKEN_EXPIRED,this.state=iR.RELAY_STATE_FAILURE))})),O_(this,"onReconnect",(async()=>{Ey.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",rR.NETWORK_DISCONNECTED),this.state=iR.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch((e=>{this.state!==iR.RELAY_STATE_IDLE&&(Ey.error("auto restart channel media relay failed",e.toString()),this.errorCode=oR.SERVER_CONNECTION_LOST,this.state=iR.RELAY_STATE_FAILURE)}))})),this.joinInfo=e,this.clientId=t,this.sid=Tv(),this.signal=new nV(this.joinInfo,this.clientId,n),this.httpRetryConfig=r,this._resolution=i}async startChannelMediaRelay(e){if(this.state!==iR.RELAY_STATE_IDLE)throw new HI(TT.INVALID_OPERATION);this.state=iR.RELAY_STATE_CONNECTING,await this.connect(),Ey.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(t){throw t.data&&t.data.serverResponse&&"SetSourceChannel"===t.data.serverResponse.command?new HI(TT.CROSS_CHANNEL_FAILED_JOIN_SRC):t.data&&t.data.serverResponse&&"SetDestChannelStatus"===t.serverResponse.command?new HI(TT.CROSS_CHANNEL_FAILED_JOIN_DEST):t.data&&t.data.serverResponse&&"StartPacketTransfer"===t.serverResponse.command?new HI(TT.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):t}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==iR.RELAY_STATE_RUNNING)throw new HI(TT.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==iR.RELAY_STATE_RUNNING)throw new HI(TT.INVALID_OPERATION);let t=this.genMessage(nR.SetVideoProfile);await this.signal.request(t),Ey.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),Ey.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=iR.RELAY_STATE_IDLE,this.dispose()}dispose(){Ey.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=LS.CancelToken.source(),this.state=iR.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){let e=await async function(e,t,n){let r=$v("UAP_AP").slice(0,$v("AJAX_REQUEST_CONCURRENT")).map((t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1?action=uap"):"https://".concat(t,"/api/v1?action=uap"))).map((r=>function(e,t,n,r){let i={command:"convergeAllocateEdge",sid:t.sid,appId:t.appId,token:t.token,ts:Date.now(),version:Wv,cname:t.cname,uid:t.uid.toString(),requestId:Vb,seq:Vb};Vb+=1;let o={service_name:"tele_channel",json_body:JSON.stringify(i)};return Fv((async()=>{let t=await bb(e,{data:o,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(0!==t.code){let e=new HI(TT.UNEXPECTED_RESPONSE,"cross channel ap error, code"+t.code,{retry:!0});throw Ey.error(e.toString()),e}let r=JSON.parse(t.json_body);if(200!==r.code){let e=new HI(TT.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(r.code,", reason: ").concat(r.reason));throw Ey.error(e.toString()),e}if(!r.servers||0===r.servers.length){let e=new HI(TT.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw Ey.error(e.toString()),e}return{vid:r.vid,workerToken:r.workerToken,addressList:($v("CHANNEL_MEDIA_RELAY_SERVERS")||r.servers).map((e=>"wss://".concat(e.address.replace(/\./g,"-"),".").concat($v("WORKER_DOMAIN"),":").concat(e.wss)))}}),void 0,(e=>!!(e.code!==TT.OPERATION_ABORTED&&e.code!==TT.UNEXPECTED_RESPONSE||e.data&&e.data.retry)),r)}(r,e,t,n)));try{let e=await Jb(r);return r.forEach((e=>e.cancel())),e}catch(i){throw i[0]}}(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",rR.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){let t=this.genMessage(nR.StopPacketTransfer);await this.signal.request(t),await this.signal.waitStatus("Normal Quit"),Ey.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));let n=this.genMessage(nR.SetSdkProfile,e);await this.signal.request(n),Ey.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));let r=this.genMessage(nR.SetSourceChannel,e);await this.signal.request(r),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",rR.PACKET_JOINED_SRC_CHANNEL),Ey.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));let i=this.genMessage(nR.SetSourceUserId,e);await this.signal.request(i),Ey.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));let o=this.genMessage(nR.SetDestChannel,e);await this.signal.request(o),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",rR.PACKET_JOINED_DEST_CHANNEL),Ey.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));let a=this.genMessage(nR.StartPacketTransfer,e);await this.signal.request(a),this.emit("event",rR.PACKET_SENT_TO_DEST_CHANNEL),this.state=iR.RELAY_STATE_RUNNING,Ey.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){let t=this.genMessage(nR.UpdateDestChannel,e);await this.signal.request(t),this.emit("event",rR.PACKET_UPDATE_DEST_CHANNEL),Ey.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){let e=this.genMessage(nR.StopPacketTransfer);await this.signal.request(e),Ey.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,t){let n=[],r=[],i=[];this.requestId+=1;let o={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Wv,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.21.0"===o.sdkVersion&&(o.sdkVersion="0.0.1");let a=null,s=null;switch(e){case nR.SetSdkProfile:return o.clientRequest={command:"SetSdkProfile",type:"multi_channel"},o;case nR.SetSourceChannel:if(s=t&&t.getSrcChannelMediaInfo(),!s)throw new HI(TT.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceChannel",uid:"0",channelName:s.channelName,token:s.token||this.joinInfo.appId},o;case nR.SetSourceUserId:if(s=t&&t.getSrcChannelMediaInfo(),!s)throw new HI(TT.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceUserId",uid:s.uid+""},o;case nR.SetDestChannel:if(a=t&&t.getDestChannelMediaInfo(),!a)throw new HI(TT.UNEXPECTED_ERROR,"can not find dest config");return a.forEach((e=>{n.push(e.channelName),r.push(e.uid+""),i.push(e.token||this.joinInfo.appId)})),o.clientRequest={command:"SetDestChannel",channelName:n,uid:r,token:i},o;case nR.StartPacketTransfer:return o.clientRequest={command:"StartPacketTransfer"},o;case nR.Reconnect:return o.clientRequest={command:"Reconnect"},o;case nR.StopPacketTransfer:return o.clientRequest={command:"StopPacketTransfer"},o;case nR.UpdateDestChannel:if(a=t&&t.getDestChannelMediaInfo(),!a)throw new HI(TT.UNEXPECTED_ERROR,"can not find dest config");return a.forEach((e=>{n.push(e.channelName),r.push(e.uid+""),i.push(e.token||this.joinInfo.appId)})),o.clientRequest={command:"UpdateDestChannel",channelName:n,uid:r,token:i},o;case nR.SetVideoProfile:o.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return o}}function iV(e){var t={},n=!1;function r(t,r){return n=!0,{done:!1,value:new jF(r=new zF((function(n){n(e[t](r))})),1)}}return t[void 0!==y_&&I_||"@@iterator"]=function(){return this},t.next=function(e){return n?(n=!1,e):r("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(n)throw n=!1,e;return r("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return n?(n=!1,e):r("return",e)}),t}var oV,aV=t(qF);function sV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function AV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sV(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function cV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function lV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?cV(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let dV=(_I((oV=class e extends gR{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")).filter((e=>{var t;return yr(t=Object.keys(ry)).call(t,e)})))]}constructor(t,n){super(t,n),O_(this,"store",void 0),O_(this,"peerConnection",void 0),O_(this,"remoteSDP",void 0),O_(this,"initialOffer",void 0),O_(this,"statsFilter",void 0),O_(this,"useRTX",!1),O_(this,"localCapabilities",void 0),O_(this,"localCandidateCount",0),O_(this,"allCandidatesReceived",!1),O_(this,"establishPromise",void 0),O_(this,"mutex",new Uv("P2PConnection-mutex")),this.store=n,this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=Px(this.peerConnection,$v("STATS_UPDATE_INTERVAL"),void 0,eT()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{let e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let t=Mx(e.sdp),n=kx(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:$v("FILTER_VIDEO_FEC"),filterAudioFec:$v("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=n,this.initialOffer=e,lV(lV({},t),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:n},offerSDP:e.sdp})}catch(e){throw new vT(TT.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e,t,n,r,i,o){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(e){O_(this,"sessionDesc",void 0),O_(this,"localCapabilities",void 0),O_(this,"rtpCapabilities",void 0),O_(this,"candidates",void 0),O_(this,"iceParameters",void 0),O_(this,"dtlsParameters",void 0),O_(this,"setup",void 0),O_(this,"currentMidIndex",void 0),O_(this,"cname",void 0),e=lv(e);let{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,remoteSetup:o,localCapabilities:a,sdkCodec:s,cname:A}=e,c=hx.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE audio video\na=msid-semantic: WMS\na=ice-lite\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:audio\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:video\n");this.rtpCapabilities=i,this.candidates=r,this.iceParameters=t,this.dtlsParameters=n,this.setup=o,this.localCapabilities=a,this.cname=A;for(let l=0;l<c.mediaDescriptions.length;l++){let e=c.mediaDescriptions[l];if(e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd,e.attributes.fingerprints=n.fingerprints,e.attributes.candidates=r,e.attributes.setup=o,"video"===e.media.mediaType){e.media.fmts=i.videoCodecs.map((e=>e.payloadType.toString(10)));let t=i.videoCodecs.filter((e=>{var t,n;return null===(t=e.rtpMap)||void 0===t?void 0:yr(n=t.encodingName.toLowerCase()).call(n,s)}));0===t.length&&(t=i.videoCodecs),e.attributes.payloads=t,e.attributes.extmaps=i.videoExtensions}"audio"===e.media.mediaType&&(e.media.fmts=i.audioCodecs.map((e=>e.payloadType.toString(10))),e.attributes.payloads=i.audioCodecs,e.attributes.extmaps=i.audioExtensions),c.mediaDescriptions[l]=this.mungMediaDesc(e)}this.sessionDesc=c,this.currentMidIndex=c.mediaDescriptions.length-1}toString(){return hx.print(this.sessionDesc)}send(e,t,n){let{ssrcs:r,ssrcGroups:i}=Qx(t,this.cname),o=this.sessionDesc.mediaDescriptions.find((t=>e===mR.VIDEO?"video"===t.media.mediaType:"audio"===t.media.mediaType)),a=r[0].attributes.label,s=r[0].attributes.mslabel;return o.attributes.ssrcs=o.attributes.ssrcs.concat(r),o.attributes.ssrcGroups=o.attributes.ssrcGroups.concat(i),{id:a,mslabel:s}}batchSend(e){return e.map((e=>{let{kind:t,ssrcMsg:n}=e;return this.send(t,n,void 0)}))}stopSending(e){this.sessionDesc.mediaDescriptions.forEach((t=>{let n=[],r=[],i=[];t.attributes.ssrcs.forEach((t=>{yr(e).call(e,t.attributes.label||"")?i.push(t):n.push(t)})),t.attributes.ssrcGroups.forEach((e=>{var t;yr(t=i.map((e=>e.ssrcId))).call(t,e.ssrcIds[0])||r.push(e)})),t.attributes.ssrcs=n,t.attributes.ssrcGroups=r}))}mute(e){let t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){let t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}receive(e,t,n){e.forEach(((e,t)=>{let n=e._mediaStreamTrack,r=this.sessionDesc.mediaDescriptions.findIndex((e=>e.attributes.mid===n.kind)),i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],e);this.sessionDesc.mediaDescriptions[r]=i}))}stopReceiving(e){}updateCandidates(e){e===_R.TCP?this.candidates.forEach((e=>{-1===this.candidates.findIndex((t=>"tcp"===t.transport&&t.connectionAddress===e.connectionAddress&&t.port===e.port))&&this.candidates.push(AV(AV({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))})):this.candidates=this.candidates.filter((e=>"tcp"!==e.transport));for(let t of this.sessionDesc.mediaDescriptions)t.attributes.candidates=this.candidates}restartICE(e){e=lv(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}predictReceivingMids(e){let t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}mungRecvMediaDsec(e,t){let n=lv(e);return Vx(n,t),Kx(n,t),n}updateRecvMedia(e,t){let n=this.sessionDesc.mediaDescriptions.findIndex((t=>t.attributes.mid===e));if(-1!==n){let e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}bumpMid(e){this.currentMidIndex+=e}updateTrackLabel(e,t,n){let r=this.sessionDesc.mediaDescriptions.find((t=>e===mR.VIDEO?"video"===t.attributes.mid:"audio"===t.attributes.mid));if(r){let e=r.attributes.ssrcs.find((e=>e.attributes.label===t));var i;e&&(e.attributes.label=n,null===(i=e.attributes.msid)||void 0===i||i.replace(t,n))}}mungMediaDesc(e){let t=lv(e);return Hx(t),function(e){let t=e.attributes.extmaps.find((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName));t&&e.attributes.extmaps.splice(e.attributes.extmaps.indexOf(t),1),e.attributes.payloads.forEach((e=>{let t=e.rtcpFeedbacks.findIndex((e=>"transport-cc"===e.type));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}(t),t}getSSRC(e){for(let t of this.sessionDesc.mediaDescriptions)for(let n of t.attributes.ssrcs)if(n.attributes.label===e)return[n]}}({remoteIceParameters:e,remoteDtlsParameters:t,candidates:n,remoteRTPCapabilities:r.send,remoteSetup:i,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:o});let a=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(a){throw new vT(TT.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(a.toString()))}}async updateRemoteRTPCapabilities(e,t){throw new vT(TT.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}send(e,t){var n=this;return ex((function*(){let r=yield GF(n.mutex.lock());try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let r,o=e.map((e=>n.peerConnection.addTrack(e._mediaStreamTrack))),a=yield GF(n.peerConnection.createOffer()),s=hx.parse(a.sdp),A=e.map((e=>{let t=e._mediaStreamTrack,r=s.mediaDescriptions.find((e=>e.attributes.mid===t.kind));if(!r)throw new Error("Cannot extract ssrc from mediaDescription.");return function(e,t,n){let r=e.attributes.ssrcs.filter((e=>e.attributes.label===t)),i=e.attributes.ssrcGroups;if(0===r.length)throw new Error("Cannot extract ssrc from plan-b SDP.");if(i&&r.length>1){let e=i.find((e=>-1!==e.ssrcIds.indexOf(r[0].ssrcId)));return e?[{ssrcId:e.ssrcIds[0],rtx:n?e.ssrcIds[1]:void 0}]:[{ssrcId:r[0].ssrcId}]}return[{ssrcId:r[0].ssrcId}]}(r,t.id,n.useRTX)}));try{r=yield A}catch(i){throw o.forEach((e=>{ZS()&&e.replaceTrack(null),n.peerConnection.removeTrack(e)})),i}let c=n.mungSendOfferSDP(a.sdp,e);n.remoteSDP.receive(e,t,r);let l=n.remoteSDP.toString();return yield GF(n.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield GF(n.applySendEncodings(o,e)),yield GF(n.peerConnection.setRemoteDescription({type:"answer",sdp:l})),e.map(((e,t)=>{let n=e._mediaStreamTrack.id;return{localSSRC:A[t],id:n}}))}catch(o){throw new vT(TT.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{r()}}))()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let t=this.peerConnection.getSenders().filter((t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")}));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map((e=>{ZS()&&e.replaceTrack(null),this.peerConnection.removeTrack(e)}));let n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);let r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(t){throw new vT(TT.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(t.toString()))}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));let{id:n,mslabel:i}=this.remoteSDP.send(e,t,r),o=new wu(((t,r)=>{let o=setTimeout((()=>{r(new Error("Cannot receive track, id: ".concat(n)))}),1e4),a=r=>{let s=WS();if(("Safari"===s.name&&11===Number(s.version)||tT())&&r.track.id!==n&&r.streams[0].id===i){var A;let i=r.streams[0].getTracks()[0];return null===(A=this.remoteSDP)||void 0===A||A.updateTrackLabel(e,n,r.track.id),this.peerConnection.removeEventListener("track",a),clearTimeout(o),void t(i)}if(r.track.id===n)return this.peerConnection.removeEventListener("track",a),clearTimeout(o),void t(r.track)};this.peerConnection.addEventListener("track",a)})),a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});let s=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(s),{track:await o,id:n}}catch(i){throw new vT(TT.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);let t=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});let n=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(n)}catch(t){throw new vT(TT.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(t.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let t=this.peerConnection.getSenders().filter((t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")}));if(t.length!==e.length)throw new Error("sender' length doesn't match mids' length.");t.map((e=>{if(ZS()&&e.track)e.track.enabled=!1;else{let t=e.getParameters();t.encodings.forEach((e=>e.active=!1)),e.setParameters(t)}}))}catch(t){throw new vT(TT.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(t.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let t=this.peerConnection.getSenders().filter((t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")}));if(t.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");t.map((async e=>{if(ZS()&&e.track)e.track.enabled=!0;else{let t=e.getParameters();t.encodings.forEach((e=>e.active=!0)),await e.setParameters(t)}}));let n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n);let r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(t){throw new vT(TT.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(t.toString()))}}restartICE(e){var t=this;return ex((function*(){let n=yield GF(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(oL().supportPCSetConfiguration){let n=t.peerConnection.getConfiguration(),r=e===_R.RELAY?"relay":"all";n.iceTransportPolicy!==r&&(Ey.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(n.iceTransportPolicy,"] to [").concat(r,"]")),n.iceTransportPolicy=r,t.peerConnection.setConfiguration(n))}else if(e===_R.RELAY)return;e!==_R.RELAY&&t.remoteSDP.updateCandidates(e);let n=yield GF(t.peerConnection.createOffer({iceRestart:!0}));if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let r=Mx(n.sdp),{remoteIceParameters:i}=yield r.iceParameters;t.remoteSDP.restartICE(i);let o=t.remoteSDP.toString();yield GF(t.peerConnection.setLocalDescription(n)),yield GF(t.peerConnection.setRemoteDescription({type:"answer",sdp:o}))}catch(r){Ey.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),r)}finally{n()}}))()}close(){var e;this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let e=await this.peerConnection.createOffer(),n=this.mungSendOfferSDP(e.sdp,[t]);this.remoteSDP.updateRecvMedia(t._mediaStreamTrack.kind,t);let r=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(n){throw new vT(TT.EXCHANGE_SDP_FAILED,n.toString())}}async updateSendParameters(e,t){let n=this.peerConnection.getSenders().filter((t=>{var n;return(null===(n=t.track)||void 0===n?void 0:n.id)===e}));1===n.length&&await this.applySendEncodings(n,[t])}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){let n=this.peerConnection.getSenders().find((e=>{var n;return(null===(n=e.track)||void 0===n?void 0:n.id)===t}));n&&await n.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,t){throw new vT(TT.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new vT(TT.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,Ey.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,Ey.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),$v("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(XT(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),$v("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(n.iceTransportPolicy="relay")})))),n}static turnServerConfigToIceServers(e){let t=[];return e.forEach((e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}async updateRtpSenderEncodings(e,t){var n;if(t||(t=this.peerConnection.getSenders().find((t=>{var n;return(null===(n=t.track)||void 0===n?void 0:n.id)===e._mediaStreamTrack.id}))),!t)return Ey.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!oL().supportSetRtpSenderParameters)return Ey.warn("Browser not support set rtp-sender parameters");let r={},i={};if(e instanceof uF)switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if($v("DSCP_TYPE")&&gT()){var o;let e=$v("DSCP_TYPE");yr(o=["very-low","low","medium","high"]).call(o,e)&&(i.networkPriority=e)}let a=t.getParameters(),s=null===(n=a.encodings)||void 0===n?void 0:n[0];s&&Object.assign(s,i),Object.assign(a,r),Ey.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(a.encodings))),await t.setParameters(a)}async applySendEncodings(e,t){try{if(!oL().supportSetRtpSenderParameters||e.length!==t.length)return;for(let n=0;n<e.length;n++){let r=e[n],i=t[n];r&&i&&await this.updateRtpSenderEncodings(i,r)}}catch{Ey.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t){let n=hx.parse(e);return t.forEach(((e,t)=>{let r=e._mediaStreamTrack,i=n.mediaDescriptions.find((e=>e.attributes.mid===r.kind));i&&Vx(i,e)})),hx.print(n)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let t=this.remoteSDP.batchSend(e).map(((t,n)=>{let{id:r,mslabel:i}=t,{kind:o}=e[n];return new wu(((e,t)=>{let n=setTimeout((()=>{t(new Error("Cannot receive track, id: ".concat(r)))}),1e4),a=t=>{let s=WS();if("Safari"===s.name&&11===Number(s.version)&&t.track.id!==r&&t.streams[0].id===i){var A;let i=t.streams[0].getTracks()[0];return null===(A=this.remoteSDP)||void 0===A||A.updateTrackLabel(o,r,t.track.id),this.peerConnection.removeEventListener("track",a),clearTimeout(n),void e({track:i,id:r})}if(t.track.id===r)return this.peerConnection.removeEventListener("track",a),clearTimeout(n),void e({track:t.track,id:r})};this.peerConnection.addEventListener("track",a)}))})),n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});let r=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(r),await wu.all(t)}catch(t){throw new vT(TT.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(t.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;let t=this.remoteSDP.getSSRC(e);return null===t||void 0===t?void 0:t[0].ssrcId}setConfiguration(t){if(oL().supportPCSetConfiguration){let n=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}}).prototype,"connect",[uV],Object.getOwnPropertyDescriptor(oV.prototype,"connect"),oV.prototype),_I(oV.prototype,"stopSending",[uV],Object.getOwnPropertyDescriptor(oV.prototype,"stopSending"),oV.prototype),_I(oV.prototype,"receive",[uV],Object.getOwnPropertyDescriptor(oV.prototype,"receive"),oV.prototype),_I(oV.prototype,"stopReceiving",[uV],Object.getOwnPropertyDescriptor(oV.prototype,"stopReceiving"),oV.prototype),_I(oV.prototype,"muteRemote",[uV],Object.getOwnPropertyDescriptor(oV.prototype,"muteRemote"),oV.prototype),_I(oV.prototype,"unmuteRemote",[uV],Object.getOwnPropertyDescriptor(oV.prototype,"unmuteRemote"),oV.prototype),_I(oV.prototype,"muteLocal",[uV],Object.getOwnPropertyDescriptor(oV.prototype,"muteLocal"),oV.prototype),_I(oV.prototype,"unmuteLocal",[uV],Object.getOwnPropertyDescriptor(oV.prototype,"unmuteLocal"),oV.prototype),_I(oV.prototype,"close",[uV],Object.getOwnPropertyDescriptor(oV.prototype,"close"),oV.prototype),_I(oV.prototype,"updateEncoderConfig",[uV],Object.getOwnPropertyDescriptor(oV.prototype,"updateEncoderConfig"),oV.prototype),_I(oV.prototype,"updateSendParameters",[uV],Object.getOwnPropertyDescriptor(oV.prototype,"updateSendParameters"),oV.prototype),_I(oV.prototype,"replaceTrack",[uV],Object.getOwnPropertyDescriptor(oV.prototype,"replaceTrack"),oV.prototype),_I(oV.prototype,"getRemoteSSRC",[uV],Object.getOwnPropertyDescriptor(oV.prototype,"getRemoteSSRC"),oV.prototype),oV);function uV(e,t,n){let r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){let e=this.mutex,n=await e.lock("Locking from P2PConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return await r.apply(this,o)}finally{n()}},n}function hV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function pV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hV(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let fV="9";function EV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function gV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?EV(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):EV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let mV=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({});var _V=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(_V||{});let CV=new Map;function wV(e,t,n,r){let{scale:i}=e;if(0===i&&r===_V.UP||i>=t.length-1&&r===_V.DOWN)return e;let o=gV(gV({},e),{},{scale:r===_V.DOWN?++i:--i});switch(n){case"maintain-framerate":o=gV(gV({},o),t[i].motion);break;case"maintain-resolution":o=gV(gV({},o),t[i].detail);break;case"balanced":o=gV(gV({},o),t[i].balanced)}return o}function SV(e,t){if(t){let n={overUse:0,underUse:0,adaptationList:TV(t)};CV.set(e,n)}else CV.delete(e)}function TV(e){let t=gV({},e),{bitrateMax:n,frameRate:r,scaleResolutionDownBy:i,bitrateMin:o}=t,{MIN_FRAME_RATE:a,MAX_THRESHOLD_FRAMERATE:s,MAX_SCALE:A,BITRATE_MIN_THRESHOLD:c,BITRATE_MAX_THRESHOLD:l,BWE_SCALE_UP_THRESHOLD:d,BWE_SCALE_DOWN_THRESHOLD:u,PERF_SCALE_DOWN_THRESHOLD:h,PERF_SCALE_UP_THRESHOLD:p,BALANCE_BITRATE_FACTOR:f,BALANCE_FRAMERATE_FACTOR:E,BALANCE_RESOLUTION_FACTOR:g,MOTION_RESOLUTION_FACTOR:m,MOTION_BITRATE_FACTOR:_,DETAIL_FRAMERATE_FACTOR:C,DETAIL_BITRATE_FACTOR:w}=Xv,S=Math.min(t.frameRate,s),T=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(u,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(h,1)*S),fps_up:r},balanced:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:o},motion:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:o},detail:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:o}}];for(let v=1;v<=A;v++){let e={bwe_up:Math.round(Math.pow(d,v)*n),bwe_down:Math.round(Math.pow(u,v+1)*n),fps_up:Math.round(Math.pow(p,v)*S),fps_down:Math.round(Math.pow(h,v+1)*S)},t={scaleResolutionDownBy:i/Math.pow(g,v),frameRate:Math.max(Math.round(Math.pow(E,v)*r),a),bitrateMax:Math.max(Math.round(Math.pow(f,v)*n),l),bitrateMin:Math.max(Math.round(Math.pow(f,v)*o),c)},s={scaleResolutionDownBy:i/Math.pow(m,v),frameRate:r,bitrateMax:Math.max(Math.round(Math.pow(_,v)*n),l),bitrateMin:Math.max(Math.round(Math.pow(_,v)*o),c)},A={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(C,v)*r),a),bitrateMax:Math.max(Math.round(Math.pow(w,v)*n),l),bitrateMin:Math.max(Math.round(Math.pow(w,v)*o),c)};T.push({scale:v,threshold:e,balanced:t,motion:s,detail:A})}return T}function vV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function yV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vV(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let IV=new Map;function RV(e){let t=IV.get(e);if(t){let{timer:n,adaptationFunc:r,originConfig:i}=t;window.clearTimeout(n),r(i),IV.delete(e)}SV(e)}var bV;function OV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function BV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?OV(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):OV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let NV=(bV=class e extends gR{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.state)&&void 0!==e?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")).filter((e=>{var t;return yr(t=Object.keys(ry)).call(t,e)})))]}constructor(t,n){super(t,n),O_(this,"store",void 0),O_(this,"peerConnection",void 0),O_(this,"id",Sv(5,"connection-")),O_(this,"remoteSDP",void 0),O_(this,"initialOffer",void 0),O_(this,"transportEventReceiver",void 0),O_(this,"statsFilter",void 0),O_(this,"useXR",$v("USE_XR")),O_(this,"localCapabilities",void 0),O_(this,"remoteCodecs",void 0),O_(this,"localCandidateCount",0),O_(this,"allCandidatesReceived",!1),O_(this,"dataStreamChannelMap",new Map),O_(this,"establishPromise",void 0),O_(this,"recoveredDataChannelIds",[]),O_(this,"currentDataChannelId",1),O_(this,"mutex",new Uv("P2PConnection-mutex")),O_(this,"qualityLimitationReason",mV.NONE),this.store=n,this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=Px(this.peerConnection,$v("STATS_UPDATE_INTERVAL"),void 0,eT()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async updateRemoteRTPCapabilities(e,t){if(this.remoteCodecs=t,this.remoteSDP)if(this.remoteSDP.updateRemoteCodec(e,t,this.store.codec)){let e=await this.peerConnection.createOffer(),t=this.logSDPExchange(e.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(e);let n=this.remoteSDP.toString();null!==t&&void 0!==t&&t(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}else Ey.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.");else Ey.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(t))}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});let e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let t=Mx(e.sdp),n=await Yx({filterRTX:!$v("USE_PUB_RTX")&&!$v("USE_SUB_RTX"),filterVideoFec:$v("FILTER_VIDEO_FEC"),filterAudioFec:$v("FILTER_AUDIO_FEC"),filterVideoCodec:$v("FILTER_VIDEO_CODEC")},{useXR:this.useXR});return this.localCapabilities=zx(n),this.initialOffer=e,BV(BV({},t),{},{rtpCapabilities:n,offerSDP:e.sdp})}catch(e){throw new vT(TT.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e,t,n,r,i,o){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{get localCapabilities(){return lv(this._localCapabilities)}get rtpCapabilities(){return lv(this._rtpCapabilities)}get candidates(){return lv(this._candidates)}get iceParameters(){return lv(this._iceParameters)}get dtlsParameters(){return lv(this._dtlsParameters)}constructor(e){O_(this,"sessionDesc",void 0),O_(this,"_localCapabilities",void 0),O_(this,"_rtpCapabilities",void 0),O_(this,"_candidates",void 0),O_(this,"_iceParameters",void 0),O_(this,"_dtlsParameters",void 0),O_(this,"setup",void 0),O_(this,"currentMidIndex",void 0),O_(this,"cname",void 0),O_(this,"firefoxSsrcMidMap",new Map),e=lv(e);let{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,remoteSetup:o,localCapabilities:a,cname:s}=e,A=hx.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n");this._rtpCapabilities=i,this._candidates=r,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=a,this.setup=o,this.cname=s;let c=this.rtpCapabilities.send;for(let l of A.mediaDescriptions){if(l.attributes.iceUfrag=t.iceUfrag,l.attributes.icePwd=t.icePwd,l.attributes.fingerprints=n.fingerprints,l.attributes.candidates=r,l.attributes.setup=o,"video"===l.media.mediaType&&(l.media.fmts=c.videoCodecs.map((e=>e.payloadType.toString(10))),l.attributes.payloads=c.videoCodecs,l.attributes.extmaps=c.videoExtensions,$v("PRELOAD_MEDIA_COUNT")>0)){let{ssrcs:e,ssrcGroups:t}=Qx([{ssrcId:4e4,rtx:$v("USE_SUB_RTX")?40001:void 0}],this.cname);l.attributes.ssrcs=e,l.attributes.ssrcGroups=t}if("audio"===l.media.mediaType&&(l.media.fmts=c.audioCodecs.map((e=>e.payloadType.toString(10))),l.attributes.payloads=c.audioCodecs,l.attributes.extmaps=c.audioExtensions,qx(l),$v("PRELOAD_MEDIA_COUNT")>0)){let{ssrcs:e,ssrcGroups:t}=Qx([{ssrcId:2e4}],this.cname);l.attributes.ssrcs=e,l.attributes.ssrcGroups=t}}this.sessionDesc=A,this.currentMidIndex=A.mediaDescriptions.length-1}preloadRemoteMedia(){let e=$v("PRELOAD_MEDIA_COUNT");this.rtpCapabilities;let t=this.candidates,n=this.dtlsParameters,r=this.iceParameters,i=this.rtpCapabilities.send;for(let o=1;o<e;o++){let e=2*o+2e4,a=2*o+4e4,{ssrcs:s,ssrcGroups:A}=Qx([{ssrcId:e}],this.cname),{ssrcs:c,ssrcGroups:l}=Qx([{ssrcId:a,rtx:$v("USE_SUB_RTX")?a+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:fV,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.videoCodecs.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.videoExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:c,ssrcGroups:l,rtcpFeedbackWildcards:[],payloads:i.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*o)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:fV,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.audioCodecs.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.audioExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:s,ssrcGroups:A,rtcpFeedbackWildcards:[],payloads:i.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*o+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return hx.print(this.sessionDesc)}send(e,t,n,r){let{ssrcs:i,ssrcGroups:o}=Qx(t,this.cname,$v("SYNC_GROUP")?n:void 0),a=this.findPreloadMediaDesc(i);if(a){if(eT()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,a.attributes.mid),r&&(r.twcc||r.remb)){let e=this.sessionDesc.mediaDescriptions.indexOf(a);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(a,r),{mid:a.attributes.mid,needExchangeSDP:!0}}return{mid:a.attributes.mid,needExchangeSDP:!1}}{let t,n=this.findAvailableMediaIndex(e,i);return-1===n||1===n&&(ZS()||AT())||0===n&&$v("USE_SUB_RTX")||cT()?(t=this.createOrRecycleSendMedia(e,i,o,"sendonly",r),this.updateBundleMids()):(t=lv(this.sessionDesc.mediaDescriptions[n]),t.attributes.direction="sendonly",t.attributes.ssrcs=i,t.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[n]=this.mungSendMediaDesc(t,r)),eT()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,t.attributes.mid),{mid:t.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){let{mediaDesc:e,needExchangeSDP:t}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:t}}batchSend(e){let t=e.map((e=>{let{kind:t,ssrcMsg:n,mslabel:r}=e;return this.send(t,n,r)})),n=[],r=!1;return t.forEach((e=>{let{mid:t,needExchangeSDP:i}=e;i&&(r=!0),n.push(t)})),{mids:n,needExchangeSDP:r}}stopSending(e){let t=this.sessionDesc.mediaDescriptions.filter((t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((e=>{"0"===e.attributes.mid||eT()||cT()?e.attributes.ssrcs=[]:(e.attributes.ssrcs=[],e.attributes.direction="inactive",e.media.port="0")})),this.updateBundleMids()}mute(e){let t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){let t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter((t=>yr(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="inactive"}))}unmuteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter((t=>yr(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="recvonly"}))}receive(e,t,n,r){e.forEach(((e,i)=>{this.createOrRecycleRecvMedia(e,[],"recvonly",t,n,r[i])})),this.updateBundleMids()}stopReceiving(e){let t=this.sessionDesc.mediaDescriptions.filter((t=>-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((e=>{e.media.port="0",e.attributes.direction="inactive"})),this.updateBundleMids()}updateCandidates(e){let t=this._candidates.filter((e=>"udp"===e.transport));if(e===_R.TCP){if(0===t.length)return;if($v("TCP_CANDIDATE_ONLY")){let e=this._candidates.filter((e=>"tcp"===e.transport));t.forEach((t=>{-1===e.findIndex((e=>e.connectionAddress===t.connectionAddress))&&e.push(pV(pV({},t),{},{foundation:"tcpcandidate",priority:Number(t.priority)-1+"",transport:"tcp",port:Number(t.port)+90+""}))})),this._candidates=e}else{let e=[];t.forEach((t=>{e.push(pV(pV({},t),{},{foundation:"tcpcandidate",priority:Number(t.priority)-1+"",transport:"tcp",port:Number(t.port)+90+""}))})),this._candidates=[...t,...e]}}else if(e===_R.RELAY){if(0!==t.length)return;{let e=this._candidates.filter((e=>"tcp"===e.transport));e.forEach((e=>{t.push(pV(pV({},e),{},{foundation:"udpcandidate",priority:Number(e.priority)+1+"",transport:"udp",port:Number(e.port)-90+""}))})),this._candidates=[...t,...e]}}else 0===t.length?(this._candidates.filter((e=>"tcp"===e.transport)).forEach((e=>{t.push(pV(pV({},e),{},{foundation:"udpcandidate",priority:Number(e.priority)+1+"",transport:"udp",port:Number(e.port)-90+""}))})),this._candidates=t):this._candidates=this._candidates.filter((e=>"tcp"!==e.transport));for(let n of this.sessionDesc.mediaDescriptions)n.attributes.candidates=this.candidates}restartICE(e){e=lv(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}predictReceivingMids(e){let t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex((n=>{let r=n.media.mediaType===e&&"0"!==n.media.port&&("sendonly"===n.attributes.direction||"sendrecv"===n.attributes.direction)&&0===n.attributes.ssrcs.length;if(eT()){if(r){let e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==n.attributes.mid&&"1"!==n.attributes.mid)||!(!e||e!==n.attributes.mid)}return!1}return r}))}createOrRecycleDataChannel(){for(let n of this.sessionDesc.mediaDescriptions)if("application"===n.media.mediaType)return{mediaDesc:n,needExchangeSDP:!1};this.currentMidIndex+=1;let e="".concat(this.currentMidIndex),t={media:{mediaType:"application",port:fV,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(t),{mediaDesc:t,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,t,n,r,i,o){let a=e._mediaStreamTrack.kind,s=this.rtpCapabilities.recv,A=$x(a,s,this.localCapabilities.send,a===mR.VIDEO?r:i),c=a===mR.VIDEO?s.videoExtensions:s.audioExtensions;this.currentMidIndex+=1;let l="".concat(this.currentMidIndex),d={media:{mediaType:a,port:fV,protos:["UDP","TLS","RTP","SAVPF"],fmts:A.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:A,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(l)}};d=this.mungRecvMediaDsec(d,e,o);let u=this.findFirstClosedMedia(a);if(u){let e=this.sessionDesc.mediaDescriptions.indexOf(u);this.sessionDesc.mediaDescriptions[e]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}updateRemoteCodec(e,t,n){let r=[...new Set(this._rtpCapabilities.recv.videoCodecs.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")).filter((e=>{var t;return yr(t=Object.keys(ry)).call(t,e)})))],i=new Set(t);if(r.every((e=>i.has(e))))return Ey.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;let o=this._rtpCapabilities.recv.videoCodecs.filter((e=>t.some((t=>{var n;return yr(n=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(n,t)}))));if(0===o.length)return Ey.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(r," codecs: ").concat(t)),!1;let a,s=[...new Set(o.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")))];if(Ey.debug("updateRemoteCodec, from ".concat(r," to ").concat(s)),0===e.length)a=this.sessionDesc.mediaDescriptions.filter((e=>"video"===e.media.mediaType&&"recvonly"===e.attributes.direction));else if(a=this.sessionDesc.mediaDescriptions.filter((t=>t.attributes.mid&&yr(e).call(e,t.attributes.mid)&&"recvonly"===t.attributes.direction)),a.length!==e.length)return Ey.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;if($v("USE_PUB_RTX")||$v("USE_SUB_RTX")){let e=eQ(o,this.rtpCapabilities.recv.videoCodecs);o.push(...e)}this._rtpCapabilities.recv.videoCodecs=o;let A=this.localCapabilities.send,c=this.rtpCapabilities.recv,l=$x(mR.VIDEO,c,A,n);return a.forEach((e=>{let t=l.map((e=>e.payloadType.toString(10)));Ey.debug("updateRemoteCodec mid: ".concat(e.attributes.mid,", from ").concat(e.attributes.payloads," to ").concat(l)),e.attributes.payloads=l,e.media.fmts=t})),!0}createOrRecycleSendMedia(e,t,n,r,i){let o=this.rtpCapabilities.send,a=e===mR.VIDEO?o.videoCodecs:o.audioCodecs,s=e===mR.VIDEO?o.videoExtensions:o.audioExtensions;this.currentMidIndex+=1;let A="".concat(this.currentMidIndex),c={media:{mediaType:e,port:fV,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:s,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(A)}};c=this.mungSendMediaDesc(c,i);let l=this.findFirstClosedMedia(e);if(l){let e=this.sessionDesc.mediaDescriptions.indexOf(l);this.sessionDesc.mediaDescriptions[e]=c}else this.sessionDesc.mediaDescriptions.push(c);return c}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((e=>"0"!==e.media.port)).map((e=>e.attributes.mid))}mungRecvMediaDsec(e,t,n){let r=lv(e);return Hx(r),Vx(r,t),Kx(r,t),jx(r),Gx(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){let n=lv(e);return Gx(n,t,this.localCapabilities.recv),qx(n),n}updateRecvMedia(e,t){let n=this.sessionDesc.mediaDescriptions.findIndex((t=>t.attributes.mid===e));if(-1!==n){let e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find((t=>eT()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port))}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find((t=>{var n;return(null===(n=t.attributes)||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId)===e[0].ssrcId}))}getSSRC(e){var t;return null===(t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e)))||void 0===t?void 0:t.attributes.ssrcs}}({remoteIceParameters:e,remoteDtlsParameters:t,candidates:n,remoteRTPCapabilities:r,remoteSetup:i,localCapabilities:this.localCapabilities,cname:o}),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let a=this.remoteSDP.toString(),s=hx.parse(this.initialOffer.sdp),A=s.mediaDescriptions.find((e=>"audio"===e.media.mediaType));A&&qx(A),this.useXR&&Zx(s);let c=hx.print(s),l=this.logSDPExchange(c||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),null!==l&&void 0!==l&&l(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a});let d=this.peerConnection.getTransceivers()[0];if(null!=d&&d.receiver&&this.tryBindTransportEvents(d.receiver),$v("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();let e=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});let t=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(t)}}catch(a){throw new vT(TT.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(a.toString()))}}send(e,t,n){var r=this;return ex((function*(){let i=yield GF(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let i=[];e.forEach((e=>{let t=r.peerConnection.addTransceiver(e._mediaStreamTrack,{direction:"sendonly"});i.push(t),e._updateRtpTransceiver(t)})),eT()&&!0===$v("SIMULCAST")&&(yield GF(r.applySimulcastForFirefox(i,e)));let a,s=yield GF(r.peerConnection.createOffer()),A=r.remoteSDP.predictReceivingMids(e.length),c=r.mungSendOfferSDP(s.sdp,e,A),l=hx.parse(c),d=A.map((e=>{let t=l.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return Fx(t,$v("USE_PUB_RTX"))}));try{a=yield d}catch(o){a=[],r.remoteSDP.receive(e,t,n,a);let i=r.remoteSDP.toString();throw yield GF(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield GF(r.peerConnection.setRemoteDescription({type:"answer",sdp:i})),yield GF(r.stopSending(A,!0)),o}r.remoteSDP.receive(e,t,n,a);let u=r.remoteSDP.toString(),h=r.logSDPExchange(c,"offer","local","send");return yield GF(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield GF(r.applySimulcastEncodings(i,e)),yield GF(r.applySendEncodings(i,e)),null!==h&&void 0!==h&&h(u),yield GF(r.peerConnection.setRemoteDescription({type:"answer",sdp:u})),i.map(((e,t)=>{let n=A[t];return{localSSRC:d[t],id:n,transceiver:e}}))}catch(a){throw a instanceof vT?a:new vT(TT.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(a.toString()))}finally{i()}}))()}async createDataChannels(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let n=this.dataStreamChannelMap.get(e);if(n&&"open"===n.readyState)Ey.debug("[P2PConnection] Channels are already available and can be reused directly.");else{let t=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if("number"!=typeof t)throw new Error("create DataChannel error, because cannot get dc id");n=this.peerConnection.createDataChannel("datastream-channel",{id:t,negotiated:!0,ordered:!1,maxRetransmits:$v("DATASTREAM_MAX_RETRANSMITS")}),n.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,n)}t.forEach((e=>{e._updateOriginDataChannel(n)}));let{needExchangeSDP:r}=this.remoteSDP.sendDataChannel();if(r){let e=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});let t=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(t),Ey.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else Ey.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(n){throw n instanceof vT?n:new vT(TT.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(n.toString()))}}async stopDataChannels(e){try{let t=this.dataStreamChannelMap.get(e);return t&&(t.id&&this.recoveredDataChannelIds.push(t.id),t.close()),void this.dataStreamChannelMap.delete(e)}catch(t){throw t instanceof vT?t:new vT(TT.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(t.toString()))}}async stopSending(e,t){let n=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let t=this.peerConnection.getTransceivers().filter((t=>-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map((e=>{var t;RV(this.id+e.mid),e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)}));let n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);let i=this.remoteSDP.toString();null!==r&&void 0!==r&&r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(r){throw new vT(TT.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}finally{n&&n()}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));let{mid:i,needExchangeSDP:o}=this.remoteSDP.send(e,t,n,r);if(o){let t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});let r=await this.peerConnection.createAnswer(),o=this.mungReceiveAnswerSDP(r.sdp,i,e);null!==n&&void 0!==n&&n(o||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:o}),Ey.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else Ey.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));let a=this.peerConnection.getTransceivers().find((e=>e.mid===i));if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:i,transceiver:a}}catch(i){throw new vT(TT.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let{mids:t,needExchangeSDP:n}=this.remoteSDP.batchSend(e);if(n){let e=this.remoteSDP.toString(),t=this.logSDPExchange(e,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});let n=await this.peerConnection.createAnswer();null!==t&&void 0!==t&&t(n.sdp||""),await this.peerConnection.setLocalDescription(n),Ey.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else Ey.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return t.map((e=>{let t=this.peerConnection.getTransceivers().find((t=>t.mid===e));if(!t)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:t.receiver.track,id:e,transceiver:t}}))}catch(t){throw new vT(TT.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(t.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);let t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});let r=await this.peerConnection.createAnswer();null!==n&&void 0!==n&&n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(t){throw new vT(TT.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(t.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);let t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});let r=await this.peerConnection.createAnswer();null!==n&&void 0!==n&&n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(t){throw new vT(TT.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(t.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);let t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});let r=await this.peerConnection.createAnswer();null!==n&&void 0!==n&&n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(t){throw new vT(TT.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(t.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((e=>{e.direction="inactive"}));let n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);let i=this.remoteSDP.toString();null!==r&&void 0!==r&&r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(t){throw new vT(TT.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(t.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((async(e,t)=>{e.direction="sendonly"}));let n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e);let i=this.remoteSDP.toString();null!==r&&void 0!==r&&r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(t){throw new vT(TT.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(t.toString()))}}restartICE(e){var t=this;return ex((function*(){let n=yield GF(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(oL().supportPCSetConfiguration){let n=t.peerConnection.getConfiguration(),r=e===_R.RELAY?"relay":"all";n.iceTransportPolicy!==r&&(Ey.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(n.iceTransportPolicy,"] to [").concat(r,"]")),n.iceTransportPolicy=r,t.peerConnection.setConfiguration(n))}else if(e===_R.RELAY)return;t.remoteSDP.updateCandidates(e);let n=yield GF(t.peerConnection.createOffer({iceRestart:!0}));if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let r=Mx(n.sdp),{remoteIceParameters:i}=yield r.iceParameters;t.remoteSDP.restartICE(i);let o=t.remoteSDP.toString(),a=t.logSDPExchange(n.sdp||"","offer","local","restartICE");t.store.descriptionStart(),yield GF(t.peerConnection.setLocalDescription(n)),null!==a&&void 0!==a&&a(o),yield GF(t.peerConnection.setRemoteDescription({type:"answer",sdp:o}))}catch(r){Ey.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),r)}finally{n()}}))()}close(){var e;this.peerConnection.getTransceivers().forEach((e=>{RV(this.id+e.mid)})),this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return BV(BV({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let n=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(n.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);let i=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),null!==o&&void 0!==o&&o(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(n){throw new vT(TT.EXCHANGE_SDP_FAILED,n.toString())}}async updateSendParameters(e,t){let n=this.peerConnection.getTransceivers().filter((t=>t.mid===e));1===n.length&&(this.isVP8Simulcast(t)?eT()||await this.applySimulcastEncodings(n,[t]):await this.applySendEncodings(n,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){let n=this.peerConnection.getTransceivers().find((e=>e.mid===t));n&&await n.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){let e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){let t=e[0].transport.iceTransport,{local:n,remote:r}=t.getSelectedCandidatePair();return{local:BV(BV({},gx),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:BV(BV({},gx),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,Ey.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,Ey.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),$v("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(XT(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),$v("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),$v("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(n.iceTransportPolicy="relay")})))),$v("ENABLE_ENCODED_TRANSFORM")&&oL().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(e){let t=[];return e.forEach((e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(ob(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!$v("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}tryBindTransportEvents(e){let t=e.transport;if(t){this.transportEventReceiver=e,t.onstatechange=()=>{var e;null!=t&&t.state&&(null===(e=this.onDTLSTransportStateChange)||void 0===e||e.call(this,t.state))},t.onerror=e=>{var t;null===(t=this.onDTLSTransportError)||void 0===t||t.call(this,"error"in e?e.error:e)};let n=t.iceTransport;n&&(n.onstatechange=()=>{let e=null===t||void 0===t?void 0:t.iceTransport.state;var n;e&&(null===(n=this.onICETransportStateChange)||void 0===n||n.call(this,e))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){let{local:e,remote:t}=n.getSelectedCandidatePair();Ey.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:e.type,protocol:e.protocol}),", remote ").concat(JSON.stringify({candidateType:t.type,protocol:t.protocol,address:t.address,port:t.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var n,r;if(t||(t=this.peerConnection.getSenders().find((t=>t.track===e._mediaStreamTrack))),!t)return Ey.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return Ey.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!oL().supportSetRtpSenderParameters)return Ey.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let i={},o={};switch(e._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;case"balanced":i.degradationPreference="balanced"}let a=(A=this.peerConnection,c=e._mediaStreamTrack,A.getTransceivers().find((e=>e.sender.track===c||e.receiver.track===c))),s=(e=>{let t=e._encoderConfig;if(!t)return;let{frameRate:n,width:r,height:i}=e.getMediaStreamTrackSettings(),{frameRate:o=n,width:a=r,height:s=i}=t;if(!o||!a||!s)return;a=Bv(a),s=Bv(s),o=Bv(o);let{max:A,min:c}=function(e,t,n){let r=200*Math.pow(n/15,.6)*Math.pow(e*t/640/360,.75);return{min:Math.floor(r),max:Math.floor(4*r)}}(a,s,o),{bitrateMax:l,bitrateMin:d}=t||{};l||Ey.debug("calculate bitrate: [w: ".concat(a,", h: ").concat(s,", fps: ").concat(o,"] => [brMax: ").concat(l,", brMin: ").concat(d,"]"));let{maxFramerate:u}=$v("ENCODER_CONFIG_LIMIT");return u&&"number"==typeof u&&(o=Math.min(o,u)),{frameRate:o,bitrateMax:l||A,bitrateMin:d||c,scaleResolutionDownBy:1,scale:0}})(e);var A,c;if(function(e){var t;return!!$v("ENABLE_AG_ADAPTATION")&&!!(e instanceof hF||yr(t=e._hints).call(t,vL.CUSTOM_TRACK))&&(!!$v("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(e){let t=WS();if(t.os!==VS.IOS||!t.osVersion)return!1;let n=t.osVersion.split(".");return Number(n[0])>=14}()&&oT(17,4)||iT(14)&&aT(17,4)))}(e)&&a&&t&&s&&this.getLocalVideoStats&&yr(n=["vp8","vp9"]).call(n,this.store.codec)){var l;let n=i.degradationPreference||(yr(l=e._hints).call(l,vL.CUSTOM_TRACK)?$v("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");!function(e,t,n,r,i,o){if(RV(e),"balanced"!==r&&"maintain-framerate"!==r&&"maintain-resolution"!==r)return;let a=-1;SV(e,t);let s=window.setInterval((()=>{let s=IV.get(e);if(!$v("ENABLE_AG_ADAPTATION")||!s)return void RV(e);let A=o();if(A.sendPackets>0&&A.OutgoingAvailableBandwidth>0){if(-1===a)return void(a=Date.now());if(Date.now()-a<1e3)return;let o=A.sendFrameRate,c=A.OutgoingAvailableBandwidth,[l,d]=function(e,t,n,r,i,o){let a=CV.get(e)||{overUse:0,underUse:0,adaptationList:TV(i)},{adaptationList:s}=a;CV.set(e,a);let A,c,{OVERUSE_TIMES_THRESHOLD:l,UNDERUSE_TIMES_THRESHOLD:d}=Xv,{scale:u}=r;return"number"==typeof t&&t>0&&function(e,t,n,r){if(t>=n.length)return!1;let{threshold:{fps_down:i}}=n[t];return $v("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===r&&(i=n[0].threshold.fps_down),e<i}(t,u,s,o)&&(a.overUse++,c=mV.CPU,a.overUse>l)||"number"==typeof n&&n>0&&function(e,t,n){if(t>=n.length)return!1;let{threshold:{bwe_down:r}}=n[t];return e<r}(n,u,s)&&(a.overUse++,c=mV.BANDWIDTH,a.overUse>l)?(a.overUse=0,a.underUse=0,A=wV(r,s,o,_V.DOWN),[A,c]):("number"==typeof t&&t>0&&"number"==typeof n&&n>0&&function(e,t,n,r){if(0===t)return;let{threshold:{fps_up:i}}=n[t];return $v("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===r&&(i=n[1].threshold.fps_up),e>i}(t,u,s,o)&&function(e,t,n){if(0===t)return;let{threshold:{bwe_up:r}}=n[t];return e>r}(n,u,s)&&(a.underUse++,a.underUse>d&&(a.overUse=0,a.underUse=0,A=wV(r,s,o,_V.UP),0===A.scale&&(c=mV.NONE))),[A,c])}(e,o,c,s.adaptationConfig,t,r);d&&(n.qualityLimitationReason=d),l&&s.adaptationConfig.scale!==l.scale&&(Ey.debug("[".concat(e,"] applyAdaptation: ").concat(n.qualityLimitationReason,"\n           sendFps ").concat(o,", bwe ").concat(c,", switch from ").concat(s.adaptationConfig.scale," to ").concat(l.scale," ")),s.adaptationConfig=yV(yV({},s.adaptationConfig),l),i(l))}}),$v("CHECK_LOCAL_STATS_INTERVAL")),A=yV({},t);IV.set(e,{timer:s,adaptationConfig:A,originConfig:t,adaptationFunc:i}),Ey.debug("[".concat(e,"] start adaptation, originConfig: ").concat(JSON.stringify(t),", degradationPreference: ").concat(r))}(this.id+a.mid,s,this,n,(e=>{t&&this.updateAdaptation(t,e)}),this.getLocalVideoStats.bind(this))}if(e._encoderConfig){var d;let{bitrateMax:t,frameRate:n,scaleResolutionDownBy:r}=e._encoderConfig;t&&(o.maxBitrate=1e3*t),(yr(d=e._hints).call(d,vL.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(n&&(o.maxFramerate=sb(n)),r&&r>=1&&(o.scaleResolutionDownBy=r))}let{maxFramerate:u}=$v("ENCODER_CONFIG_LIMIT");if(u&&"number"==typeof u&&(o.maxFramerate=o.maxFramerate?Math.min(o.maxFramerate,u):u),$v("DSCP_TYPE")&&gT()){var h;let e=$v("DSCP_TYPE");yr(h=["very-low","low","medium","high"]).call(h,e)&&(o.networkPriority=e)}let p=t.getParameters(),f=null===(r=p.encodings)||void 0===r?void 0:r[0];eT()&&!f&&(i.encodings=[o]),f&&Object.assign(f,o),Object.assign(p,i),Ey.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(p.encodings))),await t.setParameters(p)}async updateAdaptation(e,t){var n,r;if(!e)return Ey.debug("[updateAdaptation] no rtpSender found");if(!oL().supportSetRtpSenderParameters)return Ey.debug("[updateAdaptation] Browser not support set rtp-sender parameters");let i={},{bitrateMax:o,frameRate:a,scaleResolutionDownBy:s}=t;o&&(i.maxBitrate=1e3*o),a&&(i.maxFramerate=sb(a)),s&&s>=1&&yr(n=["vp8","vp9"]).call(n,this.store.codec)&&(i.scaleResolutionDownBy=s);let A=e.getParameters(),c=null===(r=A.encodings)||void 0===r?void 0:r[0];c&&Object.assign(c,i),Object.assign(A,{});try{await e.setParameters(A),Ey.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(A.encodings)))}catch(l){!("transport"in e)||e.transport&&"connected"===e.transport.state?"connected"!==this.peerConnectionState?Ey.debug("[updateAdaptation] peerConnection not connected}"):Ey.debug("[updateAdaptation] updateRtpSenderEncodings failed",l):Ey.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(e,t){try{if(!oL().supportSetRtpSenderParameters||e.length!==t.length)return;for(let n=0;n<e.length;n++){let r=e[n],i=t[n];i instanceof uF&&!this.isVP8Simulcast(i)&&await this.updateRtpSenderEncodings(i,r.sender)}}catch{Ey.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,n){let r=hx.parse(e);return t.forEach(((e,t)=>{let i=n[t],o=r.mediaDescriptions.find((e=>e.attributes.mid===i));o&&(Vx(o,e),Wx(o,e,this.store.codec))})),hx.print(r)}mungReceiveAnswerSDP(e,t,n){let r=hx.parse(e),i=r.mediaDescriptions.find((e=>e.attributes.mid===t));return i&&(n===mR.AUDIO&&"audio"===i.media.mediaType&&qx(i),this.useXR&&Zx(r)),hx.print(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let s=0;s<e.length;s++){var n,r,i,o,a;let A=e[s],c=t[s];if(c instanceof uF&&!yr(n=c._hints).call(n,vL.LOW_STREAM)&&null!==(r=c._encoderConfig)&&void 0!==r&&r.bitrateMax&&(null===(i=c._encoderConfig)||void 0===i?void 0:i.bitrateMax)>200&&null!==(o=c._scalabilityMode)&&void 0!==o&&o.numSpatialLayers&&(null===(a=c._scalabilityMode)||void 0===a?void 0:a.numSpatialLayers)>1&&"vp8"===this.store.codec){let e={},t={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];let n=A.sender.getParameters();await A.sender.setParameters(Object.assign(n,e))}}}async applySimulcastEncodings(e,t){if(!eT()&&e.length===t.length)for(let n=0;n<e.length;n++){let r=t[n];if(r instanceof uF&&this.isVP8Simulcast(r)){let t=e[n],i={},o={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};i.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:o.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:o.medium,scaleResolutionDownBy:4}];let a=t.sender.getParameters();await t.sender.setParameters(Object.assign(a,i))}}}isVP8Simulcast(e){var t,n,r,i,o;return!!(e instanceof uF&&$v("SIMULCAST")&&"vp8"===this.store.codec&&!yr(t=e._hints).call(t,vL.LOW_STREAM)&&null!==(n=e._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=e._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=e._scalabilityMode)&&void 0!==i&&i.numSpatialLayers&&(null===(o=e._scalabilityMode)||void 0===o?void 0:o.numSpatialLayers)>1)}logSDPExchange(e,t,n,r){if($v("SDP_LOGGING"))return Ey.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;let t=this.remoteSDP.getSSRC(e);return null===t||void 0===t?void 0:t[0].ssrcId}setConfiguration(t){if(oL().supportPCSetConfiguration){let n=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},_I(bV.prototype,"updateRemoteRTPCapabilities",[DV],Object.getOwnPropertyDescriptor(bV.prototype,"updateRemoteRTPCapabilities"),bV.prototype),_I(bV.prototype,"connect",[DV],Object.getOwnPropertyDescriptor(bV.prototype,"connect"),bV.prototype),_I(bV.prototype,"createDataChannels",[DV],Object.getOwnPropertyDescriptor(bV.prototype,"createDataChannels"),bV.prototype),_I(bV.prototype,"receive",[DV],Object.getOwnPropertyDescriptor(bV.prototype,"receive"),bV.prototype),_I(bV.prototype,"batchReceive",[DV],Object.getOwnPropertyDescriptor(bV.prototype,"batchReceive"),bV.prototype),_I(bV.prototype,"stopReceiving",[DV],Object.getOwnPropertyDescriptor(bV.prototype,"stopReceiving"),bV.prototype),_I(bV.prototype,"muteRemote",[DV],Object.getOwnPropertyDescriptor(bV.prototype,"muteRemote"),bV.prototype),_I(bV.prototype,"unmuteRemote",[DV],Object.getOwnPropertyDescriptor(bV.prototype,"unmuteRemote"),bV.prototype),_I(bV.prototype,"muteLocal",[DV],Object.getOwnPropertyDescriptor(bV.prototype,"muteLocal"),bV.prototype),_I(bV.prototype,"unmuteLocal",[DV],Object.getOwnPropertyDescriptor(bV.prototype,"unmuteLocal"),bV.prototype),_I(bV.prototype,"close",[DV],Object.getOwnPropertyDescriptor(bV.prototype,"close"),bV.prototype),_I(bV.prototype,"updateEncoderConfig",[DV],Object.getOwnPropertyDescriptor(bV.prototype,"updateEncoderConfig"),bV.prototype),_I(bV.prototype,"updateSendParameters",[DV],Object.getOwnPropertyDescriptor(bV.prototype,"updateSendParameters"),bV.prototype),_I(bV.prototype,"replaceTrack",[DV],Object.getOwnPropertyDescriptor(bV.prototype,"replaceTrack"),bV.prototype),_I(bV.prototype,"updateAdaptation",[DV],Object.getOwnPropertyDescriptor(bV.prototype,"updateAdaptation"),bV.prototype),_I(bV.prototype,"getRemoteSSRC",[DV],Object.getOwnPropertyDescriptor(bV.prototype,"getRemoteSSRC"),bV.prototype),bV);function DV(e,t,n){let r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){let e=this.mutex,n=await e.lock("From P2PConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return await r.apply(this,o)}finally{n()}},n}function PV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function UV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?PV(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):PV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let LV="v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0\na=msid-semantic: WMS\na=ice-lite\nm=application 9 UDP/DTLS/SCTP webrtc-datachannel\nc=IN IP4 127.0.0.1\na=mid:0\n",kV="9",MV=2e4,FV=4e4;class xV{get localCapabilities(){return lv(this._localCapabilities)}get rtpCapabilities(){return lv(this._rtpCapabilities)}get candidates(){return lv(this._candidates)}get iceParameters(){return lv(this._iceParameters)}get dtlsParameters(){return lv(this._dtlsParameters)}constructor(e){O_(this,"sessionDesc",void 0),O_(this,"_localCapabilities",void 0),O_(this,"_rtpCapabilities",void 0),O_(this,"_candidates",void 0),O_(this,"_iceParameters",void 0),O_(this,"_dtlsParameters",void 0),O_(this,"setup",void 0),O_(this,"currentMidIndex",void 0),O_(this,"cname",void 0),O_(this,"firefoxSsrcMidMap",new Map),e=lv(e);let{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,remoteSetup:o,localCapabilities:a,cname:s}=e,A=hx.parse(LV);this._rtpCapabilities=i,this._candidates=r,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=a,this.setup=o,this.cname=s;let c=this.rtpCapabilities.send;for(let l of A.mediaDescriptions){if(l.attributes.iceUfrag=t.iceUfrag,l.attributes.icePwd=t.icePwd,l.attributes.fingerprints=n.fingerprints,l.attributes.candidates=r,l.attributes.setup=o,"application"===l.media.mediaType&&(l.attributes.sctpPort="5000"),"video"===l.media.mediaType&&(l.media.fmts=c.videoCodecs.map((e=>e.payloadType.toString(10))),l.attributes.payloads=c.videoCodecs,l.attributes.extmaps=c.videoExtensions,$v("PRELOAD_MEDIA_COUNT")>0)){let{ssrcs:e,ssrcGroups:t}=Qx([{ssrcId:FV,rtx:$v("USE_SUB_RTX")?40001:void 0}],this.cname);l.attributes.ssrcs=e,l.attributes.ssrcGroups=t}if("audio"===l.media.mediaType&&(l.media.fmts=c.audioCodecs.map((e=>e.payloadType.toString(10))),l.attributes.payloads=c.audioCodecs,l.attributes.extmaps=c.audioExtensions,qx(l),$v("PRELOAD_MEDIA_COUNT")>0)){let{ssrcs:e,ssrcGroups:t}=Qx([{ssrcId:MV}],this.cname);l.attributes.ssrcs=e,l.attributes.ssrcGroups=t}}this.sessionDesc=A,this.currentMidIndex=A.mediaDescriptions.length-1}updateRemoteRTPCapabilities(e){let t=hx.parse(LV);this._rtpCapabilities=e;let n=this.rtpCapabilities.send;for(let r of t.mediaDescriptions){if(r.attributes.iceUfrag=this._iceParameters.iceUfrag,r.attributes.icePwd=this._iceParameters.icePwd,r.attributes.fingerprints=this._dtlsParameters.fingerprints,r.attributes.candidates=this._candidates,r.attributes.setup=this.setup,"application"===r.media.mediaType&&(r.attributes.sctpPort="5000"),"video"===r.media.mediaType&&(r.media.fmts=n.videoCodecs.map((e=>e.payloadType.toString(10))),r.attributes.payloads=n.videoCodecs,r.attributes.extmaps=n.videoExtensions,$v("PRELOAD_MEDIA_COUNT")>0)){let{ssrcs:e,ssrcGroups:t}=Qx([{ssrcId:FV,rtx:$v("USE_SUB_RTX")?40001:void 0}],this.cname);r.attributes.ssrcs=e,r.attributes.ssrcGroups=t}if("audio"===r.media.mediaType&&(r.media.fmts=n.audioCodecs.map((e=>e.payloadType.toString(10))),r.attributes.payloads=n.audioCodecs,r.attributes.extmaps=n.audioExtensions,$v("PRELOAD_MEDIA_COUNT")>0)){let{ssrcs:e,ssrcGroups:t}=Qx([{ssrcId:MV}],this.cname);r.attributes.ssrcs=e,r.attributes.ssrcGroups=t}}this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1}preloadRemoteMedia(e){this.rtpCapabilities;let t=this.candidates,n=this.dtlsParameters,r=this.iceParameters,i=this.rtpCapabilities.send;for(let o=1;o<e;o++){let e=2*o+MV,a=2*o+FV,{ssrcs:s,ssrcGroups:A}=Qx([{ssrcId:e}],this.cname),{ssrcs:c,ssrcGroups:l}=Qx([{ssrcId:a,rtx:$v("USE_SUB_RTX")?a+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:kV,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.videoCodecs.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.videoExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:c,ssrcGroups:l,rtcpFeedbackWildcards:[],payloads:i.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*o-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:kV,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.audioCodecs.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.audioExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:s,ssrcGroups:A,rtcpFeedbackWildcards:[],payloads:i.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*o)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return hx.print(this.sessionDesc)}send(e,t,n,r){let{ssrcs:i,ssrcGroups:o}=Qx(t,this.cname,$v("SYNC_GROUP")?n:void 0),a=this.findPreloadMediaDesc(i);if(a){if(eT()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,a.attributes.mid),r&&(r.twcc||r.remb)){let e=this.sessionDesc.mediaDescriptions.indexOf(a);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(a,r),{mid:a.attributes.mid,needExchangeSDP:!0}}return{mid:a.attributes.mid,needExchangeSDP:!1}}{let t,n=this.findAvailableMediaIndex(e,i);return-1===n||ZS()||tT()||AT()||0===n&&$v("USE_SUB_RTX")?(t=this.createOrRecycleSendMedia(e,i,o,"sendonly",r),this.updateBundleMids()):(t=lv(this.sessionDesc.mediaDescriptions[n]),t.attributes.direction="sendonly",t.attributes.ssrcs=i,t.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[n]=this.mungSendMediaDesc(t,r)),eT()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,t.attributes.mid),{mid:t.attributes.mid,needExchangeSDP:!0}}}batchSend(e){let t=e.map((e=>{let{kind:t,ssrcMsg:n,mslabel:r}=e;return this.send(t,n,r)})),n=[],r=!1;return t.forEach((e=>{let{mid:t,needExchangeSDP:i}=e;i&&(r=!0),n.push(t)})),{mids:n,needExchangeSDP:r}}stopSending(e){let t=this.sessionDesc.mediaDescriptions.filter((t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((e=>{"0"===e.attributes.mid||eT()||ZS()||tT()?e.attributes.ssrcs=[]:(e.attributes.ssrcs=[],e.attributes.direction="inactive",e.media.port="0")})),this.updateBundleMids()}mute(e){let t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){let t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter((t=>yr(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="inactive"}))}unmuteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter((t=>yr(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="recvonly"}))}receive(e,t,n,r){e.forEach(((e,i)=>{this.createOrRecycleRecvMedia(e,[],"recvonly",t,n,r[i])})),this.updateBundleMids()}stopReceiving(e){let t=this.sessionDesc.mediaDescriptions.filter((t=>-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((e=>{e.media.port="0",e.attributes.direction="inactive"})),this.updateBundleMids()}updateCandidates(e){e===_R.TCP?this._candidates.forEach((e=>{-1===this._candidates.findIndex((t=>"tcp"===t.transport&&t.connectionAddress===e.connectionAddress&&t.port===e.port))&&this._candidates.push(UV(UV({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))})):this._candidates=this._candidates.filter((e=>"tcp"!==e.transport));for(let t of this.sessionDesc.mediaDescriptions)t.attributes.candidates=this.candidates}restartICE(e){e=lv(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}predictReceivingMids(e){let t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex((n=>{let r=n.media.mediaType===e&&"0"!==n.media.port&&("sendonly"===n.attributes.direction||"sendrecv"===n.attributes.direction)&&0===n.attributes.ssrcs.length;if(eT()){if(r){let e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==n.attributes.mid&&"1"!==n.attributes.mid)||!(!e||e!==n.attributes.mid)}return!1}return r}))}createOrRecycleRecvMedia(e,t,n,r,i,o){let a=e._mediaStreamTrack.kind,s=this.rtpCapabilities.recv,A=$x(a,s,this.localCapabilities.send,a===mR.VIDEO?r:i),c=a===mR.VIDEO?s.videoExtensions:s.audioExtensions;this.currentMidIndex+=1;let l="".concat(this.currentMidIndex),d={media:{mediaType:a,port:kV,protos:["UDP","TLS","RTP","SAVPF"],fmts:A.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:A,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(l)}};d=this.mungRecvMediaDsec(d,e,o);let u=this.findFirstClosedMedia(a);if(u){let e=this.sessionDesc.mediaDescriptions.indexOf(u);this.sessionDesc.mediaDescriptions[e]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}updateRemoteCodec(e,t,n){let r=[...new Set(this._rtpCapabilities.recv.videoCodecs.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")).filter((e=>{var t;return yr(t=Object.keys(ry)).call(t,e)})))],i=new Set(t);if(r.every((e=>i.has(e))))return Ey.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;let o=this._rtpCapabilities.recv.videoCodecs.filter((e=>t.some((t=>{var n;return yr(n=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(n,t)}))));if(0===o.length)return Ey.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(r," codecs: ").concat(t)),!1;let a,s=[...new Set(o.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")))];if(Ey.debug("updateRemoteCodec, from ".concat(r," to ").concat(s)),0===e.length)a=this.sessionDesc.mediaDescriptions.filter((e=>"video"===e.media.mediaType&&"recvonly"===e.attributes.direction));else if(a=this.sessionDesc.mediaDescriptions.filter((t=>t.attributes.mid&&yr(e).call(e,t.attributes.mid)&&"recvonly"===t.attributes.direction)),a.length!==e.length)return Ey.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;this._rtpCapabilities.recv.videoCodecs=o;let A=this.localCapabilities.send,c=this.rtpCapabilities.recv,l=$x(mR.VIDEO,c,A,n);return a.forEach((e=>{let t=l.map((e=>e.payloadType.toString(10)));Ey.debug("updateRemoteCodec mid: ".concat(e.attributes.mid,", from ").concat(e.attributes.payloads," to ").concat(l)),e.attributes.payloads=l,e.media.fmts=t})),!0}createOrRecycleSendMedia(e,t,n,r,i){let o=this.rtpCapabilities.send,a=e===mR.VIDEO?o.videoCodecs:o.audioCodecs,s=e===mR.VIDEO?o.videoExtensions:o.audioExtensions;this.currentMidIndex+=1;let A="".concat(this.currentMidIndex),c={media:{mediaType:e,port:kV,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:s,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(A)}};c=this.mungSendMediaDesc(c,i);let l=this.findFirstClosedMedia(e);if(l){let e=this.sessionDesc.mediaDescriptions.indexOf(l);this.sessionDesc.mediaDescriptions[e]=c}else this.sessionDesc.mediaDescriptions.push(c);return c}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((e=>"0"!==e.media.port)).map((e=>e.attributes.mid))}mungRecvMediaDsec(e,t,n){let r=lv(e);return Hx(r),Vx(r,t),Kx(r,t),jx(r),Gx(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){let n=lv(e);return Gx(n,t,this.localCapabilities.recv),qx(n),n}updateRecvMedia(e,t){let n=this.sessionDesc.mediaDescriptions.findIndex((t=>t.attributes.mid===e));if(-1!==n){let e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find((t=>eT()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port))}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find((t=>{var n;return(null===(n=t.attributes)||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId)===e[0].ssrcId}))}getSSRC(e){var t;return null===(t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e)))||void 0===t?void 0:t.attributes.ssrcs}}var QV;function VV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function HV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?VV(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let KV=(_I((QV=class e extends gR{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){let e;return this.localCapabilities&&(e=zx(this.localCapabilities)),[...new Set(e&&e.send.videoCodecs.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")).filter((e=>{var t;return yr(t=Object.keys(ry)).call(t,e)})))]}constructor(e,t,n){super(e,t),O_(this,"store",void 0),O_(this,"peerConnection",void 0),O_(this,"remoteSDP",void 0),O_(this,"initialOffer",void 0),O_(this,"transportEventReceiver",void 0),O_(this,"statsFilter",void 0),O_(this,"useXR",$v("USE_XR")),O_(this,"localCapabilities",void 0),O_(this,"localCandidateCount",0),O_(this,"allCandidatesReceived",!1),O_(this,"remoteCodecs",void 0),O_(this,"dataStreamChannelMap",new Map),O_(this,"establishPromise",void 0),O_(this,"mutex",new Uv("NVExtentionsConnection-mutex")),O_(this,"rtcMedia",void 0),this.store=t,this.peerConnection=n,this.statsFilter=Px(this.peerConnection,$v("STATS_UPDATE_INTERVAL"),void 0,eT()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(e){try{let e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let t=Mx(e.sdp),n=await Yx({filterRTX:!$v("USE_PUB_RTX")&&!$v("USE_SUB_RTX"),filterVideoFec:$v("FILTER_VIDEO_FEC"),filterAudioFec:$v("FILTER_AUDIO_FEC"),filterVideoCodec:$v("FILTER_VIDEO_CODEC")},{useXR:this.useXR});return this.localCapabilities=n,this.initialOffer=e,HV(HV({},t),{},{rtpCapabilities:n,offerSDP:e.sdp})}catch(t){throw new HI(TT.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(e,t,n,r,i,o){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");this.remoteSDP=new xV({remoteIceParameters:e,remoteDtlsParameters:t,candidates:n,remoteRTPCapabilities:r,remoteSetup:i,localCapabilities:zx(this.localCapabilities),cname:o});let a=this.remoteSDP.toString(),s=hx.parse(this.initialOffer.sdp),A=s.mediaDescriptions.find((e=>"audio"===e.media.mediaType));A&&qx(A),this.useXR&&Zx(s);let c=hx.print(s),l=this.logSDPExchange(c||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),null!==l&&void 0!==l&&l(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(a){throw new HI(TT.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(a.toString()))}}async updateRemoteRTPCapabilities(e,t){if(this.remoteCodecs=t,this.remoteSDP)if(this.remoteSDP.updateRemoteCodec(e,t,this.store.codec)){let e=await this.peerConnection.createOffer(),t=this.logSDPExchange(e.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(e);let n=this.remoteSDP.toString();null!==t&&void 0!==t&&t(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}else Ey.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.");else Ey.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(t))}async updateRemoteConnect(e){var t,n,r,i;null===(t=this.remoteSDP)||void 0===t||t.updateRemoteRTPCapabilities(e),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&(null===(i=this.remoteSDP)||void 0===i||i.updateRemoteCodec([],this.remoteCodecs,this.store.codec)),null===(n=this.remoteSDP)||void 0===n||n.preloadRemoteMedia(2);let o=null===(r=this.remoteSDP)||void 0===r?void 0:r.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});let a=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(a),Ey.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")}send(e,t,n){var r=this;return ex((function*(){let i=yield GF(r.mutex.lock("From NVExtentionsConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");let i=[];e.forEach((e=>{let t=r.peerConnection.addTransceiver(e._mediaStreamTrack,{direction:"sendonly"});i.push(t)})),eT()&&!0===$v("SIMULCAST")&&(yield GF(r.applySimulcastForFirefox(i,e)));let a,s=yield GF(r.peerConnection.createOffer()),A=r.remoteSDP.predictReceivingMids(e.length),c=r.mungSendOfferSDP(s.sdp,e,A),l=hx.parse(c),d=A.map((e=>{let t=l.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return Fx(t,$v("USE_PUB_RTX"))}));try{a=yield d}catch(o){a=[],r.remoteSDP.receive(e,t,n,a);let i=r.remoteSDP.toString();throw yield GF(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield GF(r.peerConnection.setRemoteDescription({type:"answer",sdp:i})),yield GF(r.stopSending(A,!0)),o}r.remoteSDP.receive(e,t,n,a);let u=r.remoteSDP.toString(),h=r.logSDPExchange(c,"offer","local","send");return yield GF(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield GF(r.applySimulcastEncodings(i,e)),yield GF(r.applySendEncodings(i,e)),null!==h&&void 0!==h&&h(u),yield GF(r.peerConnection.setRemoteDescription({type:"answer",sdp:u})),i.map(((e,t)=>{let n=A[t];return{localSSRC:d[t],id:n,transceiver:e}}))}catch(a){throw a instanceof HI?a:new HI(TT.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(a.toString()))}finally{i()}}))()}async stopSending(e,t){let n=t?void 0:await this.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");let t=this.peerConnection.getTransceivers().filter((t=>-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");t.map((e=>{var t;e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)}));let n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);let i=this.remoteSDP.toString();null!==r&&void 0!==r&&r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(r){throw new HI(TT.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(r.toString()))}finally{n&&n()}}async createDataChannels(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.createDataChannels before remote SDP created");let n=this.dataStreamChannelMap.get(e);return n&&"open"===n.readyState?Ey.debug("[P2PConnection] Channels are already available and can be reused directly."):(n=this.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:$v("DATASTREAM_MAX_RETRANSMITS")}),n.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,n)),void t.forEach((e=>{e._updateOriginDataChannel(n)}))}catch(n){throw n instanceof HI?n:new HI(TT.DATACHANNEL_FAILED,"NVExtentionsConnection.createDataChannels failed; ".concat(n.toString()))}}async stopDataChannels(e){try{let t=this.dataStreamChannelMap.get(e);return null!==t&&void 0!==t&&t.close(),void this.dataStreamChannelMap.delete(e)}catch(t){throw t instanceof HI?t:new HI(TT.DATACHANNEL_FAILED,"NVExtentionsConnection.stopDataChannels failed; ".concat(t.toString()))}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(e," before remoteSDP created."));let{mid:i,needExchangeSDP:o}=this.remoteSDP.send(e,t,n,r);if(o){let t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});let r=await this.peerConnection.createAnswer(),o=this.mungReceiveAnswerSDP(r.sdp,i,e);null!==n&&void 0!==n&&n(o||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:o}),Ey.debug("[NVExtentionsConnection] receive ".concat(e," by exchanging SDP."))}else Ey.debug("[NVExtentionsConnection] receive ".concat(e," no need to exchange SDP."));let a=this.peerConnection.getTransceivers().find((e=>e.mid===i));if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:i}}catch(i){throw new HI(TT.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(i.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");let{mids:t,needExchangeSDP:n}=this.remoteSDP.batchSend(e);if(n){let e=this.remoteSDP.toString(),t=this.logSDPExchange(e,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});let n=await this.peerConnection.createAnswer();null!==t&&void 0!==t&&t(n.sdp||""),await this.peerConnection.setLocalDescription(n),Ey.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else Ey.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return t.map((e=>{let t=this.peerConnection.getTransceivers().find((t=>t.mid===e));if(!t)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:t.receiver.track,id:e}}))}catch(t){throw new HI(TT.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(t.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);let t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});let r=await this.peerConnection.createAnswer();null!==n&&void 0!==n&&n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(t){throw new HI(TT.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(t.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);let t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});let r=await this.peerConnection.createAnswer();null!==n&&void 0!==n&&n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(t){throw new HI(TT.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(t.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);let t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});let r=await this.peerConnection.createAnswer();null!==n&&void 0!==n&&n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(t){throw new HI(TT.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(t.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");let t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((e=>{e.direction="inactive"}));let n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);let i=this.remoteSDP.toString();null!==r&&void 0!==r&&r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(t){throw new HI(TT.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(t.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");let t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((async(e,t)=>{e.direction="sendonly"}));let n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e);let i=this.remoteSDP.toString();null!==r&&void 0!==r&&r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(t){throw new HI(TT.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(t.toString()))}}restartICE(e){var t=this;return ex((function*(){let n=yield GF(t.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(oL().supportPCSetConfiguration){let n=t.peerConnection.getConfiguration(),r=e===_R.RELAY?"relay":"all";n.iceTransportPolicy!==r&&(Ey.debug("restartICE change iceTransportPolicy from [".concat(n.iceTransportPolicy,"] to [").concat(r,"]")),n.iceTransportPolicy=r,t.peerConnection.setConfiguration(n))}else if(e===_R.RELAY)return;e!==_R.RELAY&&t.remoteSDP.updateCandidates(e);let n=yield GF(t.peerConnection.createOffer({iceRestart:!0}));if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let r=Mx(n.sdp),{remoteIceParameters:i}=yield r.iceParameters;t.remoteSDP.restartICE(i);let o=t.remoteSDP.toString(),a=t.logSDPExchange(n.sdp||"","offer","local","restartICE");yield GF(t.peerConnection.setLocalDescription(n)),null!==a&&void 0!==a&&a(o),yield GF(t.peerConnection.setRemoteDescription({type:"answer",sdp:o}))}catch(r){Ey.warning("restart ICE failed, abort operation",r)}finally{n()}}))()}close(){var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");let n=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(n.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);let i=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),null!==o&&void 0!==o&&o(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(n){throw new HI(TT.EXCHANGE_SDP_FAILED,n.toString())}}async updateSendParameters(e,t){let n=this.peerConnection.getTransceivers().filter((t=>t.mid===e));1===n.length&&(this.isVP8Simulcast(t)?eT()||await this.applySimulcastEncodings(n,[t]):await this.applySendEncodings(n,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){let n=this.peerConnection.getTransceivers().find((e=>e.mid===t));n&&await n.sender.replaceTrack(e._mediaStreamTrack)}getP2PConnectionParams(){var e;if(null===(e=this.peerConnection.currentLocalDescription)||void 0===e||!e.sdp||!this.localCapabilities)throw new Error;return HV(HV({},Mx(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,Ey.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,Ey.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),$v("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(XT(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),$v("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),$v("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(n.iceTransportPolicy="relay")})))),n}static turnServerConfigToIceServers(e){let t=[];return e.forEach((e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(ob(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!$v("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}async applySendEncodings(e,t){try{if(!oL().supportSetRtpSenderParameters||e.length!==t.length)return;for(let l=0;l<e.length;l++){let d=e[l],u=t[l];if(u&&u instanceof uF){var n,r,i;if(this.isVP8Simulcast(u))continue;let e={},t={};switch(u._optimizationMode){case"motion":e.degradationPreference="maintain-framerate";break;case"detail":e.degradationPreference="maintain-resolution";break;default:e.degradationPreference="balanced"}var o,a,s,A;if(null!==(n=u._encoderConfig)&&void 0!==n&&n.bitrateMax&&(t.maxBitrate=1e3*(null===(o=u._encoderConfig)||void 0===o?void 0:o.bitrateMax)),yr(r=u._hints).call(r,vL.LOW_STREAM)&&(null!==(a=u._encoderConfig)&&void 0!==a&&a.frameRate&&(t.maxFramerate=sb(u._encoderConfig.frameRate)),null!==(s=u._encoderConfig)&&void 0!==s&&s.scaleResolutionDownBy&&(null===(A=u._encoderConfig)||void 0===A?void 0:A.scaleResolutionDownBy)>1&&(t.scaleResolutionDownBy=u._encoderConfig.scaleResolutionDownBy)),$v("DSCP_TYPE")&&gT()){var c;let e=$v("DSCP_TYPE");yr(c=["very-low","low","medium","high"]).call(c,e)&&(t.networkPriority=e)}let l=d.sender.getParameters(),h=null===(i=l.encodings)||void 0===i?void 0:i[0];eT()&&!h&&(e.encodings=[t]),h&&Object.assign(h,t),Object.assign(l,e),await d.sender.setParameters(l)}}}catch{Ey.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(e,t,n){let r=hx.parse(e);return t.forEach(((e,t)=>{let i=n[t],o=r.mediaDescriptions.find((e=>e.attributes.mid===i));o&&(Vx(o,e),Wx(o,e,this.store.codec))})),hx.print(r)}mungReceiveAnswerSDP(e,t,n){let r=hx.parse(e),i=r.mediaDescriptions.find((e=>e.attributes.mid===t));return i&&n===mR.AUDIO&&"audio"===i.media.mediaType&&qx(i),this.useXR&&Zx(r),hx.print(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let s=0;s<e.length;s++){var n,r,i,o,a;let A=e[s],c=t[s];if(c instanceof uF&&!yr(n=c._hints).call(n,vL.LOW_STREAM)&&null!==(r=c._encoderConfig)&&void 0!==r&&r.bitrateMax&&(null===(i=c._encoderConfig)||void 0===i?void 0:i.bitrateMax)>200&&null!==(o=c._scalabilityMode)&&void 0!==o&&o.numSpatialLayers&&(null===(a=c._scalabilityMode)||void 0===a?void 0:a.numSpatialLayers)>1&&"vp8"===this.store.codec){let e={},t={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];let n=A.sender.getParameters();await A.sender.setParameters(Object.assign(n,e))}}}async applySimulcastEncodings(e,t){if(!eT()&&e.length===t.length)for(let n=0;n<e.length;n++){let r=t[n];if(r instanceof uF&&this.isVP8Simulcast(r)){let t=e[n],i={},o={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};i.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:o.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:o.medium,scaleResolutionDownBy:4}];let a=t.sender.getParameters();await t.sender.setParameters(Object.assign(a,i))}}}isVP8Simulcast(e){var t,n,r,i,o;return!!(e instanceof uF&&$v("SIMULCAST")&&"vp8"===this.store.codec&&!yr(t=e._hints).call(t,vL.LOW_STREAM)&&null!==(n=e._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=e._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=e._scalabilityMode)&&void 0!==i&&i.numSpatialLayers&&(null===(o=e._scalabilityMode)||void 0===o?void 0:o.numSpatialLayers)>1)}logSDPExchange(e,t,n,r){if($v("SDP_LOGGING"))return Ey.upload("exchanging ".concat(n," ").concat(t," SDP during NVExtentionsConnection.").concat(r,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;let t=this.remoteSDP.getSSRC(e);return null===t||void 0===t?void 0:t[0].ssrcId}setConfiguration(t){if(oL().supportPCSetConfiguration){let n=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}}).prototype,"connect",[jV],Object.getOwnPropertyDescriptor(QV.prototype,"connect"),QV.prototype),_I(QV.prototype,"updateRemoteRTPCapabilities",[jV],Object.getOwnPropertyDescriptor(QV.prototype,"updateRemoteRTPCapabilities"),QV.prototype),_I(QV.prototype,"updateRemoteConnect",[jV],Object.getOwnPropertyDescriptor(QV.prototype,"updateRemoteConnect"),QV.prototype),_I(QV.prototype,"createDataChannels",[jV],Object.getOwnPropertyDescriptor(QV.prototype,"createDataChannels"),QV.prototype),_I(QV.prototype,"receive",[jV],Object.getOwnPropertyDescriptor(QV.prototype,"receive"),QV.prototype),_I(QV.prototype,"batchReceive",[jV],Object.getOwnPropertyDescriptor(QV.prototype,"batchReceive"),QV.prototype),_I(QV.prototype,"stopReceiving",[jV],Object.getOwnPropertyDescriptor(QV.prototype,"stopReceiving"),QV.prototype),_I(QV.prototype,"muteRemote",[jV],Object.getOwnPropertyDescriptor(QV.prototype,"muteRemote"),QV.prototype),_I(QV.prototype,"unmuteRemote",[jV],Object.getOwnPropertyDescriptor(QV.prototype,"unmuteRemote"),QV.prototype),_I(QV.prototype,"muteLocal",[jV],Object.getOwnPropertyDescriptor(QV.prototype,"muteLocal"),QV.prototype),_I(QV.prototype,"unmuteLocal",[jV],Object.getOwnPropertyDescriptor(QV.prototype,"unmuteLocal"),QV.prototype),_I(QV.prototype,"close",[jV],Object.getOwnPropertyDescriptor(QV.prototype,"close"),QV.prototype),_I(QV.prototype,"updateEncoderConfig",[jV],Object.getOwnPropertyDescriptor(QV.prototype,"updateEncoderConfig"),QV.prototype),_I(QV.prototype,"updateSendParameters",[jV],Object.getOwnPropertyDescriptor(QV.prototype,"updateSendParameters"),QV.prototype),_I(QV.prototype,"replaceTrack",[jV],Object.getOwnPropertyDescriptor(QV.prototype,"replaceTrack"),QV.prototype),_I(QV.prototype,"getRemoteSSRC",[jV],Object.getOwnPropertyDescriptor(QV.prototype,"getRemoteSSRC"),QV.prototype),QV);function jV(e,t,n){let r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){let e=this.mutex,n=await e.lock("From NVExtentionsConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return await r.apply(this,o)}finally{n()}},n}var GV;function WV(e){var t,n,r,i=2;for(typeof Symbol<"u"&&(n=aV,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new YV(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function YV(e){function t(e){if(Object(e)!==e)return wu.reject(new TypeError(e+" is not an object."));var t=e.done;return wu.resolve(e.value).then((function(e){return{value:e,done:t}}))}return(YV=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?wu.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?wu.reject(e):t(n.apply(this.s,arguments))}},new YV(e)}let JV=(_I((GV=class e extends gR{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){return this._p2pConnection.localCodecs}constructor(t,n){super(t,n),O_(this,"store",void 0),O_(this,"peerConnection",void 0),O_(this,"cname",void 0),O_(this,"mutex",new Uv("DataChannelConnection-mutex")),O_(this,"dataChannel",void 0),O_(this,"_p2pConnection",void 0),O_(this,"establishPromise",void 0),O_(this,"_nvMedia",void 0),this.store=n,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new KV(t,n,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}async establish(){var e;let t=null===(e=this._nvMedia)||void 0===e?void 0:e.getLocalRtpCapabilities();return await this._p2pConnection.establish(t)}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}async connect(e,t,n,r,i,o){return this.cname=o,await this._p2pConnection.connect(e,t,n,r,i,o),await new wu(((e,t)=>{let r=setTimeout((()=>{this.closeSignal(),t(new HI(TT.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(n))))}),2e3);this.dataChannel.onopen=()=>{if("open"===this.dataChannel.readyState)return clearTimeout(r),void e()},this.dataChannel.onerror=e=>{this.closeSignal(),t(e)}})),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}async updateRemoteRTPCapabilities(e,t){return this._p2pConnection.updateRemoteRTPCapabilities(e,t)}send(e,t,n){var r=this;return ex((function*(){let i=yield GF(r.mutex.lock("From DataChannelConnection.send"));try{return yield*iV(WV(r._p2pConnection.send(e,t,n)))}finally{i()}}))()}async stopSending(e,t){return this._p2pConnection.stopSending(e,t)}async createDataChannels(e,t){return this._p2pConnection.createDataChannels(e,t)}async stopDataChannels(e){return this._p2pConnection.stopDataChannels(e)}async receive(e,t,n,r){return this._nvMedia?(Ey.debug("[DataChannelConnection] receive ".concat(e," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(e,t,this.cname)):(Ey.debug("[DataChannelConnection] receive ".concat(e," by WebRTC.")),await this._p2pConnection.receive(e,t,n,r))}async batchReceive(e){return[...await this._p2pConnection.batchReceive(e)]}async stopReceiving(e){return await this._p2pConnection.stopReceiving(e)}async muteRemote(e){return await this._p2pConnection.muteRemote(e)}async unmuteRemote(e){return await this._p2pConnection.unmuteRemote(e)}async muteLocal(e){return await this._p2pConnection.muteLocal(e)}async unmuteLocal(e){return await this._p2pConnection.unmuteLocal(e)}restartICE(e){var t=this;return ex((function*(){return yield*iV(WV(t._p2pConnection.restartICE(e)))}))()}close(){var e;null===(e=this._nvMedia)||void 0===e||e.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(e){return this._p2pConnection.getRemoteVideoIsReady(e)}updateRemoteConnect(e){var t;null===(t=this._nvMedia)||void 0===t||t.setRemoteRtpCapabilities(e),this._p2pConnection.updateRemoteConnect(e)}async updateEncoderConfig(e,t){return await this._p2pConnection.updateEncoderConfig(e,t)}async updateSendParameters(e,t){return await this._p2pConnection.updateSendParameters(e,t)}setStatsRemoteVideoIsReady(e,t){this._p2pConnection.setStatsRemoteVideoIsReady(e,t)}async replaceTrack(e,t){return await this._p2pConnection.replaceTrack(e,t)}async getRemoteSSRC(e){return this._p2pConnection.getRemoteSSRC(e)}logSDPExchange(e,t,n,r){if($v("SDP_LOGGING"))return Ey.upload("exchanging ".concat(n," ").concat(t," SDP during DataChannelConnection.").concat(r,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}static resolvePCConfiguration(t){let n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(XT(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),$v("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),$v("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(n.iceTransportPolicy="relay")})))),n}static turnServerConfigToIceServers(e){let t=[];return e.forEach((e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(ob(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!$v("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=e=>{var t;return null===(t=this.onICEConnectionStateChange)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onConnectionStateChange=e=>{var t;return null===(t=this.onConnectionStateChange)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onDTLSTransportStateChange=e=>{var t;return null===(t=this.onDTLSTransportStateChange)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onDTLSTransportError=e=>{var t;return null===(t=this.onDTLSTransportError)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onICETransportStateChange=e=>{var t;return null===(t=this.onICETransportStateChange)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onFirstAudioReceived=e=>{var t;return null===(t=this.onFirstAudioReceived)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onFirstVideoReceived=e=>{var t;return null===(t=this.onFirstVideoReceived)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onFirstAudioDecoded=e=>{var t;return null===(t=this.onFirstAudioDecoded)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onFirstVideoDecoded=(e,t,n)=>{var r;return null===(r=this.onFirstVideoDecoded)||void 0===r?void 0:r.call(this,e,t,n)},this._p2pConnection.onFirstVideoDecodedTimeout=e=>{var t;return null===(t=this.onFirstVideoDecodedTimeout)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onSelectedLocalCandidateChanged=(e,t)=>{var n;return null===(n=this.onSelectedLocalCandidateChanged)||void 0===n?void 0:n.call(this,e,t)},this._p2pConnection.onSelectedRemoteCandidateChanged=(e,t)=>{var n;return null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n?void 0:n.call(this,e,t)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0}setConfiguration(e){this._p2pConnection.setConfiguration(e)}}).prototype,"connect",[XV],Object.getOwnPropertyDescriptor(GV.prototype,"connect"),GV.prototype),_I(GV.prototype,"updateRemoteRTPCapabilities",[XV],Object.getOwnPropertyDescriptor(GV.prototype,"updateRemoteRTPCapabilities"),GV.prototype),_I(GV.prototype,"createDataChannels",[XV],Object.getOwnPropertyDescriptor(GV.prototype,"createDataChannels"),GV.prototype),_I(GV.prototype,"receive",[XV],Object.getOwnPropertyDescriptor(GV.prototype,"receive"),GV.prototype),_I(GV.prototype,"stopReceiving",[XV],Object.getOwnPropertyDescriptor(GV.prototype,"stopReceiving"),GV.prototype),_I(GV.prototype,"muteRemote",[XV],Object.getOwnPropertyDescriptor(GV.prototype,"muteRemote"),GV.prototype),_I(GV.prototype,"unmuteRemote",[XV],Object.getOwnPropertyDescriptor(GV.prototype,"unmuteRemote"),GV.prototype),_I(GV.prototype,"muteLocal",[XV],Object.getOwnPropertyDescriptor(GV.prototype,"muteLocal"),GV.prototype),_I(GV.prototype,"unmuteLocal",[XV],Object.getOwnPropertyDescriptor(GV.prototype,"unmuteLocal"),GV.prototype),_I(GV.prototype,"close",[XV],Object.getOwnPropertyDescriptor(GV.prototype,"close"),GV.prototype),_I(GV.prototype,"updateEncoderConfig",[XV],Object.getOwnPropertyDescriptor(GV.prototype,"updateEncoderConfig"),GV.prototype),_I(GV.prototype,"updateSendParameters",[XV],Object.getOwnPropertyDescriptor(GV.prototype,"updateSendParameters"),GV.prototype),_I(GV.prototype,"replaceTrack",[XV],Object.getOwnPropertyDescriptor(GV.prototype,"replaceTrack"),GV.prototype),_I(GV.prototype,"getRemoteSSRC",[XV],Object.getOwnPropertyDescriptor(GV.prototype,"getRemoteSSRC"),GV.prototype),GV);function XV(e,t,n){let r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){let e=this.mutex,n=await e.lock("From DataChannelConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return await r.apply(this,o)}finally{n()}},n}var zV;function qV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ZV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qV(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $V(e){var t,n,r,i=2;for(typeof Symbol<"u"&&(n=aV,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new eH(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function eH(e){function t(e){if(Object(e)!==e)return wu.reject(new TypeError(e+" is not an object."));var t=e.done;return wu.resolve(e.value).then((function(e){return{value:e,done:t}}))}return(eH=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?wu.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?wu.reject(e):t(n.apply(this.s,arguments))}},new eH(e)}let tH=(zV=class extends VT{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(TR.StateChange,t,this._state)}constructor(e,t){super(),O_(this,"store",void 0),O_(this,"statsUploader",void 0),O_(this,"connection",void 0),O_(this,"localTrackMap",new Map),O_(this,"remoteUserMap",new Map),O_(this,"localDataChannels",[]),O_(this,"remoteDataChannelMap",new Map),O_(this,"pendingLocalTracks",[]),O_(this,"pendingRemoteTracks",[]),O_(this,"pendingLocalDataChannels",[]),O_(this,"pendingRemoteDataChannels",[]),O_(this,"statsCollector",void 0),O_(this,"isPlanB",!1),O_(this,"shouldForwardP2PCreation",void 0),O_(this,"iceFailedCount",0),O_(this,"dtlsFailedCount",0),O_(this,"mutex",new Uv("P2PChannel-mutex")),O_(this,"_state",SR.Disconnected),O_(this,"_pcStatsUploadType",$v("NEW_ICE_RESTART")?CR.FIRST_CONNECTION:CR.OLD_FIRST_CONNECTION),O_(this,"_isInRestartIce",!1),O_(this,"_isStartRestartIce",!1),O_(this,"_restartStates",["disconnected","failed"]),O_(this,"_restartTimer",void 0),O_(this,"_isFirstConnected",!0),O_(this,"handleMuteLocalTrack",(async(e,t,n)=>{let r=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==SR.Connected)return void n(new vT(TT.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));let r=this.filterTobeMutedTracks(e);if(0===r.length)return void t();let i=r.find((e=>"videoLowTrack"===e[0]));i&&i[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(r.map((e=>{let[,{id:t}]=e;return t})));let o=this.createMuteMessage(r);await rv(this,TR.RequestMuteLocal,o),t()}catch(i){n(i)}finally{r()}})),O_(this,"handleUnmuteLocalTrack",(async(e,t,n)=>{let r=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==SR.Connected)return void n(new vT(TT.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));let r=this.filterTobeUnmutedTracks(e);if(0===r.length)return void t();let i=r.find((e=>"videoLowTrack"===e[0]));if(i){let t=i[1];if(t.track._originMediaStreamTrack.stop(),!$v("DISABLE_DUAL_STREAM_USE_ENCODING")&&oL().supportDualStreamEncoding){let n=e._mediaStreamTrack.clone();t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n}else{let n=AQ(e,ov(this,TR.RequestLowStreamParameter));t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n}await new wu(((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)}))}await this.connection.unmuteLocal(r.map((e=>{let[,{id:t}]=e;return t})));let o=this.createUnmuteMessage(r);await rv(this,TR.RequestUnmuteLocal,o),t()}catch(i){n(i)}finally{r()}})),O_(this,"handleUpdateVideoEncoder",(async(e,t,n)=>{let r=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{let n=this.localTrackMap.get(wR.LocalVideoTrack);if(!this.connection||!n||n.track!==e||this.state!==SR.Connected)return void t();let{id:r,track:i}=n;await this.connection.updateSendParameters(r,i),await this.connection.updateEncoderConfig(r,i),this.emit(TR.UpdateVideoEncoder,i),t()}catch(i){n(i)}finally{r()}})),O_(this,"handleUpdateVideoSendParameters",(async(e,t,n)=>{let r=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{let n=this.localTrackMap.get(wR.LocalVideoTrack);if(!this.connection||!n||n.track!==e||this.state!==SR.Connected)return void t();let{id:r,track:i}=n;await this.connection.updateSendParameters(r,i),t()}catch(i){n(i)}finally{r()}})),O_(this,"handleReplaceMixingTrack",(async(e,t,n,r)=>{if(!this.connection||this.state!==SR.Connected)return void t();let i,o=bQ([e]);Ey.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(o.getTrackId(),"]")),"boolean"==typeof r&&r||(i=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(e,o),t()}catch(s){n(s)}finally{var a;null===(a=i)||void 0===a||a()}})),O_(this,"handleReplaceTrack",(async(e,t,n,r)=>{let i;Ey.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(e.getTrackId(),"]")),"boolean"==typeof r&&r||(i=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var o;let n=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(!this.connection||!n||this.state!==SR.Connected)return void t();if(await(null===(o=this.connection)||void 0===o?void 0:o.replaceTrack(e,n[1].id)),this.isPlanB){let t=n[1];t.id=e._mediaStreamTrack.id,this.localTrackMap.set(n[0],t)}if(n[0]===wR.LocalVideoTrack&&!$v("DISABLE_DUAL_STREAM_USE_ENCODING")&&oL().supportDualStreamEncoding){let t=this.localTrackMap.get(wR.LocalVideoLowTrack);if(t){let n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new wu(((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)}))}}t()}catch(s){n(s)}finally{var a;null===(a=i)||void 0===a||a()}})),O_(this,"handleGetRTCStats",(e=>{e(this.statsCollector.getRTCStats())})),O_(this,"handleGetLocalVideoStats",(e=>{e(this.statsCollector.getLocalVideoTrackStats())})),O_(this,"handleGetLocalAudioStats",(e=>{e(this.statsCollector.getLocalAudioTrackStats())})),O_(this,"handleGetRemoteVideoStats",(e=>this.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid])),O_(this,"handleGetRemoteAudioStats",(e=>this.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid])),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new TQ(this.store),this.bindStatsUploaderEvents(),this.isPlanB=!oL().supportUnifiedPlan||$v("CHROME_FORCE_PLAN_B")&&gT(),this.shouldForwardP2PCreation=$v("FORWARD_P2P_CREATION")&&oL().supportPCSetConfiguration&&ET(),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new JV({},this.store):this.isPlanB?new dV({},this.store):new NV({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var n;this.state=SR.New;let r=this.shouldForwardP2PCreation&&"closed"===(null===(n=this.connection)||void 0===n?void 0:n.peerConnectionState);if(this.shouldForwardP2PCreation&&!r||(r&&this.connection&&(Ey.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.store.useDataChannel?new JV(e,this.store):this.isPlanB?new dV(e,this.store):new NV(e,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new vT(TT.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=$v("NEW_ICE_RESTART")?CR.FIRST_CONNECTION:CR.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e,t,n,r,i,o){if(!this.connection)throw new vT(TT.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.connection instanceof JV?this.connection.updateRemoteConnect(r):(this.store.peerConnectionStart(),await this.connection.connect(e,t,n,r,i,o),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=SR.Connected)}updateRemoteRTPCapabilities(e){let t=Array.from(this.localTrackMap.entries()).filter((e=>{var t;let[n]=e;return yr(t=[wR.LocalVideoLowTrack,wR.LocalVideoTrack]).call(t,n)})),n=t.map((e=>{let[,{id:t}]=e;return t})),r=t.map((e=>{let[t]=e;return t}));if(this.connection instanceof NV){if(vy.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!yr(e).call(e,this.store.codec)){let t=["vp9","vp8","h264"].find((t=>yr(e).call(e,t)));t&&(this.store.codec=t,Ey.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(t,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async preConnect(e,t,n,r,i,o){if(!this.connection)throw new vT(TT.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.store.peerConnectionStart();let a=await this.connection.connect(e,t,n,r,i,o);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=SR.Connected,a}getEstablishParams(){if(this.connection instanceof JV)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}async publishDataChannel(e){if(!this.connection||this.state!==SR.Connected){if(this.state===SR.Disconnected)throw new vT(TT.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return void e.forEach((e=>{var t;yr(t=this.pendingLocalDataChannels).call(t,e)||this.pendingLocalDataChannels.push(e)}))}let t=this.filterTobePublishedDataChannels(e);0!==t.length&&(t.forEach((e=>{let t=Date.now();this.store.publish(e.id.toString(),"datachannel",t)})),await this.connection.createDataChannels(this.store.uid,t),t.forEach((e=>{this.localDataChannels.push(e);let t=Date.now();this.store.publish(e.id+"","datachannel",void 0,t)})))}publish(e,t,n){var r=this;return ex((function*(){let i=yield GF(r.mutex.lock("From P2PChannel.publish"));try{if(!r.connection||r.state!==SR.Connected){if(r.state===SR.Disconnected)throw new vT(TT.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);let t=e.filter((e=>-1===r.pendingLocalTracks.indexOf(e)));return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(t))}r.store.pubId=r.store.pubId+1,KF.markPublishStart(r.store.clientId,r.store.pubId);let i=r.filterTobePublishedTracks(e,t,n);if(0===i.length)return void(yield GF(r.tryToUnmuteAudio(e)));yield*iV($V(r.doPublish(r.connection,i)))}finally{i()}}))()}doPublish(e,t){var n=this;return ex((function*(){t.forEach((e=>{let{track:t,type:r}=e,i=Date.now();n.store.publish(t.getTrackId(),r===wR.LocalAudioTrack?"audio":"video",i)})),n.bindLocalTrackEvents(t);let r,i=t.map((e=>{let{track:t}=e;return t})),o=yield GF(e.send(t.map((e=>{let{track:t}=e;return t})),n.store.codec,n.store.audioCodec)),a=(yield GF(o.next())).value,s=n.createGatewayPublishMessage(t,a);try{r=yield s}catch(d){throw o.throw(d),(null===d||void 0===d?void 0:d.code)===TT.WS_ABORT&&t.forEach((e=>{let{track:t}=e;-1===n.pendingLocalTracks.indexOf(t)&&n.pendingLocalTracks.push(t)})),n.unbindLocalTrackEvents(t),d}let A=n.mapPubResToRemoteConfig(s,r),c=(yield GF(o.next(A))).value,l=$v("ENABLE_VIDEO_SEI");i.forEach((async e=>{let t=e.getRTCRtpTransceiver();t&&l&&(e.trackMediaType===mR.VIDEO?await async function(e,t){if(!oL().supportWebRTCEncodedTransform)return void Ey.warning("browser not support video encoded transform");if(xF.has(e)||!e.track)return;let n={track:e.track};if(qS()){if(!e.createEncodedStreams)return void Ey.warning("browser not support createEncodedStreams() API");let o=null;try{o=e.createEncodedStreams()}catch(r){return void Ey.error("create video-encoded-streams error",r&&r.message)}let a=[];t.on("sei-to-send",(e=>{a.push(e)}));let s=new TransformStream({transform(t,r){n.controller||(n.controller=r),e.track&&e.track.id!==n.track.id&&(Ey.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i));let o=a.shift();o&&(t.data=function(e,t){let n=function(e){let t=e.length,n=[],r=0;for(;r<t;)r+2<t&&0===e[r]&&0===e[r+1]&&(0===e[r+2]||1===e[r+2]||2===e[r+2]||3===e[r+2])?(n.push(e[r],e[r+1],3,e[r+2]),r+=3):(n.push(e[r]),r++);return new Uint8Array(n)}(t),r=n.length,i=Math.floor(r/255),o=r%255,a=new Uint8Array(6+i+1+r+e.byteLength);a[0]=0,a[1]=0,a[2]=0,a[3]=1,a[4]=6,a[5]=101;let s=0;for(;s<i;)a[6+s]=255,s++;return a[6+s]=o,s++,a.set(n,6+s),a.set(new Uint8Array(e),6+s+r),a.buffer}(t.data,o)),r.enqueue(t)}});o.readable.pipeThrough(s).pipeTo(o.writable)}else{if(!ZS())return;{if(typeof RTCRtpScriptTransform>"u")return void Ey.warning("browser not support RTCRtpScriptTransform");let r=kF(),o=new MessageChannel;await new wu((e=>r.onmessage=t=>{"registered"===t.data&&e(void 0)}));let a=new RTCRtpScriptTransform(r,{name:"tx",port:o.port2},[o.port2]);e.transform=a,await new wu((e=>r.onmessage=t=>{"started"===t.data&&e(void 0)})),t.on("sei-to-send",(e=>{o.port1.postMessage({sei:e})})),o.port1.onmessage=t=>{var r;t.data.transformed&&e.track&&(null===(r=e.track)||void 0===r?void 0:r.id)!==n.track.id&&(Ey.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i))},n.worker=r}}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}let t=xF.get(e);if(t){xF.delete(e);try{var n,o;null===(n=t.controller)||void 0===n||n.terminate(),null===(o=t.worker)||void 0===o||o.terminate()}catch(r){Ey.warning(r&&r.message)}}}xF.set(e,n),e.track.addEventListener("ended",i)}(t.sender,e):e.trackMediaType===mR.AUDIO&&await async function(e){if(!oL().supportWebRTCEncodedTransform)return void Ey.warning("browser not support audio encoded transform");if(MF.has(e)||!e.track)return;let t={track:e.track};if(qS()){if(!e.createEncodedStreams)return void Ey.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(r){return void Ey.error("create audio-encoded-streams error",r&&r.message)}let o=new TransformStream({transform(r,i){t.controller||(t.controller=i),e.track&&e.track.id!==t.track.id&&(Ey.debug("audio track changed: ".concat(t.track.id," => ").concat(e.track.id)),t.track.removeEventListener("ended",n),t.track=e.track,t.track.addEventListener("ended",n)),i.enqueue(r)}});i.readable.pipeThrough(o).pipeTo(i.writable)}else if(ZS()){if(typeof RTCRtpScriptTransform>"u")return void Ey.warning("browser not support RTCRtpScriptTransform");let r=kF(),i=new MessageChannel;await new wu((e=>r.onmessage=t=>{"registered"===t.data&&e(void 0)}));let o=new RTCRtpScriptTransform(r,{name:"tx",port:i.port2},[i.port2]);e.transform=o,await new wu((e=>r.onmessage=t=>{"started"===t.data&&e(void 0)})),i.port1.onmessage=r=>{var i;r.data.transformed&&e.track&&(null===(i=e.track)||void 0===i?void 0:i.id)!==t.track.id&&(Ey.debug("audio track changed: ".concat(t.track.id," => ").concat(e.track.id)),t.track.removeEventListener("ended",n),t.track=e.track,t.track.addEventListener("ended",n))},t.worker=r}function n(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",n)}let t=MF.get(e);if(t){MF.delete(e);try{var r,i;null===(r=t.controller)||void 0===r||r.terminate(),null===(i=t.worker)||void 0===i||i.terminate()}catch(o){Ey.warning(o&&o.message)}}}MF.set(e,t),e.track.addEventListener("ended",n)}(t.sender))})),t.forEach((e=>{let{type:t}=e;n.statsCollector.addLocalStats(t)})),n.assignLocalTracks(t,c),n.statsUploader.startUploadOutboundStats(),t.forEach((e=>{let{track:t,type:r}=e,i=Date.now();n.store.publish(t.getTrackId(),r===wR.LocalAudioTrack?"audio":"video",void 0,i)}))}))()}async updateVideoStreamParameter(e,t){let n=this.localTrackMap.get(t);if(!n)return;if(!(n.track instanceof uF))return Ey.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof NV||this.connection instanceof dV))return Ey.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");let{track:r}=n,i=function(e,t){let n={};return e.height&&e.width&&(n.scaleResolutionDownBy=ub(e,t)),n.maxFramerate=e.framerate?sb(e.framerate):void 0,n.maxBitrate=e.bitrate?1e3*e.bitrate:void 0,n}(e,r);if(r._encoderConfig||(r._encoderConfig={}),t!==wR.LocalVideoLowTrack||!$v("DISABLE_DUAL_STREAM_USE_ENCODING")&&oL().supportDualStreamEncoding)null!=i.scaleResolutionDownBy&&(r._encoderConfig.scaleResolutionDownBy=i.scaleResolutionDownBy);else{let t=r._originMediaStreamTrack;if(!t.canvas)return Ey.warn("[".concat(r.getTrackId(),"] no canvas on track"));!function(e,t){let n=e.canvas;t.width&&(n.width=sb(t.width)),t.height&&(n.height=sb(t.height)),t.framerate&&(n.stopCapture&&n.stopCapture(),n.stopCapture=rk((()=>{!n.startCapture&&n.stopCapture&&n.stopCapture(),n.startCapture&&n.startCapture()}),sb(t.framerate)))}(t,e)}null!=i.maxBitrate&&(r._encoderConfig.bitrateMax=i.maxBitrate/1e3),null!=i.maxFramerate&&(r._encoderConfig.frameRate&&"object"==typeof r._encoderConfig.frameRate?r._encoderConfig.frameRate.max=i.maxFramerate:r._encoderConfig.frameRate={max:i.maxFramerate}),Ey.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),await this.connection.updateRtpSenderEncodings(r)}publishLowStream(e){var t=this;return ex((function*(){if(!t.connection||t.state!==SR.Connected)return;let n=yield GF(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{let n=t.localTrackMap.get(wR.LocalVideoTrack);if(!n)throw new vT(TT.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(wR.LocalVideoLowTrack))throw new vT(TT.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));let i=[{track:t.getLowVideoTrack(n.track,e),type:wR.LocalVideoLowTrack}];if(yield*iV($V(t.doPublish(t.connection,i))),n.track.muted||!n.track.enabled){var r;let e=null===(r=t.localTrackMap.get(wR.LocalVideoLowTrack))||void 0===r?void 0:r.id;void 0!==e&&(yield GF(t.connection.muteLocal([e])))}}finally{n()}}))()}async republish(){this.pendingLocalTracks.length>0&&(Ey.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await nv(this,TR.RequestRePublish,this.pendingLocalTracks),this.emit(TR.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(Ey.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await nv(this,TR.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){let{user:e,kind:n}=this.pendingRemoteTracks[t];(n!==mR.AUDIO||e._audio_added_&&e._audioSSRC)&&(n!==mR.VIDEO||e._video_added_&&e._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await nv(this,TR.RequestReSubscribe,this.pendingRemoteTracks);else for(let{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===mR.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach((e=>{let{user:t}=e;this.emit(TR.MediaReconnectEnd,t.uid)})),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==SR.Connected)return void e.forEach((e=>{let t=this.pendingLocalTracks.indexOf(e);-1!==t&&this.pendingLocalTracks.splice(t,1)}));let t=this.filterTobeUnpublishedTracks(e);if(0===t.length)return;let n=t.find((e=>"videoLowTrack"===e[0]));return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==SR.Connected)return void e.forEach((e=>{let t=this.pendingLocalDataChannels.indexOf(e);-1!==t&&this.pendingLocalDataChannels.splice(t,1)}));let t=this.filterTobeUnpublishedDataChannels(e);return 0!==t.length?(t.forEach((e=>{let t=this.localDataChannels.indexOf(e);-1!==t&&this.localDataChannels.splice(t,1)})),0===this.localDataChannels.length&&await this.connection.stopDataChannels(this.store.uid),t.map((e=>e.id))):void 0}async unpublishLowStream(){if(!this.connection||this.state!==SR.Connected)return;let e=this.localTrackMap.get(wR.LocalVideoLowTrack);if(!e)return;e.track.close();let t=[[wR.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){let n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map((e=>{let[,{id:t}]=e;return t}))),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map((e=>{let[t,{track:n}]=e;return{type:t,track:n}}))),t.forEach((e=>{let[t]=e;this.statsCollector.removeLocalStats(t)})),0===this.localTrackMap.size&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==SR.Connected)throw new vT(TT.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");let n=t.filter((t=>{var n;return!(null!==(n=this.remoteDataChannelMap.get(e))&&void 0!==n&&n.get(t.id))}));if(0!==n.length)return await this.connection.createDataChannels(e.uid,n),n.forEach((t=>{var n;this.remoteDataChannelMap.has(e)?null===(n=this.remoteDataChannelMap.get(e))||void 0===n||n.set(t.id,t):this.remoteDataChannelMap.set(e,new Map([[t.id,t]]));let r=this.pendingRemoteDataChannels.findIndex((n=>{let{user:r,id:i}=n;return r.uid===e.uid&&i===t.id}));-1!==r&&this.pendingRemoteDataChannels.splice(r,1)})),n.map((e=>e.id))}async subscribe(e,t,n,r,i){var o;if(!this.connection||this.state!==SR.Connected)throw new vT(TT.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if(null!==(o=this.remoteUserMap.get(e))&&void 0!==o&&o.has(t))return;let a,s,A;if(i){let n=i.find((e=>{let{stream_type:n}=e;return n===t}));if(!n)throw new vT(TT.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));let r=await this.connection.receive(t,n.ssrcs,String(e._uintid),n.attributes);this.connection instanceof NV&&(A=r.transceiver),a=r.track,s=r.id}else{let i=await this.connection.receive(t,[{ssrcId:n,rtx:r}],String(e._uintid),void 0);this.connection instanceof NV&&(A=i.transceiver),a=i.track,s=i.id}t===mR.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(a):(e._audioTrack=new OF(a,e.uid,e._uintid,this.store),Ey.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),A&&e._audioTrack._updateRtpTransceiver(A),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(a):(e._videoTrack=new bF(a,e.uid,e._uintid,this.store),Ey.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),A&&e._videoTrack._updateRtpTransceiver(A),this.bindRemoteTrackEvents(e,e._videoTrack)),$v("ENABLE_VIDEO_SEI")&&A&&(t==mR.VIDEO?await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!oL().supportWebRTCEncodedTransform)return void Ey.warning("browser not support video encoded transform");if(!e.track)return;if(QF.has(e)){let n=QF.get(e);return void(n&&(n.onSei=t.onSei))}let n={track:e.track,onSei:t.onSei};if(qS()){if(!e.createEncodedStreams)return void Ey.warning("browser not support createEncodedStreams() API");let t=null;try{t=e.createEncodedStreams()}catch(a){return void Ey.error("create video-encoded-streams error",a&&a.message)}let i=new TransformStream({transform(t,i){n.controller||(n.controller=i),e.track&&e.track.id!==n.track.id&&(Ey.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));let o=function(e){let t=new DataView(e.data);if(0===t.getUint8(0)&&0===t.getUint8(1)&&0===t.getUint8(2)&&1===t.getUint8(3)&&6===t.getUint8(4)){let n=6,r=0,i=0;for(;255===(i=t.getUint8(n++));)r+=255;r+=i;let o=function(e,t,n){let r=new Uint8Array(e,t,n),i=[],o=0;for(;o<n;)o+3<n&&0===r[o]&&0===r[o+1]&&3===r[o+2]&&(0===r[o+3]||1===r[o+3]||2===r[o+3]||3===r[o+3])?(i.push(r[o],r[o+1],r[o+3]),o+=4):(i.push(r[o]),o++);return new Uint8Array(i)}(e.data,n,r);return new Uint8Array(o)}return null}(t);o&&n.onSei&&n.onSei(o),i.enqueue(t)}});t.readable.pipeThrough(i).pipeTo(t.writable)}else if(ZS()){if(typeof RTCRtpScriptTransform>"u")return void Ey.warning("browser not support RTCRtpScriptTransform");let t=kF(),i=new MessageChannel;await new wu((e=>t.onmessage=t=>{"registered"===t.data&&e(void 0)}));let o=new RTCRtpScriptTransform(t,{name:"rx",port:i.port2},[i.port2]);e.transform=o,await new wu((e=>t.onmessage=t=>{"started"===t.data&&e(void 0)})),i.port1.onmessage=t=>{var i;t.data.transformed&&e.track&&(null===(i=e.track)||void 0===i?void 0:i.id)!==n.track.id?(Ey.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)):t.data.sei&&n.onSei&&n.onSei(t.data.sei)},n.worker=t}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}!function(e){let t=QF.get(e);if(t){QF.delete(e);try{var n,r;null===(n=t.controller)||void 0===n||n.terminate(),null===(r=t.worker)||void 0===r||r.terminate()}catch(A){Ey.warning(A&&A.message)}}}(e)}QF.set(e,n),e.track.addEventListener("ended",r)}(A.receiver,{onSei:t=>{var n;null===(n=e._videoTrack)||void 0===n||n._onSei(t)}}):t==mR.AUDIO&&await async function(e){if(!oL().supportWebRTCEncodedTransform)return void Ey.warning("browser not support audio encoded transform");if(FF.has(e))return;let t={track:e.track};if(qS()){if(!e.createEncodedStreams)return void Ey.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(r){return void Ey.error("create audio-encoded-streams error",r&&r.message)}let o=new TransformStream({transform(r,i){t.controller||(t.controller=i),e.track&&e.track.id!==t.track.id&&(Ey.debug("audio track changed: ".concat(t.track.id," => ").concat(e.track.id)),t.track.removeEventListener("ended",n),t.track=e.track,t.track.addEventListener("ended",n)),i.enqueue(r)}});i.readable.pipeThrough(o).pipeTo(i.writable)}else if(ZS()){if(typeof RTCRtpScriptTransform>"u")return void Ey.warning("browser not support RTCRtpScriptTransform");let r=kF(),i=new MessageChannel;await new wu((e=>r.onmessage=t=>{"registered"===t.data&&e(void 0)}));let o=new RTCRtpScriptTransform(r,{name:"rx",port:i.port2},[i.port2]);e.transform=o,await new wu((e=>r.onmessage=t=>{"started"===t.data&&e(void 0)})),i.port1.onmessage=r=>{var i;r.data.transformed&&e.track&&(null===(i=e.track)||void 0===i?void 0:i.id)!==t.track.id&&(Ey.debug("audio track changed: ".concat(t.track.id," => ").concat(e.track.id)),t.track.removeEventListener("ended",n),t.track=e.track,t.track.addEventListener("ended",n))},t.worker=r}function n(){e.track.removeEventListener("ended",n),function(e){let t=FF.get(e);if(t){FF.delete(e);try{var n,r;null===(n=t.controller)||void 0===n||n.terminate(),null===(r=t.worker)||void 0===r||r.terminate()}catch(i){Ey.warning(i&&i.message)}}}(e)}FF.set(e,t),e.track.addEventListener("ended",n)}(A.receiver));let c=this.remoteUserMap.get(e);c?c.set(t,s):this.remoteUserMap.set(e,new Map([[t,s]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();let l=this.pendingRemoteTracks.findIndex((n=>{let{user:r,kind:i}=n;return r.uid===e.uid&&t===i}));-1!==l&&(this.pendingRemoteTracks.splice(l,1),this.emit(TR.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==SR.Connected)throw new vT(TT.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter((e=>{var t;let{user:n,mediaType:r}=e;return!(null!==(t=this.remoteUserMap.get(n))&&void 0!==t&&t.has(r))}));let t=await this.connection.batchReceive(e.map((e=>{let{user:t,mediaType:n,ssrcId:r,rtxSsrcId:i}=e;return{kind:n,ssrcMsg:[{ssrcId:r,rtx:i}],mslabel:String(t._uintid)}})));e.forEach(((e,n)=>{let{user:r,mediaType:i}=e,{track:o,id:a,transceiver:s}=t[n];i===mR.AUDIO?(r._audioTrack?r._audioTrack._updateOriginMediaStreamTrack(o):(r._audioTrack=new OF(o,r.uid,r._uintid,this.store),Ey.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(r._audioTrack.getTrackId()))),s&&r._audioTrack._updateRtpTransceiver(s),this.bindRemoteTrackEvents(r,r._audioTrack)):(r._videoTrack?r._videoTrack._updateOriginMediaStreamTrack(o):(r._videoTrack=new bF(o,r.uid,r._uintid,this.store),Ey.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(r._videoTrack.getTrackId()))),s&&r._videoTrack._updateRtpTransceiver(s),this.bindRemoteTrackEvents(r,r._videoTrack));let A=this.remoteUserMap.get(r);A?A.set(i,a):this.remoteUserMap.set(r,new Map([[i,a]])),this.statsCollector.addRemoteStats(r.uid),this.statsUploader.startUploadInboundStats();let c=this.pendingRemoteTracks.findIndex((e=>{let{user:t,kind:n}=e;return t.uid===r.uid&&i===n}));-1!==c&&(this.pendingRemoteTracks.splice(c,1),this.emit(TR.MediaReconnectEnd,r.uid))}))}async unsubscribe(e,t,n){let r=this.pendingRemoteTracks.filter((n=>{let{user:r,kind:i}=n;return void 0!==t?r.uid===e.uid&&t===i:r.uid===e.uid}));if(r.forEach((e=>{let t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)})),this.connection&&this.state===SR.Connected||n||r.forEach((t=>{let{kind:n}=t;var r;if(n===mR.AUDIO)null===(r=e._audioTrack)||void 0===r||r._destroy(),e._audioTrack=void 0;else if(n===mR.VIDEO){var i;null===(i=e._videoTrack)||void 0===i||i._destroy(),e._videoTrack=void 0}})),!this.connection||this.state!==SR.Connected)return;let i=this.filterTobeUnSubscribedTracks(e,t);if(0===i.length)return;await this.connection.stopReceiving(i.map((e=>{let[,{id:t}]=e;return t})));let o=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),0===this.remoteUserMap.size&&this.statsUploader.stopUploadInboundStats(),i.forEach((e=>{let[t,{kind:r}]=e;var i,o;if(r===mR.VIDEO&&t._videoSSRC&&(null===(i=this.connection)||void 0===i||i.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),r===mR.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),n||(null===(o=t._videoTrack)||void 0===o||o._destroy(),t._videoTrack=void 0);else if(r===mR.AUDIO){var a;this.unbindRemoteTrackEvents(t._audioTrack),!n&&(null===(a=t._audioTrack)||void 0===a||a._destroy(),t._audioTrack=void 0)}})),o}async unsubscribeDataChannel(e,t){if(t.forEach((e=>{let t=this.pendingRemoteDataChannels.findIndex((t=>t.id===e.id));-1!==t&&this.pendingRemoteDataChannels.splice(t,1)})),!this.connection)return;let n=this.filterTobeUnSubscribedDataChannels(e,t);if(0===n.length)return;t.forEach((e=>{e._close()}));let r=this.remoteDataChannelMap.get(e);return n.forEach((e=>{r&&r.delete(e.id)})),r&&0===r.size&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map((e=>e.id))}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(let{user:i,mediaType:o}of e){let e=this.pendingRemoteTracks.filter((e=>{let{user:t,kind:n}=e;return void 0!==o?t.uid===i.uid&&o===n:t.uid===i.uid}));e.forEach((e=>{let t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)})),t=t.concat(e)}if(!this.connection||this.state!==SR.Connected)return void t.forEach((e=>{let{user:t,kind:n}=e;var r;if(n===mR.AUDIO)null===(r=t._audioTrack)||void 0===r||r._destroy(),t._audioTrack=void 0;else if(n===mR.VIDEO){var i;null===(i=t._videoTrack)||void 0===i||i._destroy(),t._videoTrack=void 0}}));let n=Hr(e).call(e,((e,t)=>{let{user:n,mediaType:r}=t,i=this.filterTobeUnSubscribedTracks(n,r);return e.concat(i)}),[]);if(0===n.length)return;await this.connection.stopReceiving(n.map((e=>{let[,{id:t}]=e;return t})));let r=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),0===this.remoteUserMap.size&&this.statsUploader.stopUploadInboundStats(),n.forEach((e=>{let[t,{kind:n}]=e;var r,i;if(n===mR.VIDEO&&t._videoSSRC&&(null===(r=this.connection)||void 0===r||r.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),n===mR.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),null===(i=t._videoTrack)||void 0===i||i._destroy(),t._videoTrack=void 0;else if(n===mR.AUDIO){var o;this.unbindRemoteTrackEvents(t._audioTrack),null===(o=t._audioTrack)||void 0===o||o._destroy(),t._audioTrack=void 0}})),r}async muteRemote(e,t){if(!this.connection)return;let n=this.remoteUserMap.get(e);if(!n)return void Ey.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void Ey.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let r=t===mR.VIDEO?e._videoSSRC:e._audioSSRC;void 0!==r&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;let n=this.remoteUserMap.get(e);n?n.get(t)||Ey.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,".")):Ey.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."))}getAllTracks(e){let t=this.localTrackMap.get(wR.LocalAudioTrack);if((null===t||void 0===t?void 0:t.track)instanceof yM){let n=t.track;return Array.from(this.localTrackMap.entries()).filter((e=>{let[t]=e;return t!==wR.LocalAudioTrack})).filter((t=>{let[n]=t;return!(e&&n===wR.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t})).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter((t=>{let[n]=t;return!(e&&n===wR.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t}))}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,r,i){if(e){let n=this.localTrackMap.get(wR.LocalAudioTrack),o=r?this.localTrackMap.get(wR.LocalVideoLowTrack):this.localTrackMap.get(wR.LocalVideoTrack);vy.publish(this.store.sessionId,{eventElapse:KF.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null===n||void 0===n?void 0:n.track.getTrackLabel(),videoName:null===o||void 0===o?void 0:o.track.getTrackLabel(),screenshare:-1!==(null===o||void 0===o?void 0:o.track._hints.indexOf(vL.SCREEN_TRACK)),audio:!!n,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var o;n||(n=[]);let a=n.find((e=>e instanceof SM)),s=r?null===(o=this.localTrackMap.get(wR.LocalVideoTrack))||void 0===o?void 0:o.track:n.find((e=>e instanceof uF));vy.publish(this.store.sessionId,{eventElapse:KF.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null===a||void 0===a?void 0:a.getTrackLabel(),videoName:null===s||void 0===s?void 0:s.getTrackLabel(),screenshare:-1!==(null===s||void 0===s?void 0:s._hints.indexOf(vL.SCREEN_TRACK)),audio:!!a,video:!!s,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){let i=r===mR.VIDEO?n._videoSSRC:n._audioSSRC;i&&vy.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===mR.VIDEO,audio:r===mR.AUDIO,peerid:n.uid,subscribeRequestid:r===mR.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:KF.measureFromSubscribeStart(this.store.clientId,i)})}reset(){Ey.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Uv("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new JV({},this.store):this.isPlanB?new dV({},this.store):new NV({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(wR.LocalAudioTrack);if((null===e||void 0===e?void 0:e.track)instanceof yM){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach((e=>{t.removeAudioTrack(e)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=SR.Disconnected}getStats(){var e;return null===(e=this.connection)||void 0===e?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return(null===(t=this.connection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(wR.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(wR.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof uF||t&&t.track instanceof SM?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;let n=Array.from(Qh(t=this.remoteUserMap).call(t)).find((t=>t.uid===e));return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map((e=>{let[t]=e;return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}})),t=this.localTrackMap.get(wR.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Lp(e).call(e,((e,t)=>e.level-t.level)),e}async disconnectForReconnect(){this.connection&&(Ey.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=SR.Reconnecting,$v("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&(null===(n=t._videoTrack._player.getVideoElement())||void 0===n||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())})),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new JV({},this.store):this.isPlanB?new dV({},this.store):new NV({},this.store),this.bindConnectionEvents(this.connection)),0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach((e=>{var t;let[n,{track:r}]=e;switch(n){case wR.LocalVideoTrack:yr(t=r._hints).call(t,vL.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case wR.LocalAudioTrack:r instanceof yM?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case wR.LocalVideoLowTrack:}})),this.emit(TR.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;Array.from(Qh(n).call(n)).forEach((e=>{this.setPendingRemoteMedia(t,e)})),this.emit(TR.MediaReconnectStart,t.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),0!==this.localDataChannels.length&&(this.localDataChannels.forEach((e=>{this.pendingLocalDataChannels.push(e)})),this.localDataChannels.length=0),0!==this.remoteDataChannelMap.size&&(Array.from(this.remoteDataChannelMap.entries()).forEach((e=>{let[t,n]=e;Array.from(Qh(n).call(n)).forEach((e=>{this.setPendingRemoteDataChannel(t,e)}))})),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),Ey.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(let n of this.pendingRemoteDataChannels){let{user:r,id:i}=n;if((e instanceof vQ?e.uid:e)===r.uid&&i===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(let n of this.pendingRemoteTracks){let{user:r,kind:i}=n;if((e instanceof vQ?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return ex((function*(){if(!t.connection||t.state!==SR.Connected||t.connection instanceof JV)return;let n,r=yield GF(t.mutex.lock("From P2PChannel.restartICE"));try{n=yield GF(t.connection.restartICE(e));let r=yield GF(n.next());if(r.done)return;let i=r.value,o=yield i;switch(t.reportPCDisconnectedOrFailed(e),e){case _R.TCP:t._pcStatsUploadType=CR.TCP_RESTART;break;case _R.RELAY:t._pcStatsUploadType=CR.RELAY_RESTART;break;default:t._pcStatsUploadType=CR.OLD_RESTART}t._isInRestartIce=!0,n.next(o)}catch(o){var i;null===(i=n)||void 0===i||i.throw(o)}finally{r()}}))()}getUplinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=this.localTrackMap.get(wR.LocalVideoTrack),n=this.localTrackMap.get(wR.LocalAudioTrack),r=e.videoSend.find((e=>e.ssrc===(null===t||void 0===t?void 0:t.ssrcs[0].ssrcId))),i=e.audioSend.find((e=>e.ssrc===(null===n||void 0===n?void 0:n.ssrcs[0].ssrcId)));if(!r||!i)return 1;let o=iv(this,TR.NeedSignalRTT),a=r?r.rttMs:void 0,s=i?i.rttMs:void 0,A=a&&s?(a+s)/2:a||s,c=(A&&o?(A+o)/2:A||o)||0,l=100*e.sendPacketLossRate*.7/50+.3*c/1500,d=l<.17?1:l<.36?2:l<.59?3:l<.1?4:5,u=null===t||void 0===t?void 0:t.track;if(u&&u._encoderConfig&&-1===u._hints.indexOf(vL.SCREEN_TRACK)){let t=u._encoderConfig.bitrateMax,n=e.bitrate.actualEncoded;if(t&&n){let e=(1e3*t-n)/(1e3*t);return Ry[e<.15?0:e<.3?1:e<.45?2:e<.6?3:4][d]}}return d}getDownlinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach((n=>{let[r]=n,i=r._audioSSRC,o=r._videoSSRC,a=e.audioRecv.find((e=>e.ssrc===i)),s=e.videoRecv.find((e=>e.ssrc===o));if(!a&&!s)return void(t+=1);let A=iv(this,TR.NeedSignalRTT),c=e.rtt,l=(c&&A?(c+A)/2:c||A)||0,d=a?a.jitterMs:void 0,u=e.recvPacketLossRate,h=.7*u*100/50+.3*l/1500;d&&(h=.6*u*100/50+.2*l/1500+.2*d/400),t+=h<.1?1:h<.17?2:h<.36?3:h<.59?4:5})),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new wu(((t,n)=>{this.handleMuteLocalTrack(e,t,n)}))}async replaceTrack(e,t){var n;if(Ey.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==SR.Connected)return;let r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(!r)return;let i=r[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:i}]),this.bindLocalTrackEvents([{track:t,type:i}]),r[1].track=t),await(null===(n=this.connection)||void 0===n?void 0:n.replaceTrack(t,r[1].id)),this.isPlanB){let e=r[1];e.id=t._mediaStreamTrack.id,this.localTrackMap.set(i,e)}if(i===wR.LocalVideoTrack&&!$v("DISABLE_DUAL_STREAM_USE_ENCODING")&&oL().supportDualStreamEncoding){let t=this.localTrackMap.get(wR.LocalVideoLowTrack);if(t){let n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new wu(((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)}))}}}filterTobePublishedTracks(e,t,n){let r=[],i=this.getAllTracks();e=Av(e=e.filter((e=>-1===i.indexOf(e))));let o,a=!1,s=this.localTrackMap.get(wR.LocalAudioTrack);for(let A of e){if(A instanceof uF&&(this.localTrackMap.has(wR.LocalVideoTrack)||a?new vT(TT.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:A,type:wR.LocalVideoTrack}),a=!0),t)){let e=this.getLowVideoTrack(A,n);r.push({track:e,type:wR.LocalVideoLowTrack})}if(A instanceof SM)if(s){let e=s.track;if(e instanceof yM)RQ([A]),e.addAudioTrack(A),this.bindLocalAudioTrackEvents(A,!0);else{let t=bQ([e,A]);Ey.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(t.getTrackId(),"]")),this.replaceTrack(e,t)}}else o instanceof yM?(RQ([A]),o.addAudioTrack(A)):o=o||!A._useAudioElement&&oL().webAudioMediaStreamDest&&!A._bypassWebAudio?bQ(o?[A,o]:[A]):A}return o&&(Ey.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(o.getTrackId(),"]")),r.push({track:o,type:wR.LocalAudioTrack})),r}filterTobeUnpublishedTracks(e){let t=[],n=this.getAllTracks();e=Av(e=e.filter((e=>-1!==n.indexOf(e))));for(let r of e){if(r instanceof SM){let e=this.localTrackMap.get(wR.LocalAudioTrack);if(!e)continue;e.track instanceof yM?(e.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),0===e.track.trackList.length&&(t.push([wR.LocalAudioTrack,e]),e.track.close())):t.push([wR.LocalAudioTrack,e])}if(r instanceof uF){let e=this.localTrackMap.get(wR.LocalVideoTrack);if(!e)continue;t.push([wR.LocalVideoTrack,e]);let n=this.localTrackMap.get(wR.LocalVideoLowTrack);n&&t.push([wR.LocalVideoLowTrack,n])}}return t}filterTobePublishedDataChannels(e){return(e=Av(e)).filter((e=>-1===this.localDataChannels.findIndex((t=>t.id===e.id))))}filterTobeUnpublishedDataChannels(e){return(e=(e=Av(e)).filter((e=>-1!==this.localDataChannels.indexOf(e)))).filter((e=>e._originDataChannel))}bindLocalTrackEvents(e){e.forEach((e=>{let{track:t,type:n}=e;switch(n){case wR.LocalVideoTrack:t.addListener(TL.GET_STATS,this.handleGetLocalVideoStats),t.addListener(TL.GET_RTC_STATS,this.handleGetRTCStats),t.addListener(TL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(TL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(TL.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(TL.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.addListener(TL.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(TL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(TL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case wR.LocalAudioTrack:this.bindLocalAudioTrackEvents(t);case wR.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(e,t){e instanceof yM?e.trackList.forEach((e=>{e.addListener(TL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(TL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(TL.GET_STATS,this.handleGetLocalAudioStats),e.addListener(TL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(TL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.addListener(TL.GET_STATS,this.handleGetLocalAudioStats),e.addListener(TL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(TL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(TL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(TL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(TL.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(TL.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map((e=>{let[t,{track:n}]=e;return{track:n,type:t}}))),e.forEach((e=>{let{track:t,type:n}=e;switch(n){case wR.LocalVideoTrack:t.off(TL.GET_STATS,this.handleGetLocalVideoStats),t.off(TL.GET_RTC_STATS,this.handleGetRTCStats),t.off(TL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(TL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(TL.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(TL.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.off(TL.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(TL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(TL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case wR.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t);case wR.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(e){e instanceof yM?e.trackList.forEach((e=>{e.off(TL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(TL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(TL.GET_STATS,this.handleGetLocalAudioStats),e.off(TL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(TL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.off(TL.GET_STATS,this.handleGetLocalAudioStats),e.off(TL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(TL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(TL.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(TL.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(TL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(TL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof bF&&t.addListener(TL.GET_STATS,(t=>{t(this.handleGetRemoteVideoStats(e))})),t instanceof OF&&t.addListener(TL.GET_STATS,(t=>{t(this.handleGetRemoteAudioStats(e))}))}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(TL.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;n.has(mR.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(mR.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)}))}createGatewayPublishMessage(e,t){return e.map(((e,n)=>{var r;let i,o,{track:a,type:s}=e;switch(s){case wR.LocalAudioTrack:i=aR.Audio,o={dtx:a instanceof TM&&a._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case wR.LocalVideoTrack:i=yr(r=a._hints).call(r,vL.SCREEN_TRACK)?aR.Screen:aR.High,o=ZV(ZV({},Ab(a)),{},{codec:this.store.codec});break;case wR.LocalVideoLowTrack:i=aR.Low,o=ZV(ZV({},Ab(a)),{},{codec:this.store.codec})}return{stream_type:i,attributes:o,ssrcs:t[n]}}))}createGatewayUnpublishMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:o,id:a}]=e;switch(r){case wR.LocalVideoTrack:n=yr(t=i._hints).call(t,vL.SCREEN_TRACK)?aR.Screen:aR.High;break;case wR.LocalAudioTrack:n=aR.Audio;break;case wR.LocalVideoLowTrack:n=aR.Low}return{stream_type:n,ssrcs:o,mid:a}}))}assignLocalTracks(e,t){e.forEach(((e,n)=>{let{track:r,type:i}=e;this.localTrackMap.set(i,{track:r,id:t[n].id,ssrcs:t[n].localSSRC})}))}withdrawLocalTracks(e){e.forEach((e=>{let[t]=e;this.localTrackMap.delete(t)}))}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(Ey.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(TR.PeerConnectionStateChange,t),"connected"!==t||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),"connected"===t&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),$v("NEW_ICE_RESTART")){var n;if(yr(n=this._restartStates).call(n,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;let t=t=>{("disconnected"===e.iceConnectionState||"checking"===e.iceConnectionState||"failed"===e.iceConnectionState)&&(Ey.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(t)),"CONNECTED"===iv(this,TR.QueryClientConnectionState)&&this.emit(TR.RequestRestartICE,t))},n=()=>{"disconnected"!==e.iceConnectionState&&"checking"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),Ey.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout((()=>this.emit(TR.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())},r=$v("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout((()=>{if($v("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&oL().supportPCSetConfiguration)t(_R.RELAY),this._restartTimer=window.setTimeout(n,r);else if(eT())t(_R.UDP),this._restartTimer=window.setTimeout(n,4e3);else{if(t(_R.TCP),oL().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout((()=>{t(_R.RELAY),this._restartTimer=window.setTimeout(n,r)}),r));this._restartTimer=window.setTimeout(n,r)}}),800))}}else{if("disconnected"===t&&"disconnected"===e.iceConnectionState)return setTimeout((()=>{"disconnected"===e.iceConnectionState&&$v("ICE_RESTART")&&"CONNECTED"===iv(this,TR.QueryClientConnectionState)&&this.emit(TR.RequestRestartICE)}),800),void setTimeout((()=>{"disconnected"===e.peerConnectionState&&(Ey.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout((()=>this.emit(TR.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())}),4e3);"failed"===t&&(Ey.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout((()=>this.emit(TR.P2PLost)),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=e=>{"connected"!==e||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),Ey.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),vy.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:GT.TRACER}).onSuccess(),this.emit(TR.IceConnectionStateChange,e)},e.onICETransportStateChange=e=>{Ey.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=e=>{Ey.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=e=>{Ey.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=e=>{var t;let n=Array.from(Qh(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));var r;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),null===(r=n.audioTrack)||void 0===r||r.emit(BL.FIRST_FRAME_DECODED),vy.firstRemoteFrame(this.store.sessionId,Cy.FIRST_AUDIO_DECODE,wy.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:KF.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=e=>{var t;let n=Array.from(Qh(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));n&&vy.firstRemoteFrame(this.store.sessionId,Cy.FIRST_AUDIO_RECEIVED,wy.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:KF.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(e,t,n)=>{this.reportVideoFirstFrameDecoded(e,t,n)},e.onFirstVideoReceived=e=>{var t;let n=Array.from(Qh(t=this.remoteUserMap).call(t)).find((t=>t._videoSSRC===e));n&&vy.firstRemoteFrame(this.store.sessionId,Cy.FIRST_VIDEO_RECEIVED,wy.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:KF.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(e,t)=>{let n="relay"===e.candidateType,r="relay"===t.candidateType;"unknown"!==t.candidateType&&n===r||this.emit(TR.ConnectionTypeChange,n),Ey.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(hb(t))," -> ").concat(JSON.stringify(hb(e)),")"))},e.onSelectedRemoteCandidateChanged=(e,t)=>{Ey.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(hb(t))," -> ").concat(JSON.stringify(hb(e)),")"))},e.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},e.getLocalVideoStats=()=>{let e=this.statsCollector.getLocalVideoTrackStats(),t=this.statsCollector.getRTCStats();return ZV(ZV({},e),t)}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}filterTobeMutedTracks(e){let t=[];if(-1===this.getAllTracks().indexOf(e))return t;let n=this.localTrackMap.get(wR.LocalAudioTrack);if(e instanceof SM&&(null===n||void 0===n?void 0:n.track)instanceof yM)return n.track.isActive||t.push([wR.LocalAudioTrack,n]),t;let r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r&&(t.push(r),r[0]===wR.LocalVideoTrack)){let e=this.localTrackMap.get(wR.LocalVideoLowTrack);e&&t.push([wR.LocalVideoLowTrack,e])}return t}filterTobeUnmutedTracks(e){let t=[],n=this.localTrackMap.get(wR.LocalAudioTrack);if(e instanceof SM&&(null===n||void 0===n?void 0:n.track)instanceof yM)return n.track.isActive&&t.push([wR.LocalAudioTrack,n]),t;let r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r)if(r[0]===wR.LocalVideoTrack){t.push(r);let e=this.localTrackMap.get(wR.LocalVideoLowTrack);e&&t.push([wR.LocalVideoLowTrack,e])}else t.push(r);return t}createMuteMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:o,id:a}]=e;switch(r){case wR.LocalAudioTrack:n=aR.Audio;break;case wR.LocalVideoTrack:n=yr(t=i._hints).call(t,vL.SCREEN_TRACK)?aR.Screen:aR.High;break;case wR.LocalVideoLowTrack:n=aR.Low}return{stream_type:n,ssrcs:o,mid:a}}))}createUnmuteMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:o,id:a}]=e;switch(r){case wR.LocalAudioTrack:n=aR.Audio;break;case wR.LocalVideoTrack:n=yr(t=i._hints).call(t,vL.SCREEN_TRACK)?aR.Screen:aR.High;break;case wR.LocalVideoLowTrack:n=aR.Low}return{stream_type:n,ssrcs:o,mid:a}}))}filterTobeUnSubscribedTracks(e,t){let n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){let i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach((t=>{let[r,i]=t;n.push([e,{kind:r,id:i}])}));return n}filterTobeUnSubscribedDataChannels(e,t){let n=[];return t.forEach((t=>{var r;null!==(r=this.remoteDataChannelMap.get(e))&&void 0!==r&&r.has(t.id)&&n.push(t)})),n}createUnsubscribeMessage(e){let t=[];return e.forEach((e=>{let[n,{kind:r,id:i}]=e;switch(r){case mR.VIDEO:return void(n._videoSSRC&&t.push({stream_type:mR.VIDEO,ssrcId:n._videoSSRC}));case mR.AUDIO:return void(n._audioSSRC&&t.push({stream_type:mR.AUDIO,ssrcId:n._audioSSRC}))}})),t}createUnsubscribeAllMessage(e){let t=new Map;return e.forEach((e=>{let[n,{kind:r}]=e;if(t.has(n)){let e=t.get(n);r===mR.VIDEO?e|=cR.Video:e|=cR.Audio,t.set(n,e)}else r===mR.VIDEO?t.set(n,cR.Video):t.set(n,cR.Audio)})),{users:Array.from(t.entries()).map((e=>{let[t,n]=e;return{stream_id:t.uid,stream_type:n}}))}}withdrawRemoteTracks(e){e.forEach((e=>{let[t,{kind:n}]=e,r=this.remoteUserMap.get(t);r&&(r.delete(n),0===Array.from(r.entries()).length&&this.remoteUserMap.delete(t))}))}async updateBitrateLimit(e){let t=this.localTrackMap.get(wR.LocalVideoTrack),n=this.localTrackMap.get(wR.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),n&&e.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return!this.connection||"connected"!==this.connection.peerConnectionState}mapPubResToRemoteConfig(e,t){return e.map(((e,n)=>{var r;let{stream_type:i}=e;return null===(r=t.find((e=>{let{stream_type:t}=e;return i===t})))||void 0===r?void 0:r.attributes}))}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof SM){var t;let r=this.filterTobeUnmutedTracks(e[n]);if(0===r.length)continue;await(null===(t=this.connection)||void 0===t?void 0:t.unmuteLocal(r.map((e=>{let[,{id:t}]=e;return t}))));let i=this.createUnmuteMessage(r);return void await rv(this,TR.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!(null===(t=this.connection)||void 0===t||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(TR.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(TR.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await wv(Mv(this.dtlsFailedCount,kv)),this.emit(TR.RequestReconnect)}async reconnectP2P(){let e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await nv(this,TR.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(TR.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(wR.LocalVideoTrack)||this.pendingLocalTracks.some((e=>e instanceof uF))}throwIfTrackTypeNotMatch(e){if(e.filter((e=>e instanceof uF)).length>1)throw new vT(TT.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((e=>e instanceof SM)).length>1&&(e.some((e=>e instanceof SM&&e._bypassWebAudio))||!oL().webAudioMediaStreamDest))throw new vT(TT.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof uF&&this.pendingLocalTracks.some((e=>e instanceof uF)))throw new vT(TT.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof SM&&this.pendingLocalTracks.some((e=>e instanceof SM))&&(!oL().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some((e=>e instanceof SM&&e._bypassWebAudio))))throw new vT(TT.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){let n,r=!$v("DISABLE_DUAL_STREAM_USE_ENCODING")&&oL().supportDualStreamEncoding,i=ZV(ZV({},{width:160,height:120,framerate:15,bitrate:50}),t);n=r?e._mediaStreamTrack.clone():AQ(e,i);let o=Sv(8,"track-low-"),a=new uF(n,ZV(ZV({},r&&{scaleResolutionDownBy:ub(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,o);return a.on(bL.TRANSCEIVER_UPDATED,(t=>{e._updateRtpTransceiver(t,yL.LOW_STREAM)})),a._hints.push(vL.LOW_STREAM),e.on("sei-to-send",(e=>{a.emit("sei-to-send",e)})),e.addListener(TL.NEED_CLOSE,(()=>{a.close()})),a}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this.connection&&this.connection instanceof NV){var i,o,a,s;let A=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:c,dtlsTransportState:l,peerConnectionState:d}=this.connection,{local:u,remote:h}=await this.connection.getSelectedCandidatePair();vy.pcStats(this.store.sessionId,{startTime:A,eventElapse:e-A||0,iceconnectionsate:c,dtlsstate:l,connectionstate:d,intSucc:t?1:2,error:r,selectedLocalCandidateProtocol:null!==(i=null===u||void 0===u?void 0:u.protocol)&&void 0!==i?i:"",selectedLocalCandidateType:null!==(o=u.candidateType)&&void 0!==o?o:"",selectedLocalCandidateAddress:"".concat(u.address,":").concat(u.port),selectedRemoteCandidateProtocol:null!==(a=h.protocol)&&void 0!==a?a:"",selectedRemoteCandidateType:null!==(s=h.candidateType)&&void 0!==s?s:"",selectedRemoteCandidateAddress:"".concat(h.address,":").concat(h.port),restartCnt:n})}}reportVideoFirstFrameDecoded(e,t,n,r){var i;let o=Array.from(Qh(i=this.remoteUserMap).call(i)).find((t=>t._videoSSRC===e));if(o){r||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());let i=this.store.keyMetrics,a=i.subscribe.find((e=>e.userId===o.uid&&"video"===e.type));vy.firstRemoteVideoDecode(this.store.sessionId,Cy.FIRST_VIDEO_DECODE,wy.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:t,videoheight:n,subscribeElapse:KF.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:i.requestAPEnd||0,apStart:i.requestAPStart||0,joinGwEnd:i.joinGatewayEnd||0,joinGwStart:i.joinGatewayStart||0,pcEnd:i.peerConnectionEnd||0,pcStart:i.peerConnectionStart||0,subscriberEnd:(null===a||void 0===a?void 0:a.subscribeEnd)||0,subscriberStart:(null===a||void 0===a?void 0:a.subscribeStart)||0,videoAddNotify:(null===a||void 0===a?void 0:a.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;let r=this.remoteUserMap.get(e);if(!r)return!1;let i=r.get(t);if(!i)return!1;let o=await this.connection.getRemoteSSRC(i);return void 0!==o&&o!==n}resetConnection(e){Ey.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(e)),this.state===SR.Connected?(Ey.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=e===lR.datachannel?new JV({},this.store):this.isPlanB?new dV({},this.store):new NV({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach((e=>{let[t,{track:n}]=e;t===wR.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,yL.LOW_STREAM):n._updateRtpTransceiver(void 0)}))}reportPCDisconnectedOrFailed(e){this.connection&&this.connection instanceof NV&&("disconnected"!==this.connection.iceConnectionState&&"checking"!==this.connection.iceConnectionState&&"failed"!==this.connection.iceConnectionState||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===CR.TCP_RESTART&&e===_R.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,CR.DISCONNECTED_OR_FAILED)))}},_I(zV.prototype,"startP2PConnection",[nH],Object.getOwnPropertyDescriptor(zV.prototype,"startP2PConnection"),zV.prototype),_I(zV.prototype,"connect",[nH],Object.getOwnPropertyDescriptor(zV.prototype,"connect"),zV.prototype),_I(zV.prototype,"updateRemoteRTPCapabilities",[nH],Object.getOwnPropertyDescriptor(zV.prototype,"updateRemoteRTPCapabilities"),zV.prototype),_I(zV.prototype,"preConnect",[nH],Object.getOwnPropertyDescriptor(zV.prototype,"preConnect"),zV.prototype),_I(zV.prototype,"publishDataChannel",[nH],Object.getOwnPropertyDescriptor(zV.prototype,"publishDataChannel"),zV.prototype),_I(zV.prototype,"unpublish",[nH],Object.getOwnPropertyDescriptor(zV.prototype,"unpublish"),zV.prototype),_I(zV.prototype,"unpublishDataChannel",[nH],Object.getOwnPropertyDescriptor(zV.prototype,"unpublishDataChannel"),zV.prototype),_I(zV.prototype,"unpublishLowStream",[nH],Object.getOwnPropertyDescriptor(zV.prototype,"unpublishLowStream"),zV.prototype),_I(zV.prototype,"subscribeDataChannel",[nH],Object.getOwnPropertyDescriptor(zV.prototype,"subscribeDataChannel"),zV.prototype),_I(zV.prototype,"subscribe",[nH],Object.getOwnPropertyDescriptor(zV.prototype,"subscribe"),zV.prototype),_I(zV.prototype,"massSubscribe",[nH],Object.getOwnPropertyDescriptor(zV.prototype,"massSubscribe"),zV.prototype),_I(zV.prototype,"unsubscribe",[nH],Object.getOwnPropertyDescriptor(zV.prototype,"unsubscribe"),zV.prototype),_I(zV.prototype,"unsubscribeDataChannel",[nH],Object.getOwnPropertyDescriptor(zV.prototype,"unsubscribeDataChannel"),zV.prototype),_I(zV.prototype,"massUnsubscribe",[nH],Object.getOwnPropertyDescriptor(zV.prototype,"massUnsubscribe"),zV.prototype),_I(zV.prototype,"muteRemote",[nH],Object.getOwnPropertyDescriptor(zV.prototype,"muteRemote"),zV.prototype),_I(zV.prototype,"unmuteRemote",[nH],Object.getOwnPropertyDescriptor(zV.prototype,"unmuteRemote"),zV.prototype),_I(zV.prototype,"hasRemoteMediaWithLock",[nH],Object.getOwnPropertyDescriptor(zV.prototype,"hasRemoteMediaWithLock"),zV.prototype),_I(zV.prototype,"disconnectForReconnect",[nH],Object.getOwnPropertyDescriptor(zV.prototype,"disconnectForReconnect"),zV.prototype),_I(zV.prototype,"updateBitrateLimit",[nH],Object.getOwnPropertyDescriptor(zV.prototype,"updateBitrateLimit"),zV.prototype),_I(zV.prototype,"remoteMediaSsrcChanged",[nH],Object.getOwnPropertyDescriptor(zV.prototype,"remoteMediaSsrcChanged"),zV.prototype),zV);function nH(e,t,n){let r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){let e=this.mutex,n=await e.lock("From P2PChannel.".concat(t));try{for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return await r.apply(this,o)}finally{n()}},n}function rH(e){let t={};e:for(;!fH(e);){let n=yH(e);switch(n>>>3){case 0:break e;case 1:t.requestId=mH(e,yH(e));break;case 2:t.requestType=yH(e)>>>0;break;case 3:t.scorePorn=TH(e);break;case 4:t.scoreSexy=TH(e);break;case 5:t.scoreNeutral=TH(e);break;case 6:t.requestScene=yH(e)>>>0;break;case 7:t.scene=yH(e)>>>0;break;default:aH(e,7&n)}}return t}function iH(e,t){let n=e.service;void 0!==n&&(IH(t,8),IH(t,n));let r=e.vendor;void 0!==r&&(IH(t,16),IH(t,r));let i=e.token;void 0!==i&&(IH(t,26),_H(t,i));let o=e.callbackUrl;void 0!==o&&(IH(t,34),_H(t,o))}function oH(e){let t=yH(e),n=e.limit;return e.limit=e.offset+t,n}function aH(e,t){switch(t){case 0:for(;128&wH(e););break;case 2:pH(e,yH(e));break;case 5:pH(e,4);break;case 1:pH(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let sH=new Float32Array(1);new Uint8Array(sH.buffer);let AH=new Float64Array(1),cH=new Uint8Array(AH.buffer);function lH(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let dH=[];function uH(){let e=dH.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function hH(e){dH.push(e)}function pH(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function fH(e){return e.offset>=e.limit}function EH(e,t){let n=e.bytes,r=e.offset,i=e.limit,o=r+t;if(o>n.length){let t=new Uint8Array(2*o);t.set(n),e.bytes=t}return e.offset=o,o>i&&(e.limit=o),r}function gH(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function mH(e,t){let n=gH(e,t),r=String.fromCharCode,i=e.bytes,o="\ufffd",a="";for(let s=0;s<t;s++){let e,A,c,l,d=i[s+n];128&d?192==(224&d)?s+1>=t?a+=o:(e=i[s+n+1],128!=(192&e)?a+=o:(l=(31&d)<<6|63&e,l<128?a+=o:(a+=r(l),s++))):224==(240&d)?s+2>=t?a+=o:(e=i[s+n+1],A=i[s+n+2],32896!=(49344&(e|A<<8))?a+=o:(l=(15&d)<<12|(63&e)<<6|63&A,l<2048||l>=55296&&l<=57343?a+=o:(a+=r(l),s+=2))):240==(248&d)?s+3>=t?a+=o:(e=i[s+n+1],A=i[s+n+2],c=i[s+n+3],8421504!=(12632256&(e|A<<8|c<<16))?a+=o:(l=(7&d)<<18|(63&e)<<12|(63&A)<<6|63&c,l<65536||l>1114111?a+=o:(l-=65536,a+=r(55296+(l>>10),56320+(1023&l)),s+=3))):a+=o:a+=r(d)}return a}function _H(e,t){let n=t.length,r=0;for(let a=0;a<n;a++){let e=t.charCodeAt(a);e>=55296&&e<=56319&&a+1<n&&(e=(e<<10)+t.charCodeAt(++a)-56613888),r+=e<128?1:e<2048?2:e<65536?3:4}IH(e,r);let i=EH(e,r),o=e.bytes;for(let a=0;a<n;a++){let e=t.charCodeAt(a);e>=55296&&e<=56319&&a+1<n&&(e=(e<<10)+t.charCodeAt(++a)-56613888),e<128?o[i++]=e:(e<2048?o[i++]=e>>6&31|192:(e<65536?o[i++]=e>>12&15|224:(o[i++]=e>>18&7|240,o[i++]=e>>12&63|128),o[i++]=e>>6&63|128),o[i++]=63&e|128)}}function CH(e,t){let n=EH(e,t.limit),r=e.bytes,i=t.bytes;for(let o=0,a=t.limit;o<a;o++)r[o+n]=i[o]}function wH(e){return e.bytes[gH(e,1)]}function SH(e,t){let n=EH(e,1);e.bytes[n]=t}function TH(e){let t=gH(e,8),n=e.bytes;return cH[0]=n[t++],cH[1]=n[t++],cH[2]=n[t++],cH[3]=n[t++],cH[4]=n[t++],cH[5]=n[t++],cH[6]=n[t++],cH[7]=n[t++],AH[0]}function vH(e,t){let n=EH(e,8),r=e.bytes;AH[0]=t,r[n++]=cH[0],r[n++]=cH[1],r[n++]=cH[2],r[n++]=cH[3],r[n++]=cH[4],r[n++]=cH[5],r[n++]=cH[6],r[n++]=cH[7]}function yH(e){let t,n=0,r=0;do{t=wH(e),n<32&&(r|=(127&t)<<n),n+=7}while(128&t);return r}function IH(e,t){for(t>>>=0;t>=128;)SH(e,127&t|128),t>>>=7;SH(e,t)}function RH(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,o=0===i?0===r?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,a=EH(e,o),s=e.bytes;switch(o){case 10:s[a+9]=i>>>7&1;case 9:s[a+8]=9!==o?128|i:127&i;case 8:s[a+7]=8!==o?r>>>21|128:r>>>21&127;case 7:s[a+6]=7!==o?r>>>14|128:r>>>14&127;case 6:s[a+5]=6!==o?r>>>7|128:r>>>7&127;case 5:s[a+4]=5!==o?128|r:127&r;case 4:s[a+3]=4!==o?n>>>21|128:n>>>21&127;case 3:s[a+2]=3!==o?n>>>14|128:n>>>14&127;case 2:s[a+1]=2!==o?n>>>7|128:n>>>7&127;case 1:s[a]=1!==o?128|n:127&n}}function bH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}let OH=new Map([["moderation",1],["supervise",2]]);class BH extends VT{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;let t=this._connectionState;this._connectionState=e,this.emit(IR.CONNECTION_STATE_CHANGE,t,e)}get inspectType(){return this._inspectType}set inspectType(e){var t;this._inspectMode=Hr(t=e.map((e=>OH.get(e)||0))).call(t,((e,t)=>e+t)),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this.qualityRatio}),6e4))}constructor(e){super(),O_(this,"name","AgoraRTCVideoContentInspect"),O_(this,"_connectionState",vR.CONNECTING),O_(this,"_innerConnectionState",void 0),O_(this,"sequence",0),O_(this,"inspectStartTime",void 0),O_(this,"workerManagerConnection",void 0),O_(this,"workerConnection",void 0),O_(this,"workerMessageLengthLimit",void 0),O_(this,"inspectIntervalMinimum",void 0),O_(this,"qualityRatio",void 0),O_(this,"_connectInfo",void 0),O_(this,"_cancelTokenSource",LS.CancelToken.source()),O_(this,"_retryConfig",void 0),O_(this,"wmSequence",0),O_(this,"inspectInterval",void 0),O_(this,"inspectTimer",null),O_(this,"ossFilePrefix",void 0),O_(this,"extraInfo",void 0),O_(this,"_inspectType",void 0),O_(this,"_inspectMode",void 0),O_(this,"_quality",1),O_(this,"qualityTimer",null),O_(this,"_inspectId",void 0),O_(this,"_needWorkUrlOnly",!1),O_(this,"inspectImage",(()=>{if(this.connectionState!==vR.CONNECTED)throw new HI(TT.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval((()=>{this.connectionState===vR.CONNECTED?this.requestToInspectImage():Ey.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)}),this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()})),this._inspectId=Sv(5,"inspect-"),this.workerMessageLengthLimit=$v("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=$v("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=$v("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new eb("worker-manager-"+this._inspectId,kv),this.on(IR.STATE_CHANGE,((e,t)=>{this._innerConnectionState=e,Ey.debug("[".concat(this._inspectId,"] Inspect operation :").concat(yR[e]," ").concat(t||""))})),this.handleWorkerManagerEvents(),this.workerConnection=new eb("worker-"+this._inspectId,kv),this.handleWorkerEvents()}async init(e,t){this.emit(IR.STATE_CHANGE,yR.CONNECT_AP),this._connectInfo=e;let n=this._cancelTokenSource.token;return this._retryConfig=t,new wu(((r,i)=>{this.on(IR.CONNECTION_STATE_CHANGE,((e,t)=>{t===vR.CONNECTED&&r()})),this.requestAP(e,n,t).then((e=>{this.connectWorkerManager(e)})).catch((e=>{i(e)}))}))}async requestAP(e,t,n){let r=$v("WEBCS_DOMAIN").map((e=>"https://".concat(e,"/api/v1"))),i=await function(e,t,n,r){let{appId:i,areaCode:o,cname:a,sid:s,token:A,uid:c}=t;Yb++;let l,d,u="image_moderation_api",h={service_name:u,json_body:JSON.stringify({appId:i,areaCode:o,cname:a,command:"allocateEdge",requestId:Yb,seq:Yb,sid:s,token:A,ts:Date.now(),uid:c+""})},p=e[0];return Fv((async()=>{l=Date.now();let e=await bb(p,{data:h,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(d=Date.now()-l,0!==e.code){let t=new HI(TT.UNEXPECTED_RESPONSE,"image inspect ap error, code"+e.code,{retry:!0,responseTime:d});throw Ey.error(t.toString()),t}let t=JSON.parse(e.json_body);if(200!==t.code){let e=new HI(TT.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(t.code,", reason: ").concat(t.reason),{code:t.code,responseTime:d});throw Ey.error(e.toString()),e}if(!t.servers||!Array.isArray(t.servers)||0===t.servers.length){let e=new HI(TT.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:t.code,responseTime:d});throw Ey.error(e.toString()),e}let r=$v("VIDEO_INSPECT_WORKER_MANAGER_HOST"),i=$v("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:t.servers.map((e=>{let{address:t,wss:n}=e;if(t&&n)return"wss://".concat(t.replace(/\./g,"-"),".").concat(r,":").concat(i||n)})).filter((e=>!!e)),workerToken:t.workerToken,vid:t.vid,responseTime:d}}),((t,n)=>(vy.apworkerEvent(s,{success:!0,sc:200,serviceName:u,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===n,responseTime:d,serverIp:e[n%e.length]}),!1)),((t,n)=>(vy.apworkerEvent(s,{success:!1,sc:t.data&&t.data.code||200,serviceName:u,responseTime:d,serverIp:e[n%e.length]}),!!(t.code!==TT.OPERATION_ABORTED&&t.code!==TT.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(p=e[(n+1)%e.length],!0))),r)}(r,e,t,n);this.emit(IR.STATE_CHANGE,yR.AP_CONNECTED);let{addressList:o}=i;return this.wmSequence++,o}async connectWorkerManager(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._needWorkUrlOnly=t,this.emit(IR.STATE_CHANGE,yR.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(VI.CONNECTED,(async()=>{this.emit(IR.STATE_CHANGE,yR.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.21.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(VI.CLOSED,(()=>{this._innerConnectionState<yR.GET_WORKER_MANAGER_RESPONSE&&Ey.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))})),this.workerManagerConnection.on(VI.FAILED,(()=>{this._innerConnectionState<yR.GET_WORKER_MANAGER_RESPONSE&&Ey.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))})),this.workerManagerConnection.on(VI.RECONNECTING,(()=>{this._innerConnectionState<yR.GET_WORKER_MANAGER_RESPONSE&&Ey.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))})),this.workerManagerConnection.on(VI.ON_MESSAGE,(async e=>{this.emit(IR.STATE_CHANGE,yR.GET_WORKER_MANAGER_RESPONSE);let t=this.workerManagerConnection.url;this.workerManagerConnection.close();let n=JSON.parse(e.data);if(200!==n.code)throw Ey.error("[".concat(this._inspectId,"] Unexpected code ").concat(n.code," from worker manager")),new HI(TT.UNEXPECTED_RESPONSE,"response code of worker is unexpected",n);if(!(n.serverResponse&&n.serverResponse.portWss&&t))throw Ey.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(n))),new HI(TT.UNEXPECTED_RESPONSE,"response content of worker is unexpected",n);{let e=$v("VIDEO_INSPECT_WORKER_PORT")||n.serverResponse.portWss,r=t.replace(/:\d+\/?$/,":".concat(e));this.emit(IR.STATE_CHANGE,yR.CONNECT_WORKER,r),this._needWorkUrlOnly?this.emit(IR.REQUEST_NEW_WORKER_URL,r):await this.connectWorker(r)}})),this.workerManagerConnection.on(VI.WILL_RECONNECT,((e,t,n)=>{n(e)})),this.workerManagerConnection.on(VI.REQUEST_NEW_URLS,((e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)}))}handleWorkerEvents(){this.workerConnection.on(VI.CONNECTED,(async()=>{this.emit(IR.STATE_CHANGE,yR.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=vR.CONNECTED})),this.workerConnection.on(VI.ON_MESSAGE,(async e=>{if(e.data instanceof ArrayBuffer){let n=function(e){return function(e){let t={};e:for(;!fH(e);){let n=yH(e);switch(n>>>3){case 0:break e;case 1:t.code=yH(e);break;case 2:t.msg=mH(e,yH(e));break;case 3:{let n=oH(e);t.data=rH(e),e.limit=n;break}default:aH(e,7&n)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}(new Uint8Array(e.data));if($v("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&Ey.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(n)),200===n.code){if(Array.isArray(this.inspectType)&&1===this.inspectType.length&&"supervise"===this.inspectType[0])return void this.emit(IR.INSPECT_RESULT,void 0,void 0);if(n.data&&n.data.scorePorn&&n.data.scoreSexy&&n.data.scoreNeutral){var t;let e={porn:n.data.scorePorn,sexy:n.data.scoreSexy,neutral:n.data.scoreNeutral},r=Hr(t=Object.keys(e)).call(t,((t,n)=>e[t]>e[n]?t:n),"porn"),i=Object.keys(e).find((e=>e===r));this.emit(IR.INSPECT_RESULT,i)}else this.emit(IR.INSPECT_RESULT,void 0,new HI(TT.UNEXPECTED_RESPONSE,n.code+"","There is an unexpected data on message"))}else this.emit(IR.INSPECT_RESULT,void 0,new HI(TT.UNEXPECTED_RESPONSE,n.code+"",n.msg))}else Ey.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(IR.INSPECT_RESULT,void 0,new HI(TT.UNEXPECTED_RESPONSE,"invalid worker message type"))})),this.workerConnection.on(VI.CLOSED,(()=>{this.connectionState=vR.CLOSED})),this.workerConnection.on(VI.FAILED,(()=>{this.connectionState=vR.CLOSED})),this.workerConnection.on(VI.RECONNECTING,(()=>{this.connectionState=this.connectionState===vR.CONNECTED?vR.RECONNECTING:vR.CONNECTING})),this.workerConnection.on(VI.WILL_RECONNECT,((e,t,n)=>{"recover"===e&&n(e),n("tryNext")})),this.workerConnection.on(VI.REQUEST_NEW_URLS,((e,t)=>{this.workerManagerConnection.close(),this.once(IR.REQUEST_NEW_WORKER_URL,(t=>{e([t])})),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then((e=>{this.connectWorkerManager(e,!0)})).catch((e=>{t(e)}))}))}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){this.sequence++;let e=iv(this,IR.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(IR.INSPECT_RESULT,void 0,new HI(TT.INVALID_OPERATION,"Only the track being played can be inspected"));let n=await this.generateRequestData(e,t);this.workerConnection.sendMessage(n,!0,!0)}else this.emit(IR.INSPECT_RESULT,void 0,new HI(TT.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,t){let{appId:n,cname:r,cid:i,vid:o,sid:a,uid:s}=t,A=Date.now(),c=await e.getCurrentFrameImage("image/jpeg",this.quality),l=await Pk(c,n,r),d=this.sequence+"-"+i+"-"+s+"-"+A+"-"+Sv(12,""),u={appId:n,cid:i,cname:r,deviceId:"",elapse:BH.intToLong(Number(A-this.inspectStartTime)),fileSize:l.byteLength,jpgEncryption:2,height:c.height,width:c.width,jpg:l,networkType:6,osType:7,requestId:d,sdkVersion:"4.21.0",sequence:this.sequence,sid:a,timestamp:BH.intToLong(A),uid:s,vid:o,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};void 0===this.extraInfo&&delete u.callbackData,void 0===this.ossFilePrefix&&delete u.ossFilePrefix;let h=function(e){let t=uH();return function(e,t){let n=e.appId;void 0!==n&&(IH(t,10),_H(t,n));let r=e.cid;void 0!==r&&(IH(t,16),IH(t,r));let i=e.cname;void 0!==i&&(IH(t,26),_H(t,i));let o=e.deviceId;void 0!==o&&(IH(t,34),_H(t,o));let a=e.elapse;void 0!==a&&(IH(t,40),RH(t,a));let s=e.fileSize;void 0!==s&&(IH(t,48),RH(t,lH(s)));let A=e.height;void 0!==A&&(IH(t,56),RH(t,lH(A)));let c=e.jpg;void 0!==c&&(IH(t,66),IH(t,c.length),function(e,t){let n=EH(e,t.length);e.bytes.set(t,n)}(t,c));let l=e.networkType;void 0!==l&&(IH(t,72),RH(t,lH(l)));let d=e.osType;void 0!==d&&(IH(t,80),RH(t,lH(d)));let u=e.requestId;void 0!==u&&(IH(t,90),_H(t,u));let h=e.sdkVersion;void 0!==h&&(IH(t,98),_H(t,h));let p=e.sequence;void 0!==p&&(IH(t,104),RH(t,lH(p)));let f=e.sid;void 0!==f&&(IH(t,114),_H(t,f));let E=e.timestamp;void 0!==E&&(IH(t,120),RH(t,E));let g=e.uid;void 0!==g&&(IH(t,128),IH(t,g));let m=e.vid;void 0!==m&&(IH(t,136),IH(t,m));let _=e.width;void 0!==_&&(IH(t,144),RH(t,lH(_)));let C=e.service;void 0!==C&&(IH(t,152),IH(t,C));let w=e.callbackData;void 0!==w&&(IH(t,162),_H(t,w));let S=e.jpgEncryption;void 0!==S&&(IH(t,168),IH(t,S));let T=e.requestType;void 0!==T&&(IH(t,176),IH(t,T));let v=e.scorePorn;void 0!==v&&(IH(t,185),vH(t,v));let y=e.scoreSexy;void 0!==y&&(IH(t,193),vH(t,y));let I=e.scoreNeutral;void 0!==I&&(IH(t,201),vH(t,I));let R=e.scene;void 0!==R&&(IH(t,208),IH(t,R));let b=e.ossFilePrefix;void 0!==b&&(IH(t,218),_H(t,b));let O=e.serviceVendor;if(void 0!==O)for(let B of O){IH(t,226);let e=uH();iH(B,e),IH(t,e.limit),CH(t,e),hH(e)}}(e,t),function(e){let t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}(t)}(u);if(h.byteLength<this.workerMessageLengthLimit){if($v("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){let e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bH(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bH(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},u);delete e.jpg,Ey.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(e))}return h}{let t=this.quality*this.qualityRatio;return this.quality=t,await this.generateRequestData(e,{appId:n,cname:r,cid:i,vid:o,sid:a,uid:s})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=LS.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=vR.CLOSED,this.emit(IR.STATE_CHANGE,yR.CLOSED)}}function NH(e,t){switch(t){case 0:for(;128&VH(e););break;case 2:UH(e,KH(e));break;case 5:UH(e,4);break;case 1:UH(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function DH(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let PH=[];function UH(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function LH(e){return e.offset>=e.limit}function kH(e,t){let n=e.bytes,r=e.offset,i=e.limit,o=r+t;if(o>n.length){let t=new Uint8Array(2*o);t.set(n),e.bytes=t}return e.offset=o,o>i&&(e.limit=o),r}function MH(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function FH(e,t){let n=kH(e,t.length);e.bytes.set(t,n)}function xH(e,t){let n=MH(e,t),r=String.fromCharCode,i=e.bytes,o="\ufffd",a="";for(let s=0;s<t;s++){let e,A,c,l,d=i[s+n];128&d?192==(224&d)?s+1>=t?a+=o:(e=i[s+n+1],128!=(192&e)?a+=o:(l=(31&d)<<6|63&e,l<128?a+=o:(a+=r(l),s++))):224==(240&d)?s+2>=t?a+=o:(e=i[s+n+1],A=i[s+n+2],32896!=(49344&(e|A<<8))?a+=o:(l=(15&d)<<12|(63&e)<<6|63&A,l<2048||l>=55296&&l<=57343?a+=o:(a+=r(l),s+=2))):240==(248&d)?s+3>=t?a+=o:(e=i[s+n+1],A=i[s+n+2],c=i[s+n+3],8421504!=(12632256&(e|A<<8|c<<16))?a+=o:(l=(7&d)<<18|(63&e)<<12|(63&A)<<6|63&c,l<65536||l>1114111?a+=o:(l-=65536,a+=r(55296+(l>>10),56320+(1023&l)),s+=3))):a+=o:a+=r(d)}return a}function QH(e,t){let n=t.length,r=0;for(let a=0;a<n;a++){let e=t.charCodeAt(a);e>=55296&&e<=56319&&a+1<n&&(e=(e<<10)+t.charCodeAt(++a)-56613888),r+=e<128?1:e<2048?2:e<65536?3:4}jH(e,r);let i=kH(e,r),o=e.bytes;for(let a=0;a<n;a++){let e=t.charCodeAt(a);e>=55296&&e<=56319&&a+1<n&&(e=(e<<10)+t.charCodeAt(++a)-56613888),e<128?o[i++]=e:(e<2048?o[i++]=e>>6&31|192:(e<65536?o[i++]=e>>12&15|224:(o[i++]=e>>18&7|240,o[i++]=e>>12&63|128),o[i++]=e>>6&63|128),o[i++]=63&e|128)}}function VH(e){return e.bytes[MH(e,1)]}function HH(e,t){let n=kH(e,1);e.bytes[n]=t}function KH(e){let t,n=0,r=0;do{t=VH(e),n<32&&(r|=(127&t)<<n),n+=7}while(128&t);return r}function jH(e,t){for(t>>>=0;t>=128;)HH(e,127&t|128),t>>>=7;HH(e,t)}function GH(e,t){let n,r=0,i=0,o=0;return n=VH(e),r=127&n,128&n&&(n=VH(e),r|=(127&n)<<7,128&n&&(n=VH(e),r|=(127&n)<<14,128&n&&(n=VH(e),r|=(127&n)<<21,128&n&&(n=VH(e),i=127&n,128&n&&(n=VH(e),i|=(127&n)<<7,128&n&&(n=VH(e),i|=(127&n)<<14,128&n&&(n=VH(e),i|=(127&n)<<21,128&n&&(n=VH(e),o=127&n,128&n&&(n=VH(e),o|=(127&n)<<7))))))))),{low:r|i<<28,high:i>>>4|o<<24,unsigned:t}}function WH(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,o=0===i?0===r?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,a=kH(e,o),s=e.bytes;switch(o){case 10:s[a+9]=i>>>7&1;case 9:s[a+8]=9!==o?128|i:127&i;case 8:s[a+7]=8!==o?r>>>21|128:r>>>21&127;case 7:s[a+6]=7!==o?r>>>14|128:r>>>14&127;case 6:s[a+5]=6!==o?r>>>7|128:r>>>7&127;case 5:s[a+4]=5!==o?128|r:127&r;case 4:s[a+3]=4!==o?n>>>21|128:n>>>21&127;case 3:s[a+2]=3!==o?n>>>14|128:n>>>14&127;case 2:s[a+1]=2!==o?n>>>7|128:n>>>7&127;case 1:s[a]=1!==o?128|n:127&n}}let YH={},JH={},XH=4294967296,zH=XH*XH/2;eK(0,!0);let qH=eK(0),ZH=tK(0,-2147483648,!1),$H=tK(-1,2147483647,!1);function eK(e,t){let n,r,i;return t?(i=0<=(e>>>=0)&&e<256)&&(r=JH[e],r)?r:(n=tK(e,0,!0),i&&(JH[e]=n),n):(i=-128<=(e|=0)&&e<128)&&(r=YH[e],r)?r:(n=tK(e,e<0?-1:0,!1),i&&(YH[e]=n),n)}function tK(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function nK(e,t){return isNaN(e)?qH:e<=-zH?ZH:e+1>=zH?$H:e<0?qH:tK(e%XH|0,e/XH|0,t)}function rK(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}class iK extends VT{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;let t=this._connectionState;this._connectionState=e,this.emit(NR.CONNECTION_STATE_CHANGE,e,t)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this._qualityRatio}),6e4))}constructor(e){var t;super(),O_(this,"name","AgoraRTCImageModeration"),O_(this,"_connectionState",BR.CONNECTING),O_(this,"_sequence",0),O_(this,"_moderationStartTime",void 0),O_(this,"_workerConnection",void 0),O_(this,"_workerMessageLengthLimit",void 0),O_(this,"_qualityRatio",void 0),O_(this,"_connectInfo",void 0),O_(this,"_cancelTokenSource",LS.CancelToken.source()),O_(this,"_retryConfig",void 0),O_(this,"_moderationInterval",void 0),O_(this,"_moderationTimer",null),O_(this,"_moderationMode",1),O_(this,"_quality",1),O_(this,"_qualityTimer",null),O_(this,"_ticket",void 0),O_(this,"_moderationIntervalMinimum",void 0),O_(this,"_uploadFailedNum",0),O_(this,"_uploadNum",0),O_(this,"_uploadTimer",null),O_(this,"_extraInfo",void 0),O_(this,"_vendor",""),O_(this,"_encoder",new TextEncoder),O_(this,"_moderationId",void 0),O_(this,"inspectImage",(()=>{if(this.connectionState!==BR.CONNECTED)throw new HI(TT.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval((()=>{this.connectionState===BR.CONNECTED?this.requestToInspectImage():Ey.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)}),this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()})),this._moderationId=Sv(5,"image-moderation-"),this._workerMessageLengthLimit=$v("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=$v("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=$v("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new eb("worker-"+this._moderationId,kv),this.on(NR.STATE_CHANGE,((e,t)=>{Ey.debug("[".concat(this._moderationId,"] Moderation operation :").concat(DR[e]," ").concat(t||""))})),this.handleWorkerEvents()}async init(e,t){this.emit(NR.STATE_CHANGE,DR.CONNECT_AP),this._connectInfo=e;let n=this._cancelTokenSource.token;return this._retryConfig=t,new wu(((r,i)=>{this.on(NR.CONNECTION_STATE_CHANGE,((e,t)=>{e===BR.CONNECTED&&r()})),this.requestAP(e,n,t).then((e=>{this.connectWorker(e)})).catch((e=>{i(e)}))}))}updateConfig(e){var t;this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),Ey.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===BR.CONNECTED&&this.inspectImage()}async requestAP(e,t,n){let r=$v("WEBCS_DOMAIN").map((e=>"https://".concat(e,"/api/v1"))),i=await function(e,t,n,r){let{appId:i,areaCode:o,cname:a,sid:s,token:A,uid:c}=t;Yb++;let l,d,u="moderation_plugin",h={service_name:u,json_body:JSON.stringify({appId:i,areaCode:o,cname:a,command:"allocateEdge",requestId:Yb,seq:Yb,sid:s,appToken:A,ts:Date.now(),uid:c+""})},p=e[0];return Fv((async()=>{l=Date.now();let e=await bb(p,{data:h,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(d=Date.now()-l,0!==e.code){let t=new HI(TT.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+e.code,{retry:!0,responseTime:d});throw Ey.error(t.toString()),t}let t=JSON.parse(e.json_body);if(200!==t.code){let e=new HI(TT.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(t.code,", reason: ").concat(t.reason),{code:t.code,responseTime:d});throw Ey.error(e.toString()),e}if(!t.servers||!Array.isArray(t.servers)||0===t.servers.length){let e=new HI(TT.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:t.code,responseTime:d});throw Ey.error(e.toString()),e}if(!t.servers.some((e=>!!e.wss))){let e=new HI(TT.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:t.code,responseTime:d});throw Ey.error(e.toString()),e}let r=$v("IMAGE_MODERATION_WORKER_HOST");return{addressList:t.servers.map((e=>{let{address:t,wss:n}=e;if(t&&n)return"wss://".concat(t.replace(/\./g,"-"),".").concat(r,":").concat(n,"/moderation")})).filter((e=>!!e)),workerToken:t.workerToken,vid:t.vid,ticket:t.appTicket,responseTime:d}}),((t,n)=>(vy.apworkerEvent(s,{success:!0,sc:200,serviceName:u,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===n,responseTime:d,serverIp:e[n%e.length]}),!1)),((t,n)=>(vy.apworkerEvent(s,{success:!1,sc:t.data&&t.data.code||200,serviceName:u,responseTime:d,serverIp:e[n%e.length]}),!!(t.code!==TT.OPERATION_ABORTED&&t.code!==TT.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(p=e[(n+1)%e.length],!0))),r)}(r,e,t,n);this.emit(NR.STATE_CHANGE,DR.AP_CONNECTED);let{addressList:o,ticket:a}=i;return this._ticket=a,o}async connectWorker(e){this.emit(NR.STATE_CHANGE,DR.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(VI.CONNECTED,(async()=>{this.emit(NR.STATE_CHANGE,DR.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=BR.CONNECTED})),this._workerConnection.on(VI.CLOSED,(()=>{this.connectionState=BR.CLOSED})),this._workerConnection.on(VI.FAILED,(()=>{this.connectionState=BR.CLOSED})),this._workerConnection.on(VI.RECONNECTING,(()=>{this.connectionState=this.connectionState===BR.CONNECTED?BR.RECONNECTING:BR.CONNECTING})),this._workerConnection.on(VI.ON_MESSAGE,(async e=>{if(e.data instanceof ArrayBuffer){let t=function(e){return function(e){let t={};e:for(;!LH(e);){let n=KH(e);switch(n>>>3){case 0:break e;case 1:t.code=KH(e);break;case 2:t.msg=xH(e,KH(e));break;case 3:t.requestId=xH(e,KH(e));break;case 4:t.timestamp=GH(e,!1);break;default:NH(e,7&n)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}(new Uint8Array(e.data));$v("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&Ey.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(t)),this._uploadNum++,void 0===t.code||0===t.code||(this._uploadFailedNum++,Ey.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(t.code,", msg is ").concat(t.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout((()=>{vy.reportApiInvoke(this._connectInfo.sid||null,{name:jT.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,t.code],tag:GT.TRACER}).onError(new HI(TT.IMAGE_MODERATION_UPLOAD_FAILED,t.msg)),this._uploadTimer=null}),$v("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else Ey.error("[".concat(this._moderationId,"] Unexpected message type from worker"))})),this._workerConnection.on(VI.WILL_RECONNECT,((e,t,n)=>{"recover"===e&&n(e),n("tryNext")})),this._workerConnection.on(VI.REQUEST_NEW_URLS,((e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)}))}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){let e=iv(this,NR.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void($v("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&Ey.debug("Only the track being played can be inspected"));this._sequence++;let n=await this.generateRequestData(e,t);this._workerConnection.sendMessage(n,!0,!0)}else $v("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&Ey.debug("Only the track being published can be inspected")}async generateRequestData(e,t){let{appId:n,cname:r,cid:i,vid:o,sid:a,uid:s}=t,A=Date.now(),c=await e.getCurrentFrameImage("image/jpeg",this.quality),l=await Pk(c,n,r),d=this._sequence+"-"+i+"-"+s+"-"+A+"-"+Sv(12,""),u={appId:n,cid:i,cname:r,deviceId:"",elapse:iK.intToLong(Number(A-this._moderationStartTime)),fileSize:c.buffer.byteLength,height:c.height,width:c.width,jpg:l,networkType:6,osType:7,requestId:d,sdkVersion:"4.21.0",sequence:this._sequence,sid:a,timestamp:nK(A),uid:s,vid:o,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};void 0===this._extraInfo&&delete u.callbackData;let h=function(e){let t=function(){let e=PH.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(e,t){let n=e.appId;void 0!==n&&(jH(t,10),QH(t,n));let r=e.cid;void 0!==r&&(jH(t,16),jH(t,r));let i=e.cname;void 0!==i&&(jH(t,26),QH(t,i));let o=e.deviceId;void 0!==o&&(jH(t,34),QH(t,o));let a=e.elapse;void 0!==a&&(jH(t,40),WH(t,a));let s=e.fileSize;void 0!==s&&(jH(t,48),WH(t,DH(s)));let A=e.height;void 0!==A&&(jH(t,56),WH(t,DH(A)));let c=e.jpg;void 0!==c&&(jH(t,66),jH(t,c.length),FH(t,c));let l=e.networkType;void 0!==l&&(jH(t,72),WH(t,DH(l)));let d=e.osType;void 0!==d&&(jH(t,80),WH(t,DH(d)));let u=e.requestId;void 0!==u&&(jH(t,90),QH(t,u));let h=e.sdkVersion;void 0!==h&&(jH(t,98),QH(t,h));let p=e.sequence;void 0!==p&&(jH(t,104),WH(t,DH(p)));let f=e.sid;void 0!==f&&(jH(t,114),QH(t,f));let E=e.timestamp;void 0!==E&&(jH(t,120),WH(t,E));let g=e.uid;void 0!==g&&(jH(t,128),jH(t,g));let m=e.vid;void 0!==m&&(jH(t,136),jH(t,m));let _=e.width;void 0!==_&&(jH(t,144),WH(t,DH(_)));let C=e.service;void 0!==C&&(jH(t,152),jH(t,C));let w=e.callbackData;void 0!==w&&(jH(t,162),jH(t,w.length),FH(t,w));let S=e.ticket;void 0!==S&&(jH(t,170),QH(t,S));let T=e.vendorConfigs;void 0!==T&&(jH(t,178),QH(t,T))}(e,t),function(e){let t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}(t)}(u);if(h.byteLength<this._workerMessageLengthLimit){if($v("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){let e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rK(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rK(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},u);delete e.jpg,Ey.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(e))}return h}{let t=this.quality*this._qualityRatio;return this.quality=t,await this.generateRequestData(e,{appId:n,cname:r,cid:i,vid:o,sid:a,uid:s})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=LS.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=BR.CLOSED,this.emit(NR.STATE_CHANGE,DR.CLOSED)}}function oK(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function aK(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oK(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oK(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let sK=Date.now(),AK=20,cK=new Map,lK=new Map;async function dK(e){let t=cK.get(e),n=Array.isArray(t)&&t[t.length-1],r=lK.get(e);if(!n)return void(r.isSyncing=!1);let i={uid:n.uid,payload:n.payload};0===r.firstRecvTs&&(r.firstRecvTs=n.recvTs,r.firstSendTs=n.sendTs);let o=n.sendTs-r.firstSendTs,a=o-(Date.now()-r.firstRecvTs);a>0&&(r.firstRecvTs=Date.now()-o);let s=n.mediaDelay+a;s<=0?(t.pop(),uK(n.context,i),s=0):s=Math.min(s,AK),setTimeout((()=>t.length&&dK(e)),s)}function uK(e,t){e.safeEmit(ZT.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function hK(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return uK(n,{uid:e.uid,payload:e.payload});let r="".concat(n.id,"-").concat(e.uid),i=cK.get(r)||[],o=i.findIndex((t=>e.sendTs>=t.sendTs)),a=aK(aK({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});-1===o?i.push(a):i.splice(o,0,a),cK.set(r,i);let s=!1;var A;lK.has(r)?s=!(null===(A=lK.get(r))||void 0===A||!A.isSyncing):lK.set(r,{isSyncing:s,firstRecvTs:0,firstSendTs:0}),s||dK(r)}let pK=WS().name;function fK(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function EK(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fK(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fK(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let gK="websdk_ng_cache_parameter",mK=$v("MAX_PRELOAD_ASYNC_LENGTH"),_K=new Map,CK=[],wK=null,SK=0,TK=0,vK=new Map,yK=function(e,t){let n=[],r=0,i=async()=>{let e=n.shift();e&&await e(),n.length>0&&r<t?i():r--};return async function(){for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return new wu((async(o,s)=>{n.push((async()=>{try{let t=await e(...a);o(t)}catch(t){s(t)}})),r<t&&(r++,i())}))}}(RK,mK),IK=LS.CancelToken.source();async function RK(e,t,n,r,i){try{if(!$v("ENABLE_PRELOAD"))return;if(!oL().supportWebCrypto)return void hv((()=>{Ey.warn("Your browser does not support preloading, this feature  be run in a secure environment")}),"preload_webcrypto_not_supported");if(!n&&null!==n)throw new vT(TT.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&OT(n,"token",1,2047),OT(e,"appid",1,2047),KI(t),r&&jI(r);let o=Tv();Ey.debug("preload channel ".concat(t,", uid is ").concat(r));let a,s,A={appId:e,cname:t,token:n||e,uid:"string"!=typeof r?r:null,sid:o,proxyServer:i};"string"==typeof r?(A.stringUid=r,[s,a]=await wu.all([eO(r,{sid:o,appId:e},IK.token),tO(EK(EK({},A),{},{token:n||e,uid:0}),IK.token)]),A.uid=s.uid,a.gatewayInfo.uid=A.uid,a.gatewayInfo.res.uid=A.uid):a=await tO(A,IK.token);let c={sid:o,appId:e,cname:t,token:n||e,uid:A.stringUid||r,intUid:A.uid||a.gatewayInfo.uid,stringUid:A.stringUid,ts:Date.now(),sua:s,ap:a};await async function(e){let t;try{e.uid&&OK({appId:e.appId,cname:e.cname,token:e.token,uid:e.uid,stringUid:e.stringUid});let n=LK(e),r=await async function(e,t){try{let n=await window.crypto.subtle.importKey("raw",Ev(t),"AES-GCM",!1,["encrypt"]),r=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},n,pv(window.btoa(JSON.stringify(e))));return fv(new Uint8Array(r))}catch{return}}(e,e.token||e.appId);if(!r)return;t=PK(gK);let i=t?JSON.parse(t):[];i.push({[n]:r}),i.length>$v("AP_CACHE_NUM")&&i.shift(),UK(gK,JSON.stringify(i))}catch(n){Ey.warn("Error caching server parameters:",n.message),UK(gK,"")}}(c),SK++}catch(o){throw TK++,function(e){wK||(wK=window.setTimeout((()=>{let t="";vK.forEach(((e,n)=>{t+="".concat(n,": ").concat(e," ;")})),vy.reportApiInvoke(null,{name:jT.PRELOAD,options:{success:SK,failed:TK,err:t}}).onError(e),SK=0,TK=0,vK.clear(),wK=null}),1e4));let t=vK.get(e.code)||0;vK.set(e.code,t+1)}(o),o}}async function bK(e){try{let r=OK(e);if(!r||"disabled"!==e.cloudProxyServer)return;let i=await async function(e,t){try{let n=await window.crypto.subtle.importKey("raw",Ev(t),"AES-GCM",!1,["decrypt"]),r=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},n,pv(e));return JSON.parse(window.atob(fv(new Uint8Array(r))))}catch{return}}(r,e.token||e.appId);if(!i||(n=e,(t=i).cname!==n.cname||t.appId!==n.appId||t.token!==n.token||(n.stringUid?t.stringUid!==n.stringUid:"number"==typeof n.uid?t.uid!==n.uid:t.uid!=n.uid)))return;if(i&&Date.now()-i.ts<$v("AP_CACHE_LIFETIME"))return i}catch(r){Ey.warn("Error get preloadInfo",r.message)}var t,n}function OK(e){let t;try{if(t=PK(gK),!t)return;let n=JSON.parse(t),r=LK(e),i=function(e,t){for(let n=e.length-1;n>=0;n--)if(t(e[n]))return n;return-1}(n,(e=>r in e));if(-1===i)return;let o=n.splice(i,1)[0];return UK(gK,JSON.stringify(n)),o[r]}catch(n){Ey.warn("Error delete preload info: ".concat(t),n.message),UK(gK,"")}}function BK(e){if(e){let t=_K.get(e);t&&(window.clearTimeout(t),t=null,_K.delete(e)),yr(CK).call(CK,e)||"disabled"!==e.cloudProxyServer||CK.push(e)}if(_K.size<$v("AP_CACHE_NUM")&&CK.length>0){let e=CK.shift();_K.set(e,window.setTimeout((async()=>{let{appId:t,cname:n,token:r,uid:i,proxyServer:o}=e;try{await yK(t,n,r,i,o),_K.has(e)&&BK(e)}catch(a){Ey.warn("update preload failed",a.message),NK(e)}}),$v("AP_UPDATE_INTERVAL")))}}function NK(e){let t=CK.indexOf(e);-1!==t&&CK.splice(t,1);let n=_K.get(e);n&&(window.clearTimeout(n),n=null,_K.delete(e),BK())}function DK(e,t){let n=e.sua,r=e.ap;t&&n&&vy.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),vy.reportResourceTiming(e.ap.url,e.sid),vy.joinWebProxyAP(e.sid,{lts:r.requestTime,elapse:r.elapse,sucess:1,apServerAddr:r.url,turnServerAddrList:r.proxyInfo.addresses.map((e=>e.ip)).join(","),eventType:"disabled",unilbsServerIds:[nb.CHOOSE_SERVER,nb.CLOUD_PROXY_FALLBACK].toString()}),vy.joinChooseServer(e.sid,{lts:r.requestTime,elapse:r.elapse,succ:!0,csAddr:r.url,opid:r.opid,serverList:r.gatewayInfo.gatewayAddrs.map((e=>e.address)),ec:null,cid:r.gatewayInfo.cid.toString(),uid:r.gatewayInfo.uid.toString(),csIp:r.gatewayInfo.csIp,unilbsServerIds:[nb.CHOOSE_SERVER].toString(),isHttp3:r.isHttp3})}function PK(e){return window.atob(window.localStorage.getItem(e)||"")}function UK(e,t){window.localStorage.setItem(e,window.btoa(t))}function LK(e){let t="".concat(e.appId,"_").concat(e.cname);return"string"==typeof e.uid&&(t+="_s_".concat(e.uid)),"number"==typeof e.uid&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),Nv(t)}var kK,MK,FK,xK,QK,VK,HK,KK,jK,GK,WK,YK,JK,XK,zK,qK,ZK,$K,ej,tj,nj,rj,ij,oj,aj,sj,Aj,cj,lj,dj,uj,hj,pj,fj,Ej,gj,mj,_j,Cj,wj,Sj,Tj,vj;function yj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ij(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yj(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yj(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}Uv.setLogger(Ey);let Rj=(kK=Ty(),MK=Ty({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof zL))return[t];t=[t]}return t.map((e=>e?Object(e).toString():"null"))}}),FK=Ty({argsMap:(e,t)=>(t||(t=[]),t instanceof LF?[t.getChannelId()]:(Array.isArray(t)||(t=[t]),t.map((e=>e.getTrackId()))))}),xK=Ty({argsMap:(e,t,n,r)=>["object"==typeof t?t.uid:t,n,r]}),QK=Ty({argsMap:(e,t,n)=>[t,n]}),VK=Ty({argsMap:(e,t)=>t.map((e=>{let{user:t,mediaType:n}=e;return[null===t||void 0===t?void 0:t.uid,n]}))}),HK=Ty({argsMap:(e,t,n,r)=>["object"==typeof t?t.uid:t,n,r]}),KK=Ty({argsMap:(e,t)=>t.map((e=>{let{user:t,mediaType:n}=e;return{uid:null===t||void 0===t?void 0:t.uid,mediaType:n}}))}),jK=Ty(),GK=Ty(),WK=Ty(),YK=Ty(),JK=Ty(),XK=Ty(),zK=Ty(),qK=Ty(),ZK=Ty(),$K=Ty(),ej=Ty(),tj=Ty(),nj=Ty(),rj=Ty(),ij=Ty({argsMap:(e,t)=>[t]}),oj=Ty(),aj=Ty(),sj=Ty(),Aj=Ty(),cj=Ty(),lj=Ty(),dj=Ty(),uj=Ty(),hj=Ty(),pj=Ty(),fj=Ty({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),Ej=Ty(),gj=Ty(),mj=Ty(),_j=Ty(),Cj=Ty(),wj=Ty(),Sj=Ty({reportResult:!0}),Tj=Ty(),vj=class extends VT{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return(null===(e=this._config)||void 0===e?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e){let t;if(super(),O_(this,"store",void 0),O_(this,"_uid",void 0),O_(this,"_channelName",void 0),O_(this,"_uintUid",void 0),O_(this,"_users",[]),O_(this,"_config",void 0),O_(this,"_clientId",void 0),O_(this,"_appId",void 0),O_(this,"_sessionId",null),O_(this,"_key",void 0),O_(this,"_rtmConfig",{}),O_(this,"_joinInfo",void 0),O_(this,"_gateway",void 0),O_(this,"_statsCollector",void 0),O_(this,"_configDistribute",void 0),O_(this,"_leaveMutex",new Uv("client-leave")),O_(this,"_publishMutex",new Uv("client-publish")),O_(this,"_renewTokenMutex",new Uv("client-renewtoken")),O_(this,"_subscribeMutex",new Uv("client-subscribe")),O_(this,"_encryptionMode","none"),O_(this,"_encryptionSecret",null),O_(this,"_encryptionSalt",null),O_(this,"_encryptDataStream",!1),O_(this,"_encryptDataStreamKey",null),O_(this,"_encryptDataStreamIv",null),O_(this,"_proxyServer",void 0),O_(this,"_turnServer",{servers:[],mode:"auto"}),O_(this,"_cloudProxyServerMode","disabled"),O_(this,"_isDualStreamEnabled",!1),O_(this,"_defaultStreamFallbackType",void 0),O_(this,"_lowStreamParameter",void 0),O_(this,"_streamFallbackTypeCacheMap",new Map),O_(this,"_remoteStreamTypeCacheMap",new Map),O_(this,"_axiosCancelSource",LS.CancelToken.source()),O_(this,"_audioVolumeIndicationInterval",void 0),O_(this,"_networkQualityInterval",void 0),O_(this,"_userOfflineTimeout",void 0),O_(this,"_streamRemovedTimeout",void 0),O_(this,"_injectStreamingClient",void 0),O_(this,"_liveTranscodeStreamingClient",void 0),O_(this,"_liveRawStreamingClient",void 0),O_(this,"_channelMediaRelayClient",void 0),O_(this,"_networkQualitySensitivity","normal"),O_(this,"_p2pChannel",void 0),O_(this,"_useLocalAccessPoint",!1),O_(this,"_setLocalAPVersion",void 0),O_(this,"_joinAndNotLeaveYet",!1),O_(this,"_numberOfJoinCount",0),O_(this,"_remoteDefaultVideoStreamType",void 0),O_(this,"_inspect",void 0),O_(this,"_moderation",void 0),O_(this,"_license",void 0),O_(this,"_pendingPublishedUsers",[]),O_(this,"ntpAlignErrorCount",0),O_(this,"remoteInboundOffset",0),O_(this,"_handleLocalTrackEnable",((e,t,n)=>{this.publish(e,!1).then(t).catch(n)})),O_(this,"_handleLocalTrackDisable",((e,t,n)=>{this.unpublish(e).then(t).catch(n)})),O_(this,"_handleUserOnline",(e=>{if($v("BLOCK_LOCAL_CLIENT")&&Oy(e.uid,this.channelName))return void Ey.debug("[".concat(e.uid,"] will be ignored in local"));this.isStringUID&&"string"!=typeof e.uid&&Ey.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));let t=this._users.find((t=>t.uid===e.uid));if(t)t._trust_in_room_=!0,t._is_pre_created&&(t._is_pre_created=!1,this.safeEmit(ZT.USER_JOINED,t));else{let t=new vQ(e.uid,e.uint_id||e.uid);this._users.push(t),Ey.debug("[".concat(this._clientId,"] user online"),e.uid),this.safeEmit(ZT.USER_JOINED,t)}})),O_(this,"_handleUserOffline",(e=>{if($v("BLOCK_LOCAL_CLIENT")&&Oy(e.uid,this.channelName))return;let t=this._users.find((t=>t.uid===e.uid));t&&(this._handleRemoveStream(e),this._handleRemoveDataChannels(e),t._audio_pre_subscribed||t._video_pre_subscribed?t._is_pre_created=!0:sv(this._users,t),this._remoteStreamTypeCacheMap.delete(t.uid),this._streamFallbackTypeCacheMap.delete(t.uid),Ey.debug("[".concat(this._clientId,"] user offline"),e.uid,"reason:",e.reason),this.safeEmit(ZT.USER_LEAVED,t,e.reason))})),O_(this,"_handleAddAudioOrVideoStream",((e,t,n,r,i,o,a)=>{if($v("BLOCK_LOCAL_CLIENT")&&Oy(t,this.channelName))return;let s=this._users.find((e=>e.uid===t));if(!s)return void Ey.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));Ey.debug("[".concat(this._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),this.store.subscribe(s.uid,e,void 0,void 0,void 0,Date.now());let A="audio"===e?s.hasAudio:s.hasVideo;s._uintid||(s._uintid=i||t),"audio"===e?s._trust_audio_stream_added_state_=!0:s._trust_video_stream_added_state_=!0,"audio"===e?(s._audio_added_=!0,void 0!==n&&(s._audioSSRC=n),void 0!==r&&(s._cname=r),o&&(s._audioOrtc=o)):(s._video_added_=!0,void 0!==n&&(s._videoSSRC=n),void 0!==r&&(s._cname=r),void 0!==a&&(s._rtxSsrcId=a),o&&(s._videoOrtc=o)),("audio"===e?s.hasAudio:s.hasVideo)&&!A&&(Ey.info("[".concat(this._clientId,"] remote user ").concat(s.uid," published ").concat(e)),this.safeEmit(ZT.USER_PUBLISHED,s,e)),"video"===e?vy.onGatewayStream(this._sessionId,Cy.ON_ADD_VIDEO_STREAM,wy.ON_ADD_VIDEO_STREAM,{peer:i||t,ssrc:s._videoSSRC}):vy.onGatewayStream(this._sessionId,Cy.ON_ADD_AUDIO_STREAM,wy.ON_ADD_AUDIO_STREAM,{peer:i||t,ssrc:s._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(s,e,n).then((t=>{if(t&&(Ey.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(s.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof tH))return this._p2pChannel.unsubscribe(s,e,!0).then((()=>this._subscribe(s,e,!0).catch((e=>{Ey.error("[".concat(this._clientId,"] resubscribe error"),e.toString())}))))})),this._p2pChannel.hasPendingRemoteMedia(s,e)&&(Ey.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(s.uid," after reconnect.")),this._subscribe(s,e,!0).catch((e=>{Ey.error("[".concat(this._clientId,"] resubscribe error"),e.toString())})))})),O_(this,"_handleRemoveStream",(e=>{if($v("BLOCK_LOCAL_CLIENT")&&Oy(e.uid,this.channelName))return;let t=this._users.find((t=>t.uid===e.uid));if(!t)return void Ey.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));Ey.debug("[".concat(this._clientId,"] stream removed with uid ").concat(e.uid));let n=()=>{};t.hasAudio&&t.hasVideo?n=()=>{Ey.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished audio track")),this.safeEmit(ZT.USER_UNPUBLISHED,t,"audio"),Ey.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished video track")),this.safeEmit(ZT.USER_UNPUBLISHED,t,"video")}:t.hasVideo?n=()=>{Ey.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished video track")),this.safeEmit(ZT.USER_UNPUBLISHED,t,"video")}:t.hasAudio&&(n=()=>{Ey.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished audio track")),this.safeEmit(ZT.USER_UNPUBLISHED,t,"audio")}),t._video_pre_subscribed||t._audio_pre_subscribed||(t._trust_audio_stream_added_state_=!0,t._trust_video_stream_added_state_=!0,t._audio_added_=!1,t._video_added_=!1,this._p2pChannel instanceof tH&&this._p2pChannel.unsubscribe(t).then((e=>{if(e)return this._gateway.unsubscribe(e,t.uid)})),t._audioSSRC=void 0,t._videoSSRC=void 0,t._audioOrtc=void 0,t._videoOrtc=void 0,t._rtxSsrcId=void 0),vy.onGatewayStream(this._sessionId,Cy.ON_REMOVE_STREAM,wy.ON_REMOVE_STREAM,{peer:e.uint_id||e.uid}),n()})),O_(this,"_handleSetStreamLocalEnable",((e,t,n)=>{if($v("BLOCK_LOCAL_CLIENT")&&Oy(t,this.channelName))return;let r=this._users.find((e=>e.uid===t));if(!r)return void Ey.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));Ey.debug("[".concat(this._clientId,"] local ").concat(e," ").concat(n?"enabled":"disabled"," with uid ").concat(t));let i="audio"===e?r.hasAudio:r.hasVideo;if("audio"===e){r._trust_audio_enabled_state_=!0;let e=r._audio_enabled_;if(r._audio_enabled_=n,r._audio_enabled_===e)return;{let e=r._audio_enabled_?"enable-local-audio":"disable-local-audio";Ey.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(ZT.USER_INFO_UPDATED,t,e)}}else{r._trust_video_enabled_state_=!0;let e=r._video_enabled_;if(r._video_enabled_=n,r._video_enabled_===e)return;{let e=r._video_enabled_?"enable-local-video":"disable-local-video";Ey.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(ZT.USER_INFO_UPDATED,t,e)}}let o="audio"===e?r.hasAudio:r.hasVideo;return i!==o?!i&&o?(Ey.info("[".concat(this._clientId,"] remote user ").concat(t," published ").concat(e)),void this.safeEmit(ZT.USER_PUBLISHED,r,e)):("video"===e&&r._videoTrack&&r._videoTrack._destroy(),"audio"===e&&r._audioTrack,this._p2pChannel.muteRemote(r,e),Ey.info("[".concat(this._clientId,"] remote user ").concat(t," unpublished ").concat(e)),void this.safeEmit(ZT.USER_UNPUBLISHED,r,e)):void 0})),O_(this,"_handleMuteStream",((e,t,n)=>{if($v("BLOCK_LOCAL_CLIENT")&&Oy(e,this.channelName))return;Ey.debug("[".concat(this._clientId,"] receive mute message"),e,t,n);let r=this._users.find((t=>t.uid===e));if(!r)return void Ey.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(e));let i="audio"===t?r.hasAudio:r.hasVideo;if("audio"===t){r._trust_audio_mute_state_=!0;let t=r._audio_muted_;if(r._audio_muted_=n,r._audio_muted_===t)return;{let t=r._audio_muted_?"mute-audio":"unmute-audio";Ey.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(ZT.USER_INFO_UPDATED,e,t)}}else{r._trust_video_mute_state_=!0;let t=r._video_muted_;if(r._video_muted_=n,r._video_muted_===t)return;{let t=r._video_muted_?"mute-video":"unmute-video";Ey.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(ZT.USER_INFO_UPDATED,e,t)}}let o="audio"===t?r.hasAudio:r.hasVideo;if(i!==o){if(!i&&o)return("audio"===t?r._audioSSRC:r._videoSSRC)?(Ey.info("[".concat(this._clientId,"] remote user ").concat(e," published ").concat(t)),void this.safeEmit(ZT.USER_PUBLISHED,r,t)):void Ey.warning("[".concat(this._clientId,"] remote user ").concat(e," receive ").concat(t," unmute message  before add stream message, ").concat(t," SSRC doesn't exist yet."));"video"===t&&r._videoTrack&&!r._video_pre_subscribed&&r._videoTrack._destroy(),"audio"===t&&r._audioTrack,this._p2pChannel.muteRemote(r,t),Ey.info("[".concat(this._clientId,"] remote user ").concat(e," unpublished ").concat(t)),this.safeEmit(ZT.USER_UNPUBLISHED,r,t)}})),O_(this,"_handleP2PLost",(async e=>{Ey.debug("[".concat(this._clientId,"] receive p2p lost"),e),parseInt(e.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():Ey.warning("[".concat(this._clientId,"] P2PLost stream not found"),e)})),O_(this,"_handleTokenWillExpire",(()=>{Ey.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(ZT.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)})),O_(this,"_handleBeforeUnload",(e=>{"beforeunload"===e.type&&void 0!==e.returnValue&&""!==e.returnValue||(this.leave(),Ey.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))})),O_(this,"_handleUpdateNetworkQuality",(()=>{if("normal"===this._networkQualitySensitivity)return;if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.safeEmit(ZT.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});let e={downlinkNetworkQuality:0,uplinkNetworkQuality:0};e.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),e.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(ZT.NETWORK_QUALITY,e)})),O_(this,"_handleP2PAddAudioOrVideoStream",((e,t,n,r)=>{let i=this._users.find((e=>e.uid===t));if(!i)return void Ey.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));Ey.debug("[".concat(this._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),this.store.subscribe(i.uid,e,void 0,void 0,void 0,Date.now());let o="audio"===e?i.hasAudio:i.hasVideo;"audio"===e?i._trust_audio_stream_added_state_=!0:i._trust_video_stream_added_state_=!0,"audio"===e?(i._audio_added_=!0,void 0!==n&&(i._audioSSRC=n),void 0!==r&&(i._audioMid=r)):(i._video_added_=!0,void 0!==n&&(i._videoSSRC=n),void 0!==r&&(i._videoMid=r)),("audio"===e?i.hasAudio:i.hasVideo)&&!o&&(Ey.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published ").concat(e)),this.safeEmit(ZT.USER_PUBLISHED,i,e)),this._p2pChannel.hasPendingRemoteMedia(i,e)&&(Ey.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(i.uid," after reconnect.")),this._subscribe(i,e,!0).catch((e=>{Ey.error("[".concat(this._clientId,"] resubscribe error"),e.toString())})))})),this._config=e,this._clientId=Sv(5,"client-"),this.store=new ny(e.codec,e.audioCodec,e.mode,this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),Ey.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Wv," build: ").concat(zv,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{qT(e.clientRoleOptions),t=Object.assign({},e.clientRoleOptions)}catch(n){Ey.warning("[".concat(this._clientId,"] ").concat(n.toString()))}this._statsCollector=new YQ(this.store),this._statsCollector.onStatsException=(e,t,n)=>{Ey.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(e,", msg: ").concat(t,", uid: ").concat(n)),this.safeEmit(ZT.EXCEPTION,{code:e,msg:t,uid:n})},this._statsCollector.onUploadPublishDuration=(e,t,n,r)=>{let i=this._users.find((t=>t.uid===e));i&&vy.peerPublishStatus(this._sessionId,{subscribeElapse:r,audioPublishDuration:t,videoPublishDuration:n,peer:i._uintid})},this.store.useDataChannel=oL().supportDataChannel&&$v("SIGNAL_CHANNEL"),this.store.useP2P="p2p"===e.mode,this._gateway=new yb(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||kv,httpRetryConfig:e.httpRetryConfig||kv,forceWaitGatewayResponse:void 0===e.forceWaitGatewayResponse||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:t}),this._configDistribute=new sO,this.store.useP2P?(this._p2pChannel=new KQ(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new tH(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,r,i){let o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];Zv("JOIN_GATEWAY_USE_443PORT_ONLY",o),Zv("JOIN_GATEWAY_USE_DUAL_DOMAIN",a);let s=this._gateway.signal.websocket;return s instanceof $R&&(s.use443PortOnly=o,s.tryDoubleDomain=a),async function(e,t,n){FS.get(e)||FS.set(e,[]),xS.get(e)||xS.set(e,t),QS.get(e)||QS.set(e,0);let r=FS.get(e),i=xS.get(e);if(!r||!i)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(QS.get(e)===i){let e=MS();r.push(e),await e.promise}QS.set(e,QS.get(e)+1);for(var o=arguments.length,a=new Array(o>3?o-3:0),s=3;s<o;s++)a[s-3]=arguments[s];let A=await n(...a);return QS.set(e,QS.get(e)-1),QS.get(e)===i-1&&r.length>0&&(r[0].resolve(),r.shift()),0===QS.get(e)&&(FS.set(e,[]),xS.set(e,0),QS.set(e,0)),A}("client.join",$v("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,r,i)}async join(e,t,n,r,i){let o=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);let a="HTTPS"===(Qv||Qv||(Qv=(window.location.protocol.split(":")[0]||"").toUpperCase(),Qv)),s=Gv()?window.isSecureContext:"Browser Not Support";(!Gv()&&!a||!window.isSecureContext)&&Ey.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),"DISCONNECTED"===this.connectionState&&(this.store.avoidJoinStart=Math.round(Date.now()),Ey.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),vy.setAppId(e);try{if(!n&&null!==n)throw new HI(TT.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&OT(n,"token",1,2047),OT(e,"appid",1,2047),KI(t),r&&jI(r),i&&OT(i,"optionalInfo",1,2047)}catch(p){throw vy.reportApiInvoke(Tv(),{name:jT.JOIN,options:[e,t,n,r],states:{isHttps:a,isSecureContext:s},tag:GT.TRACER}).onError(p),p}let A=await bK({appId:e,cname:t,uid:r,stringUid:"string"==typeof r?r:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode}),c=(null===A||void 0===A?void 0:A.sid)||Tv(),l=vy.reportApiInvoke(c,{name:jT.JOIN,options:[e,t,n,r],states:{isHttps:a,isSecureContext:s},tag:GT.TRACER});if(Ey.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(o)),this._leaveMutex.isLocked&&(Ey.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),Ey.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,"DISCONNECTED"!==this.connectionState){let e=new HI(TT.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw l.onError(e),e}this._sessionId||(this._sessionId=c,this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";let d=Ij(Ij({},this._rtmConfig),{},{clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:"string"!=typeof r?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:i,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!A},void 0!==this._remoteDefaultVideoStreamType&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(d.setLocalAPVersion=this._setLocalAPVersion),"string"==typeof r&&(d.stringUid=r,this._uintUid?(d.uid=this._uintUid,this._uintUid=void 0):d.uid=0),"none"!==this._encryptionMode&&this._encryptionSecret){if(d.aesmode=this._encryptionMode,d.aespassword=await(async e=>{let t=function(e){let t=window.atob("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),n=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}(),n=await window.crypto.subtle.importKey("spki",t,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),r=FT(e),i=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},n,r);return function(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}(new Uint8Array(i))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new HI(TT.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(d.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&("aes-128-gcm2"===this._encryptionMode||"aes-256-gcm2"===this._encryptionMode))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){let e=new TextEncoder,t=$v("USE_PURE_ENCRYPTION_MASTER_KEY")?e.encode(d.appId+this._encryptionSecret+this._encryptionSecret):e.encode(d.appId+d.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(e,t,n){let r=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits","deriveKey"]),i="aes-128-gcm2"===e?128:256,o=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:1e3,hash:"SHA-256",salt:n},r,i+96);return new Uint8Array(o).subarray(i/8)}(this._encryptionMode,t,pv(this._encryptionSalt)),this._encryptDataStreamKey=await async function(e,t,n){let r=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits","deriveKey"]),i="aes-128-gcm2"===e?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:1e3,hash:"SHA-256",salt:n},r,{name:"AES-GCM",length:i},!0,["encrypt","decrypt"])}(this._encryptionMode,t,pv(this._encryptionSalt))}else s?Ey.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):Ey.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,Ey.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:d.stringUid,preload:d.preload});let u=this._sessionId;setTimeout((()=>{"CONNECTING"===this.connectionState&&u===this._sessionId&&vy.joinChannelTimeout(this._sessionId,5)}),5e3);try{var h;let r,i=d.cloudProxyServer;if(yr(h=["proxy3","proxy4","proxy5"]).call(h,i)){let e=$v("PROXY_SERVER_TYPE3");Array.isArray(e)?d.proxyServer=e[0]:d.proxyServer=e}if(vy.setProxyServer(d.proxyServer),Ey.setProxyServer(d.proxyServer),this.store.requestAPStart(),A){if(Ey.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(d.stringUid?", ".concat(d.stringUid," => ").concat(A.intUid):""," ")),d.stringUid&&!d.uid&&(d.uid=A.intUid),r={gatewayInfo:A.ap.gatewayInfo},$v("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&"auto"===d.turnServer.mode)if(0===A.ap.proxyInfo.addresses.length)Ey.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{let e=(await db(A.ap.proxyInfo,A.ap.gatewayInfo.uid)).map((e=>({turnServerURL:e.address,tcpport:e.tcpport||Iy.tcpport,udpport:e.udpport||Iy.udpport,username:e.username||Iy.username,password:e.password||Iy.password,forceturn:!1,security:!0})));d.turnServer={mode:"manual",servers:e}}DK(A,d.stringUid)}else{if(d.stringUid&&!d.uid){let e;[e,r]=await wu.all([$b(d.stringUid,d,this._axiosCancelSource.token,this._config.httpRetryConfig||kv,this.store),Zb(d,this._axiosCancelSource.token,this._config.httpRetryConfig||kv,0,this.store)]),Ey.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(d.stringUid," => ").concat(e)),d.uid=e,r.gatewayInfo.uid=e,r.gatewayInfo.res.uid=e}else r=await Zb(d,this._axiosCancelSource.token,this._config.httpRetryConfig||kv,0,this.store);if(!this._joinAndNotLeaveYet)throw new HI(TT.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout((()=>{this._configDistribute.startGetConfigDistribute(d,this._axiosCancelSource.token),this._configDistribute.on(fR.UPDATE_BITRATE_LIMIT,(e=>{this._p2pChannel.updateBitrateLimit(e)}))}),0),this._key=n||e;let o=r.gatewayInfo,a=d.uid?d.uid:o.uid;this._joinInfo=Ij(Ij({},d),{},{cid:o.cid,uid:a,vid:o.vid,apResponse:o.res,uni_lbs_ip:o.uni_lbs_ip,gatewayAddrs:o.gatewayAddrs}),this.store.intUid=a;let s=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new HI(TT.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));l.onSuccess(s),this._appId=e,this._channelName=d.cname,this._uid=s,this.store.uid=s,setTimeout((()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(ZS()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()}),0);let c=d.stringUid?"string uid: ".concat(d.stringUid,",uid: ").concat(d.uid):"uid: ".concat(this._uid);return Ey.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(c)),setTimeout((()=>{Ey.startUpload()}),5e3),this.store.joinEnd(),yr(by).call(by,this)||by.push(this),"disabled"===this._cloudProxyServerMode&&oL().supportWebCrypto&&$v("ENABLE_PRELOAD")&&BK(this._joinInfo),s}catch(p){let e=Array.isArray(p)?p[0]:p;throw e&&e.code===TT.OPERATION_ABORTED?Ey.warning("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),e):Ey.error("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),e),e.code!==TT.OPERATION_ABORTED&&this._numberOfJoinCount===o&&(this._gateway.state="DISCONNECTED",this._reset()),l.onError(e),e}}_joinGateway(){if(!this._joinInfo||!this._key)throw new HI(TT.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!$v("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then((e=>e)).catch((e=>{if(e.code===TT.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,JT.FALLBACK),e;if(e.code===TT.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,JT.FALLBACK),e;throw e})).then((e=>{if(e instanceof HI){if(e.code===TT.INIT_WEBSOCKET_TIMEOUT){if(Ey.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new HI(TT.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";let e=$v("PROXY_SERVER_TYPE3");if(Array.isArray(e))if(this._joinInfo.apUrl){let t=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),n=t.slice(t.length-2).join(".");e.forEach((e=>{this._joinInfo&&yr(e).call(e,n)&&(this._joinInfo.proxyServer=e)})),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=e[0])}else this._joinInfo.proxyServer=e[0];else this._joinInfo.proxyServer=e;let t=$v("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return t&&t[1]&&"443"!==t[1]&&Ey.setProxyServer(this._joinInfo.proxyServer),"443"!==$v("STATS_COLLECTOR_PORT").toString()&&vy.setProxyServer(this._joinInfo.proxyServer),vy.reportApiInvoke(this._sessionId,{name:jT.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:GT.TRACER}).onSuccess(),this.safeEmit(ZT.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),$v("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach((e=>{"forceturn"in e&&(e.forceturn=!0)})),this._gateway.join(this._joinInfo,this._key)}if(Ey.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new HI(TT.INVALID_OPERATION);return vy.reportApiInvoke(this._sessionId,{name:jT.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:GT.TRACER}).onSuccess(),this._joinGateway()}return e})).then((e=>e))}async leave(){Ey.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(ZS()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){let t=by.indexOf(e);-1!==t&&by.splice(t,1)}(this),this._statsCollector.stopUpdateStats();let e=await this._leaveMutex.lock();if("DISCONNECTED"===this.connectionState)return Ey.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave("CONNECTED"!==this.connectionState),Ey.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!Array.isArray(e)){if(!(e instanceof zL))return this._publishDataChannel(e);e=[e]}if(0===e.length)throw new HI(TT.INVALID_PARAMS,"param list is empty");let n=e;if("audience"===this._gateway.role)throw new HI(TT.INVALID_OPERATION,"audience can not publish stream");for(let o of n){if(!(o instanceof zL))throw new HI(TT.INVALID_PARAMS,"parameter is not local track");if(!o._enabled&&t)throw new HI(TT.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(o.getTrackId()))}Ey.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map((e=>"".concat(e.getTrackId()," ")))));let r=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach((e=>{let t=this._configDistribute.getBitrateLimit();e instanceof uF&&t&&e.setBitrateLimit(t.uplink)}));try{await this._publishHighStream(n),Ey.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map((e=>"".concat(e.getTrackId()," ")))))}catch(i){throw Ey.error("[".concat(this._clientId,"] publish error"),i.toString()),i}finally{r()}}async _publishDataChannel(e){RT(e.id,"id",0,65535,!0),yT(e.ordered,"ordered"),OT(e.metadata,"metadata",0,512),Ey.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));let t=await this._publishMutex.lock();try{if(-1!==this._p2pChannel.getAllDataChannels().findIndex((t=>t.id===e.id)))throw new HI(TT.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||void 0===this._uid)throw new HI(TT.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new HI(TT.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&$v("FORCE_TURN")&&!$v("TURN_ENABLE_TCP")&&!$v("TURN_ENABLE_UDP"))throw new HI(TT.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");let t=new LF(e);if(await this._p2pChannel.publishDataChannel([t]),!this._p2pChannel.isP2PDisconnected()){if("number"!=typeof t._originDataChannelId)throw Ey.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new HI(TT.CREATE_DATACHANNEL_ERROR);try{let n={streamId:e.id,ordered:e.ordered,maxRetransmits:$v("DATASTREAM_MAX_RETRANSMITS"),metadata:e.metadata,channelId:t._originDataChannelId};await this._gateway.publishDataChannel(this._uid,n,!0),await t._waitTillOpen()}catch(n){if(n.code!==TT.DISCONNECT_P2P)throw n}}return Ey.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(t.id)),t}catch(r){throw Ey.error("[".concat(this._clientId,"] publish datachannels error"),r.toString()),r}finally{t()}}async unpublish(e){if(!this._joinInfo||void 0===this._uid)throw new HI(TT.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof zL))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);Ey.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map((e=>"".concat(e.getTrackId()," ")))," "));let n=await this._publishMutex.lock();try{if(this._p2pChannel instanceof KQ){let e=await this._p2pChannel.unpublish(t);e&&await this._gateway.sendExtensionMessage(PR.UNPUBLISH,{unpubMsg:e},!0)}else{let e=await this._p2pChannel.unpublish(t);e&&await this._gateway.unpublish(e,this._uid),Ey.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map((e=>"".concat(e.getTrackId())))))}}catch(r){throw Ey.error("[".concat(this._clientId,"] unpublish error"),r.toString()),r}finally{n&&n()}}async _unpublishDataChannel(e){void 0!==e&&0!==e.length||(e=this._p2pChannel.getAllDataChannels()),Ey.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map((e=>"".concat(e.id," ")))," "));let t=await this._publishMutex.lock();try{let t=await this._p2pChannel.unpublishDataChannel(e);t&&await this._gateway.unpublishDataChannel(t),Ey.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map((e=>"".concat(e.id)))))}catch(n){throw Ey.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof vQ)){let t=this.remoteUsers.find((t=>t.uid===e));if(!t)throw new HI(TT.INVALID_REMOTE_USER,"user is not in the channel");e=t}return"datachannel"===t?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(IT(t,"mediaType",["audio","video"]),this._p2pChannel instanceof KQ)throw new HI(TT.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new HI(TT.INVALID_OPERATION,"can't presub when not join");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new HI(TT.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));let n=t===mR.AUDIO,r=t===mR.VIDEO,i=await this._subscribeMutex.lock();try{let{ssrcId:i,ortc:o,rtxSsrcId:a,cname:s,uint_id:A}=await this._gateway.presubscribe(e,t,!0);if(null==i)throw new HI(TT.UNEXPECTED_RESPONSE,"no ssrc id");let c=this._users.find((t=>t.uid===e));c||(c=new vQ(e,A||e),c._is_pre_created=!0,this._users.push(c)),s&&(c._cname=s),c._uintid||(c._uintid=A||e),n&&(c._audioSSRC=i,c._audio_pre_subscribed=!0,o&&(c._audioOrtc=o)),r&&(c._videoSSRC=i,c._video_pre_subscribed=!0,o&&(c._videoOrtc=o),null!=a&&(c._rtxSsrcId=a)),Ey.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(i)),await this._p2pChannel.subscribe(c,t,i,a,o);let l=n?c._audioTrack:c._videoTrack;if(!l)throw new HI(TT.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0),r&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0),l}catch(o){throw Ey.error("[".concat(this._clientId,"] presub user ").concat(e," error"),o),o}finally{i()}}async _subscribeDataChannel(e,t){var n;if(RT(t,"channelId",0,65535,!0),!this._joinInfo)throw new HI(TT.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new HI(TT.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find((t=>t===e)))throw Ey.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new HI(TT.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&0===e._dataChannels.length)throw Ey.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new HI(TT.INVALID_REMOTE_USER,"user is not published");let r=null===(n=e._dataChannels)||void 0===n?void 0:n.find((e=>e.id===t));if(!r)throw Ey.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new HI(TT.REMOTE_USER_IS_NOT_PUBLISHED);let i=await this._subscribeMutex.lock();Ey.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{let t=await this._p2pChannel.subscribeDataChannel(e,[r]);if(t&&yr(t).call(t,r.id))try{var o;if("number"!=typeof r._originDataChannelId)throw Ey.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new HI(TT.CREATE_DATACHANNEL_ERROR);let t={id:r.id,datachannelId:r._originDataChannelId,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:null!==(o=r.metadata)&&void 0!==o?o:""};await this._gateway.subscribeDataChannel(e.uid,t,!0),await r._waitTillOpen()}catch(a){if((null===a||void 0===a?void 0:a.code)!==TT.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[r]),a;await this._p2pChannel.unsubscribeDataChannel(e,[r]),this._p2pChannel.setPendingRemoteDataChannel(e,r.id)}return Ey.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),r}finally{i()}}async _p2pSubscribe(e,t,n){if(IT(t,"mediaType",["audio","video"]),!this._joinInfo)throw new HI(TT.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new HI(TT.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find((t=>t===e))){let t=new HI(TT.INVALID_REMOTE_USER,"user is not in the channel");throw Ey.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),t}if(!e.hasAudio&&!e.hasVideo){let t=new HI(TT.INVALID_REMOTE_USER,"user is not published");throw Ey.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),t}if(!n&&("audio"===t&&!e.hasAudio||"video"===t&&!e.hasVideo)){let n=new HI(TT.REMOTE_USER_IS_NOT_PUBLISHED);throw Ey.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),n}let r=await this._subscribeMutex.lock();Ey.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let n="audio"===t?e._audioSSRC:e._videoSSRC,r="audio"===t?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this._p2pChannel instanceof KQ&&await this._p2pChannel.subscribe(e,t,n,r)}catch(i){throw i}Ey.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch((e=>{Ey.warning("[".concat(this._clientId,"] auto set fallback failed"),e)}));let n="audio"===t?e._audioTrack:e._videoTrack;if(!n)throw new HI(TT.UNEXPECTED_ERROR,"can not find remote track in user object");return n}catch(o){throw Ey.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),o),o}finally{r()}}async _subscribe(e,t,n){if(this._p2pChannel instanceof KQ)return this._p2pSubscribe(e,t);if(IT(t,"mediaType",["audio","video"]),!this._joinInfo)throw new HI(TT.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new HI(TT.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find((t=>t===e))){let t=new HI(TT.INVALID_REMOTE_USER,"user is not in the channel");throw Ey.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),t}if(!e.hasAudio&&!e.hasVideo){let t=new HI(TT.INVALID_REMOTE_USER,"user is not published");throw Ey.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),t}if(!(n||("audio"!==t||e.hasAudio&&void 0!==e._audioSSRC)&&("video"!==t||e.hasVideo&&void 0!==e._videoSSRC))){let n=new HI(TT.REMOTE_USER_IS_NOT_PUBLISHED);throw Ey.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),n}let r="audio"===t?e._audioSSRC:e._videoSSRC,i="audio"===t?e._audioOrtc:e._videoOrtc,o="video"===t?e._rtxSsrcId:void 0,a={stream_type:"audio"===t?mR.AUDIO:mR.VIDEO,ssrcId:r},s=await this._subscribeMutex.lock();Ey.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let n="audio"===t?e._audioSSRC:e._videoSSRC;void 0!==n&&n!==r&&(r=n,i="audio"===t?e._audioOrtc:e._videoOrtc,o="video"===t?e._rtxSsrcId:void 0,a={stream_type:"audio"===t?mR.AUDIO:mR.VIDEO,ssrcId:r}),KF.markSubscribeStart(this.store.clientId,r),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,r,o,i);try{await this._gateway.subscribe(e.uid,a,!0)}catch(A){if((null===A||void 0===A?void 0:A.code)!==TT.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),A;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(c){throw this._p2pChannel.reportSubscribeEvent(!1,null===c||void 0===c?void 0:c.code,e,t),c}Ey.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch((e=>{Ey.warning("[".concat(this._clientId,"] auto set fallback failed"),e)}));let n="audio"===t?e._audioTrack:e._videoTrack;if(!n)throw new HI(TT.UNEXPECTED_ERROR,"can not find remote track in user object");return n}catch(l){throw Ey.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),l),l}finally{s()}}async massSubscribe(e){if(BT(e,"subscribeList"),!this._joinInfo)throw new HI(TT.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new HI(TT.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));let t=Date.now(),n=new Map,r=await this._subscribeMutex.lock();Ey.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null===t||void 0===t?void 0:t.uid,", mediaType: ").concat(n)})).join("; ")));let i=(e=[...e]).map((e=>{let{user:t,mediaType:n}=e;return{user:t,mediaType:n}})),o=await this._p2pChannel.globalLock();try{var a;for(let t=e.length-1;t>=0;t--){let r=e[t],{user:o,mediaType:a}=r;if(IT(a,"mediaType",["audio","video"]),!o){let e=new HI(TT.INVALID_PARAMS,"user property does not exist in subscribeList item");throw Ey.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),e}if(!this._users.find((e=>e===o))){let n=new HI(TT.INVALID_REMOTE_USER,"user is not in the channel");Ey.error("[".concat(this._clientId,"] can not massSubscribe ").concat(o.uid,", this user is not in the channel")),i[t].error=n,e.splice(t,1);continue}if("audio"===a&&(!o.hasAudio||void 0===o._audioSSRC)||"video"===a&&(!o.hasVideo||void 0===o._videoSSRC)){let n=new HI(TT.REMOTE_USER_IS_NOT_PUBLISHED);Ey.error("[".concat(this._clientId,"] can not subscribe ").concat(o.uid," with mediaType ").concat(a,", remote user is not published")),i[t].error=n,e.splice(t,1);continue}let s=cR.Video|cR.LwoVideo,A=n.get(o);if(A){if("video"===a?A&s:A&cR.Audio){e.splice(t,1),Ey.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(o.uid,", mediaType:").concat(a," twice"));continue}n.set(o,A|("video"===a?s:cR.Audio))}else n.set(o,"video"===a?s:cR.Audio)}for(let t=e.length-1;t>=0;t--){let r=e[t],{user:i,mediaType:o}=r,a=cR.Video|cR.LwoVideo;if(this._p2pChannel.hasRemoteMedia(i,o)){await this._p2pChannel.unmuteRemoteNoLock(i,o);let r=n.get(i);n.set(i,"video"===o?r^a:r^cR.Audio),e.splice(t,1)}}this.store.massSubscribe(e.map((e=>({userId:e.user.uid,type:e.mediaType}))),t);let r=Hr(a=Array.from(n.entries())).call(a,((e,t)=>{let[n,r]=t;if(0===r)return e;let i={stream_id:n.uid,stream_type:r};return r&cR.Audio&&(i.audio_ssrc=n._audioSSRC),r&cR.Video&&(i.video_ssrc=n._videoSSRC),e.push(i),e}),[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map((e=>{let{user:t,mediaType:n}=e;return{user:t,mediaType:n,ssrcId:n===mR.VIDEO?t._videoSSRC:t._audioSSRC,rtxSsrcId:n===mR.VIDEO?t._rtxSsrcId:void 0}})));let n=new Map;if(r.length>0){let e=await this._gateway.subscribeAll(r,!0);((null===e||void 0===e?void 0:e.users)||[]).forEach((e=>{let{stream_id:t,video_error_code:r,audio_error_code:i,error_code:o}=e;(r||i||o)&&n.set(t,{video_error_code:r,audio_error_code:i,error_code:o})}))}if(Array.from(n.entries()).length>0){let e=[];Array.from(n.entries()).forEach((t=>{let[n,r]=t,i=this.remoteUsers.find((e=>e.uid===n));if(i){let t;r.error_code||r.video_error_code&&r.audio_error_code?t=void 0:r.video_error_code?t=mR.VIDEO:r.audio_error_code&&(t=mR.AUDIO),e.push({user:i,mediaType:t})}})),e.length>0&&await this._p2pChannel.massUnsubscribeNoLock(e)}for(let e of i){let t=n.get(e.user.uid);if(t){let n=t.error_code||"audio"===e.mediaType&&t.audio_error_code||"video"===e.mediaType&&t.video_error_code;if(n){let t=QR(n);Ey.error("user:".concat(e.user.uid," mediaType:").concat(e.mediaType," has massSubscribe error ").concat(t.desc)),e.error=new HI(TT.SUBSCRIBE_FAILED,"code ".concat(n,": ").concat(t.desc))}}e.error||("video"===e.mediaType?e.track=e.user.videoTrack:e.track=e.user.audioTrack)}return this.store.massSubscribe(i.filter((e=>!e.error)).map((e=>({userId:e.user.uid,type:e.mediaType}))),void 0,Date.now()),i.forEach((e=>{var n;vy.subscribe(this.store.sessionId,{succ:!!e.error,ec:(null===(n=e.error)||void 0===n?void 0:n.code)||null,video:e.mediaType===mR.VIDEO,audio:e.mediaType===mR.AUDIO,peerid:e.user.uid,subscribeRequestid:e.mediaType===mR.VIDEO?e.user._videoSSRC:e.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t)},!0)})),Ey.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null===t||void 0===t?void 0:t.uid,", mediaType: ").concat(n)})).join("; "))),i}catch(s){throw await this._p2pChannel.massUnsubscribeNoLock(e),s}}finally{o(),r()}}async unsubscribe(e,t,n){if(!(e instanceof vQ)){let t=this.remoteUsers.find((t=>t.uid===e));if(!t)throw new HI(TT.INVALID_REMOTE_USER,"user is not in the channel");e=t}if(t||this.store.useP2P){if("datachannel"===t)return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&IT(t,"mediaType",["audio","video"]),!this._joinInfo)throw new HI(TT.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find((t=>t===e))){let t=new HI(TT.INVALID_REMOTE_USER,"user is not in the channel");throw Ey.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),t}Ey.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));let r=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof KQ)await this._p2pChannel.unsubscribe(e,t);else{let n=await this._p2pChannel.unsubscribe(e,t);n&&await this._gateway.unsubscribe(n,e.uid),t&&"audio"!==t||(e._audio_pre_subscribed=!1),t&&"video"!==t||(e._video_pre_subscribed=!1),e._is_pre_created&&sv(this._users,e),Ey.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(i){if(i.code===TT.DISCONNECT_P2P)return void Ey.warning("disconnecting p2p, abort unsubscribe request.");throw Ey.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),i.toString()),i}finally{r()}}async _unsubscribeDataChannel(e,t){if(t&&RT(t,"id",0,65535,!0),!this._joinInfo)throw new HI(TT.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find((t=>t===e))){let t=new HI(TT.INVALID_REMOTE_USER,"user is not in the channel");throw Ey.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),t}let n;if("number"==typeof t){let r=e._dataChannels.find((e=>e.id===t));r&&(n=[r])}else n=e._dataChannels;if(void 0===n){let n=new HI(TT.REMOTE_USER_IS_NOT_PUBLISHED);throw Ey.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),n}Ey.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(n.map((e=>e.id))));try{let t=await this._p2pChannel.unsubscribeDataChannel(e,n);t&&await this._gateway.unsubscribeDataChannel(t,e.uid),Ey.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(t))}catch(r){if(r.code===TT.DISCONNECT_P2P)return void Ey.warning("disconnecting p2p, abort unsubscribe request.");throw Ey.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),r.toString()),r}}async massUnsubscribe(e){if(BT(e,"unsubscribeList"),!this._joinInfo)throw new HI(TT.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");Ey.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null===t||void 0===t?void 0:t.uid,", mediaType: ").concat(n,";")})).join())),e=[...e];let t=new Map;for(let r=e.length-1;r>=0;r--){let{user:n,mediaType:i}=e[r];if(!n){let e=new HI(TT.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw Ey.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),e}if(IT(i,"mediaType",["video","audio",void 0]),!this._users.find((e=>e===n))){Ey.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(n.uid,", user is not in the channel")),e.splice(r,1);continue}let o=cR.Video|cR.LwoVideo;if(t.has(n)){let a,s=t.get(n);switch(i){case"video":a=s&o;break;case"audio":a=s&cR.Audio;break;default:a=s&(cR.Audio|o)}if(a){Ey.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(n.uid,",mediaType:").concat(i," twice.")),e.splice(r,1);continue}i?"audio"===i?t.set(n,s|cR.Audio):"video"===i&&t.set(n,s|o):t.set(n,s|cR.Audio|o)}else i?"audio"===i?t.set(n,cR.Audio):"video"===i&&t.set(n,o):t.set(n,cR.Audio|o)}try{let t=await this._p2pChannel.massUnsubscribe(e);t&&await this._gateway.massUnsubscribe(t),Ey.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null===t||void 0===t?void 0:t.uid,", mediaType: ").concat(n,";")})).join()))}catch(n){if(n.code===TT.DISCONNECT_P2P)return void Ey.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw Ey.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(e){(function(e){if(!e)throw new vT(TT.INVALID_PARAMS);NT(e.width)||bT(e.width,"streamParameter.width"),NT(e.height)||bT(e.height,"streamParameter.height"),NT(e.framerate)||bT(e.framerate,"streamParameter.framerate"),NT(e.bitrate)||RT(e.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&Ey.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),Ey.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));let t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,wR.LocalVideoLowTrack)}async enableDualStream(){if(!oL().supportDualStream)throw vy.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new HI(TT.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new HI(TT.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(th){throw vy.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),th}this._isDualStreamEnabled=!0,vy.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),Ey.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new HI(TT.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(wR.LocalVideoLowTrack))try{let e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(th){throw vy.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),th}this._isDualStreamEnabled=!1,vy.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),Ey.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(IT(e,"role",["audience","host"]),t&&qT(t),"rtc"===this.mode||"p2p"===this.mode)throw Ey.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new HI(TT.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&"host"===e)throw new HI(TT.INVALID_OPERATION,"host mode can not set audience latency level");if("audience"===e&&this._p2pChannel.hasLocalMedia())throw new HI(TT.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(e,t),this._config.role=e,Ey.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}getRemoteInboundOffset(){var e;let t=null===(e=this._p2pChannel.getStats())||void 0===e?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;let n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return"visible"===document.visibilityState&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(OT(e,"proxyServer"),!t){if("DISCONNECTED"!==this.connectionState)throw new HI(TT.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new HI(TT.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,vy.setProxyServer(this._proxyServer),Ey.setProxyServer(this._proxyServer),Ey.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if("DISCONNECTED"!==this.connectionState)throw new HI(TT.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new HI(TT.INVALID_OPERATION,"You have already set the proxy")}if(XT(e))return this._turnServer={servers:e,mode:"original-manual"},void Ey.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map((e=>e.urls)).join(","),"."));e.forEach((e=>zT(e))),this._turnServer={servers:e,mode:"manual"},Ey.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if("DISCONNECTED"!==this.connectionState)throw new HI(TT.INVALID_OPERATION,"you should set license before join channel");if(OT(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new HI(TT.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,Ey.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if("DISCONNECTED"!==this.connectionState)throw new HI(TT.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new HI(TT.INVALID_OPERATION,"You have already set the proxy");let t,n=[3,4,5];switch(void 0===e&&(e=3),e){case 1:case 2:throw new HI(TT.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:t="proxy3";break;case 4:t="proxy4";break;case 5:t="proxy5";break;default:throw new HI(TT.INVALID_PARAMS,"proxy server mode must be ".concat(n.join("|")))}this._cloudProxyServerMode=t,this.store.cloudProxyServerMode=t,Ey.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if("DISCONNECTED"!==this.connectionState)throw new HI(TT.INVALID_OPERATION,"Stop proxy server after leave channel");vy.setProxyServer(),Ey.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",Ey.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new HI(TT.INVALID_PARAMS,"accessPoints is required.");BT(e.accessPoints.serverList,"accessPoints.serverList"),OT(e.accessPoints.domain,"accessPoints.domain");let t=(e,t)=>{RT(e,t,0,65535,!0)},n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new HI(TT.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");$v("CLOSE_AFB_FOR_LOCAL_AP")&&(Zv("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Zv("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));let r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=e.accessPoints.domain,o=e.accessPoints.serverList.map((e=>r.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(i):e)),a=o.map((e=>"".concat(e,":").concat(n)));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Zv("WEBCS_DOMAIN",a),Zv("WEBCS_DOMAIN_BACKUP_LIST",a),Zv("GATEWAY_DOMAINS",[i]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(BT(e.report.hostname,"report.hostname"),Zv("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Zv("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Zv("EVENT_REPORT_DOMAIN",o[0]),Zv("EVENT_REPORT_BACKUP_DOMAIN",o[1]||o[0]));let s=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),s=e.report.port),Zv("STATS_COLLECTOR_PORT",s),e.report?Zv("ENABLE_EVENT_REPORT",!0):Zv("ENABLE_EVENT_REPORT",!1);let A="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(BT(e.log.hostname,"log.hostname"),A=e.log.hostname[0]):A=o[0];let c=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),c=e.log.port),Zv("LOG_UPLOAD_SERVER","".concat(A,":").concat(c));let l=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(BT(e.cds.hostname,"cds.hostname"),l=e.cds.hostname):l=o;let d=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),d=e.cds.port),Zv("CDS_AP",l.map((e=>"".concat(e,":").concat(d)))),e.cds?Zv("ENABLE_CONFIG_DISTRIBUTE",!0):Zv("ENABLE_CONFIG_DISTRIBUTE",!1),Ey.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(BT(e,"serverList"),OT(t,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new HI(TT.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");let n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map((e=>n.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(t):e)),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Zv("WEBCS_DOMAIN",e),Zv("WEBCS_DOMAIN_BACKUP_LIST",e),Zv("GATEWAY_DOMAINS",[t]),Zv("EVENT_REPORT_DOMAIN",e[0]),Zv("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Zv("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),Ey.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(IT(e,"streamType",[0,1]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw Ey.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else Ey.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){IT(t,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout((()=>{let t=this._users.find((t=>t.uid===e));t&&t.videoTrack&&t.videoTrack.updateMediaStreamTrackResolution()}),2e3)}catch(n){throw Ey.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}Ey.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){IT(t,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(n){throw Ey.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}Ey.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,r){IT(e,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"]),OT(t,"secret");let i=["aes-128-gcm2","aes-256-gcm2"];if(yr(i).call(i,e)){if(!n||!(n instanceof Uint8Array&&32===n.length))throw new HI(TT.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new HI(TT.INVALID_PARAMS,"current encrypt mode does not need salt");if(r){if(yT(r,"encryptDataStream"),!yr(i).call(i,e))throw new HI(TT.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(t)||Ey.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=fv(n))}async renewToken(e){if(OT(e,"token",1,2047),!this._key||!this._joinInfo)throw new HI(TT.INVALID_OPERATION,"renewToken should not be called before user join");let t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);let n=await this._renewTokenMutex.lock();try{if($v("USE_NEW_TOKEN")){Ey.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));let t=await iO(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||kv);Ey.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:t})}else Ey.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});Ey.debug("[".concat(this._clientId,"] renewToken success"))}catch(r){throw this._key=t,this._joinInfo.token=t,Ey.error("[".concat(this._clientId,"] renewToken failed"),r.toString()),r}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?Ey.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval((()=>{let e=this._p2pChannel.getAudioLevels();this.safeEmit(ZT.VOLUME_INDICATOR,e)}),$v("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){let e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if("h264"!==this.codec)throw new HI(TT.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new HI(TT.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new HI(TT.LIVE_STREAMING_TASK_CONFLICT);let n=t?GI.TRANSCODE:GI.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(GI.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){let t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter((t=>t&&t.hasUrl(e)));if(!t.length)throw new HI(TT.INVALID_PARAMS,"can not find live streaming url to stop");await wu.all(t.map((t=>t&&t.stopLiveStreamingTask(e))))}async addInjectStreamUrl(e,t){if(!this._joinInfo)throw new HI(TT.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");let n=this._createLiveStreamingClient(GI.INJECT);n.setInjectStreamConfig(t,0),await n.startLiveStreamingTask(e,GI.INJECT)}async removeInjectStreamUrl(){var e;let t=this._createLiveStreamingClient(GI.INJECT),n=Array.from(RI(e=t.streamingTasks).call(e)).find((e=>e.mode===GI.INJECT));if(!this._joinInfo||!n)throw new HI(TT.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await t.stopLiveStreamingTask(n.url)}async startChannelMediaRelay(e){tV(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){tV(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._joinInfo)throw new HI(TT.INVALID_OPERATION,"can not send data stream, not joined");if(("string"==typeof e||e instanceof Uint8Array)&&(e={payload:e}),"string"==typeof e.payload){let t=new TextEncoder;e.payload=t.encode(e.payload)}let r=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&yr(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(r=!0,e.payload=await async function(e,t,n){var r;let i=Hr(r=Array.from(n)).call(r,((e,t)=>e+t),0),o={serverTs:0,seq:oy++,length:n.length,checkSum:i},a=new Uint8Array(Ov(i,2)),s=new ArrayBuffer(iy),A=new DataView(s);A.setUint32(0,o.serverTs),A.setUint16(4,o.seq),A.setUint16(6,o.length),A.setUint16(8,o.checkSum);let c=16-n.length%16;n=gv(n,new Uint8Array(c));let l=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:e,tagLength:128,additionalData:a},t,n);return gv(new Uint8Array(s),new Uint8Array(l))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new HI(TT.INVALID_PARAMS,r?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(MI.DATA_STREAM,{payload:fv(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-sK},!n)}sendMetadata(e){if(!this._joinInfo)throw new HI(TT.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new HI(TT.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(MI.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:fv(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(my),!this._joinInfo)throw new HI(TT.INVALID_OPERATION,"can not send custom report, not joined");await vy.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){IT(t.spatialLayer,"spatialLayer",[0,1,2,3]),IT(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(n){throw Ey.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(e){let{apRTM:t=!1,rtmFlag:n}=e;if(yT(t,"apRTM"),RT(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,Ey.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState)&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(Ey.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=LS.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&NK(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach((e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach((e=>e._close())),e._dataChannels.length=0)})),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Uv("client-publish"),this._subscribeMutex=new Uv("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var n;let r=e||Tv();e?Ey.debug("[".concat(this._clientId,"] new Session ").concat(r)):Ey.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r));let i=e?"":this._sessionId||"";this._sessionId=r,this.store.sessionId=r;let o={lts:(new Date).getTime(),mode:this.mode,buildFormat:1,stringUid:(null===t||void 0===t?void 0:t.stringUid)||(null===(n=this._joinInfo)||void 0===n?void 0:n.stringUid),channelProfile:"live"===this.mode?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i,clientRole:"audience"===this.role?2:1};t?vy.sessionInit(this._sessionId,Ij({cname:t.channel,appid:t.appId,preload:t.preload},o)):this._joinInfo?vy.sessionInit(this._sessionId,Ij({cname:this._joinInfo.cname,appid:this._joinInfo.appId,preload:!!this._joinInfo.recoverPreloadCache},o)):this._gateway.joinInfo&&vy.sessionInit(this._sessionId,Ij({cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId},o)),this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)}async _publishHighStream(e){if(!this._joinInfo||void 0===this._uid)throw new HI(TT.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new HI(TT.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&$v("FORCE_TURN")&&!$v("TURN_ENABLE_TCP")&&!$v("TURN_ENABLE_UDP"))throw new HI(TT.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");Ey.debug("[".concat(this._clientId,"] publish high stream"));try{let i=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this._p2pChannel instanceof KQ){let e=(await i.next()).value;if(e){try{await this._gateway.sendExtensionMessage(PR.PUBLISH,e,!0)}catch(n){throw i.throw(n),n}await i.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{let n=(await i.next()).value;if(n){var t;let e;try{e=await this._gateway.publish(this._uid,n,!0)}catch(r){if(r.code!==TT.DISCONNECT_P2P)throw i.throw(r),r}await i.next((null===(t=e)||void 0===t?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(let t of e)t instanceof uF&&t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig),!t.muted&&t.enabled||await this._p2pChannel.muteLocalTrack(t)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,null===i||void 0===i?void 0:i.code,e),(null===i||void 0===i?void 0:i.code)===TT.WS_ABORT)return;throw i}}async _publishLowStream(){if(!this._joinInfo||void 0===this._uid)throw new HI(TT.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new HI(TT.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));Ey.debug("[".concat(this._clientId,"] publish low stream"));let e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{let e=await this._p2pChannel.publishLowStream(this._lowStreamParameter),r=(await e.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(n){if(n.code!==TT.DISCONNECT_P2P)throw e.throw(n),n}e.next((null===(t=i)||void 0===t?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(r){if(this._p2pChannel.reportPublishEvent(!1,null===r||void 0===r?void 0:r.code,void 0,!0),(null===r||void 0===r?void 0:r.code)===TT.WS_ABORT)return;throw r}}_createLiveStreamingClient(e){if(!this._joinInfo||!this._appId)return new HI(TT.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();let t=()=>new $Q(this._joinInfo,this._config.websocketRetryConfig||kv,this._config.httpRetryConfig||kv),n=e=>{e.onLiveStreamError=(e,t)=>{vy.reportApiInvoke(this._sessionId,{name:jT.ON_LIVE_STREAM_ERROR,options:[e,t],tag:GT.TRACER}).onSuccess(),this.safeEmit(ZT.LIVE_STREAMING_ERROR,e,t)},e.onLiveStreamWarning=(e,t)=>{vy.reportApiInvoke(this._sessionId,{name:jT.ON_LIVE_STREAM_WARNING,options:[e,t],tag:GT.TRACER}).onSuccess(),this.safeEmit(ZT.LIVE_STREAMING_WARNING,e,t)},e.on($I.REQUEST_WORKER_MANAGER_LIST,((e,t,n)=>{if(!this._joinInfo)return n(new HI(TT.INVALID_OPERATION,"can not find join info to get worker manager"));rO(e,this._joinInfo,this._axiosCancelSource.token,kv).then(t).catch(n)}))};switch(e){case GI.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=t(),n(this._liveRawStreamingClient)),this._liveRawStreamingClient;case GI.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=t(),n(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case GI.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=t(),this._injectStreamingClient.on($I.REQUEST_WORKER_MANAGER_LIST,((e,t,n)=>{if(!this._joinInfo)return n(new HI(TT.INVALID_OPERATION,"can not find join info to get worker manager"));rO(e,this._joinInfo,this._axiosCancelSource.token,kv).then(t).catch(n)})),this._injectStreamingClient.onInjectStatusChange=(e,t,n)=>{this.safeEmit(ZT.INJECT_STREAM_STATUS,e,t,n)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new HI(TT.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){let{sendResolutionWidth:e,sendResolutionHeight:t}=this.getLocalVideoStats(),n={width:e,height:t};this._channelMediaRelayClient=new rV(this._joinInfo,this._clientId,this._config.websocketRetryConfig||kv,this._config.httpRetryConfig||kv,n),this._channelMediaRelayClient.on("state",(e=>{e===iR.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit(ZT.CHANNEL_MEDIA_RELAY_STATE,e)})),this._channelMediaRelayClient.on("event",(e=>{this.safeEmit(ZT.CHANNEL_MEDIA_RELAY_EVENT,e)})),this._statsCollector.onStatsChanged=(e,t)=>{var n;"resolution"===e&&(null===(n=this._channelMediaRelayClient)||void 0===n||n.setVideoProfile(t))}}return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){let{added:n,deleted:r}=e,i=[];Array.isArray(n)&&n.length>0&&n.forEach((e=>{let{uid:n,stream_id:r,ordered:o,max_retrans_times:a,metadata:s}=e,A=this._users.find((e=>e._uintid===n));if(A){if(Ey.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(n)),yr(i).call(i,A)||i.push(A),A._uintid||(A._uintid=n),-1===A._dataChannels.findIndex((t=>t.id===e.stream_id))){let e={id:r,ordered:!!o,maxRetransmits:a,metadata:s},n=new UF(e);A._dataChannels.push(n),Ey.info("[".concat(this._clientId,"] remote user ").concat(A.uid," published datachannel")),t||this.safeEmit(ZT.USER_PUBLISHED,A,"datachannel",e)}this._p2pChannel.hasPendingRemoteDataChannel(A,e.stream_id)&&(Ey.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(A.uid," after reconnect.")),this._subscribeDataChannel(A,e.stream_id).catch((e=>{Ey.error("[".concat(this._clientId,"] resubscribe datachannel error"),e.toString())})))}else Ey.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"))})),t&&(this.safeEmit(ZT.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r)&&r.length>0&&r.forEach((e=>{let{uid:t,stream_id:n}=e,r=this._users.find((e=>e._uintid===t));if(!r)return void Ey.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));let i=r._dataChannels.find((t=>t.id===e.stream_id));i&&(Ey.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(t)),this._p2pChannel.unsubscribeDataChannel(r,[i]).then((e=>{if(r._dataChannels=r._dataChannels.filter((e=>e!==i)),e)return this._gateway.unsubscribeDataChannel(e,r.uid)})),Ey.info("[".concat(this._clientId,"] remote user ").concat(t," unpublished datachannel ,id:").concat(i.id)),this.safeEmit(ZT.USER_UNPUBLISHED,r,"datachannel",i._config))}))}_handleRemoveDataChannels(e){let t=this._users.find((t=>t.uid===e.uid));if(t){if(void 0!==t._dataChannels&&t._dataChannels.length>0){Ey.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));let n=()=>{Ey.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach((e=>{this.safeEmit(ZT.USER_UNPUBLISHED,t,"datachannel",e._config)}))};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then((e=>{if(e)return this._gateway.unsubscribeDataChannel(e,t.uid)})),n()}}else Ey.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(sR.DISCONNECT_P2P,(async()=>{await this._p2pChannel.disconnectForReconnect()})),this._gateway.on(sR.CONNECTION_STATE_CHANGE,((e,t,n)=>{var r;if(n===JT.FALLBACK)return;let i=()=>{this.safeEmit(ZT.CONNECTION_STATE_CHANGE,e,t,n)};if(vy.reportApiInvoke(this._sessionId||(null===(r=this._gateway.joinInfo)||void 0===r?void 0:r.sid)||null,{name:jT.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:GT.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),Ey.info("[".concat(this._clientId,"] connection state change: ").concat(t," -> ").concat(e)),"DISCONNECTED"===e)return this._reset(),void i();if("RECONNECTING"===e)this._users.forEach((e=>{e._trust_in_room_=!1,e._trust_audio_enabled_state_=!1,e._trust_video_enabled_state_=!1,e._trust_audio_mute_state_=!1,e._trust_video_mute_state_=!1,e._trust_audio_stream_added_state_=!1,e._trust_video_stream_added_state_=!1,e._is_pre_created||(e._audio_pre_subscribed||(e._audioSSRC=void 0,e._audioOrtc=void 0),e._video_pre_subscribed||(e._videoSSRC=void 0,e._videoOrtc=void 0,e._rtxSsrcId=void 0),e._cname=void 0)})),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if("CONNECTED"===e){var o;this._streamFallbackTypeCacheMap.forEach(((e,t)=>{this._gateway.setStreamFallbackOption(t,e).catch((e=>{Ey.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),e)}))})),this._remoteStreamTypeCacheMap.forEach(((e,t)=>{this._gateway.setRemoteVideoStreamType(t,e).catch((e=>{Ey.warning("[".concat(this._clientId,"] auto set remote stream type failed"),e)}))})),void 0!==this._remoteDefaultVideoStreamType&&void 0===(null===(o=this._joinInfo)||void 0===o?void 0:o.defaultVideoStream)&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then((()=>{Ey.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))})).catch((e=>{Ey.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(e))})),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout((()=>{"CONNECTED"===this.connectionState&&(this._userOfflineTimeout=void 0,this._users.filter((e=>!e._trust_in_room_)).forEach((e=>{Ey.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(e.uid)),this._handleUserOffline({uid:e.uid})})))}),3e3),this._streamRemovedTimeout=window.setTimeout((()=>{"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,this._users.forEach((e=>{e._trust_audio_mute_state_||(Ey.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,mR.AUDIO,!1)),e._trust_video_mute_state_||(Ey.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,mR.VIDEO,!1)),e._trust_audio_enabled_state_||(Ey.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(e.uid)),this._handleSetStreamLocalEnable("audio",e.uid,!0)),e._trust_video_enabled_state_||(Ey.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(e.uid)),this._handleSetStreamLocalEnable("video",e.uid,!0)),e._trust_video_stream_added_state_||(Ey.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(e.uid)),this._handleResetAddStream(e,"video")),e._trust_audio_stream_added_state_||(Ey.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(e.uid)),this._handleResetAddStream(e,"audio")),e._video_added_||e._audio_added_||(Ey.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(e.uid)),this._handleRemoveStream({uid:e.uid,uint_id:e._uintid}))})))}),1e3))}i()})),this._gateway.on(sR.REQUEST_NEW_GATEWAY_LIST,(async(e,t)=>{if(!this._joinInfo)return t(new HI(TT.UNEXPECTED_ERROR,"can not recover, no join info"));try{let t;this._joinInfo.recoverPreloadCache?(t=this._joinInfo.recoverPreloadCache.ap,DK(this._joinInfo.recoverPreloadCache),this._joinInfo.recoverPreloadCache=void 0):t=await qb(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||kv,this.store),this._joinInfo&&(this._joinInfo.apResponse=t.gatewayInfo.res,this._joinInfo.gatewayAddrs=t.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=t.gatewayInfo.uni_lbs_ip);let n=[];t.gatewayInfo.gatewayAddrs.forEach((e=>{let{address:t}=e,[r,i]=t.split(":");this._joinInfo&&this._joinInfo.proxyServer?n.push({proxy:this._joinInfo.proxyServer,host:r,port:i}):n.push({host:r,port:i})})),e(n)}catch(n){t(n)}})),this._gateway.on(sR.NETWORK_QUALITY,(e=>{"normal"===this._networkQualitySensitivity&&this.safeEmit(ZT.NETWORK_QUALITY,e)})),this._gateway.on(sR.STREAM_TYPE_CHANGE,((e,t)=>{this.safeEmit(ZT.STREAM_TYPE_CHANGED,e,t),vy.reportApiInvoke(this._sessionId,{name:jT.STREAM_TYPE_CHANGE,options:[e,t],tag:GT.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))})),this._gateway.on(sR.IS_P2P_DISCONNECTED,(e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)})),this._gateway.on(sR.NEED_RENEW_SESSION,(async e=>{if("recover"===e&&this._joinInfo){let e=await bK(Ij(Ij({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));this._joinInfo.recoverPreloadCache=e,this._startSession(null===e||void 0===e?void 0:e.sid)}else this._startSession()})),this._gateway.on(sR.REQUEST_P2P_CONNECTION_PARAMS,(async(e,t,n)=>{try{t(await this._p2pChannel.startP2PConnection(e))}catch(r){n(r)}})),this._gateway.on(sR.JOIN_RESPONSE,((e,t)=>{if(this.store.useP2P)return;let{dtlsParameters:n,iceParameters:r,candidates:i,rtpCapabilities:o,setup:a,cname:s}=xx(e.ortc,t);this._p2pChannel.connect(r,n,i,o,a,s)})),this._gateway.on(sR.REQUEST_DC_CONNECTION_PARAMS,(e=>{e(this._p2pChannel.getEstablishParams())})),this._gateway.on(sR.RESET_SIGNAL,(e=>{this._p2pChannel.resetConnection(e),this._handleGatewaySignalEvents()})),this._gateway.on(sR.DATACHANNEL_FAILBACK,(()=>{this._joinGateway()})),this._gateway.on(sR.DATACHANNEL_PRECONNECT,(async(e,t,n,r)=>{var i,o,a,s,A,c;await this._p2pChannel.startP2PConnection({turnServer:null===(i=this._joinInfo)||void 0===i?void 0:i.turnServer},!0);let l=function(e,t){let n;return t&&t.ip&&"number"==typeof t.port?(n=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],Ey.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(n.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),Ey.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))):n=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],n}(e,t);return this._p2pChannel.preConnect({iceUfrag:"".concat(null===(o=this._joinInfo)||void 0===o?void 0:o.apResponse.cid,"_").concat(null===(a=this._joinInfo)||void 0===a?void 0:a.apResponse.cert),icePwd:"".concat(null===(s=this._joinInfo)||void 0===s?void 0:s.apResponse.cid,"_").concat(null===(A=this._joinInfo)||void 0===A?void 0:A.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(c=$v("FINGERPRINT"))&&void 0!==c?c:e.fingerprint}]},l,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(n).catch(r)}))}_handleGatewaySignalEvents(){this._gateway.signal.on(xI.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(xI.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(xI.ON_ADD_AUDIO_STREAM,(e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc))),this._gateway.signal.on(xI.ON_ADD_VIDEO_STREAM,(e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId))),this._gateway.signal.on(xI.ON_REMOTE_DATASTREAM_UPDATE,(e=>{this._handleUpdateDataChannel(e)})),this._gateway.signal.on(xI.ON_REMOTE_FULL_DATASTREAM_INFO,(e=>{this._handleUpdateDataChannel({added:e.datastreams,deleted:[]},!0)})),this._gateway.signal.on(xI.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(xI.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(xI.MUTE_AUDIO,(e=>this._handleMuteStream(e.uid,mR.AUDIO,!0))),this._gateway.signal.on(xI.UNMUTE_AUDIO,(e=>this._handleMuteStream(e.uid,mR.AUDIO,!1))),this._gateway.signal.on(xI.MUTE_VIDEO,(e=>this._handleMuteStream(e.uid,mR.VIDEO,!0))),this._gateway.signal.on(xI.UNMUTE_VIDEO,(e=>this._handleMuteStream(e.uid,mR.VIDEO,!1))),this._gateway.signal.on(xI.RECEIVE_METADATA,(e=>{let t=pv(e.metadata);this.safeEmit(ZT.RECEIVE_METADATA,e.uid,t)})),this._gateway.signal.on(xI.ON_DATA_STREAM,(async e=>{var t;if(!e)return;let n=pv(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&yr(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<iy)throw new HI(TT.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(iy));n=await async function(e,t,n){let r=n.subarray(0,iy),i=r.slice(8,iy),o=(i[0]<<8)+i[1],a=(r[6]<<8)+r[7],s=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:e,tagLength:128,additionalData:new Uint8Array(Ov(o,2))},t,n.subarray(iy));return new Uint8Array(s).subarray(0,a)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let r=0;if(e.ordered||e.syncWithAudio){let t=this._p2pChannel.getStats(),n=this.remoteUsers.find((t=>t.uid===e.uid)),i=null===t||void 0===t?void 0:t.audioRecv.find((e=>e.ssrc===(null===n||void 0===n?void 0:n._audioSSRC)));r=null===i||void 0===i?void 0:i.jitterBufferMs}null==r&&(r=0),hK(Ij(Ij({},e),{},{payload:n}),r,{id:this._clientId,onStreamMessage:"function"==typeof this.onStreamMessage?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})})),this._gateway.signal.on(xI.ON_CRYPT_ERROR,(()=>{hv((()=>{Ey.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(ZT.CRYPT_ERROR)}),this._sessionId)})),this._gateway.signal.on(xI.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(xI.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{Ey.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,JT.TOKEN_EXPIRE),this.safeEmit(ZT.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()})),this._gateway.signal.on(xI.ON_STREAM_FALLBACK_UPDATE,(e=>{Ey.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(ZT.STREAM_FALLBACK,e.stream_id,1===e.stream_type?"fallback":"recover")})),this._gateway.signal.on(xI.ON_PUBLISH_STREAM,(e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),Ey.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))})),this._gateway.signal.on(xI.ENABLE_LOCAL_VIDEO,(e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)})),this._gateway.signal.on(xI.DISABLE_LOCAL_VIDEO,(e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)})),this._gateway.signal.on(kI.REQUEST_TIMEOUT,((e,t)=>{if(this._joinInfo)switch(e){case MI.PUBLISH:{if(!t)return;let e=t.ortc;if(e){var n,r;let i=e.some((e=>{let{stream_type:t}=e;return t===aR.Audio})),o=e.some((e=>{let{stream_type:t}=e;return t!==aR.Audio})),a=e.some((e=>{let{stream_type:t}=e;return t===aR.Screen||t===aR.ScreenLow}));"offer"===t.state&&vy.publish(this._joinInfo.sid,{eventElapse:KF.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:TT.TIMEOUT,audio:i,video:o,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:a,audioName:i?null===(n=e.find((e=>{let{stream_type:t}=e;return t===aR.Audio})))||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId.toString():void 0,videoName:o?null===(r=e.find((e=>{let{stream_type:t}=e;return t!==aR.Audio})))||void 0===r||null===(r=r.ssrcs[0])||void 0===r?void 0:r.ssrcId.toString():void 0})}break}case MI.SUBSCRIBE:t&&vy.subscribe(this._joinInfo.sid,{succ:!1,ec:TT.TIMEOUT,audio:t.stream_type===mR.AUDIO,video:t.stream_type===mR.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:KF.measureFromSubscribeStart(this.store.clientId,t.ssrcId)})}})),this._gateway.signal.on(xI.ON_P2P_OK,(e=>{this.uid,this._uid})),this._gateway.signal.on(xI.ON_PUBLISHED_USER_LIST,(e=>{if(null==e||!e.users)return;$v("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter((e=>!Oy(e.string_id||e.stream_id,this.channelName))));let t=[],n=[];for(let r of e.users){let e=this._users.find((e=>e._uintid===r.stream_id));e?e._trust_in_room_=!0:(e=new vQ(r.string_id||r.stream_id,r.stream_id),this._users.push(e),0===this.getListeners(ZT.PUBLISHED_USER_LIST).length&&(Ey.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(ZT.USER_JOINED,e)));let i=cR.Audio&r.stream_type,o=(cR.Video|cR.LwoVideo)&r.stream_type,a=0!=(65280&r.stream_type),s=i&&e.hasAudio,A=o&&e.hasVideo;o&&(e._trust_video_stream_added_state_=!0,e._video_added_=!0,e._videoSSRC=r.video_ssrc,e._rtxSsrcId=r.video_rtx),i&&(e._trust_audio_stream_added_state_=!0,e._audio_added_=!0,e._audioSSRC=r.audio_ssrc),i&&!s&&0===this.getListeners(ZT.PUBLISHED_USER_LIST).length&&(Ey.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published audio")),this.safeEmit(ZT.USER_PUBLISHED,e,"audio")),o&&!A&&0===this.getListeners(ZT.PUBLISHED_USER_LIST).length&&(Ey.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published video")),this.safeEmit(ZT.USER_PUBLISHED,e,"video")),(i&&!s||o&&!A||a)&&t.push(e),o&&this._p2pChannel.hasPendingRemoteMedia(e,"video")&&n.push({user:e,mediaType:"video"}),i&&this._p2pChannel.hasPendingRemoteMedia(e,"audio")&&n.push({user:e,mediaType:"audio"})}n.length>0&&(Ey.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map((e=>"user: ".concat(e.user.uid,", mediaType: ").concat(e.mediaType))).join("; ")," ")),this.massSubscribe(n).catch((e=>{Ey.error("[".concat(this._clientId,"] mass resubscribe error"),e.toString())}))),this.getListeners(ZT.PUBLISHED_USER_LIST).length>0?$v("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(Ey.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map((e=>e.uid)).join(", "))),this.safeEmit(ZT.PUBLISHED_USER_LIST,t)):Ey.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map((e=>e.uid)).join(", ")))})),this._gateway.signal.on(xI.ON_RTP_CAPABILITY_CHANGE,(e=>{let{video_codec:t}=e;this._p2pChannel instanceof tH&&this._p2pChannel.updateRemoteRTPCapabilities(t.map((e=>e.toLowerCase())).filter((e=>{var t;return yr(t=Object.keys(ry)).call(t,e)})))}))}_handleP2PEvents(){this._gateway.signal.on(xI.ON_USER_OFFLINE,(()=>{this._p2pChannel.disconnectForReconnect()})),this._gateway.signal.on(PR.PUBLISH,((e,t,n)=>{let{uid:r}=e;e.forEach((e=>{let{kind:i,ssrcs:o,mid:a,isMuted:s}=e;this._handleP2PAddAudioOrVideoStream(i,r,o[0].ssrcId,a);let A=this._users.find((e=>e.uid===r));return A&&this._p2pChannel instanceof KQ?this._p2pChannel.mockSubscribe(A,i,o[0].ssrcId,a).then((()=>{t()})).catch(n):t(),this._handleMuteStream(r,i,!!s)}))})),this._gateway.signal.on(PR.CALL,(async(e,t,n)=>{if(this._p2pChannel instanceof KQ)try{var r;t(await this._p2pChannel.startP2P({turnServer:null===(r=this._joinInfo)||void 0===r?void 0:r.turnServer},e))}catch(i){n(i)}})),this._gateway.signal.on(kI.P2P_CONNECTION,(async e=>{this._p2pChannel instanceof KQ&&await this._p2pChannel.p2pConnect(e)})),this._gateway.signal.on(PR.UNPUBLISH,(async(e,t,n)=>{if(this._p2pChannel instanceof KQ){let{unpubMsg:i,uid:o}=e,a=this._users.find((e=>e.uid===o));if(!a)return Ey.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(o)),void t();try{i.forEach((async e=>{let{stream_type:t}=e,n=t===aR.Audio?mR.AUDIO:mR.VIDEO;await this._p2pChannel.unsubscribe(a,n),this._handleMuteStream(o,n,!0)})),t()}catch(r){n(r)}}})),this._gateway.signal.on(PR.CONTROL,(async(e,t)=>{let{action:n}=e;switch(n){case LR.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,mR.VIDEO,!0);break;case LR.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,mR.AUDIO,!0);break;case LR.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,mR.VIDEO,!1);break;case LR.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,mR.AUDIO,!1)}})),this._gateway.signal.on(PR.RESTART_ICE,(async(e,t,n)=>{if(this._p2pChannel instanceof KQ)try{let{direction:n,iceParameter:r}=e;n!==QI.SEND_ONLY||r?t(await this._p2pChannel.restartICE(n,r)):(this._p2pChannel.handleDisconnect(n),t())}catch(r){n(r)}})),this._gateway.signal.on(PR.CANDIDATE,(e=>{if(this._p2pChannel instanceof KQ){let{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}})),this._p2pChannel.on(TR.RequestP2PRestartICE,(async(e,t,n)=>{try{let{direction:n}=e;t(await this._gateway.sendExtensionMessage(PR.RESTART_ICE,e,n===QI.SEND_ONLY))}catch(r){n(r)}})),this._p2pChannel.on(TR.LocalCandidate,(e=>{this._gateway.sendExtensionMessage(PR.CANDIDATE,JSON.stringify(e),!0)})),this._p2pChannel.on(TR.RequestP2PMuteLocal,(async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(PR.CONTROL,e,!0),t()}catch(r){n(r)}})),this._p2pChannel.on(TR.RequestP2PUnmuteRemote,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===TT.DISCONNECT_P2P?t():n(r)}else t()})),this._p2pChannel.on(TR.RequestP2PMuteRemote,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===TT.DISCONNECT_P2P?t():n(r)}else t()})),this._p2pChannel.on(TR.StateChange,((e,t)=>{t===SR.Connected&&this._p2pChannel.republish()}))}_handleP2PChannelEvents(){this._p2pChannel.on(TR.RequestMuteLocal,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===TT.DISCONNECT_P2P?t():n(r)}else t()})),this._p2pChannel.on(TR.RequestUnmuteLocal,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===TT.DISCONNECT_P2P?t():n(r)}else t()})),this._p2pChannel.on(TR.RequestRePublish,((e,t,n)=>{this.publish(e,!1).then(t).catch(n)})),this._p2pChannel.on(TR.RequestRePublishDataChannel,((e,t,n)=>{wu.all(e.map((async e=>{await this._p2pChannel.publishDataChannel([e]);let t={streamId:e.id,ordered:e.ordered,maxRetransmits:e.maxRetransmits,metadata:e.metadata,channelId:e._originDataChannelId};try{await this._gateway.publishDataChannel(this._uid,t,!0)}catch(n){if(n.code!==TT.DISCONNECT_P2P)throw n}}))).then(t).catch(n)})),this._p2pChannel.on(TR.RequestReSubscribe,(async(e,t,n)=>{try{for(let{user:t,kind:n}of e)n===mR.VIDEO?await this.subscribe(t,"video"):await this.subscribe(t,"audio");t()}catch(r){n(r)}})),this._p2pChannel.on(TR.RequestUpload,((e,t)=>{this._gateway.upload(e,t)})),this._p2pChannel.on(TR.RequestUploadStats,(e=>{this._gateway.uploadWRTCStats(e)})),this._p2pChannel.on(TR.MediaReconnectStart,(e=>{this.safeEmit(ZT.MEDIA_RECONNECT_START,e)})),this._p2pChannel.on(TR.MediaReconnectEnd,(e=>{this.safeEmit(ZT.MEDIA_RECONNECT_END,e)})),this._p2pChannel.on(TR.NeedSignalRTT,(e=>{e(this._gateway.getSignalRTT())})),this._p2pChannel.on(TR.RequestRestartICE,(async e=>{if(this._p2pChannel instanceof KQ)return;let t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;let r,i=n.value;try{r=await this._gateway.restartICE({iceParameters:i})}catch(a){return void t.throw(a)}let{iceParameters:o}=function(e){let t=e.iceParameters;return{iceParameters:{iceUfrag:t.iceUfrag,icePwd:t.icePwd}}}(r);await t.next({remoteIceParameters:o})})),this._p2pChannel.on(TR.RequestReconnect,(async()=>{this._gateway.reconnect()})),this._p2pChannel.on(TR.RequestReconnectPC,(async()=>{var e;let{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:null===(e=this._joinInfo)||void 0===e?void 0:e.turnServer}),{gatewayEstablishParams:i,gatewayAddress:o}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:r}),{dtlsParameters:a,iceParameters:s,candidates:A,rtpCapabilities:c,setup:l,cname:d}=xx(i,o);await this._p2pChannel.connect(s,a,A,c,l,d),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()})),this._p2pChannel.on(TR.RequestUnpublishForReconnectPC,(async(e,t,n)=>{this._joinInfo&&void 0!==this._uid?(await this._gateway.unpublish(e,this._uid),t()):n()})),this._p2pChannel.on(TR.P2PLost,(()=>{this.safeEmit(ZT.P2P_LOST,this.store.uid)})),this._p2pChannel.on(TR.UpdateVideoEncoder,(e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)})),this._p2pChannel.on(TR.ConnectionTypeChange,(e=>{this.safeEmit(ZT.IS_USING_CLOUD_PROXY,e)})),this._p2pChannel.on(TR.RequestLowStreamParameter,(e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})})),this._p2pChannel.on(TR.QueryClientConnectionState,(e=>{e(this.connectionState)}))}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if("CONNECTED"!==this.connectionState||!this._joinInfo)throw new HI(TT.INVALID_OPERATION,"[".concat(this._clientId,"] Client did not join channel"));if(this._inspect)throw new HI(TT.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));if(!e)throw new HI(TT.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig is necessary"));if(!e.inspectType||!Array.isArray(e.inspectType))throw new HI(TT.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{let t=[...new Set(e.inspectType)];t.forEach((e=>{var t;if(!yr(t=["supervise","moderation"]).call(t,e))throw new HI(TT.INVALID_PARAMS,"[".concat(this._clientId,"] ").concat(e," is not a valid inspect type."))})),e.inspectType=t}if(e&&e.extraInfo&&e.extraInfo.length>1024)throw new HI(TT.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{let t=new BH(e);this._inspect=t,this.handleVideoInspectEvents(this._inspect),await t.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},kv)}catch(t){throw Array.isArray(t)?t[0]:t}}async disableContentInspect(){if(!this._inspect)throw new HI(TT.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(th){throw Array.isArray(th)?th[0]:th}}async setImageModeration(e,t){if(yT(e,"enabled"),e){if(!t)throw new HI(TT.INVALID_PARAMS,"[".concat(this._clientId,"] config is necessary"));if(RT(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new HI(TT.INVALID_PARAMS,"[".concat(this._clientId,"] config.extraInfo length cannot exceed 1024 bytes"));if(t&&t.vendor&&t.vendor.length>1024)throw new HI(TT.INVALID_PARAMS,"[".concat(this._clientId,"] config.vendor length cannot exceed 1024 bytes"));if("CONNECTED"!==this.connectionState||!this._joinInfo)throw new HI(TT.INVALID_OPERATION,"[".concat(this._clientId,'] can not enable image moderation, not joined"'));try{if(this._moderation)return void this._moderation.updateConfig(t);let e=new iK(t);this._moderation=e,this.handleImageModerationEvents(this._moderation),await e.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},kv)}catch(n){throw Array.isArray(n)?n[0]:n}}else{if(!this._moderation)throw new HI(TT.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(n){throw Array.isArray(n)?n[0]:n}}}setP2PTransport(e){if(IT(e,"transport",["default","auto","relay","sd-rtn"]),"p2p"!==this.mode)throw new HI(TT.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,Ey.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}handleImageModerationEvents(e){e.on(NR.CONNECTION_STATE_CHANGE,((t,n)=>{if(this.safeEmit(ZT.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===BR.CONNECTED){if("CONNECTED"!==this.connectionState)throw this.setImageModeration(!1),new HI(TT.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}})),e.on(NR.CLIENT_LOCAL_VIDEO_TRACK,(e=>{e(this.localTracks.filter((e=>"video"===e.trackMediaType))[0])}))}handleVideoInspectEvents(e){e.on(IR.CONNECTION_STATE_CHANGE,((t,n)=>{if(this.safeEmit(ZT.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===vR.CONNECTED){if("CONNECTED"!==this.connectionState)return void this.safeEmit(ZT.CONTENT_INSPECT_ERROR,new HI(TT.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}})),e.on(IR.INSPECT_RESULT,((e,t)=>{var n;if((null===t||void 0===t?void 0:t.code)===TT.INVALID_OPERATION&&"DISCONNECTED"===this.connectionState)return Ey.debug("Stop inspect content because that has left channel"),null==this||null===(n=this._inspect)||void 0===n||n.close(),void(this._inspect=void 0);this.safeEmit(ZT.CONTENT_INSPECT_RESULT,e,t)})),e.on(IR.CLIENT_LOCAL_VIDEO_TRACK,(e=>{e(this.localTracks.filter((e=>"video"===e.trackMediaType))[0])}))}getJoinChannelServiceRecords(){return Ey.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){yT(e,"enabled"),Zv("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},_I(vj.prototype,"leave",[kK],Object.getOwnPropertyDescriptor(vj.prototype,"leave"),vj.prototype),_I(vj.prototype,"publish",[MK],Object.getOwnPropertyDescriptor(vj.prototype,"publish"),vj.prototype),_I(vj.prototype,"unpublish",[FK],Object.getOwnPropertyDescriptor(vj.prototype,"unpublish"),vj.prototype),_I(vj.prototype,"subscribe",[xK],Object.getOwnPropertyDescriptor(vj.prototype,"subscribe"),vj.prototype),_I(vj.prototype,"presubscribe",[QK],Object.getOwnPropertyDescriptor(vj.prototype,"presubscribe"),vj.prototype),_I(vj.prototype,"massSubscribe",[VK],Object.getOwnPropertyDescriptor(vj.prototype,"massSubscribe"),vj.prototype),_I(vj.prototype,"unsubscribe",[HK],Object.getOwnPropertyDescriptor(vj.prototype,"unsubscribe"),vj.prototype),_I(vj.prototype,"massUnsubscribe",[KK],Object.getOwnPropertyDescriptor(vj.prototype,"massUnsubscribe"),vj.prototype),_I(vj.prototype,"setLowStreamParameter",[jK],Object.getOwnPropertyDescriptor(vj.prototype,"setLowStreamParameter"),vj.prototype),_I(vj.prototype,"enableDualStream",[GK],Object.getOwnPropertyDescriptor(vj.prototype,"enableDualStream"),vj.prototype),_I(vj.prototype,"disableDualStream",[WK],Object.getOwnPropertyDescriptor(vj.prototype,"disableDualStream"),vj.prototype),_I(vj.prototype,"setClientRole",[YK],Object.getOwnPropertyDescriptor(vj.prototype,"setClientRole"),vj.prototype),_I(vj.prototype,"setProxyServer",[JK],Object.getOwnPropertyDescriptor(vj.prototype,"setProxyServer"),vj.prototype),_I(vj.prototype,"setTurnServer",[XK],Object.getOwnPropertyDescriptor(vj.prototype,"setTurnServer"),vj.prototype),_I(vj.prototype,"setLicense",[zK],Object.getOwnPropertyDescriptor(vj.prototype,"setLicense"),vj.prototype),_I(vj.prototype,"startProxyServer",[qK],Object.getOwnPropertyDescriptor(vj.prototype,"startProxyServer"),vj.prototype),_I(vj.prototype,"stopProxyServer",[ZK],Object.getOwnPropertyDescriptor(vj.prototype,"stopProxyServer"),vj.prototype),_I(vj.prototype,"setLocalAccessPointsV2",[$K],Object.getOwnPropertyDescriptor(vj.prototype,"setLocalAccessPointsV2"),vj.prototype),_I(vj.prototype,"setLocalAccessPoints",[ej],Object.getOwnPropertyDescriptor(vj.prototype,"setLocalAccessPoints"),vj.prototype),_I(vj.prototype,"setRemoteDefaultVideoStreamType",[tj],Object.getOwnPropertyDescriptor(vj.prototype,"setRemoteDefaultVideoStreamType"),vj.prototype),_I(vj.prototype,"setRemoteVideoStreamType",[nj],Object.getOwnPropertyDescriptor(vj.prototype,"setRemoteVideoStreamType"),vj.prototype),_I(vj.prototype,"setStreamFallbackOption",[rj],Object.getOwnPropertyDescriptor(vj.prototype,"setStreamFallbackOption"),vj.prototype),_I(vj.prototype,"setEncryptionConfig",[ij],Object.getOwnPropertyDescriptor(vj.prototype,"setEncryptionConfig"),vj.prototype),_I(vj.prototype,"renewToken",[oj],Object.getOwnPropertyDescriptor(vj.prototype,"renewToken"),vj.prototype),_I(vj.prototype,"enableAudioVolumeIndicator",[aj],Object.getOwnPropertyDescriptor(vj.prototype,"enableAudioVolumeIndicator"),vj.prototype),_I(vj.prototype,"startLiveStreaming",[sj],Object.getOwnPropertyDescriptor(vj.prototype,"startLiveStreaming"),vj.prototype),_I(vj.prototype,"setLiveTranscoding",[Aj],Object.getOwnPropertyDescriptor(vj.prototype,"setLiveTranscoding"),vj.prototype),_I(vj.prototype,"stopLiveStreaming",[cj],Object.getOwnPropertyDescriptor(vj.prototype,"stopLiveStreaming"),vj.prototype),_I(vj.prototype,"addInjectStreamUrl",[lj],Object.getOwnPropertyDescriptor(vj.prototype,"addInjectStreamUrl"),vj.prototype),_I(vj.prototype,"removeInjectStreamUrl",[dj],Object.getOwnPropertyDescriptor(vj.prototype,"removeInjectStreamUrl"),vj.prototype),_I(vj.prototype,"startChannelMediaRelay",[uj],Object.getOwnPropertyDescriptor(vj.prototype,"startChannelMediaRelay"),vj.prototype),_I(vj.prototype,"updateChannelMediaRelay",[hj],Object.getOwnPropertyDescriptor(vj.prototype,"updateChannelMediaRelay"),vj.prototype),_I(vj.prototype,"stopChannelMediaRelay",[pj],Object.getOwnPropertyDescriptor(vj.prototype,"stopChannelMediaRelay"),vj.prototype),_I(vj.prototype,"sendCustomReportMessage",[fj],Object.getOwnPropertyDescriptor(vj.prototype,"sendCustomReportMessage"),vj.prototype),_I(vj.prototype,"pickSVCLayer",[Ej],Object.getOwnPropertyDescriptor(vj.prototype,"pickSVCLayer"),vj.prototype),_I(vj.prototype,"setRTMConfig",[gj],Object.getOwnPropertyDescriptor(vj.prototype,"setRTMConfig"),vj.prototype),_I(vj.prototype,"enableContentInspect",[mj],Object.getOwnPropertyDescriptor(vj.prototype,"enableContentInspect"),vj.prototype),_I(vj.prototype,"disableContentInspect",[_j],Object.getOwnPropertyDescriptor(vj.prototype,"disableContentInspect"),vj.prototype),_I(vj.prototype,"setImageModeration",[Cj],Object.getOwnPropertyDescriptor(vj.prototype,"setImageModeration"),vj.prototype),_I(vj.prototype,"setP2PTransport",[wj],Object.getOwnPropertyDescriptor(vj.prototype,"setP2PTransport"),vj.prototype),_I(vj.prototype,"getJoinChannelServiceRecords",[Sj],Object.getOwnPropertyDescriptor(vj.prototype,"getJoinChannelServiceRecords"),vj.prototype),_I(vj.prototype,"setPublishAudioFilterEnabled",[Tj],Object.getOwnPropertyDescriptor(vj.prototype,"setPublishAudioFilterEnabled"),vj.prototype),vj);class bj{constructor(e,t){O_(this,"id",0),O_(this,"element",void 0),O_(this,"peerPair",void 0),O_(this,"context",void 0),O_(this,"audioPlayerElement",void 0),O_(this,"audioTrack",void 0),bj.count+=1,this.id=bj.count,this.element=e,this.context=t}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{let t=document.createElement("audio");t.srcObject=new MediaStream([e.track]),t.play(),this.audioPlayerElement=t}}async switchSdp(){if(!this.peerPair)return;let e=async(e,t)=>{let n="offer"===t?await e.createOffer():await e.createAnswer();return await e.setLocalDescription(n),"complete"===e.iceGatheringState?e.localDescription:new wu((t=>{e.onicegatheringstatechange=()=>{"complete"===e.iceGatheringState&&t(e.localDescription)}}))},t=async(e,t)=>await e.setRemoteDescription(t);try{let n=await e(this.peerPair[0],"offer");await t(this.peerPair[1],n);let r=await e(this.peerPair[1],"answer");await t(this.peerPair[0],r)}catch(n){throw new HI(TT.LOCAL_AEC_ERROR,n.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let t;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),t=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(t)}catch(r){throw new HI(TT.LOCAL_AEC_ERROR,r.toString()).print()}if(!t)throw new HI(TT.LOCAL_AEC_ERROR,"no dest node when local aec").print();let n=t.stream.getAudioTracks()[0];return this.audioTrack=n,n}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();let e=this.element,t=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(t),await this.switchSdp()}close(){Ey.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach((e=>{e.close()})),this.peerPair=void 0,this.audioPlayerElement=void 0}}var Oj,Bj;O_(bj,"count",0);let Nj=window.AudioContext||window.webkitAudioContext,Dj=new(Oj=Ty({report:vy}),_I((Bj=class{constructor(){O_(this,"units",[]),O_(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return Ey.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Nj);let t=this.units.find((t=>t&&t.getElement()===e));return t||(t=new bj(e,this.context),this.units.push(t)),t.startEchoCancellation(),Ey.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return WS().name!==HS.SAFARI}}).prototype,"processExternalMediaAEC",[Oj],Object.getOwnPropertyDescriptor(Bj.prototype,"processExternalMediaAEC"),Bj.prototype),Bj);function Pj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Uj(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pj(Object(n),!0).forEach((function(t){O_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pj(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let Lj=window||document;function kj(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!Lj)return;let n=Fj._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);let r=e=>{if(!(e&&e.blockedURI&&(Fj.onSecurityPolicyViolation||Fj.getListeners(OR.SECURITY_POLICY_VIOLATION).length>0)))return;let t=e.blockedURI;$v("CSP_DETECTED_HOSTNAME_LIST").some((e=>yr(t).call(t,e)))&&(Fj.onSecurityPolicyViolation&&"function"==typeof Fj.onSecurityPolicyViolation&&Fj.onSecurityPolicyViolation(e),Fj.getListeners(OR.SECURITY_POLICY_VIOLATION).length>0&&Fj.safeEmit(OR.SECURITY_POLICY_VIOLATION,e))};n&&Lj.removeEventListener("securitypolicyviolation",n),(t||e&&"function"==typeof e||Fj.getListeners(OR.SECURITY_POLICY_VIOLATION).length>0)&&Lj.addEventListener("securitypolicyviolation",r),Fj._cspEventHandlerPointer=r}Zv("PROCESS_ID","process-".concat(Sv(8,""),"-").concat(Sv(4,""),"-").concat(Sv(4,""),"-").concat(Sv(4,""),"-").concat(Sv(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void Ey.error("Error loading sdk config",t.message)}if(e)try{let t=JSON.parse(window.atob(e)),n=Date.now();Ey.debug("Loading global parameters from cache",t),Object.keys(t).forEach((e=>{if(Object.prototype.hasOwnProperty.call(qv,e)){let{value:r,expires:i}=t[e];if(i&&i<=n)return;ey[e]=r,qv[e]=r}}))}catch(t){Ey.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(ey.AREAS)&&ey.AREAS.length>0&&Mb(ey.AREAS,!0);let Mj=(e,t,n)=>{Ey.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),Zv(e,t,n)},Fj=function(e){let t=new VT,n=e,r={getListeners:t.getListeners.bind(t),on:(e,n)=>{return r=n,e===OR.SECURITY_POLICY_VIOLATION&&kj(r,!0),t.on.bind(t)(e,n);var r},addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return Uj(Uj({},n),r)}({__TRACK_LIST__:wL,VERSION:Wv,BUILD:zv,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:Mj,getParameter:$v,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection,n=await async function(e){let t;return oL().supportUnifiedPlan?(e.addTransceiver("video",{direction:"recvonly"}),e.addTransceiver("audio",{direction:"recvonly"}),t=(await e.createOffer()).sdp):t=(await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,t}(t);if(!n)return e;t.close(),t=null,e=function(e){let t={video:[],audio:[]};return e.match(/ VP8/i)&&t.video.push("VP8"),e.match(/ VP9/i)&&t.video.push("VP9"),e.match(/ AV1/i)&&t.video.push("AV1"),e.match(/ H264/i)&&t.video.push("H264"),e.match(/ H265/i)&&t.video.push("H265"),e.match(/ opus/i)&&t.audio.push("OPUS"),e.match(/ PCMU/i)&&t.audio.push("PCMU"),e.match(/ PCMA/i)&&t.audio.push("PCMA"),e.match(/ G722/i)&&t.audio.push("G722"),t}(n)}catch(t){throw new HI(TT.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){let e=vy.reportApiInvoke(null,{name:jT.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:GT.TRACER}),t=!1;try{let e=window.RTCPeerConnection,n=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,r=window.WebSocket;t=!!(e&&n&&r),t&&ET()&&function(e){let t=WS();return!(t.name!==HS.CHROME||!t.osVersion)&&Number(t.version)<75}()&&(new e).close()}catch(o){return Ey.error("check system requirement failed: ",o),!1}let n=!1,r=WS();r.name===HS.CHROME&&Number(r.version)>=58&&("WebKit"!==jS.engine.name||function(){let e=WS();if(zS()){if(e.os===VS.MAC_OS)return!0;if(e.os===VS.IOS){let e=jS.os.version&&jS.os.version.split(".");if(e&&14===Number(e[0])&&e[1]&&Number(e[1])>=3||e&&Number(e[0])>14)return!0}}return!1}())&&(n=!0),(r.name===HS.FIREFOX&&Number(r.version)>=56||r.name===HS.OPERA&&Number(r.version)>=45||r.name===HS.SAFARI&&Number(r.version)>=11||"WebKit"===r.name&&(tT()||hT())&&r.osVersion&&Number(r.osVersion.split(".")[0])>=11||pT()||WS().name===HS.QQ)&&(n=!0),Ey.debug("checkSystemRequirements, api:",t,"browser",n);let i=t&&n;return e.onSuccess(i),i},getDevices:function(e){return Ek.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return Ek.getRecordingDevices(e)},getCameras:function(e){return Ek.getCamerasDevices(e)},getElectronScreenSources:Ak,getPlaybackDevices:function(e){return Ek.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"},n=vy.reportApiInvoke(null,{name:jT.CREATE_CLIENT,options:[t],tag:GT.TRACER});try{IT((r=t).codec,"config.codec",["vp8","vp9","av1","h264","h265"]),IT(r.mode,"config.mode",["rtc","live","p2p"]),void 0!==r.audioCodec&&IT(r.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==r.proxyServer&&OT(r.proxyServer,"config.proxyServer",1,1e4),void 0!==r.turnServer&&zT(r.turnServer),void 0!==r.httpRetryConfig&&WT(r.httpRetryConfig),void 0!==r.websocketRetryConfig&&WT(r.websocketRetryConfig)}catch(r){throw n.onError(r),r}var r;return(oT(16,0)||aT(16,0))&&("vp9"===t.codec&&(t.codec="vp8",Ey.debug("browser not support vp9, force use vp8")),Zv("UNSUPPORTED_VIDEO_CODEC",["vp9"])),void 0===t.audioCodec&&(t.audioCodec="opus"),n.onSuccess(),new Rj(Ij(Ij({forceWaitGatewayResponse:!0},t),{},{role:yr(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}))},createCameraVideoTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=$v("CAMERA_CAPTURE_CONFIG"),n=vy.reportApiInvoke(null,{tag:GT.TRACER,name:jT.CREATE_CAM_VIDEO_TRACK,options:[WL({},e),t]});t&&(e.encoderConfig=t);let r=Nk(e),i=Sv(8,"track-cam-"),o=null,a="720p_auto"===e.encoderConfig;Ey.info("start create camera video track with config",JSON.stringify(e),"trackId",i);try{o=(await uk({video:r},i)).getVideoTracks()[0]||null}catch(A){throw n.onError(A),A}if(!o){let e=new vT(TT.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(e),e.throw(Ey)}e.optimizationMode&&pF(i,o,e,EL(e.encoderConfig));let s=new hF(o,e,r,e.scalabiltyMode?mL(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i);return a&&s.startMonitorStats(),n.onSuccess(s.getTrackId()),Ey.info("create camera video success, trackId:",i),s},createCustomVideoTrack:function(e){let t=vy.reportApiInvoke(null,{tag:GT.TRACER,name:jT.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),n=new uF(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?mL(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,Sv(8,"track-cus-"),[vL.CUSTOM_TRACK]);return t.onSuccess(n.getTrackId()),Ey.info("create custom video track success with config",e,"trackId",n.getTrackId()),n},createScreenVideoTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"disable",n=vy.reportApiInvoke(null,{tag:GT.TRACER,name:jT.CREATE_SCREEN_VIDEO_TRACK,options:[WL({},e),t]}),r="720p_auto"===e.encoderConfig;e.encoderConfig?"string"==typeof e.encoderConfig||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";let i=function(e){let t={};e.screenSourceType&&(t.mediaSource=e.screenSourceType),e.extensionId&&qS()&&(t.extensionId=e.extensionId);let{displaySurface:n,selfBrowserSurface:r,surfaceSwitching:i,systemAudio:o}=e;(nT(107)||rT(107)||sT(93))&&(n&&(IT(n,"displaySurface",["browser","window","monitor"]),t.displaySurface=n),r?(IT(r,"selfBrowserSurface",["exclude","include"]),t.selfBrowserSurface=r):t.selfBrowserSurface="include",i&&(IT(i,"surfaceSwitching",["exclude","include"]),t.surfaceSwitching=i)),(nT(105)||rT(105)||sT(91))&&o&&(IT(o,"systemAudio",["exclude","include"]),t.systemAudio=o),e.electronScreenSourceId&&(t.sourceId=e.electronScreenSourceId);let a=e.encoderConfig?gL(e.encoderConfig):null;return t.mandatory={chromeMediaSource:"desktop",maxWidth:a?a.width:void 0,maxHeight:a?a.height:void 0},a&&(a.frameRate&&("number"==typeof a.frameRate?(t.mandatory.maxFrameRate=a.frameRate,t.mandatory.minFrameRate=a.frameRate):(t.mandatory.maxFrameRate=a.frameRate.max||a.frameRate.ideal||a.frameRate.exact||void 0,t.mandatory.minFrameRate=a.frameRate.min||a.frameRate.ideal||a.frameRate.exact||void 0),t.frameRate=a.frameRate),a.width&&(t.width=a.width),a.height&&(t.height=a.height)),t}(e),o=Sv(8,"track-scr-v-"),a=null,s=null,A=oL();if(!A.supportShareAudio&&"enable"===t){let e=new vT(TT.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return n.onError(e),e.throw(Ey)}Ey.info("start create screen video track with config",e,"withAudio",t,"trackId",o);try{let e=await uk({screen:i,screenAudio:"auto"===t?A.supportShareAudio:"enable"===t},o);a=e.getVideoTracks()[0]||null,s=e.getAudioTracks()[0]||null}catch(d){throw n.onError(d),d}if(!a){let e=new vT(TT.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(e),e.throw(Ey)}if(!s&&"enable"===t){a&&a.stop();let e=new vT(TT.SHARE_AUDIO_NOT_ALLOWED);return n.onError(e),e.throw(Ey)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(pF(o,a,e,e.encoderConfig&&gL(e.encoderConfig)||void 0),e.encoderConfig&&"string"!=typeof e.encoderConfig&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));let c=new uF(a,e.encoderConfig?gL(e.encoderConfig):{},e.scalabiltyMode?mL(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,o,[vL.SCREEN_TRACK]);if(r&&c.startMonitorStats(),!s)return n.onSuccess(c.getTrackId()),Ey.info("create screen video track success","video:",c.getTrackId()),c;let l=new SM(s,void 0,Sv(8,"track-scr-a-"),!1);return n.onSuccess([c.getTrackId(),l.getTrackId()]),Ey.info("create screen video track success","video:",c.getTrackId(),"audio:",l.getTrackId()),[c,l]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=$v("CAMERA_CAPTURE_CONFIG"),r=vy.reportApiInvoke(null,{tag:GT.TRACER,name:jT.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);let i="720p_auto"===t.encoderConfig,o=Nk(t),a=Dk(e),s=Sv(8,"track-mic-"),A=Sv(8,"track-cam-"),c=null,l=null;Ey.info("start create camera video track(".concat(A,") and microphone audio track(").concat(s,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{let e=await uk({audio:a,video:o},"".concat(s,"-").concat(A));c=e.getAudioTracks()[0],l=e.getVideoTracks()[0]}catch(h){throw r.onError(h),h}if(!c||!l){let e=new vT(TT.UNEXPECTED_ERROR,"can not find tracks in media stream");return r.onError(e),e.throw(Ey)}t.optimizationMode&&pF(A,l,t,EL(t.encoderConfig));let d=new TM(c,e,a,s),u=new hF(l,t,o,t.scalabiltyMode?mL(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,A);return i&&u.startMonitorStats(),r.onSuccess([d.getTrackId(),u.getTrackId()]),Ey.info("create camera video track(".concat(A,") and microphone audio track(").concat(s,") success")),[d,u]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=vy.reportApiInvoke(null,{tag:GT.TRACER,name:jT.CREATE_MIC_AUDIO_TRACK,options:[e]}),n=Dk(e),r=Sv(8,"track-mic-"),i=null;Ey.info("start create microphone audio track with config",JSON.stringify(e),"trackId",r);try{i=(await uk({audio:n},r)).getAudioTracks()[0]||null}catch(a){throw t.onError(a),a}if(!i){let e=new vT(TT.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(e),e.throw(Ey)}let o=new TM(i,e,n,r);return t.onSuccess(o.getTrackId()),Ey.info("create microphone audio track success, trackId:",r),o},createCustomAudioTrack:function(e){let t=vy.reportApiInvoke(null,{tag:GT.TRACER,name:jT.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),n=new SM(e.mediaStreamTrack,e.encoderConfig?CL(e.encoderConfig):{},Sv(8,"track-cus-"),!1);return Ey.info("create custom audio track success with config",e,"trackId",n.getTrackId()),t.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:async function(e){var t;let{cacheOnlineFile:n,encoderConfig:r}=e,{source:i}=e,o={source:i instanceof AudioBuffer?"AudioBuffer":i instanceof File?null!==(t=File.name)&&void 0!==t?t:"File":i,cacheOnlineFile:n,encoderConfig:r},a=vy.reportApiInvoke(null,{tag:GT.TRACER,name:jT.CREATE_BUFFER_AUDIO_TRACK,options:[o]});if($v("DISABLE_WEBAUDIO"))throw new vT(TT.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");let s=Sv(8,"track-buf-");Ey.info("start create buffer source audio track with config",JSON.stringify(o),"trackId",s);let A=i;if(!(i instanceof AudioBuffer))try{i=await async function(e,t){let n=null;if("string"==typeof e){let t=RM.get(e);if(t)return Ey.debug("use cached audio resource: ",e),t;try{n=(await Fv((()=>LS.get(e,{responseType:"arraybuffer"})),void 0,void 0,{maxRetryCount:3})).data}catch(i){throw new vT(TT.FETCH_AUDIO_FILE_FAILED,i.toString())}}else n=await new wu(((t,n)=>{let r=new FileReader;r.onload=e=>{e.target?t(e.target.result):n(new vT(TT.READ_LOCAL_AUDIO_FILE_ERROR))},r.onerror=()=>{n(new vT(TT.READ_LOCAL_AUDIO_FILE_ERROR))},r.readAsArrayBuffer(e)}));let r=await function(e){let t=ek();return new wu(((n,r)=>{t.decodeAudioData(e,(e=>{n(e)}),(e=>{r(new vT(TT.DECODE_AUDIO_FILE_FAILED,e.toString()))}))}))}(n);return"string"==typeof e&&t&&RM.set(e,r),r}(i,n)}catch(d){return a.onError(d),d.throw(Ey)}let c=new IM(i),l=new vM(A,c,r?CL(r):{},s);return Ey.info("create buffer source audio track success, trackId:",s),a.onSuccess(l.getTrackId()),l},setAppType:function(e){if(Ey.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw Ey.debug("Invalid appType"),new HI(TT.INVALID_PARAMS,"invalid app type",e);Zv("APP_TYPE",Math.floor(e))},setLogLevel:function(e){Ey.setLogLevel(e)},enableLogUpload:function(){$v("USE_NEW_LOG")?Zv("UPLOAD_LOG",!0):Ey.enableLogUpload()},disableLogUpload:function(){$v("USE_NEW_LOG")?Zv("UPLOAD_LOG",!1):Ey.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new eV},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,n=vy.reportApiInvoke(null,{tag:GT.TRACER,name:jT.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof SM||e instanceof OF)){let e=new HI(TT.INVALID_TRACK,"the parameter is not a audio track");return n.onError(e),e.throw()}t&&t<1e3&&(t=1e3);let r=e instanceof SM?e.getTrackLabel():"remote_track",i=e.getVolumeLevel(),o=i,a=i,s=Date.now();return new wu((i=>{let A=setInterval((()=>{let c=e.getVolumeLevel();o=c>o?c:o,a=c<a?c:a;let l=o-a>1e-4,d=Date.now()-s;if(l||d>t){clearInterval(A);let t=l,a={duration:d,deviceLabel:r,maxVolumeLevel:o,result:t};Ey.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(a))),n.onSuccess(a),i(t)}}),200)}))},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,n=vy.reportApiInvoke(null,{tag:GT.TRACER,name:jT.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof uF||e instanceof bF)){let e=new HI(TT.INVALID_TRACK,"the parameter is not a video track");return n.onError(e),e.throw()}t&&t<1e3&&(t=1e3);let r=e instanceof uF?e.getTrackLabel():"remote_track",i=e.getMediaStreamTrack(!0),o=document.createElement("video");o.style.width="1px",o.style.height="1px",o.setAttribute("muted",""),o.muted=!0,o.setAttribute("playsinline",""),o.controls=!1,(ZS()||zS())&&(o.style.opacity="0.01",o.style.position="fixed",o.style.left="0",o.style.top="0",document.body.appendChild(o)),o.srcObject=new MediaStream([i]),o.play();let a=document.createElement("canvas");a.width=160,a.height=120;let s=0,A=0;try{let e=Date.now();s=await function(e,t,n,r){let i,o=0,a=null;return new wu(((r,s)=>{setTimeout((()=>{i&&(i(),r(o))}),t),i=rk((()=>{!function(){o>4&&i&&(i(),r(o));let t=n.getContext("2d");if(!t){let e=new HI(TT.UNEXPECTED_ERROR,"can not get canvas 2d context.");return Ey.error(e.toString()),void s(e)}t.drawImage(e,0,0,160,120);let A=t.getImageData(0,0,n.width,n.height),c=Math.floor(A.data.length/3);if(a){for(let e=0;e<c;e+=3)if(A.data[e]!==a[e])return o+=1,void(a=A.data);a=A.data}else a=A.data}()}),30)}))}(o,t,a),A=Date.now()-e}catch(d){throw n.onError(d),d}pK===HS.SAFARI&&(o.pause(),o.remove()),o.srcObject=null;let c=s>4,l={duration:A,changedPicNum:s,deviceLabel:r,result:c};return Ey.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(l))),n.onSuccess(l),c},setArea:Mb,audioElementPlayCenter:Sk,resumeAudioContext:function(){Sk.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){Dj.processExternalMediaAEC(e)},registerExtensions:function(e){let t=$v("PLUGIN_INFO")||[];e.forEach((e=>{"name"in e&&!yr(t).call(t,e.name)&&t.push(e.name);let n=e;n.__registered__=!0,n.logger.hookLog=Ey.extLog,n.reporter.hookApiInvoke=vy.extApiInvoke,n.parameters&&Object.keys(n.parameters).forEach((e=>{n.parameters[e]=$v(e)}))})),Mj("PLUGIN_INFO",t)},ChannelMediaRelayError:oR,ChannelMediaRelayEvent:rR,ChannelMediaRelayState:iR,RemoteStreamFallbackType:RL,RemoteStreamType:IL,ConnectionDisconnectedReason:JT,AudienceLatencyLevelType:YT,AREAS:dR,preload:async function(e,t,n,r){return RK(e,t,n,r)}});return Object.defineProperties(Fj,{onAudioAutoplayFailed:{get:()=>mk.onAudioAutoplayFailed,set:e=>{mk.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>mk.onAutoplayFailed,set:e=>{mk.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Fj._onSecurityPolicyViolation,set(e){Fj._onSecurityPolicyViolation=e,kj(e)}},__CLIENT_LIST__:{get:()=>$v("SHOW_GLOBAL_CLIENT_LIST")?by:[]}}),Ek.on(QL.CAMERA_DEVICE_CHANGED,(e=>{Ey.info("camera device changed",JSON.stringify(e)),Fj.onCameraChanged&&Fj.onCameraChanged(e),Fj.safeEmit(OR.CAMERA_CHANGED,e)})),Ek.on(QL.RECORDING_DEVICE_CHANGED,(e=>{Ey.info("microphone device changed",JSON.stringify(e)),Fj.onMicrophoneChanged&&Fj.onMicrophoneChanged(e),Fj.safeEmit(OR.MICROPHONE_CHANGED,e)})),Ek.on(QL.PLAYOUT_DEVICE_CHANGED,(e=>{Ey.debug("playout device changed",JSON.stringify(e)),Fj.onPlaybackDeviceChanged&&Fj.onPlaybackDeviceChanged(e),Fj.safeEmit(OR.PLAYBACK_DEVICE_CHANGED,e)})),Sk.onAutoplayFailed=()=>{Ey.info("detect audio element autoplay failed"),mk.onAudioAutoplayFailed&&mk.onAudioAutoplayFailed()},$L.on("autoplay-failed",(()=>{Ey.info("detect webaudio autoplay failed"),mk.onAudioAutoplayFailed&&mk.onAudioAutoplayFailed(),Fj.safeEmit(OR.AUTOPLAY_FAILED)})),$L.on(sL.STATE_CHANGE,((e,t)=>{Ey.info("audio context state changed: ".concat(t," => ").concat(e)),Fj.onAudioContextStateChanged&&Fj.onAudioContextStateChanged(e,t),Fj.safeEmit(OR.AUDIO_CONTEXT_STATE_CHANGED,e,t)})),av.on(tv.NETWORK_STATE_CHANGE,((e,t)=>{Ey.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))})),window&&(window.__ARTC__=Fj),Fj},"object"==typeof e&&typeof t<"u"?t.exports=r():"function"==typeof define&&define.amd?define(r):(n=typeof globalThis<"u"?globalThis:n||self).AgoraRTC=r()},()=>(s||a((s={exports:{}}).exports,s),s.exports)),_={};((e,t)=>{for(var n in t)d(e,n,{get:t[n],enumerable:!0})})(_,{AgoraRTCProvider:()=>P,AgoraRTCReactError:()=>V,AgoraRTCScreenShareProvider:()=>k,LocalAudioTrack:()=>ce,LocalUser:()=>me,LocalVideoTrack:()=>pe,RemoteAudioTrack:()=>_e,RemoteUser:()=>we,RemoteVideoTrack:()=>Ce,TrackBoundary:()=>ae,VERSION:()=>Te,default:()=>ve,useAutoPlayAudioTrack:()=>Ae,useAutoPlayVideoTrack:()=>se,useClientEvent:()=>B,useConnectionState:()=>F,useCurrentUID:()=>Q,useIsConnected:()=>x,useJoin:()=>H,useLocalCameraTrack:()=>q,useLocalMicrophoneTrack:()=>X,useLocalScreenTrack:()=>re,useNetworkQuality:()=>j,usePublish:()=>W,useRTCClient:()=>U,useRTCScreenShareClient:()=>M,useRemoteAudioTracks:()=>Z,useRemoteUserTrack:()=>ee,useRemoteUsers:()=>te,useRemoteVideoTracks:()=>$,useTrackEvent:()=>N,useVolumeLevel:()=>Y});var C=g(m());function w(e,t,n){return e.on(t,n),()=>e.off(t,n)}function S(e){try{return e()}catch(s){console.error(s)}}function T(e){return()=>e.forEach(S)}function v(e,t){let n=setTimeout(e,t);return()=>clearTimeout(n)}function y(){let e,t,n;function r(){if(t){let e=t;t=void 0,e()}}async function i(){if(n){let t=n;n=void 0;try{await t()}catch(e){console.error(e)}}}async function o(t){e=!0,await i();try{n=await t()}catch(o){console.error(o)}e=!1,r()}async function a(){e=!0,await i(),e=!1,r()}return{run:function(n){e?t=()=>o(n):o(n)},dispose:function(){e?t=a:a()}}}var I=typeof document<"u"?A.useLayoutEffect:A.useEffect;function R(){let e=(0,A.useRef)(!1);return(0,A.useEffect)((()=>(e.current=!1,()=>{e.current=!0})),[]),e}function b(e){let t=function(){let e=R();return(0,A.useCallback)((function(t,n){return new Promise((async(r,i)=>{try{let n=await t;e.current||r(n)}catch(o){e.current?n&&n(o):i(o)}}))}),[e])}(),[n,r]=(0,A.useState)();return I((()=>{!function(e){return null!=e&&"function"==typeof e.then}(e)?r(e):t(e).then(r)}),[e,t]),n}function O(e,t){let n=(0,A.useRef)();(0,A.useEffect)((()=>{let{run:t,dispose:r}=n.current||(n.current=y());return t(e),r}),t)}function B(e,t,n){let r=(0,A.useRef)(n);I((()=>{r.current=n}),[n]),(0,A.useEffect)((()=>{if(e)return w(e,t,(function(){r.current&&r.current(...arguments)}))}),[t,e])}function N(e,t,n){let r=(0,A.useRef)(n);I((()=>{r.current=n}),[n]),(0,A.useEffect)((()=>{if(e)return w(e,t,(function(){r.current&&r.current(...arguments)}))}),[t,e])}var D=(0,A.createContext)(null);function P(e){let{client:t,children:n}=e;return(0,c.jsx)(D.Provider,{value:t,children:n})}function U(e){let t=function(e){let t=(0,A.useContext)(D);return e||t}(e);if(!t)throw new Error("Agora RTC client not found. Should be wrapped in <AgoraRTCProvider value={client} />");return t}var L=(0,A.createContext)(null);function k(e){let{client:t,children:n}=e;return(0,c.jsx)(L.Provider,{value:t,children:n})}function M(e){let t=(0,A.useContext)(L);return e||t}function F(e){let t=U(e),[n,r]=(0,A.useState)(t?t.connectionState:"DISCONNECTED");return(0,A.useEffect)((()=>{if(t){let e;return r(t.connectionState),T([w(t,"connection-state-change",(t=>{var n;null!==(n=e)&&void 0!==n&&n(),"CONNECTED"===t?e=v((()=>r(t)),0):r(t)})),()=>{var t;return null===(t=e)||void 0===t?void 0:t()}])}r("DISCONNECTED")}),[t]),n}function x(e){let t=U(e),[n,r]=(0,A.useState)(!!t&&"CONNECTED"===t.connectionState);return(0,A.useEffect)((()=>{if(t){let e;return r("CONNECTED"===t.connectionState),T([w(t,"connection-state-change",(t=>{var n;null!==(n=e)&&void 0!==n&&n(),e=v((()=>r("CONNECTED"===t)),0)})),()=>{var t;return null===(t=e)||void 0===t?void 0:t()}])}r(!1)}),[t]),n}function Q(e){let t=U(e),[n,r]=(0,A.useState)(null===t||void 0===t?void 0:t.uid);return(0,A.useEffect)((()=>{if(t)return w(t,"connection-state-change",(e=>{if("CONNECTED"===e)return v((()=>r(t.uid)),0);"DISCONNECTED"===e&&r(void 0)}))}),[t]),n}var V=class extends Error{constructor(e,t){"string"==typeof t?(super(t),o(this,"rtcMethod",void 0),o(this,"rtcError",void 0),o(this,"name","AgoraRTCReactException")):(super(t.message),o(this,"rtcMethod",void 0),o(this,"rtcError",void 0),o(this,"name","AgoraRTCReactException")),this.rtcMethod=e,this.rtcError=t}log(e){console[e](this)}};function H(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=U(n),i=x(n),o=(0,A.useRef)(),[a,s]=(0,A.useState)(!1),[c,l]=(0,A.useState)(0),[d,u]=(0,A.useState)(null),h=R();return O((async()=>{if(h.current||(u(null),l(0),s(!1)),t&&r){try{h.current||s(!0);let{appid:t,channel:n,token:i,uid:o}="function"==typeof e?await e():e,a=await r.join(t,n,i,o);h.current||l(a)}catch(n){console.error(n),h.current||u(new V("IAgoraRTCClient.join",n))}h.current||s(!1);let t=o.current||(o.current=y());return T([()=>{t.dispose()},()=>{t.run((()=>r.unpublish(r.localTracks)))},()=>{for(let e of r.localTracks)e.isPlaying&&e.stop(),e.close();t.run((()=>r.leave()))}])}}),[t,n]),{data:c,isLoading:a,isConnected:i,error:d}}var K=()=>({uplinkNetworkQuality:0,downlinkNetworkQuality:0,delay:0});function j(e){let t=U(e),[n,r]=(0,A.useState)(K);return(0,A.useEffect)((()=>{if(t)return w(t,"network-quality",(e=>{var n;return r({uplinkNetworkQuality:e.uplinkNetworkQuality,downlinkNetworkQuality:e.downlinkNetworkQuality,delay:null!==(n=t.getRTCStats().RTT)&&void 0!==n?n:0})}));r(K())}),[t]),n}var G=g(m());function W(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=U(n),i=x(n),o=(0,A.useRef)([]),[a,s]=(0,A.useState)(!1),[c,l]=(0,A.useState)(null),d=R();return O((async()=>{if(d.current||(s(!1),l(null)),!r||!i||!t)return;let n=e.filter(Boolean),a=e=>{let t=function(e,t){let n=e.split("."),r=t.split("."),i=Math.max(n.length,r.length);for(let o=0;o<i;o++){let e=parseInt(n[o]||"0"),t=parseInt(r[o]||"0");if(e>t)return 1;if(e<t)return-1}return 0}(G.default.VERSION,"4.18.2")>=0;return t||new V("usePublish","please check your agora-rtc-sdk-ng version in package.json, it's recommend upgrade to >= 4.18.2").log("warn"),!t||("live"!==r.mode||"audience"!==r.role)},A=e=>a()&&e.enabled&&t&&!(e=>o.current.some((t=>t&&t.getTrackId()===e.getTrackId())))(e);for(let e=0;e<n.length;e++){let t=n[e];if(t&&A(t)){await r.unpublish(o.current.filter((e=>(null===e||void 0===e?void 0:e.trackMediaType)===t.trackMediaType)));try{d.current||s(!0),await r.publish(t)}catch(c){console.error(c),d.current||l(new V("IAgoraRTCClient.publish",c))}d.current||s(!1)}}o.current=n}),[i,t,r,e]),{isLoading:a,error:c}}function Y(e){let[t,n]=(0,A.useState)(0);return(0,A.useEffect)((()=>{if(e)return function(e,t){let n=setInterval(e,t);return()=>clearInterval(n)}((()=>{n(e.getVolumeLevel())}),1e3)}),[e]),t}var J=g(m());function X(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ANS:!0,AEC:!0},n=x(arguments.length>2?arguments[2]:void 0),[r,i]=(0,A.useState)(null),[o,a]=(0,A.useState)(!1),[s,c]=(0,A.useState)(null),l=R();return O((async()=>{if(l.current||(a(!1),c(null)),n&&e&&!r){try{l.current||a(!0);let e=await J.default.createMicrophoneAudioTrack(t);l.current||i(e)}catch(o){console.error(o),l.current||c(new V("IAgoraRTC.createMicrophoneAudioTrack",o))}l.current||a(!1)}!n&&!l.current&&i(null)}),[n,e]),{localMicrophoneTrack:r,isLoading:o,error:s}}var z=g(m());function q(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=x(arguments.length>2?arguments[2]:void 0),[r,i]=(0,A.useState)(null),[o,a]=(0,A.useState)(!1),[s,c]=(0,A.useState)(null),l=R();return O((async()=>{if(l.current||(a(!1),c(null)),n&&e&&!r){try{l.current||a(!0);let e=await z.default.createCameraVideoTrack(t);l.current||i(e)}catch(o){console.error(o),l.current||c(new V("IAgoraRTC.createCameraVideoTrack",o))}l.current||a(!1)}!n&&!l.current&&i(null)}),[n,e]),{localCameraTrack:r,isLoading:o,error:s}}function Z(e,t){let n=U(t),[r,i]=(0,A.useState)([]),o=x(),a=(0,A.useRef)([]),[s,c]=(0,A.useState)(!1),[l,d]=(0,A.useState)(null),u=R();return O((async()=>{if(u.current||d(null),!Array.isArray(e)||!o)return;let t=async t=>{if(!t.audioTrack&&e.some((e=>{let{uid:n}=e;return t.uid===n}))){try{u.current||c(!0),await n.subscribe(t,"audio")}catch(r){console.error(r),u.current||d(new V("IAgoraRTCClient.subscribe",r))}t.audioTrack&&!a.current.some((e=>e.getUserId()===t.uid))&&a.current.push(t.audioTrack),a.current=a.current.map((e=>t.audioTrack&&e.getUserId()===t.uid&&e.getTrackId()!==t.audioTrack.getTrackId()?t.audioTrack:e)),u.current||(i([...a.current]),c(!1))}};e.map((e=>{!e.audioTrack&&e.hasAudio&&t(e)}));let r=[];for(let i=0;i<a.current.length;i++){let t=a.current[i];if(!e.some((e=>e.uid===t.getUserId()))){let e=n.remoteUsers.find((e=>e.uid===t.getUserId()));e&&r.push({user:e,mediaType:"audio"}),a.current.splice(i,1),i--}}if(r.length>0){try{u.current||c(!0),await n.massUnsubscribe(r)}catch(s){console.error(s),u.current||d(new V("IAgoraRTCClient.massUnsubscribe",s))}u.current||(i(a.current.slice()),c(!1))}return T([w(n,"user-published",((n,r)=>{e.find((e=>e.uid===n.uid))&&"audio"===r&&t(n)})),w(n,"user-unpublished",((t,r)=>{e.find((e=>e.uid===t.uid))&&"audio"===r&&(async t=>{if(e.some((e=>{let{uid:n}=e;return t.uid===n}))){u.current||(a.current=a.current.filter((e=>e.getUserId()!==t.uid)),i([...a.current]));try{u.current||c(!0),await n.unsubscribe(t,"audio")}catch(r){console.error(r),u.current||d(new V("IAgoraRTCClient.unsubscribe",r))}u.current||c(!1)}})(t)}))])}),[o,n,e]),{audioTracks:r,isLoading:s,error:l}}function $(e,t){let n=U(t),[r,i]=(0,A.useState)([]),o=x(),a=(0,A.useRef)([]),[s,c]=(0,A.useState)(!1),[l,d]=(0,A.useState)(null),u=R();return O((async()=>{if(u.current||d(null),!Array.isArray(e)||!o)return;let t=async t=>{if(!t.videoTrack&&e.some((e=>{let{uid:n}=e;return t.uid===n}))){try{u.current||c(!0),await n.subscribe(t,"video")}catch(r){console.error(r),u.current||d(new V("IAgoraRTCClient.subscribe",r))}t.videoTrack&&!a.current.some((e=>e.getUserId()===t.uid))&&a.current.push(t.videoTrack),a.current=a.current.map((e=>t.videoTrack&&e.getUserId()===t.uid&&e.getTrackId()!==t.videoTrack.getTrackId()?t.videoTrack:e)),u.current||(i([...a.current]),c(!1))}};e.map((e=>{!e.videoTrack&&e.hasVideo&&t(e)}));let r=[];for(let i=0;i<a.current.length;i++){let t=a.current[i];if(!e.some((e=>e.uid===t.getUserId()))){let e=n.remoteUsers.find((e=>e.uid===t.getUserId()));e&&r.push({user:e,mediaType:"video"}),a.current.splice(i,1),i--}}if(r.length>0){try{u.current||c(!0),await n.massUnsubscribe(r)}catch(s){console.error(s),u.current||d(new V("IAgoraRTCClient.massUnsubscribe",s))}u.current||(i(a.current.slice()),c(!1))}return T([w(n,"user-published",((n,r)=>{e.find((e=>e.uid===n.uid))&&"video"===r&&t(n)})),w(n,"user-unpublished",((t,r)=>{e.find((e=>e.uid===t.uid))&&"video"===r&&(async t=>{if(e.some((e=>{let{uid:n}=e;return t.uid===n}))){u.current||(a.current=a.current.filter((e=>e.getUserId()!==t.uid)),i([...a.current]));try{u.current||c(!0),await n.unsubscribe(t,"video")}catch(r){console.error(r),u.current||d(new V("IAgoraRTCClient.unsubscribe",r))}u.current||c(!1)}})(t)}))])}),[o,n,e]),{videoTracks:r,isLoading:s,error:l}}function ee(e,t,n){let r=U(n),i="audio"===t?"audioTrack":"videoTrack",[o,a]=(0,A.useState)(e&&e[i]),s=x(),c=(0,A.useRef)(),[l,d]=(0,A.useState)(!1),[u,h]=(0,A.useState)(null);return(0,A.useEffect)((()=>{if(!e||!s)return;let n=!1;n||h(null);let o="audio"===t?"hasAudio":"hasVideo",A=e.uid,l=async(e,t)=>{try{!e[i]&&r.remoteUsers.some((t=>{let{uid:n}=t;return e.uid===n}))&&(n||d(!0),await r.subscribe(e,t)),n||a(e[i])}catch(o){n||h(new V("IAgoraRTCClient.subscribe",o)),console.error(o)}n||d(!1)},u=c.current||(c.current=y());return!e[i]&&e[o]?u.run((()=>l(e,t))):a(e[i]),T([()=>{n=!0,u.dispose()},w(r,"user-published",((e,n)=>{e.uid===A&&n===t&&u.run((()=>l(e,t)))})),w(r,"user-unpublished",((e,o)=>{e.uid===A&&o===t&&u.run((()=>(async(e,t)=>{if(e[i]&&r.remoteUsers.some((t=>{let{uid:n}=t;return e.uid===n})))try{n||d(!0),await r.unsubscribe(e,t)}catch(o){n||h(new V("IAgoraRTCClient.unsubscribe",o)),console.error(o)}n||(a(void 0),d(!1))})(e,t)))}))])}),[s,r,e,t,i]),{track:o,isLoading:l,error:u}}function te(e){let t=U(e),[n,r]=(0,A.useState)(t?t.remoteUsers:[]);return(0,A.useEffect)((()=>{if(t){let e=()=>r(t.remoteUsers.slice());return T([w(t,"user-joined",e),w(t,"user-left",e),w(t,"user-published",e),w(t,"user-unpublished",e)])}}),[t]),n}var ne=g(m());function re(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=x(arguments.length>3?arguments[3]:void 0),[i,o]=(0,A.useState)(null),[a,s]=(0,A.useState)(!1),[c,l]=(0,A.useState)(null),d=R();return O((async()=>{if(d.current||(s(!1),l(null)),r&&e&&!i){try{d.current||s(!0);let e=await ne.default.createScreenVideoTrack(t,n);d.current||o(e)}catch(a){console.error(a),d.current||l(new V("IAgoraRTC.createScreenVideoTrack",a))}d.current||s(!1)}(!r||!e)&&!d.current&&o(null)}),[r,e]),{screenTrack:i,isLoading:a,error:c}}function ie(){let e=new Map;return{onMount:t=>{let n=e.get(t);n&&(n(),e.delete(t))},onUnmount:t=>{let n=e.get(t);n&&n(),e.set(t,v((()=>{t.isPlaying&&t.stop(),e.delete(t)}),1500))},dispose:()=>{for(let[t,n]of e)t.isPlaying&&t.stop(),n&&n();e.clear()}}}var oe=(0,A.createContext)(void 0);function ae(e){let{children:t}=e,[n]=(0,A.useState)(ie);return(0,A.useEffect)((()=>n.dispose),[n]),(0,c.jsx)(oe.Provider,{value:n,children:t})}function se(e,t,n,r){let i=(0,A.useContext)(oe);(0,A.useEffect)((()=>{if(e)return r&&t?e.play(r,n||void 0):e.stop(),i?(i.onMount(e),()=>i.onUnmount(e)):()=>{e.isPlaying&&e.stop()}}),[e,r,t,i,n])}function Ae(e,t){let n=(0,A.useContext)(oe);I((()=>{if(e)return t?e.play():e.stop(),n?(n.onMount(e),()=>n.onUnmount(e)):()=>{e.isPlaying&&e.stop()}}),[e,t,n])}function ce(e){let{track:t,play:n=!1,volume:r,disabled:i,muted:o,children:a}=e,s=b(t);return Ae(s,n),(0,A.useEffect)((()=>{s&&null!=r&&s.setVolume(r)}),[s,r]),(0,A.useEffect)((()=>{s&&null!=i&&s.setEnabled(!i).catch(console.warn)}),[i,s]),(0,A.useEffect)((()=>{s&&null!=o&&s.setMuted(o).catch(console.warn)}),[o,s]),a?(0,c.jsx)(c.Fragment,{children:a}):null}var le={position:"relative",width:"100%",height:"100%",overflow:"hidden",background:"#000"},de={width:"100%",height:"100%"},ue={position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"hidden",zIndex:2},he=(e,t)=>(0,A.useMemo)((()=>({...e,...t})),[e,t]);function pe(e){let{track:t,play:n,disabled:r,muted:i,style:o,videoPlayerConfig:a,...s}=e,l=he(de,o),[d,u]=(0,A.useState)(null),h=b(t);return se(h,n,a,d),(0,A.useEffect)((()=>{h&&null!=r&&h.setEnabled(!r).catch(console.warn)}),[r,h]),(0,A.useEffect)((()=>{h&&null!=i&&h.setMuted(i).catch(console.warn)}),[i,h]),(0,c.jsx)("div",{...s,ref:u,style:l})}var fe={width:"100%",height:"100%",background:"#1a1e21 center/cover no-repeat",filter:"blur(16px) brightness(0.4)"},Ee={position:"absolute",top:"50%",left:"50%",maxWidth:"50%",maxHeight:"50%",aspectRatio:"1",transform:"translate(-50%, -50%)",borderRadius:"50%",overflow:"hidden",objectFit:"cover"};function ge(e){let{cover:t}=e;return(0,c.jsx)("div",{style:ue,children:"string"==typeof t?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{style:{...fe,backgroundImage:"url(".concat(t,")")}}),(0,c.jsx)("img",{src:t,style:Ee})]}):t()})}function me(e){var t,n;let{micOn:r,cameraOn:i,audioTrack:o,videoTrack:a,playAudio:s,playVideo:A,volume:l,cover:d,children:u,style:h,...p}=e,f=he(le,h);return A=null!==(t=A)&&void 0!==t?t:!!i,s=null!==(n=s)&&void 0!==n?n:!!r,(0,c.jsxs)("div",{...p,style:f,children:[(0,c.jsx)(pe,{disabled:!i,play:A,track:a}),(0,c.jsx)(ce,{disabled:!r,play:s,track:o,volume:l}),d&&!i&&(0,c.jsx)(ge,{cover:d}),(0,c.jsx)("div",{style:ue,children:u})]})}function _e(e){let{track:t,play:n=!1,playbackDeviceId:r,volume:i,children:o}=e;return Ae(t,n),(0,A.useEffect)((()=>{t&&null!=r&&t.setPlaybackDevice(r).catch(console.warn)}),[t,r]),(0,A.useEffect)((()=>{t&&null!=i&&t.setVolume(i)}),[t,i]),o?(0,c.jsx)(c.Fragment,{children:o}):null}function Ce(e){let{track:t,play:n,style:r,videoPlayerConfig:i,...o}=e,a=he(de,r),[s,l]=(0,A.useState)(null);return se(t,n,i,s),(0,c.jsx)("div",{...o,ref:l,style:a})}function we(e){var t,n;let{user:r,playVideo:i,playAudio:o,playbackDeviceId:a,volume:s,cover:A,style:l,children:d,videoPlayerConfig:u,...h}=e,p=he(le,l),{track:f}=ee(r,"video"),{track:E}=ee(r,"audio");return i=null!==(t=i)&&void 0!==t?t:null===r||void 0===r?void 0:r.hasVideo,o=null!==(n=o)&&void 0!==n?n:null===r||void 0===r?void 0:r.hasAudio,(0,c.jsxs)("div",{...h,style:p,children:[(0,c.jsx)(Ce,{play:i,track:f,videoPlayerConfig:u}),(0,c.jsx)(_e,{play:o,playbackDeviceId:a,track:E,volume:s}),A&&!i&&(0,c.jsx)(ge,{cover:A}),(0,c.jsx)("div",{style:ue,children:d})]})}var Se=g(m());new class{constructor(){o(this,"appType",1001),Se.default.setAppType(this.appType)}};var Te="2.2.0";((e,t,n)=>{E(e,t,"default")})(_,g(m()));var ve=C.default}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}n.m=e,(()=>{var e="function"===typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"===typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",r="function"===typeof Symbol?Symbol("webpack error"):"__webpack_error__",i=e=>{e&&e.d<1&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))};n.a=(n,o,a)=>{var s;a&&((s=[]).d=-1);var A,c,l,d=new Set,u=n.exports,h=new Promise(((e,t)=>{l=t,c=e}));h[t]=u,h[e]=e=>(s&&e(s),d.forEach(e),h.catch((e=>{}))),n.exports=h,o((n=>{var o;A=(n=>n.map((n=>{if(null!==n&&"object"===typeof n){if(n[e])return n;if(n.then){var o=[];o.d=0,n.then((e=>{a[t]=e,i(o)}),(e=>{a[r]=e,i(o)}));var a={};return a[e]=e=>e(o),a}}var s={};return s[e]=e=>{},s[t]=n,s})))(n);var a=()=>A.map((e=>{if(e[r])throw e[r];return e[t]})),c=new Promise((t=>{(o=()=>t(a)).r=0;var n=e=>e!==s&&!d.has(e)&&(d.add(e),e&&!e.d&&(o.r++,e.push(o)));A.map((t=>t[e](n)))}));return o.r?c:a()}),(e=>(e?l(h[r]=e):c(u),i(s)))),s&&s.d<0&&(s.d=0)}})(),n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,i){if(1&i&&(r=this(r)),8&i)return r;if("object"===typeof r&&r){if(4&i&&r.__esModule)return r;if(16&i&&"function"===typeof r.then)return r}var o=Object.create(null);n.r(o);var a={};e=e||[null,t({}),t([]),t(t)];for(var s=2&i&&r;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach((e=>a[e]=()=>r[e]));return a.default=()=>r,n.d(o,a),o}})(),n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,r)=>(n.f[r](e,t),t)),[])),n.u=e=>"static/js/"+e+".6f2fe795.chunk.js",n.miniCssF=e=>{},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="signcomreact:";n.l=(r,i,o,a)=>{if(e[r])e[r].push(i);else{var s,A;if(void 0!==o)for(var c=document.getElementsByTagName("script"),l=0;l<c.length;l++){var d=c[l];if(d.getAttribute("src")==r||d.getAttribute("data-webpack")==t+o){s=d;break}}s||(A=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,n.nc&&s.setAttribute("nonce",n.nc),s.setAttribute("data-webpack",t+o),s.src=r),e[r]=[i];var u=(t,n)=>{s.onerror=s.onload=null,clearTimeout(h);var i=e[r];if(delete e[r],s.parentNode&&s.parentNode.removeChild(s),i&&i.forEach((e=>e(n))),t)return t(n)},h=setTimeout(u.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=u.bind(null,s.onerror),s.onload=u.bind(null,s.onload),A&&document.head.appendChild(s)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/signcomreact/",(()=>{var e={792:0};n.f.j=(t,r)=>{var i=n.o(e,t)?e[t]:void 0;if(0!==i)if(i)r.push(i[2]);else{var o=new Promise(((n,r)=>i=e[t]=[n,r]));r.push(i[2]=o);var a=n.p+n.u(t),s=new Error;n.l(a,(r=>{if(n.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var o=r&&("load"===r.type?"missing":r.type),a=r&&r.target&&r.target.src;s.message="Loading chunk "+t+" failed.\n("+o+": "+a+")",s.name="ChunkLoadError",s.type=o,s.request=a,i[1](s)}}),"chunk-"+t,t)}};var t=(t,r)=>{var i,o,a=r[0],s=r[1],A=r[2],c=0;if(a.some((t=>0!==e[t]))){for(i in s)n.o(s,i)&&(n.m[i]=s[i]);if(A)A(n)}for(t&&t(r);c<a.length;c++)o=a[c],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0},r=self.webpackChunksigncomreact=self.webpackChunksigncomreact||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();n(812)})();
//# sourceMappingURL=main.eb86453a.js.map